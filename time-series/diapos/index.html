<!DOCTYPE html>
<html lang="es"><head>
<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/tabby.min.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.3.450">

  <meta name="author" content="Grado en Estad√≠stica Aplicada ‚Ä¢ Javier √Ålvarez Li√©bana">
  <title>Series temporales</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/theme/quarto.css">
  <link href="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="img/time-series.jpg" data-background-opacity="0.35" data-background-size="cover" class="quarto-title-block center">
  <h1 class="title">Series temporales</h1>
  <p class="subtitle">An√°lisis de series temporales en R</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Grado en Estad√≠stica Aplicada ‚Ä¢ Javier √Ålvarez Li√©bana 
</div>
</div>
</div>

</section>
<section class="slide level2">

<div class="r-fit-text">
<p><span class="flow">¬°Bienvenidos a la nave del tiempo!</span></p>
</div>
<p><span style="color:#444442;"><strong>Dejad vuestras regresiones a un lado</strong></span></p>
</section>
<section id="buenas" class="slide level2">
<h2>¬°Buenas!</h2>
<p><span class="hl-green"><strong>Correo</strong></span>: <strong><a href="mailto:javalv09@ucm.es" class="email">javalv09@ucm.es</a></strong>. <span class="hl-green"><strong>Despacho</strong></span>: 722 (3¬™ planta). <span class="hl-green"><strong>Tutor√≠as (curso 2024-2025)</strong></span>: ‚Ä¶</p>
<div class="columns">
<div class="column" style="width:30%;">
<p><img data-src="img/me.jpeg"></p>
</div><div class="column" style="width:70%;">
<div>
<ul>
<li class="fragment"><p><span class="hl-yellow"><strong>Javier √Ålvarez Li√©bana</strong></span>, de Carabanchel (Bajo).</p></li>
<li class="fragment"><p>Licenciado en Matem√°ticas (UCM). <span class="hl-yellow"><strong>Doctorado en estad√≠stica</strong></span> (UGR).</p></li>
<li class="fragment"><p>Encargado de la <span class="hl-yellow"><strong>visualizaci√≥n y an√°lisis de datos covid</strong></span> del Principado de Asturias (2021-2022).</p></li>
<li class="fragment"><p>Miembro de la <span class="hl-yellow"><strong>Sociedad Espa√±ola de Estad√≠stica e IO</strong></span> y la <span class="hl-yellow"><strong>Real Sociedad Matem√°tica Espa√±ola</strong></span>.</p></li>
</ul>
</div>
</div>
</div>
<p>Actualmente, <span class="hl-yellow"><strong>investigador y docente en la Facultad de Estad√≠stica de la UCM</strong></span>. Divulgando por <a href="https://twitter.com/dadosdelaplace"><strong>Twitter</strong></a> e <a href="https://instagram.com/javieralvarezliebana"><strong>Instagram</strong></a></p>
</section>
<section id="objetivos" class="slide level2">
<h2>Objetivos</h2>
<div class="columns">
<div class="column" style="width:37%;">
<p><img data-src="https://assets-global.website-files.com/6092cb6b4ac959f39728dd26/6188a97fa499b5fbfe410417_target%20(1).png"></p>
</div><div class="column" style="width:63%;">
<div>
<ul>
<li class="fragment"><p>Entender el <span class="hl-yellow"><strong>concepto de serie temporal y sus diferencias con la regresi√≥n</strong></span> ‚Üí lo que te equivocaste ayer influye en lo que te equivocar√°s hoy</p></li>
<li class="fragment"><p>Entender conceptos te√≥ricos b√°sicos de <span class="hl-yellow"><strong>procesos estoc√°sticos</strong></span></p></li>
<li class="fragment"><p>Aprender a manejar <span class="hl-yellow"><strong>paquetes estad√≠sticos de R</strong></span> de series temporales ‚Üí la aplicabilidad de la teor√≠a ser√° tu valor en el futuro</p></li>
<li class="fragment"><p>Introducirnos en la <span class="hl-yellow"><strong>metodolog√≠a Box-Jenkins</strong></span> ‚Üí los datos deben ser estacionarios</p></li>
</ul>
</div>
</div>
</div>
</section>
<section id="evaluaci√≥n" class="slide level2">
<h2>Evaluaci√≥n</h2>
<ul>
<li><span class="hl-yellow"><strong>Evaluaci√≥n continua</strong></span>: <span class="hl-purple"><strong>3 entregas individuales a ordenador en clase (20%-25%-35%)</strong></span>, y una <span class="hl-purple"><strong>entrega individual te√≥rica a papel en clase (20%)</strong></span>. <span class="hl-yellow"><strong>Asistencia</strong></span> no obligatoria pero se <span class="hl-purple"><strong>valorar√° positivamente</strong></span> la participaci√≥n.</li>
</ul>
<div class="fragment">
<ul>
<li><p><span class="hl-yellow"><strong>Examen final</strong></span>: la nota ponderar√° en funci√≥n de tu evaluaci√≥n continua.</p>
<ul>
<li><span class="hl-purple"><strong>M√°s de un 7</strong></span> -&gt; podr√°s decidir <strong>peso del final entre un 0% y un 100%</strong> de la nota (es decir, <span class="hl-yellow"><strong>no ser√° obligatorio el final</strong></span>).</li>
<li><span class="hl-purple"><strong>Entre 6 y 7</strong></span> -&gt; podr√°s decidir <strong>peso del final entre un 35% y un 100%</strong>.</li>
<li><span class="hl-purple"><strong>Entre 5 y 6</strong></span> -&gt; podr√°s decidir <strong>peso del final entre un 60% y un 100%</strong>.</li>
<li><span class="hl-purple"><strong>Entre 3.5 y 5</strong></span> -&gt; podr√°s decidir <strong>peso del final entre un 80% y un 100%</strong>.</li>
<li><span class="hl-purple"><strong>Por debajo del 3.5</strong></span> -&gt; el <strong>peso del final ser√° del 100%</strong></li>
</ul></li>
</ul>
<p>Si tienes que hacer el examen final, ser√° <strong>obligatorio presentarse y sacar m√°s de un 3</strong> para aprobar.</p>
</div>
</section>
<section id="planificaci√≥n-entregas" class="slide level2">
<h2>Planificaci√≥n entregas</h2>
<ul>
<li><p><span class="hl-yellow"><strong>Entrega I (20%)</strong></span>: 8 de octubre (120 minutos).</p></li>
<li><p><span class="hl-yellow"><strong>Entrega II (25%)</strong></span>: ‚Ä¶ (120 minutos).</p></li>
<li><p><span class="hl-yellow"><strong>Entrega III (35%)</strong></span>: ‚Ä¶ (120 minutos).</p></li>
<li><p><span class="hl-yellow"><strong>Entrega te√≥rica (20%)</strong></span>: ‚Ä¶ (120 minutos).</p></li>
</ul>
<p>&nbsp;</p>
<ul>
<li><span class="hl-yellow"><strong>Examen final</strong></span>: 14 de enero (10:00-13:30)</li>
</ul>
<p>&nbsp;</p>
<p>Se podr√°n modificar las fechas por saturaci√≥n con otras asignaturas siempre y cuando el/la delegado/a lo solicite con <strong>m√°s de 7 d√≠as de antelaci√≥n</strong>.</p>
</section>
<section id="planificacion" class="slide level2">
<h2>Planificaci√≥n</h2>
<div class="column-screen-inset-right">
<div style="font-size:20px">
<table>
<thead>
<tr class="header">
<th style="text-align: center;">CLASE</th>
<th style="text-align: center;">SEMANA</th>
<th style="text-align: center;">FECHAS</th>
<th style="text-align: center;">TOPIC</th>
<th style="text-align: center;">EJ.</th>
<th style="text-align: center;">WORKBOOK</th>
<th style="text-align: center;">ENTREGA</th>
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><a href="#/clase-1">1-2</a></td>
<td style="text-align: center;">S1</td>
<td style="text-align: center;">9-12 sep</td>
<td style="text-align: center;">Repaso de R</td>
<td style="text-align: center;"><a href="#/tu-turno-1-1">üíª</a> <a href="#/tu-turno-1-2">üíª</a> <a href="#/tu-turno-1-3">üíª</a> <a href="#/tu-turno-1-4">üíª</a> <a href="#/tu-turno-1-5">üíª</a></td>
<td style="text-align: center;"><a href="#/caso-practico-1-1">üê£</a> <a href="#/caso-practico-1-2">üê£</a> <a href="#/caso-practico-1-3">üê£</a></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;"><a href="#/clase-2">3</a></td>
<td style="text-align: center;">S1</td>
<td style="text-align: center;">12 sep</td>
<td style="text-align: center;">Repaso de estad√≠stica</td>
<td style="text-align: center;"><a href="#/tu-turno-2-1">üíª</a> <a href="#/tu-turno-2-2">üíª</a></td>
<td style="text-align: center;"><a href="#/caso-practico-2">üê£</a></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="materiales" class="slide level2">
<h2>Materiales</h2>
<ul>
<li><span class="hl-yellow"><strong>Diapositivas</strong></span>: diapositivas en <code>Quarto</code> disponibles y actualizadas en <strong><a href="https://javieralvarezliebana.es/docencia/time-series" class="uri">https://javieralvarezliebana.es/docencia/time-series</a></strong>. En el men√∫ de las diapositivas (abajo a la izquierda) tienes una <span class="hl-yellow"><strong>opci√≥n para descargarlas en pdf</strong></span> en <code>Tools</code></li>
</ul>
<p>&nbsp;</p>
<ul>
<li><p><span class="hl-yellow"><strong>Material</strong></span>: <a href="https://javieralvarezliebana.es/docencia/time-series/material/"><strong>cuadernos de trabajo</strong></a> y materiales extras y <strong>res√∫menes de paquetes</strong></p></li>
<li><p><span class="hl-yellow">üóÉ <strong>Datos</strong></span>: datasets que usaremos a lo largo de la asignatura, disponibles en <strong><a href="https://javieralvarezliebana.es/docencia/time-series/material" class="uri">https://javieralvarezliebana.es/docencia/time-series/material</a></strong></p></li>
<li><p><span class="hl-yellow">üìö <strong>Recursos de apoyo</strong></span>: en ingl√©s <a href="https://r4ds.had.co.nz/" class="uri">https://r4ds.had.co.nz/</a> y en castellano <a href="https://cdr-book.github.io/" class="uri">https://cdr-book.github.io/</a>, y <a href="https://ivelasq.quarto.pub/intro-to-quarto/" class="uri">https://ivelasq.quarto.pub/intro-to-quarto/</a> para Quarto.</p></li>
</ul>
</section>
<section id="datasets" class="slide level2">
<h2>Datasets</h2>
<ul>
<li><span class="hl-yellow">üóÉ <strong>Datos</strong></span>: datasets que usaremos a lo largo de la asignatura, disponibles en <strong><a href="https://javieralvarezliebana.es/docencia/time-series/material" class="uri">https://javieralvarezliebana.es/docencia/time-series/material</a></strong></li>
</ul>
<p>&nbsp;</p>
<ul>
<li><code>airquality</code> del paquete <code>{datasets}</code> (ya instalado por defecto): medidas diarias (153 observaciones) de la calidad del aire en Nueva York, de mayo a septiembre de 1973. Se midieron <strong>6 variables</strong>: ozono, radiaci√≥n solar, viento, temperatura, mes y d√≠a.</li>
</ul>
</section>
<section>
<section id="clase-1" class="title-slide slide level1 center">
<h1>Clases 1 y 2: <span class="flow">objetivos y repaso R</span></h1>
<p><span style="color:#444442;"><strong>Objetivos. Repaso de R</strong></span></p>
<ul>
<li><a href="#/tu-turno-1-1">üíª Ejercicios resueltos: repaso R</a>. <a href="#/tu-turno-1-2">üíª Ejercicios resueltos: manejo de tibble</a></li>
<li><a href="#/caso-practico-1-1">üê£ Workbook/caso pr√°ctico I</a></li>
<li><a href="#/tu-turno-1-3">üíª Ejercicios resueltos: if-else y bucles</a></li>
<li><a href="#/caso-practico-1-2">üê£ Workbook/caso pr√°ctico II</a></li>
<li><a href="#/tu-turno-1-4">üíª Ejercicios resueltos: funciones</a>. <a href="#/tu-turno-1-5">üíª Ejercicios resueltos: tidy data</a></li>
<li><a href="#/caso-practico-1-3">üê£ Workbook/caso pr√°ctico III</a></li>
<li><a href="#/planificacion">üìÜ Planificaci√≥n</a></li>
</ul>
</section>
<section id="qu√©-es-una-serie-temporal" class="slide level2">
<h2>¬øQu√© es una serie temporal?</h2>
<p>Durante la carrera es probable que hayas tratado con multitud de datos pero hay uno muy especial que trataremos en esta asignatura de manera diferente: las <span class="hl-yellow"><strong>series temporales</strong></span>.</p>
<div class="fragment">
<p>Vamos a cargar el fichero <code>retiro_temp.csv</code> donde tenemos los datos de temperaturas diarios (AEMET) desde 1980 hasta 2024 de la estaci√≥n instalada en El Retiro (Madrid).</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(readr) <span class="co"># de tidyverse</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co"># en tidyverse, read_ en lugar de read.</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co"># tendremos datos en formato tibble en lugar de data.frame</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>retiro <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">"./datos/retiro_temp.csv"</span>)</span>
<span id="cb1-5"><a href="#cb1-5"></a>retiro</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16,314 √ó 8
   fecha      id_station nombre         provincia altitud  tmed  tmin  tmax
   &lt;date&gt;          &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 2000-01-01       3195 MADRID, RETIRO MADRID        667   5.4   0.3  10.4
 2 2000-01-02       3195 MADRID, RETIRO MADRID        667   5     0.3   9.6
 3 2000-01-03       3195 MADRID, RETIRO MADRID        667   3.5   0.1   6.9
 4 2000-01-04       3195 MADRID, RETIRO MADRID        667   4.3   1.4   7.2
 5 2000-01-05       3195 MADRID, RETIRO MADRID        667   0.6  -0.4   1.6
 6 2000-01-06       3195 MADRID, RETIRO MADRID        667   3.8  -1.1   8.8
 7 2000-01-07       3195 MADRID, RETIRO MADRID        667   6.2   0.6  11.7
 8 2000-01-08       3195 MADRID, RETIRO MADRID        667   5.4  -0.1  11  
 9 2000-01-09       3195 MADRID, RETIRO MADRID        667   5.5   3     8  
10 2000-01-10       3195 MADRID, RETIRO MADRID        667   4.8   1.8   7.8
# ‚Ñπ 16,304 more rows</code></pre>
</div>
</div>
</div>
</section>
<section id="qu√©-es-una-serie-temporal-1" class="slide level2">
<h2>¬øQu√© es una serie temporal?</h2>
<p>¬øQu√© analizar de estos datos?</p>
<div class="fragment">
<div class="columns">
<div class="column" style="width:20%;">
<p>Podemos por ejemplo visualizar un <span class="hl-yellow"><strong>boxplot de las temperaturas medias de cada d√≠a</strong></span> durante estos √∫ltimos 44 a√±os‚Ä¶</p>
</div><div class="column" style="width:80%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">ggplot</span>(retiro) <span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> tmed)) <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>                       scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">suffix =</span> <span class="st">"¬∫C"</span>)) <span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Temperatura desde 1980 hasta 2024"</span>,</span>
<span id="cb3-8"><a href="#cb3-8"></a>       <span class="at">x =</span> <span class="st">"Cuatrimestre"</span>, <span class="at">y =</span> <span class="st">"Temperatura media diaria"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-2-1.png" width="960"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="qu√©-es-una-serie-temporal-2" class="slide level2">
<h2>¬øQu√© es una serie temporal?</h2>
<div class="columns">
<div class="column" style="width:20%;">
<p>‚Ä¶ la densidad de la temperatura durante todo ese tiempo‚Ä¶</p>
</div><div class="column" style="width:80%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">ggplot</span>(retiro) <span class="sc">+</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> tmed)) <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>                       scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">suffix =</span> <span class="st">"¬∫C"</span>)) <span class="sc">+</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Temperatura desde 1980 hasta 2024"</span>,</span>
<span id="cb4-7"><a href="#cb4-7"></a>       <span class="at">x =</span> <span class="st">"Temperatura media diaria"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-3-1.png" width="960"></p>
</div>
</div>
</div>
</div>
</section>
<section id="qu√©-es-una-serie-temporal-3" class="slide level2">
<h2>¬øQu√© es una serie temporal?</h2>
<div class="columns">
<div class="column" style="width:20%;">
<p>‚Ä¶ pero tambi√©n podr√≠amos querer <span class="hl-yellow"><strong>relacionar la temperatura media con el mes</strong></span> (por ejemplo con una regresi√≥n)‚Ä¶</p>
</div><div class="column" style="width:80%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">ggplot</span>(retiro <span class="sc">|&gt;</span> </span>
<span id="cb5-2"><a href="#cb5-2"></a>         <span class="fu">mutate</span>(<span class="at">mes =</span> <span class="fu">as_factor</span>(lubridate<span class="sc">::</span><span class="fu">month</span>(fecha))) <span class="sc">|&gt;</span> </span>
<span id="cb5-3"><a href="#cb5-3"></a>         <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">mean</span>(tmed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb5-4"><a href="#cb5-4"></a>                   <span class="at">.by =</span> <span class="st">"mes"</span>)) <span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> mes, <span class="at">y =</span> mean_temp)) <span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Temperatura media por mes"</span>,</span>
<span id="cb5-8"><a href="#cb5-8"></a>       <span class="at">x =</span> <span class="st">"Mes"</span>, <span class="at">y =</span> <span class="st">"¬∫C (media)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-4-1.png" width="960"></p>
</div>
</div>
</div>
</div>
</section>
<section id="qu√©-es-una-serie-temporal-4" class="slide level2">
<h2>¬øQu√© es una serie temporal?</h2>
<div class="columns">
<div class="column" style="width:20%;">
<p>‚Ä¶ o analizar c√≥mo la <span class="hl-yellow"><strong>temperatura media va increment√°ndose en cada d√©cada</strong></span>‚Ä¶</p>
</div><div class="column" style="width:80%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">ggplot</span>(retiro <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="#cb6-2"></a>         <span class="fu">mutate</span>(<span class="at">periodo =</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>                  <span class="fu">if_else</span>(fecha <span class="sc">&lt;</span> <span class="fu">as_date</span>(<span class="st">"1990-01-01"</span>),</span>
<span id="cb6-4"><a href="#cb6-4"></a>                          <span class="st">"1980-1990"</span>,</span>
<span id="cb6-5"><a href="#cb6-5"></a>                          <span class="fu">if_else</span>(fecha <span class="sc">&lt;</span> <span class="fu">as_date</span>(<span class="st">"2000-01-01"</span>),</span>
<span id="cb6-6"><a href="#cb6-6"></a>                                  <span class="st">"1990-2000"</span>,</span>
<span id="cb6-7"><a href="#cb6-7"></a>                                  <span class="fu">if_else</span>(fecha <span class="sc">&lt;</span> <span class="fu">as_date</span>(<span class="st">"2010-01-01"</span>),</span>
<span id="cb6-8"><a href="#cb6-8"></a>                                          <span class="st">"2000-2010"</span>,</span>
<span id="cb6-9"><a href="#cb6-9"></a>                                          <span class="fu">if_else</span>(fecha <span class="sc">&lt;</span> <span class="fu">as_date</span>(<span class="st">"2020-01-01"</span>),</span>
<span id="cb6-10"><a href="#cb6-10"></a>                                          <span class="st">"2010-2020"</span>, <span class="st">"despu√©s de 2020"</span>)))))) <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> periodo, <span class="at">y =</span> tmed)) <span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb6-13"><a href="#cb6-13"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Temperatura media seg√∫n periodo"</span>,</span>
<span id="cb6-14"><a href="#cb6-14"></a>       <span class="at">x =</span> <span class="st">"periodo"</span>, <span class="at">y =</span> <span class="st">"¬∫C (media)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-5-1.png" width="960"></p>
</div>
</div>
</div>
</div>
</section>
<section id="qu√©-es-una-serie-temporal-5" class="slide level2">
<h2>¬øQu√© es una serie temporal?</h2>
<p>En todos ejemplos anteriores hemos analizado una <span class="hl-yellow"><strong>variable continua (temperatura)</strong></span> en funci√≥n de una <span class="hl-purple"><strong>variable discreta o de grupo</strong></span> (periodo, d√©cada, etc).</p>
<p>&nbsp;</p>
<div class="fragment">
<p>¬øPero y si queremos relacionarla con una <span class="hl-yellow"><strong>variable temporal ‚Äúcontinua‚Äù</strong></span> como es la propia fecha?</p>
</div>
</section>
<section id="qu√©-es-una-serie-temporal-6" class="slide level2">
<h2>¬øQu√© es una serie temporal?</h2>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">ggplot</span>(retiro) <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fecha, <span class="at">y =</span> tmed), <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Temperatura media como SERIE TEMPORAL"</span>,</span>
<span id="cb7-5"><a href="#cb7-5"></a>       <span class="at">x =</span> <span class="st">"t (fecha)"</span>, <span class="at">y =</span> <span class="st">"¬∫C (media)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-6-1.png" width="960" class="r-stretch"></section>
<section id="qu√©-es-una-serie-temporal-7" class="slide level2">
<h2>¬øQu√© es una serie temporal?</h2>
<p>F√≠jate bien‚Ä¶¬øqu√© elementos detectas?</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">ggplot</span>(retiro) <span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fecha, <span class="at">y =</span> tmed), <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Temperatura media como SERIE TEMPORAL"</span>,</span>
<span id="cb8-5"><a href="#cb8-5"></a>       <span class="at">x =</span> <span class="st">"t (fecha)"</span>, <span class="at">y =</span> <span class="st">"¬∫C (media)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-7-1.png" width="960" class="r-stretch"></section>
<section id="qu√©-es-una-serie-temporal-8" class="slide level2">
<h2>¬øQu√© es una serie temporal?</h2>
<ul>
<li><span class="hl-yellow"><strong>Tendencia</strong></span>: lo que ajustar√≠as con un modelo cl√°sico (por ejemplo, una regresi√≥n lineal) y representa el <span class="hl-purple"><strong>comportamiento global de la serie</strong></span>, algo as√≠ como un <strong>nivel base respecto al que la serie oscila</strong>.</li>
</ul>
<p>(en nuestro caso: la temperatura global aumenta con el paso de los a√±os)</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">ggplot</span>(retiro, <span class="fu">aes</span>(<span class="at">x =</span> fecha, <span class="at">y =</span> tmed)) <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Temperatura media como SERIE TEMPORAL"</span>,</span>
<span id="cb9-6"><a href="#cb9-6"></a>       <span class="at">x =</span> <span class="st">"t (fecha)"</span>, <span class="at">y =</span> <span class="st">"¬∫C (media)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-8-1.png" width="960" class="r-stretch"></section>
<section id="qu√©-es-una-serie-temporal-9" class="slide level2">
<h2>¬øQu√© es una serie temporal?</h2>
<ul>
<li><span class="hl-yellow"><strong>Estacionalidad</strong></span>: al margen de esa tendencia general, si hacemos zoom, en muchas series podemos observar un <span class="hl-purple"><strong>patr√≥n que se repite cada x unidades temporales</strong></span>. En el caso de la temperatura, hay un patr√≥n anual: diciembre hace m√°s fr√≠o que en agosto.</li>
</ul>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">ggplot</span>(retiro <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2"></a>         <span class="fu">filter</span>(<span class="fu">between</span>(fecha, <span class="fu">as_date</span>(<span class="st">"2020-01-01"</span>), <span class="fu">as_date</span>(<span class="st">"2023-12-31"</span>))),</span>
<span id="cb10-3"><a href="#cb10-3"></a>                <span class="fu">aes</span>(<span class="at">x =</span> fecha, <span class="at">y =</span> tmed)) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Temperatura media diaria de 2020 a 2023"</span>,</span>
<span id="cb10-8"><a href="#cb10-8"></a>       <span class="at">x =</span> <span class="st">"t (fecha)"</span>, <span class="at">y =</span> <span class="st">"¬∫C (media)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-9-1.png" width="960" class="r-stretch"></section>
<section id="qu√©-es-una-serie-temporal-10" class="slide level2">
<h2>¬øQu√© es una serie temporal?</h2>
<ul>
<li><span class="hl-yellow"><strong>At√≠picos</strong></span>: como sucede siempre en estad√≠stica ser√° important√≠simo analizar y tratar los <span class="hl-purple"><strong>datos at√≠picos muy alejados de lo esperado</strong></span>. Por ejemplo, en nuestro caso, Filomena.</li>
</ul>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">ggplot</span>(retiro <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2"></a>         <span class="fu">filter</span>(<span class="fu">between</span>(fecha, <span class="fu">as_date</span>(<span class="st">"2020-01-01"</span>), <span class="fu">as_date</span>(<span class="st">"2023-12-31"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>         <span class="fu">mutate</span>(<span class="at">filomena =</span> <span class="fu">between</span>(fecha, <span class="fu">as_date</span>(<span class="st">"2020-12-25"</span>), <span class="fu">as_date</span>(<span class="st">"2021-01-22"</span>))),</span>
<span id="cb11-4"><a href="#cb11-4"></a>                <span class="fu">aes</span>(<span class="at">x =</span> fecha, <span class="at">y =</span> tmed)) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">alpha =</span> filomena), <span class="at">color =</span> <span class="st">"#991545"</span>) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>  <span class="fu">guides</span>(<span class="at">alpha =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Temperatura media diaria de 2020 a 2023"</span>,</span>
<span id="cb11-11"><a href="#cb11-11"></a>       <span class="at">x =</span> <span class="st">"t (fecha)"</span>, <span class="at">y =</span> <span class="st">"¬∫C (media)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-10-1.png" width="960" class="r-stretch"></section>
<section id="qu√©-es-una-serie-temporal-11" class="slide level2">
<h2>¬øQu√© es una serie temporal?</h2>
<ul>
<li><span class="hl-yellow"><strong>Intervenciones</strong></span>: incluso podr√≠a suceder que la serie tuviese un <span class="hl-purple"><strong>corte o salto en su comportamiento</strong></span>. Por ejemplo, imagina que de repente el aparato de medici√≥n empieza a medir +25 grados de la temperatura real.</li>
</ul>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">ggplot</span>(retiro <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a href="#cb12-2"></a>         <span class="fu">filter</span>(<span class="fu">between</span>(fecha, <span class="fu">as_date</span>(<span class="st">"2020-01-01"</span>), <span class="fu">as_date</span>(<span class="st">"2023-12-31"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>         <span class="fu">mutate</span>(<span class="at">tmed =</span> <span class="fu">if_else</span>(fecha <span class="sc">&lt;=</span> <span class="st">"2021-12-31"</span>, tmed, tmed <span class="sc">+</span> <span class="dv">25</span>))) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fecha, <span class="at">y =</span> tmed), <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>  <span class="fu">guides</span>(<span class="at">alpha =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Temperatura media diaria de 2020 a 2023"</span>,</span>
<span id="cb12-8"><a href="#cb12-8"></a>       <span class="at">subtitle =</span> <span class="st">"Error de +25¬∫C a partir de 2022"</span>,</span>
<span id="cb12-9"><a href="#cb12-9"></a>       <span class="at">x =</span> <span class="st">"t (fecha)"</span>, <span class="at">y =</span> <span class="st">"¬∫C (media)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-11-1.png" width="960" class="r-stretch"></section>
<section id="ejemplos-de-series" class="slide level2">
<h2>Ejemplos de series</h2>
<p>En esta asignatura ser√° fundamental un concepto: <span class="hl-yellow"><strong>estacionariedad</strong></span>. Diremos que una <span class="hl-yellow"><strong>serie es estacionaria si oscila de manera estable con una media y varianza constante</strong></span>.</p>
<p><img data-src="https://estrategiastrading.com/wp-content/plugins/phastpress/phast.php/c2VydmljZT1pbWFnZXMmc3JjPWh0dHBzJTNBJTJGJTJGZXN0cmF0ZWdpYXN0cmFkaW5nLmNvbSUyRndwLWNvbnRlbnQlMkZ1cGxvYWRzJTJGMjAxNiUyRjEyJTJGbWVkaWFfZXN0YWNpb25hcmlhLnBuZyZjYWNoZU1hcmtlcj0xNjMyOTAyOTc5LTc5NjQmdG9rZW49M2Y0ZTg4NWMyZjM0NmE2MA.q.png"></p>
<p><img data-src="https://estrategiastrading.com/wp-content/plugins/phastpress/phast.php/c2VydmljZT1pbWFnZXMmc3JjPWh0dHBzJTNBJTJGJTJGZXN0cmF0ZWdpYXN0cmFkaW5nLmNvbSUyRndwLWNvbnRlbnQlMkZ1cGxvYWRzJTJGMjAxNiUyRjEyJTJGaG9tb3NjZWRhc3RpY2lkYWQucG5nJmNhY2hlTWFya2VyPTE2MzI5MDI5NzktOTA0MyZ0b2tlbj1mNjhiMDIwYjg2NGE1M2Rl.q.png"></p>
</section>
<section id="distintos-objetivos" class="slide level2">
<h2>Distintos objetivos</h2>
<ul>
<li><span class="hl-yellow"><strong>An√°lisis descriptivo</strong></span>
<ul>
<li>Visualizaci√≥n: ¬øc√≥mo son los datos? ¬øExiste alg√∫n ausente o valor at√≠pico?</li>
<li>¬øSe puede descomponer la serie en series m√°s sencillas?</li>
</ul></li>
</ul>
<div class="fragment">
<ul>
<li><span class="hl-yellow"><strong>An√°lisis probabil√≠stico</strong></span>:
<ul>
<li>¬øExiste un modelo te√≥rico tal que lo que observamos sea simplemente una muestra dicho modelo probabil√≠stico?</li>
<li>Aunque los datos sean aleatorios, ¬øpodemos modelizar de manera te√≥rica alguna de sus caracter√≠stica?</li>
</ul></li>
</ul>
</div>
<div class="fragment">
<ul>
<li><span class="hl-yellow"><strong>Predicci√≥n</strong></span>
<ul>
<li>Conociendo su comportamiento pasado, ¬øcu√°nto valdr√° su valor ma√±ana?</li>
<li>¬øCu√°nto me estoy equivocando? ¬øC√≥mo medir ese error?</li>
</ul></li>
</ul>
</div>
</section>
<section id="bloques-del-curso" class="slide level2">
<h2>Bloques del curso</h2>
<ul>
<li><span class="hl-yellow"><strong>Bloque I</strong></span>: analisis exploratorio. <span class="hl-purple"><strong>Descomposici√≥n y suavizado</strong></span></li>
</ul>
<div class="fragment">
<ul>
<li><span class="hl-yellow"><strong>Bloque II</strong></span>: ¬øqu√© son los <span class="hl-purple"><strong>prcesos estoc√°sticos</strong></span>?</li>
</ul>
</div>
<div class="fragment">
<ul>
<li><span class="hl-yellow"><strong>Bloque III</strong></span>: metodolog√≠a <span class="hl-purple"><strong>Box-Jenkins</strong></span></li>
</ul>
</div>
<div class="fragment">
<ul>
<li><span class="hl-yellow"><strong>Bloque IV</strong></span>: problemas (<span class="hl-purple"><strong>intervenci√≥n, at√≠picos</strong></span>, ausentes, heterocedasticidad, ‚Ä¶</li>
</ul>
</div>
</section>
<section id="instalaci√≥n-de-r" class="slide level2">
<h2>Instalaci√≥n de R</h2>
<p>El lenguaje <code>R</code> ser√° nuestra <span class="hl-yellow"><strong>gram√°tica y ortograf√≠a</strong></span> (nuestras reglas de juego)</p>
<div>
<ul>
<li class="fragment"><p><span class="hl-yellow"><strong>Paso 1</strong></span>: entra en <a href="https://cran.r-project.org/" class="uri">https://cran.r-project.org/</a> y selecciona tu sistema operativo.</p></li>
<li class="fragment"><p><span class="hl-yellow"><strong>Paso 2</strong></span>: para Mac basta con que hacer click en el <strong>archivo .pkg</strong>, y abrirlo una vez descargado. Para sistemas Windows, debemos clickar en <strong>install R for the first time</strong> y despu√©s en <strong>Download R for Windows</strong>. Una vez descargado, abrirlo como cualquier archivo de instalaci√≥n.</p></li>
<li class="fragment"><p><span class="hl-yellow"><strong>Paso 3</strong></span>: abrir el ejecutable de instalaci√≥n.</p></li>
</ul>
</div>
<div class="fragment">
<div class="callout callout-warning callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Cuidado</strong></p>
</div>
<div class="callout-content">
<p>Siempre que tengas que descargar algo de CRAN (ya sea el propio R o un paquete), <span class="hl-orange"><strong>aseg√∫rate de tener conexi√≥n a internet</strong></span>.</p>
</div>
</div>
</div>
</div>
</section>
<section id="instalaci√≥n-de-r-studio" class="slide level2">
<h2>Instalaci√≥n de R Studio</h2>
<p><code>RStudio</code> ser√° el <span class="hl-yellow"><strong>Word</strong></span> que usaremos para escribir (lo que se conoce como un <span class="hl-yellow"><strong>IDE: entorno integrado de desarrollo</strong></span>).</p>
<div>
<ul>
<li class="fragment"><p><span class="hl-yellow"><strong>Paso 1</strong></span>: entra la <a href="https://posit.co/download/rstudio-desktop/">web oficial de RStudio</a> (ahora llamado Posit) y selecciona la descarga gratuita.</p></li>
<li class="fragment"><p><span class="hl-yellow"><strong>Paso 2</strong></span>: selecciona el ejecutable que te aparezca acorde a tu sistema operativo.</p></li>
<li class="fragment"><p><span class="hl-yellow"><strong>Paso 3</strong></span>: tras descargar el ejecutable, hay que abrirlo como otro cualquier otro y dejar que termine la instalaci√≥n.</p></li>
</ul>
</div>
</section>
<section id="scripts-documentos-.r" class="slide level2">
<h2>Scripts (documentos .R)</h2>
<div class="columns">
<div class="column" style="width:35%;">
<p><img data-src="img/abrir_script.jpg" width="350"></p>
</div><div class="column" style="width:65%;">
<p>Un <span class="hl-yellow"><strong>script</strong></span> ser√° el documento en el que programamos, nuestro archivo <code>.doc</code> (aqu√≠ con extensi√≥n <code>.R</code>) donde escribiremos las √≥rdenes. Para <strong>abrir nuestro primero script</strong>, haz click en el men√∫ en <code>File &lt; New File &lt; R Script</code>.</p>
<div class="callout callout-warning callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Cuidado</strong></p>
</div>
<div class="callout-content">
<p>Es importante <strong>no abusar de la consola</strong>: todo lo que no escribas en un script, cuando cierres, <span class="hl-orange"><strong>lo habr√°s perdido</strong></span>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-warning callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Cuidado</strong></p>
</div>
<div class="callout-content">
<p><code>R</code> es <span class="hl-orange"><strong>case-sensitive</strong></span>: es sensible a may√∫sculas y min√∫sculas por lo que <code>x</code> y <code>X</code> representa variables distintas.</p>
</div>
</div>
</div>
</section>
<section id="ejecutando-el-primer-script" class="slide level2">
<h2>Ejecutando el primer script</h2>
<p>Ahora tenemos una <strong>cuarta ventana</strong>: la ventana donde <span class="hl-yellow"><strong>escribiremos nuestros c√≥digos</strong></span>. ¬øC√≥mo ejecutarlo?</p>
<div class="fragment">
<ol type="1">
<li><strong>Escribimos</strong> el c√≥digo a ejecutar.</li>
</ol>
</div>
<div class="fragment">
<ol start="2" type="1">
<li><strong>Guardamos</strong> el archivo .R haciendo click en <code>Save current document</code>.</li>
</ol>
</div>
<div class="fragment">
<ol start="3" type="1">
<li>El c√≥digo no se ejecuta salvo que se lo indiquemos. Tenemos <strong>tres opciones de ejecutar un script</strong>:</li>
</ol>
<ul>
<li><span class="hl-yellow"><strong>Copiar y pegar</strong></span> en consola.</li>
<li><span class="hl-yellow"><strong>Seleccionar l√≠neas</strong></span> y <code>Ctrl+Enter</code></li>
<li><span class="hl-yellow"><strong>Activar Source on save</strong></span> a la derecha de guardar: no solo guarda sino que ejecuta el c√≥digo <strong>completo</strong>.</li>
</ul>
</div>
</section>
<section id="s√©-organizado-proyectos" class="slide level2">
<h2>S√© organizado: proyectos</h2>
<p>De la misma manera que en el ordenador solemos trabajar de manera <span class="hl-yellow"><strong>ordenada por carpetas</strong></span>, en <code>RStudio</code> podemos hacer lo mismo para trabajar de <span class="hl-yellow"><strong>manera eficaz creando proyectos</strong></span>.</p>
<div class="fragment">
<div class="columns">
<div class="column" style="width:60%;">
<p>Un <span class="hl-yellow"><strong>proyecto ser√° una ¬´carpeta¬ª</strong></span> dentro de <code>RStudio</code>, de manera que nuestro directorio ra√≠z autom√°ticamente ser√° la propia carpeta de proyecto (pudiendo pasar de un proyecto a otro con el menu superior derecho).</p>
<p>Podemos crear uno en una carpeta nueva o en una carpeta ya existente.</p>
</div><div class="column" style="width:40%;">
<p><img data-src="img/rstudio_proyectos.png" width="370"></p>
</div>
</div>
</div>
</section>
<section id="buenas-pr√°cticas" class="slide level2">
<h2>Buenas pr√°cticas</h2>
<ul>
<li><span class="hl-green"><strong>Tip 1</strong></span>: <span class="hl-yellow"><strong>asignar, evaluar y comparar no es lo mismo</strong></span>. Si te has fijado en <code>R</code> estamos usando <code>&lt;-</code> para asignar valores a variables. Usaremos <code>=</code> para evaluar argumentos en funciones y <code>==</code> para saber si dos elementos son iguales.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># asignar</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>x <span class="ot">=</span> <span class="dv">1</span> <span class="co"># evaluar</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>x <span class="sc">==</span> <span class="dv">1</span> <span class="co"># comparar</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<ul>
<li><span class="hl-green"><strong>Tip 2</strong></span>: programa como escribes. Al igual que cuando redactas en castellano, acost√∫mbrate a incorporar <span class="hl-yellow"><strong>espacios y saltos de l√≠nea</strong></span> paranoquedarteciego (es una buena pr√°ctica y no un requisito porque <code>R</code> no procesa los espacios)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># √≥ptimo</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>x<span class="ot">&lt;-</span><span class="dv">1</span> <span class="co"># regu</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>x<span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># peor (dec√≠dete)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="buenas-pr√°cticas-1" class="slide level2">
<h2>Buenas pr√°cticas</h2>
<ul>
<li><span class="hl-green"><strong>Tip 3</strong></span>: no seas ca√≥tico, <span class="hl-yellow"><strong>estandariza nombres</strong></span>, acost√∫mbrate siempre a hacerlo igual. El √∫nico requisito es que <strong>debe empezar siempre por una letra</strong> (y sin tildes). La forma m√°s recomendable es la conocida como <code>snake_case</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>variable_en_modo_snake_case</span>
<span id="cb15-2"><a href="#cb15-2"></a>otraFormaMasDificilDeLeer</span>
<span id="cb15-3"><a href="#cb15-3"></a>hay.gente.que.usa.esto</span>
<span id="cb15-4"><a href="#cb15-4"></a>Incluso_Haygente.Caotica_que.NoMereceNuestraATENCION</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<ul>
<li><span class="hl-green"><strong>Tip 4</strong></span>: facilita la lectura y escritura, <span class="hl-yellow"><strong>pon m√°rgenes</strong></span>. En <code>Tools &lt; Global Options</code> puedes personalizar algunas opciones de <code>RStudio</code>. En <code>Code &lt; Display</code> podemos indicarle en <code>Show margin</code> (no interacciona con el c√≥digo).</li>
</ul>
<p><img data-src="img/show_margin.jpg" height="200"></p>
</div>
</section>
<section id="buenas-pr√°cticas-2" class="slide level2">
<h2>Buenas pr√°cticas</h2>
<ul>
<li><span class="hl-green"><strong>Tip 5</strong></span>: el <span class="hl-yellow"><strong>tabulador es tu mejor amigo</strong></span>. En <code>RStudio</code> tenemos una herramienta maravillosa: si escribes parte del nombre de una variable o funci√≥n y tabulas, <code>RStudio</code> te autocompleta</li>
</ul>

<img data-src="img/tab-autocompletar.png" class="r-stretch"></section>
<section id="buenas-pr√°cticas-3" class="slide level2">
<h2>Buenas pr√°cticas</h2>
<ul>
<li><span class="hl-green"><strong>Tip 6</strong></span>: ni un par√©ntesis soltero. Siempre que abras un par√©ntesis deber√°s cerrarlo. Para facilitar esta tarea entra en <code>Tools &lt; Global Options &lt; Code &lt; Display</code> y activa la opci√≥n <code>Rainbow parentheses</code></li>
</ul>

<img data-src="img/rainbow-parentheses.jpg" class="r-stretch"></section>
<section id="buenas-pr√°cticas-4" class="slide level2">
<h2>Buenas pr√°cticas</h2>
<ul>
<li><span class="hl-green"><strong>Tip 7</strong></span>: f√≠jate en el lateral izquierdo. No solo podr√°s ver la l√≠nea de c√≥digo por la que vas sino que, en caso de estar cometiendo un <span class="hl-red"><strong>error de sintaxis</strong></span>, el propio <code>RStudio</code> te avisar√°.</li>
</ul>

<img data-src="img/rstudio-error-sintaxis.png" class="r-stretch"><ul>
<li><span class="hl-green"><strong>Tip 8</strong></span>: intenta <span class="hl-yellow"><strong>trabajar siempre por proyectos</strong></span> (para esta clase, crea un script <code>clase2.R</code> en el proyecto que creamos en la anterior clase)</li>
</ul>
<p>&nbsp;</p>
<p>Ver m√°s tips en <a href="https://r4ds.had.co.nz/workflow-basics.html#whats-in-a-name" class="uri">https://r4ds.had.co.nz/workflow-basics.html#whats-in-a-name</a></p>
</section>
<section id="tipos-de-datos" class="slide level2">
<h2>Tipos de datos</h2>
<p>¬øExisten <span class="hl-yellow"><strong>variables m√°s all√° de los n√∫meros en la ciencia de datos</strong></span>? Piensa por ejemplo en los datos que podr√≠as guardar de una persona:</p>
<div class="fragment fade-up">
<ul>
<li>La edad o el peso ser√° un <span class="hl-yellow"><strong>n√∫mero</strong></span>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>edad <span class="ot">&lt;-</span> <span class="dv">33</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment fade-up">
<ul>
<li>Su nombre ser√° una cadena de <span class="hl-yellow"><strong>texto (conocida como string o char)</strong></span>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>nombre <span class="ot">&lt;-</span> <span class="st">"javi"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment fade-up">
<ul>
<li>A la pregunta ¬´¬øest√°s matriculado en la Facultad?¬ª la respuesta ser√° lo que llamamos una <span class="hl-yellow"><strong>variable l√≥gica</strong></span> (<code>TRUE</code> si est√° matriculado o <code>FALSE</code> en otro caso).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>matriculado <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment fade-up">
<ul>
<li>Su fecha de nacimiento ser√° precisamente eso, una <span class="hl-yellow"><strong>fecha</strong></span>, un tipo de variable <strong>crucial en esta asignatura</strong></li>
</ul>
</div>
</section>
<section id="variables-de-fecha" class="slide level2">
<h2>Variables de fecha</h2>
<p>Un tipo de datos muy especial: los <span class="hl-yellow"><strong>datos de tipo fecha</strong></span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>fecha_char <span class="ot">&lt;-</span> <span class="st">"2021-04-21"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Parece una simple cadena de texto pero <span class="hl-yellow"><strong>deber√≠a representar un instante en el tiempo</strong></span>. ¬øQu√© deber√≠a suceder si <span class="hl-purple"><strong>sumamos un 1 a una fecha</strong></span>?</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>fecha_char <span class="sc">+</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in fecha_char + 1: non-numeric argument to binary operator</code></pre>
</div>
</div>
<p>Las fechas <span class="hl-red"><strong>NO pueden ser texto</strong></span>: debemos convertir la cadena de texto a fecha.</p>
</div>
<div class="fragment">
<p>&nbsp;</p>
<p>Para trabajar con fechas usaremos el paquete <code>{lubridate}</code>, que deberemos instalar antes de poder usarlo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">install.packages</span>(<span class="st">"lubridate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="variables-de-fecha-1" class="slide level2">
<h2>Variables de fecha</h2>
<p>Una vez instalado, de todos los paquetes (libros) que tenemos, le indicaremos que nos cargue ese concretamente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="fu">library</span>(lubridate) <span class="co"># instala si no lo has hecho</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>Para <span class="hl-yellow"><strong>convertir a tipo fecha</strong></span> usaremos la funci√≥n <code>as_date()</code> del paquete <code>{lubridate}</code> (por defecto en formato <code>yyyy-mm-dd</code>)</p>
<p>&nbsp;</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># ¬°no es una fecha, es un texto!</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>fecha_char <span class="sc">+</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in fecha_char + 1: non-numeric argument to binary operator</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">class</span>(fecha_char)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>fecha <span class="ot">&lt;-</span> <span class="fu">as_date</span>(<span class="st">"2023-03-28"</span>)</span>
<span id="cb28-2"><a href="#cb28-2"></a>fecha <span class="sc">+</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2023-03-29"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="fu">class</span>(fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Date"</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="variables-de-fecha-2" class="slide level2">
<h2>Variables de fecha</h2>
<p>En <code>as_date()</code> el formato de fecha por defecto es <code>yyyy-mm-dd</code> as√≠ si la cadena de texto no se introduce de manera adecuada‚Ä¶</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu">as_date</span>(<span class="st">"28-03-2023"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
<div class="fragment">
<p>Para <span class="hl-yellow"><strong>cualquier otro formato debemos especificarlo</strong></span> en el argumento opcional <code>format = ...</code> tal que <code>%d</code> representa d√≠as, <code>%m</code> meses, <code>%Y</code> en formato de 4 a√±os y <code>%y</code> en formato de 2 a√±os.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="fu">as_date</span>(<span class="st">"28-03-2023"</span>, <span class="at">format =</span> <span class="st">"%d-%m-%Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2023-03-28"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="fu">as_date</span>(<span class="st">"28-03-23"</span>, <span class="at">format =</span> <span class="st">"%d-%m-%y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2023-03-28"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="fu">as_date</span>(<span class="st">"03-28-2023"</span>, <span class="at">format =</span> <span class="st">"%m-%d-%Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2023-03-28"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="fu">as_date</span>(<span class="st">"28/03/2023"</span>, <span class="at">format =</span> <span class="st">"%d/%m/%Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2023-03-28"</code></pre>
</div>
</div>
</div>
</section>
<section id="variables-de-fecha-3" class="slide level2">
<h2>Variables de fecha</h2>
<p>En dicho paquete tenemos funciones muy √∫tiles para <span class="hl-yellow"><strong>manejar fechas</strong></span>:</p>
<ul>
<li>Con <code>today()</code> podemos obtener directamente la <span class="hl-purple"><strong>fecha actual</strong></span>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="fu">today</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-11-21"</code></pre>
</div>
</div>
<div class="fragment">
<ul>
<li>Con <code>now()</code> podemos obtener la <span class="hl-purple"><strong>fecha y hora actual</strong></span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="fu">now</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-11-21 17:48:42 CET"</code></pre>
</div>
</div>
</div>
<div class="fragment">
<ul>
<li>Con <code>year()</code>, <code>month()</code> o <code>day()</code> podemos <span class="hl-purple"><strong>extraer el a√±o, mes y d√≠a</strong></span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>fecha <span class="ot">&lt;-</span> <span class="fu">today</span>()</span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="fu">year</span>(fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2024</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="fu">month</span>(fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11</code></pre>
</div>
</div>
</div>
</section>
<section id="res√∫menes-de-paquetes" class="slide level2">
<h2>Res√∫menes de paquetes</h2>

<img data-src="img/lubridate.png" class="r-stretch"><div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Amplia contenido</strong></p>
</div>
<div class="callout-content">
<p>Tienes un resumen en pdf de los paquetes m√°s importantes en la <span class="hl-green"><strong>carpeta correspondiente en el campus</strong></span></p>
</div>
</div>
</div>
</section>
<section id="vectores-concatenar" class="slide level2">
<h2>Vectores: concatenar</h2>
<p>Cuando trabajamos con datos normalmente tendremos <span class="hl-yellow"><strong>columnas que representan variables</strong></span>: llamaremos <span class="hl-yellow"><strong>vectores</strong></span> a una <span class="hl-purple"><strong>concatenaci√≥n</strong></span> de celdas (valores) del <span class="hl-purple"><strong>mismo tipo</strong></span> (lo que ser√≠a una columna de una tabla).</p>
<div class="fragment">
<p>La forma m√°s sencilla es con el comando <code>c()</code> (c de <strong>concatenar</strong>), y basta con introducir sus <strong>elementos entre par√©ntesis y separados por comas</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>edades <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">32</span>, <span class="dv">27</span>, <span class="dv">60</span>, <span class="dv">61</span>)</span>
<span id="cb50-2"><a href="#cb50-2"></a>edades</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 32 27 60 61</code></pre>
</div>
</div>
</div>
<div class="fragment">
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Consejo</strong></p>
</div>
<div class="callout-content">
<p>Un n√∫mero individual <code>x &lt;- 1</code> (o bien <code>x &lt;- c(1)</code>) es en realidad un <strong>vector de longitud uno</strong> ‚Äì&gt; todo lo que sepamos <span class="hl-green"><strong>hacer con un n√∫mero podemos hacerlo con un vector de ellos</strong></span>.</p>
</div>
</div>
</div>
</div>
</section>
<section id="tu-turno-1-1" class="slide level2">
<h2>üíª Tu turno</h2>
<p><span style="color:#444442;"><strong>Intenta realizar los siguientes ejercicios sin mirar las soluciones</strong></span></p>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1"><span class="hl-yellow"><strong>Ejercicio 1</strong></span></a></li><li><a href="#tabset-1-2"><span class="hl-yellow"><strong>Ejercicio 2</strong></span></a></li><li><a href="#tabset-1-3"><span class="hl-yellow"><strong>Ejercicio 3</strong></span></a></li><li><a href="#tabset-1-4"><span class="hl-yellow"><strong>Ejercicio 4</strong></span></a></li><li><a href="#tabset-1-5"><span class="hl-yellow"><strong>Ejercicio 5</strong></span></a></li><li><a href="#tabset-1-6"><span class="hl-yellow"><strong>Ejercicio 6</strong></span></a></li><li><a href="#tabset-1-7"><span class="hl-yellow"><strong>Ejercicio 7</strong></span></a></li><li><a href="#tabset-1-8"><span class="hl-yellow"><strong>Ejercicio 8</strong></span></a></li><li><a href="#tabset-1-9"><span class="hl-yellow"><strong>Ejercicio 9</strong></span></a></li><li><a href="#tabset-1-10"><span class="hl-yellow"><strong>Ejercicio 10</strong></span></a></li><li><a href="#tabset-1-11"><span class="hl-yellow"><strong>Ejercicio 11</strong></span></a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<p>üìù Define el vector <code>x</code> como la concatenaci√≥n de los 5 primeros n√∫meros impares. Calcula la longitud del vector</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="co"># Dos formas</span></span>
<span id="cb52-2"><a href="#cb52-2"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>)</span>
<span id="cb52-3"><a href="#cb52-3"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">9</span>, <span class="at">by =</span> <span class="dv">2</span>)</span>
<span id="cb52-4"><a href="#cb52-4"></a></span>
<span id="cb52-5"><a href="#cb52-5"></a><span class="fu">length</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-2">
<p>üìù Accede al tercer elemento de <code>x</code>. Accede al √∫ltimo elemento (sin importar la longitud, un c√≥digo que pueda ejecutarse siempre). Elimina el primer elemento.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>x[<span class="dv">3</span>]</span>
<span id="cb53-2"><a href="#cb53-2"></a>x[<span class="fu">length</span>(x)]</span>
<span id="cb53-3"><a href="#cb53-3"></a>x[<span class="sc">-</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-3">
<p>üìù Obt√©n los elementos de <code>x</code> mayores que 4. Calcula el vector <code>1/x</code> y gu√°rdalo en una variable.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a>x[x <span class="sc">&gt;</span> <span class="dv">4</span>]</span>
<span id="cb54-2"><a href="#cb54-2"></a>z <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>x</span>
<span id="cb54-3"><a href="#cb54-3"></a>z</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-4">
<p>üìù Crea un vector que represente los nombres de 5 personas, de los cuales uno es desconocido.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>nombres <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Javi"</span>, <span class="st">"Sandra"</span>, <span class="cn">NA</span>, <span class="st">"Laura"</span>, <span class="st">"Carlos"</span>)</span>
<span id="cb55-2"><a href="#cb55-2"></a>nombres</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-5">
<p>üìù Encuentra del vector <code>x</code> de ejercicios anteriores los elementos mayores (estrictos) que 1 Y ADEM√ÅS menores (estrictos) que 7. Encuentra una forma de averiguar si todos los elementos son o no positivos.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>x[x <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> x <span class="sc">&lt;</span> <span class="dv">7</span>]</span>
<span id="cb56-2"><a href="#cb56-2"></a><span class="fu">all</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-6">
<p>üìù Dado el vector <code>x &lt;- c(1, -5, 8, NA, 10, -3, 9)</code>, ¬øpor qu√© su media no devuelve un n√∫mero sino lo que se muestra en el c√≥digo inferior?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">5</span>, <span class="dv">8</span>, <span class="cn">NA</span>, <span class="dv">10</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">9</span>)</span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="fu">mean</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
</div>
<div id="tabset-1-7">
<p>üìù Dado el vector <code>x &lt;- c(1, -5, 8, NA, 10, -3, 9)</code>, extrae los elementos que ocupan los lugares 1, 2, 5, 6.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">5</span>, <span class="dv">8</span>, <span class="cn">NA</span>, <span class="dv">10</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">9</span>)</span>
<span id="cb59-2"><a href="#cb59-2"></a>x[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>)]</span>
<span id="cb59-3"><a href="#cb59-3"></a>x[<span class="sc">-</span><span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-8">
<p>üìù Dado el vector <code>x</code> del ejercicio anterior, ¬øcuales tienen un dato ausente? Pista: las funciones <code>is.algo()</code> comprueban si el elemento es tipo <code>algo</code> (tabula)</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a><span class="fu">is.na</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-9">
<p>üìù Define el vector <code>x</code> como la concatenaci√≥n de los 4 primeros n√∫meros pares. Calcula el n√∫mero de elementos de <code>x</code> menores estrictamente que 5.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a>x[x <span class="sc">&lt;</span> <span class="dv">5</span>] </span>
<span id="cb61-2"><a href="#cb61-2"></a><span class="fu">sum</span>(x <span class="sc">&lt;</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-10">
<p>üìù Calcula el vector <code>1/x</code> y obt√©n la versi√≥n ordenada (de menor a mayor) de las dos formas posibles</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a>z <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>x</span>
<span id="cb62-2"><a href="#cb62-2"></a><span class="fu">sort</span>(z)</span>
<span id="cb62-3"><a href="#cb62-3"></a>z[<span class="fu">order</span>(z)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-11">
<p>üìù Encuentra del vector <code>x</code> los elementos mayores (estrictos) que 1 y menores (estrictos) que 6. Encuentra una forma de averiguar si todos los elementos son o no negativos.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a>x[x <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> x <span class="sc">&lt;</span> <span class="dv">7</span>]</span>
<span id="cb63-2"><a href="#cb63-2"></a><span class="fu">all</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="primera-base-de-datos" class="slide level2">
<h2>Primera base de datos</h2>
<p>Cuando analizamos datos solemos tener <span class="hl-yellow"><strong>varias variables</strong></span> de cada individuo: necesitamos una ¬´tabla¬ª que las recopile. La opci√≥n m√°s inmediata son las <span class="hl-yellow"><strong>matrices</strong></span>: concatenaci√≥n de variables del <span class="hl-purple"><strong>mismo tipo e igual longitud</strong></span>.</p>
<p>Imagina que tenemos estaturas y pesos de 4 personas. ¬øC√≥mo <span class="hl-yellow"><strong>crear un dataset con las dos variables</strong></span>?</p>
<div class="fragment">
<p>La opci√≥n m√°s habitual es usando <code>cbind()</code>: <span class="hl-yellow"><strong>concatenamos (bind) vectores en forma de columnas (c)</strong></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64" data-code-line-numbers="3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a>estaturas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">150</span>, <span class="dv">160</span>, <span class="dv">170</span>, <span class="dv">180</span>)</span>
<span id="cb64-2"><a href="#cb64-2"></a>pesos <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">63</span>, <span class="dv">70</span>, <span class="dv">85</span>, <span class="dv">95</span>)</span>
<span id="cb64-3"><a href="#cb64-3"></a>datos_matriz <span class="ot">&lt;-</span> <span class="fu">cbind</span>(estaturas, pesos)</span>
<span id="cb64-4"><a href="#cb64-4"></a>datos_matriz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     estaturas pesos
[1,]       150    63
[2,]       160    70
[3,]       170    85
[4,]       180    95</code></pre>
</div>
</div>
</div>
</section>
<section id="primer-intento-matrices" class="slide level2">
<h2>Primer intento: matrices</h2>
<p>Tambi√©n podemos <span class="hl-yellow"><strong>construir la matriz por filas</strong></span> con la funci√≥n <code>rbind()</code> (concatenar - bind - por filas - rows), aunque lo <span class="hl-green"><strong>recomendable es tener cada variable en columna</strong></span> e individuo en fila como luego veremos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="fu">rbind</span>(estaturas, pesos) <span class="co"># Construimos la matriz por filas</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1] [,2] [,3] [,4]
estaturas  150  160  170  180
pesos       63   70   85   95</code></pre>
</div>
</div>
<div class="fragment">
<ul>
<li>Podemos <span class="hl-yellow"><strong>comprobar las dimensiones</strong></span> con <code>dim()</code>, <code>nrow()</code> y <code>ncol()</code>: las matrices son un tipo de <strong>datos tabulados</strong> (organizados en filas y columnas)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a><span class="fu">dim</span>(datos_matriz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="fu">nrow</span>(datos_matriz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a><span class="fu">ncol</span>(datos_matriz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
</div>
</section>
<section id="segundo-intento-data.frame" class="slide level2">
<h2>Segundo intento: data.frame</h2>
<p>Las matrices tienen el mismo problema que los vectores: si juntamos datos de distinto tipo, se <span class="hl-red"><strong>perturba la integridad del dato</strong></span> ya que los convierte (f√≠jate en el c√≥digo inferior: las edades y los <code>TRUE/FALSE</code> los ha convertido a texto)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74" data-code-line-numbers="4-5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a>edades <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">14</span>, <span class="dv">24</span>, <span class="cn">NA</span>)</span>
<span id="cb74-2"><a href="#cb74-2"></a>soltero <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">NA</span>, <span class="cn">FALSE</span>)</span>
<span id="cb74-3"><a href="#cb74-3"></a>nombres <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"javi"</span>, <span class="st">"laura"</span>, <span class="st">"luc√≠a"</span>)</span>
<span id="cb74-4"><a href="#cb74-4"></a>matriz <span class="ot">&lt;-</span> <span class="fu">cbind</span>(edades, soltero, nombres)</span>
<span id="cb74-5"><a href="#cb74-5"></a>matriz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     edades soltero nombres
[1,] "14"   "TRUE"  "javi" 
[2,] "24"   NA      "laura"
[3,] NA     "FALSE" "luc√≠a"</code></pre>
</div>
</div>
<div class="fragment">
<p>De hecho al no ser n√∫meros ya no podemos realizar operaciones aritm√©ticas</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a>matriz <span class="sc">+</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in matriz + 1: non-numeric argument to binary operator</code></pre>
</div>
</div>
</div>
</section>
<section id="segundo-intento-data.frame-1" class="slide level2">
<h2>Segundo intento: data.frame</h2>
<p>Para poder trabajar con <span class="hl-yellow"><strong>variables de distinto tipo</strong></span> tenemos en <code>R</code> lo que se conoce como <span class="hl-yellow"><strong>data.frame</strong></span>: concatenaci√≥n de variables de igual longitud pero que pueden ser de <span class="hl-purple"><strong>tipo distinto</strong></span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a>tabla <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(edades, soltero, nombres)</span>
<span id="cb78-2"><a href="#cb78-2"></a><span class="fu">class</span>(tabla)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a>tabla</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  edades soltero nombres
1     14    TRUE    javi
2     24      NA   laura
3     NA   FALSE   luc√≠a</code></pre>
</div>
</div>
</section>
<section id="segundo-intento-data.frame-2" class="slide level2">
<h2>Segundo intento: data.frame</h2>
<p>Dado que un <code>data.frame</code> es ya un intento de ¬´base de datos¬ª las variables no son meros vectores matem√°ticos: <span class="hl-yellow"><strong>tienen un significado</strong></span> y podemos (debemos) <span class="hl-purple"><strong>ponerles nombres</strong></span> que describan su significado</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb82-2"><a href="#cb82-2"></a>tabla <span class="ot">&lt;-</span></span>
<span id="cb82-3"><a href="#cb82-3"></a>  <span class="fu">data.frame</span>(<span class="st">"edad"</span> <span class="ot">=</span> edades, <span class="st">"estado"</span> <span class="ot">=</span> soltero, <span class="st">"nombre"</span> <span class="ot">=</span> nombres,</span>
<span id="cb82-4"><a href="#cb82-4"></a>             <span class="st">"f_nacimiento"</span> <span class="ot">=</span> <span class="fu">as_date</span>(<span class="fu">c</span>(<span class="st">"1989-09-10"</span>, <span class="st">"1992-04-01"</span>, <span class="st">"1980-11-27"</span>)))</span>
<span id="cb82-5"><a href="#cb82-5"></a>tabla</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  edad estado nombre f_nacimiento
1   14   TRUE   javi   1989-09-10
2   24     NA  laura   1992-04-01
3   NA  FALSE  luc√≠a   1980-11-27</code></pre>
</div>
</div>
</section>
<section id="intento-final-tibble" class="slide level2">
<h2>Intento final: tibble</h2>
<p>Las tablas en formato <code>data.frame</code> tienen algunas <span class="hl-red"><strong>limitaciones</strong></span>. La principal es que <span class="hl-red"><strong>no permite la recursividad</strong></span>: imagina que definimos una base de datos con estaturas y pesos, y queremos una tercera variable con el IMC</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a><span class="fu">data.frame</span>(<span class="st">"estatura"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">1.7</span>, <span class="fl">1.8</span>, <span class="fl">1.6</span>), <span class="st">"peso"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">75</span>, <span class="dv">70</span>),</span>
<span id="cb84-2"><a href="#cb84-2"></a>           <span class="st">"IMC"</span> <span class="ot">=</span> peso <span class="sc">/</span> (estatura<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in data.frame(estatura = c(1.7, 1.8, 1.6), peso = c(80, 75, 70), : object 'peso' not found</code></pre>
</div>
</div>
<div class="fragment">
<p>En adelante usaremos el formato <code>tibble</code> (<span class="hl-yellow"><strong>data.frame mejorado</strong></span>) del paquete <code>{tibble}</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb86-2"><a href="#cb86-2"></a>datos_tb <span class="ot">&lt;-</span> </span>
<span id="cb86-3"><a href="#cb86-3"></a>  <span class="fu">tibble</span>(<span class="st">"estatura"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">1.7</span>, <span class="fl">1.8</span>, <span class="fl">1.6</span>), <span class="st">"peso"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">75</span>, <span class="dv">70</span>), <span class="st">"IMC"</span> <span class="ot">=</span> peso <span class="sc">/</span> (estatura<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb86-4"><a href="#cb86-4"></a><span class="fu">class</span>(datos_tb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a>datos_tb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 3
  estatura  peso   IMC
     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1      1.7    80  27.7
2      1.8    75  23.1
3      1.6    70  27.3</code></pre>
</div>
</div>
</div>
</section>
<section id="intento-final-tibble-1" class="slide level2">
<h2>Intento final: tibble</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a>datos_tb <span class="ot">&lt;-</span></span>
<span id="cb90-2"><a href="#cb90-2"></a>  <span class="fu">tibble</span>(<span class="st">"estatura"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">1.7</span>, <span class="fl">1.8</span>, <span class="fl">1.6</span>), <span class="st">"peso"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">75</span>, <span class="dv">70</span>), <span class="st">"IMC"</span> <span class="ot">=</span> peso <span class="sc">/</span> (estatura<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb90-3"><a href="#cb90-3"></a>datos_tb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 3
  estatura  peso   IMC
     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1      1.7    80  27.7
2      1.8    75  23.1
3      1.6    70  27.3</code></pre>
</div>
</div>
<p>Las tablas en formato <code>tibble</code> nos permitir√° una <span class="hl-yellow"><strong>gesti√≥n m√°s √°gil, eficiente y coherente</strong></span> de los datos, con 4 ventajas principales:</p>
<div class="fragment">
<ul>
<li><span class="hl-yellow"><strong>Metainformaci√≥n</strong></span>: si te fijas en la cabecera, nos dice ya autom√°ticamente el n√∫mero de filas y columnas, y el tipo de cada variable</li>
</ul>
</div>
<div class="fragment">
<ul>
<li><span class="hl-yellow"><strong>Recursividad</strong></span>: permite definir las variables secuencialmente (como hemos visto)</li>
</ul>
</div>
</section>
<section id="intento-final-tibble-2" class="slide level2">
<h2>Intento final: tibble</h2>
<ul>
<li><span class="hl-yellow"><strong>Consistencia</strong></span>: si accedes a una columna que no existe avisa con un warning</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a>datos_tb<span class="sc">$</span>invent</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Unknown or uninitialised column: `invent`.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<div class="fragment">
<ul>
<li><span class="hl-yellow"><strong>Por filas</strong></span>: crear por filas (copiar y pegar de una tabla) con <code>tribble()</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a><span class="fu">tribble</span>(<span class="sc">~</span>colA, <span class="sc">~</span>colB,</span>
<span id="cb95-2"><a href="#cb95-2"></a>        <span class="st">"a"</span>,   <span class="dv">1</span>,</span>
<span id="cb95-3"><a href="#cb95-3"></a>        <span class="st">"b"</span>,   <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 √ó 2
  colA   colB
  &lt;chr&gt; &lt;dbl&gt;
1 a         1
2 b         2</code></pre>
</div>
</div>
</div>
<div class="fragment">
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Consejo</strong></p>
</div>
<div class="callout-content">
<p>El paquete <code>{datapasta}</code> nos permite <span class="hl-green"><strong>copiar y pegar</strong></span> tablas de p√°ginas web y documentos sencillos</p>
</div>
</div>
</div>
</div>
</section>
<section id="recapitulando" class="slide level2">
<h2>Recapitulando</h2>
<ul>
<li>Cada <span class="hl-yellow"><strong>celda puede ser de un tipo diverso</strong></span>: n√∫meros, texto, fechas, valores l√≥gicos, etc</li>
</ul>
<div class="fragment">
<ul>
<li>Un <span class="hl-yellow"><strong>vector es una concatenaci√≥n de celdas</strong></span> (las futuras columnas de nuestras tablas) ‚Äì&gt; En <code>R</code> por defecto las operaciones se hacen <span class="hl-yellow"><strong>elemento a elemento</strong></span></li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Una <span class="hl-yellow"><strong>matriz</strong></span> nos permite concatenar <span class="hl-yellow"><strong>variables del MISMO tipo y MISMA longitud</strong></span> ‚Äì&gt; datos tabulados</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Un <span class="hl-yellow"><strong>data.frame</strong></span> nos permite concatenar <span class="hl-yellow"><strong>variables de DISTINTO tipo y MISMA longitud</strong></span> ‚Äì&gt; usaremos <span class="hl-yellow"><strong>tibble</strong></span> como una opci√≥n mejorada de base de datos</li>
</ul>
</div>
</section>
<section id="tu-turno-1-2" class="slide level2">
<h2>üíª Tu turno (tb/df)</h2>
<p><span style="color:#444442;"><strong>Intenta realizar los siguientes ejercicios sin mirar las soluciones</strong></span></p>
<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1"><span class="hl-yellow"><strong>Ejercicio 1</strong></span></a></li><li><a href="#tabset-2-2"><span class="hl-yellow"><strong>Ejercicio 2</strong></span></a></li><li><a href="#tabset-2-3"><span class="hl-yellow"><strong>Ejercicio 3</strong></span></a></li><li><a href="#tabset-2-4"><span class="hl-yellow"><strong>Ejercicio 4</strong></span></a></li><li><a href="#tabset-2-5"><span class="hl-yellow"><strong>Ejercicio 5</strong></span></a></li><li><a href="#tabset-2-6"><span class="hl-yellow"><strong>Ejercicio 6</strong></span></a></li><li><a href="#tabset-2-7"><span class="hl-yellow"><strong>Ejercicio 7</strong></span></a></li><li><a href="#tabset-2-8"><span class="hl-yellow"><strong>Ejercicio 8</strong></span></a></li></ul>
<div class="tab-content">
<div id="tabset-2-1">
<p>üìù Carga del paquete <code>{datasets}</code> el conjunto de datos <code>airquality</code> (variables de la calidad del aire de Nueva York desde mayo hasta septiembre de 1973). ¬øEs el conjunto de datos airquality de tipo tibble? En caso negativo, convi√©rtelo a tibble (busca en la documentaci√≥n del paquete en <a href="https://tibble.tidyverse.org/index.html" class="uri">https://tibble.tidyverse.org/index.html</a>).</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb97-2"><a href="#cb97-2"></a><span class="fu">class</span>(datasets<span class="sc">::</span>airquality)</span>
<span id="cb97-3"><a href="#cb97-3"></a>airquality_tb <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(datasets<span class="sc">::</span>airquality)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-2-2">
<p>üìù Una vez convertido a <code>tibble</code> obt√©n el nombre de las variables y las dimensiones del conjunto de datos. ¬øCu√°ntas variables hay? ¬øCu√°ntos d√≠as se han medido?</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1"></a><span class="fu">names</span>(airquality_tb)</span>
<span id="cb98-2"><a href="#cb98-2"></a><span class="fu">ncol</span>(airquality_tb)</span>
<span id="cb98-3"><a href="#cb98-3"></a><span class="fu">nrow</span>(airquality_tb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-2-3">
<p>üìù Filtra solo los datos de la quinta observaci√≥n</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a>airquality_tb[Month <span class="sc">==</span> <span class="dv">8</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-2-4">
<p>üìù Filtra solo los datos del mes de agosto. ¬øC√≥mo indicarle que queremos solo las filas que cumplan una condici√≥n concreta? (pista: en realidad todo son vectores ‚Äúformateados‚Äù)</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1"></a>airquality_tb[Month <span class="sc">==</span> <span class="dv">8</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-2-5">
<p>üìù Selecciona aquellos datos que no sean ni de julio ni de agosto.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a>airquality_tb[Month <span class="sc">!=</span> <span class="dv">7</span> <span class="sc">&amp;</span> Month <span class="sc">!=</span> <span class="dv">8</span>, ]</span>
<span id="cb101-2"><a href="#cb101-2"></a>airquality_tb[<span class="sc">!</span>(Month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">8</span>)), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-2-6">
<p>üìù Modifica el siguiente c√≥digo para quedarte solo con las variable de ozono y temperatura (sin importar qu√© posici√≥n ocupen)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a>airquality_tb[, <span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-7">
<p>üìù Selecciona los datos de temperatura y viento de agosto.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a>airquality_tb[Month <span class="sc">==</span> <span class="dv">8</span>, <span class="fu">c</span>(<span class="st">"Temp"</span>, <span class="st">"Wind"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-2-8">
<p>üìù Traduce a castellano el nombre de las variables.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a><span class="fu">names</span>(airquality_tb) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ozono"</span>, <span class="st">"rad_solar"</span>, <span class="st">"viento"</span>, <span class="st">"temp"</span>, <span class="st">"mes"</span>, <span class="st">"dia"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="caso-practico-1-1" class="slide level2">
<h2>üê£ Caso pr√°ctico I: tibble</h2>
<p>Del paquete <code>{Biostatistics}</code> usaremos el conunto de datos <code>pinniped</code>, que guarda los <strong>datos de peso de cuerpo y cerebro</strong> (desagregado por sexo y mono/poligamia) de 33 especies de mam√≠feros marinos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a>Biostatistics<span class="sc">::</span>pinniped</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       Species Male_brain_g Female_brain_g Male_mass_Kg
1       Monachus schauinslandi        370.0             NA        173.0
2            Monachus monachus        480.0          480.0        260.0
3      Mirounga angustirostris        700.0          640.0       2275.0
4             Mirounga leonina       1431.3          898.8       3510.0
5       Leptonychotes weddelli        535.0          637.5        450.0
6            Ommatophoca rossi        425.0          530.0        153.8
7        Lobodon carcinophagus        578.2          538.8        220.5
8            Hydrurga leptonyx        765.0          660.0        324.0
9          Cystophora cristata        480.0          430.0        343.2
10         Erignathus barbatus           NA          460.0        312.5
11          Halichoerus grypus        342.5          272.5        233.0
12          Phoca groenlandica        297.5          252.5        145.0
13              Phoca fasciata        257.5          240.0         94.8
14                Phoca largha        257.5          250.0         97.0
15               Phoca caspica        165.0          160.0         70.5
16              Phoca sibirica        185.0          190.0         89.5
17               Phoca hispida        229.3          220.0         84.0
18              Phoca vitulina        362.3          265.0         97.1
19      Zalophus californianus        405.0          361.5        244.5
20          Eumetopias jubatus        747.5          575.0       1000.0
21              Otaria byronia        546.3          470.0        300.0
22            Neophoca cinerea        440.0          337.5        300.0
23          Phocarctos hookeri        417.5          370.0        364.0
24         Callorhinus ursinus        355.0          302.5        140.0
25     Arctocephalus townsendi           NA             NA        112.0
26     Arctocephalus philippii        415.0             NA        140.0
27 Arctocephalus galapagoensis        302.5          280.0         64.5
28     Arctocephalus australis        350.0          265.0         91.0
29      Arctocephalus forsteri        340.0          300.0        125.0
30       Arctocephalus gazella        360.0          320.0        155.0
31    Arctocephalus tropicalis        322.5          330.0        152.5
32      Arctocephalus pusillus        401.3          337.5        263.0
33           Odobenus rosmarus       1303.0         1340.5       1233.0
   Female_mass_Kg Mate_type
1           272.2      mono
2           275.0      mono
3           488.0      poly
4           565.7      poly
5           447.0      poly
6           164.0      mono
7           224.0      mono
8           367.0      mono
9           222.5      mono
10          326.0      mono
11          205.8      poly
12          139.0      mono
13           80.4      mono
14           71.3      mono
15           55.0      mono
16           85.0      mono
17           81.2      mono
18           85.2      mono
19           81.0      poly
20          287.5      poly
21          144.0      poly
22           78.6      poly
23          114.7      poly
24           33.3      poly
25           49.6      poly
26           48.1      poly
27           27.4      poly
28           48.5      poly
29           38.1      poly
30           45.0      poly
31           50.0      poly
32           64.1      poly
33          811.5      poly</code></pre>
</div>
</div>
<p>Intenta responder a las preguntas planteadas en el <a href="https://javieralvarezliebana.quarto.pub/repaso-r-ts/"><strong>workbook</strong></a></p>
</section>
<section id="comunicar-rmd-y-quarto" class="slide level2">
<h2>Comunicar: rmd y Quarto</h2>
<p>Una de las <span class="hl-yellow"><strong>principales fortalezas</strong></span> de <code>R</code> es la <span class="hl-yellow"><strong>facilidad para generar informes, libros, webs, apuntes y hasta diapositivas</strong></span> (este mismo material por ejemplo). Para ello <span class="hl-purple"><strong>instalaremos</strong></span> antes</p>
<div class="columns">
<div class="column" style="width:40%;">
<ul>
<li>el paquete <code>{rmarkdown}</code> (para generar archivos <code>.rmd</code>)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a><span class="fu">install.packages</span>(<span class="st">"rmarkdown"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>instalar <a href="https://quarto.org/docs/get-started/"><strong>Quarto</strong></a> (si ya conoc√≠as <code>R</code>, el ¬´nuevo¬ª <code>.rmd</code> ahora como <code>.qmd</code>)</li>
</ul>
</div><div class="column" style="width:60%;">
<p><img data-src="img/quarto.png"></p>
</div>
</div>
</section>
<section id="comunicar-rmd-y-quarto-1" class="slide level2">
<h2>Comunicar: rmd y Quarto</h2>
<p>Hasta ahora solo hemos programado en scripts (archivos <code>.R</code>) dentro de proyectos, pero en muchas ocasiones <span class="hl-yellow"><strong>no trabajaremos solos</strong></span> y necesitaremos <span class="hl-yellow"><strong>comunicar los resultados</strong></span> en diferentes formatos:</p>
<ul>
<li>apuntes (para nosotros mismos)</li>
<li>diapositivas</li>
<li>web</li>
<li>informes</li>
</ul>
<p>Para todo ello usaremos <span class="hl-yellow"><strong>Quarto</strong></span> (ver m√°s en <a href="https://ivelasq.quarto.pub/intro-to-quarto/" class="uri">https://ivelasq.quarto.pub/intro-to-quarto/</a>)</p>
</section>
<section id="comunicar-rmd-y-quarto-2" class="slide level2">
<h2>Comunicar: rmd y Quarto</h2>
<p>Los archivos de extensi√≥n <code>.qmd</code> (o <code>.rmd</code> antes) nos permitir√°n f√°cilmente combinar:</p>
<ul>
<li><span class="hl-yellow"><strong>Markdown</strong></span>: <span class="hl-purple"><strong>lenguaje tipado</strong></span> que nos permite crear contenido simple (tipo wordpress, con texto, <strong>negritas</strong>, <em>cursivas</em>, etc) con un dise√±o legible.</li>
</ul>
<div class="fragment">
<ul>
<li><span class="hl-yellow"><strong>Matem√°ticas (latex)</strong></span>: lenguaje para escribir notaci√≥n matem√°tica como <span class="math inline">\(x^2\)</span> o <span class="math inline">\(\sqrt{y}\)</span> o <span class="math inline">\(\int_{a}^{b} f(x) dx\)</span></li>
</ul>
</div>
<div class="fragment">
<ul>
<li><span class="hl-yellow"><strong>C√≥digo y salidas</strong></span>: podremos no solo mostrar el paso final sino el c√≥digo que has ido realizando (en <code>R</code>, <code>Python</code>, <code>C++</code>, <code>Julia</code>, ‚Ä¶), con <span class="hl-purple"><strong>cajitas de c√≥digo llamadas CHUNKS</strong></span>.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Im√°genes, <span class="hl-yellow"><strong>gr√°ficas</strong></span>, tablas, estilos (css, js), etc.</li>
</ul>
</div>
</section>
<section id="comunicar-rmd-y-quarto-3" class="slide level2">
<h2>Comunicar: rmd y Quarto</h2>
<p>La principal ventaja de realizar este tipo de material en Quarto/Rmarkdown es que, al hacerlo desde <code>RStudio</code>, puedes generar un <span class="hl-yellow"><strong>informe o una presentaci√≥n sin salirte del entorno de programaci√≥n</strong></span> en el que est√°s trabajando</p>
<p>De esta forma podr√°s analizar los datos, resumirlos y a la vez comunicarlos con la misma herramienta.</p>
<div class="fragment">
<p>Recientemente el equipo de <code>RStudio</code> desarroll√≥ <span class="hl-yellow"><strong>Quarto</strong></span>, una versi√≥n mejorada de Rmarkdown (archivos <code>.qmd</code>), con un formato un poco m√°s est√©tico y simple. Tienes toda la documentaci√≥n y ejemplos en <a href="https://quarto.org/"><strong>https://quarto.org/</strong></a></p>
</div>
</section>
<section id="usos-de-quarto" class="slide level2">
<h2>Usos de Quarto</h2>
<div class="panel-tabset">
<ul id="tabset-3" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-3-1">Webs</a></li><li><a href="#tabset-3-2">Libros</a></li><li><a href="#tabset-3-3">Blogs</a></li><li><a href="#tabset-3-4">Presentaciones</a></li><li><a href="#tabset-3-5">Revistas</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1">
<p><img data-src="./img/website.png" height="350"></p>
</div>
<div id="tabset-3-2">
<p><img data-src="./img/book.png" height="350"></p>
</div>
<div id="tabset-3-3">
<p><img data-src="./img/blog.png" height="350"></p>
</div>
<div id="tabset-3-4">
<p><img data-src="./img/presentation.png" height="350"></p>
</div>
<div id="tabset-3-5">
<p><img data-src="https://user-images.githubusercontent.com/163582/42351114-e5deaa1c-8078-11e8-90de-2aff57bba255.png" height="350"></p>
</div>
</div>
</div>
<p>Im√°genes obtenidas de <a href="https://ivelasq.quarto.pub/intro-to-quarto/#/working-with-the-rstudio-visual-editor" class="uri">https://ivelasq.quarto.pub/intro-to-quarto/#/working-with-the-rstudio-visual-editor</a></p>
</section>
<section id="nuestro-primer-informe" class="slide level2">
<h2>Nuestro primer informe</h2>
<div class="columns">
<div class="column" style="width:55%;">
<p><img data-src="img/quarto-create.png"></p>
</div><div class="column" style="width:45%;">
<p>Vamos a crear el <span class="hl-yellow"><strong>primer fichero rmarkdown con Quarto</strong></span> con extensi√≥n <code>.qmd</code>. Para ello solo necesitaremos hacer click en</p>
<p><code>File &lt;&lt; New File &lt;&lt; Quarto Document</code></p>
</div>
</div>
</section>
<section id="nuestro-primer-informe-1" class="slide level2">
<h2>Nuestro primer informe</h2>
<div class="columns">
<div class="column" style="width:45%;">
<p><img data-src="img/quarto-format.png"></p>
</div><div class="column" style="width:55%;">
<p>Tras hacerlo nos aparecer√°n varias <span class="hl-yellow"><strong>opciones de formatos de salida</strong></span>:</p>
<ul>
<li>archivo <code>.pdf</code></li>
<li>archivo <code>.html</code> (<span class="hl-yellow"><strong>recomendable</strong></span>): documento din√°mico, permite la interacci√≥n con el usuario, como una ¬´p√°gina web¬ª.</li>
<li>archivo <code>.doc</code> (nada recomendable)</li>
</ul>
</div>
</div>
<div class="fragment">
<p>De momento dejaremos marcado el <span class="hl-yellow"><strong>formato HTML que viene por defecto</strong></span>, y escribiremos el <span class="hl-yellow"><strong>t√≠tulo</strong></span> de nuestro documento. Tras ello tendremos nuestro <span class="hl-yellow"><strong>archivo .qmd</strong></span> (ya no es un script .R como los que hemos abierto hasta ahora).</p>
</div>
</section>
<section id="nuestro-primer-informe-2" class="slide level2">
<h2>Nuestro primer informe</h2>
<div class="columns">
<div class="column" style="width:60%;">
<p><img data-src="img/quarto-example.png"></p>
</div><div class="column" style="width:40%;">
<p>Deber√≠as tener algo similar a la captura de la imagen con <span class="hl-yellow"><strong>dos modos de edici√≥n</strong></span>: <code>Source</code> (con c√≥digo, la opci√≥n recomendada hasta que lo domines) y <code>Visual</code> (m√°s parecido a un blog)</p>
</div>
</div>
<p>Para <span class="hl-yellow"><strong>ejecutar TODO el documento</strong></span> debes clickar <code>Render on Save</code> y darle a guardar.</p>
</section>
<section id="salida-de-quarto" class="slide level2">
<h2>Salida de Quarto</h2>

<img data-src="img/quarto-prueba-html.png" class="r-stretch"><p>Deber√≠as haber obtenido una <span class="hl-yellow"><strong>salida en html similar a esta</strong></span> (y se te ha generado en tu ordenador un <span class="hl-yellow"><strong>archivo html</strong></span>)</p>
</section>
<section id="editor-source-vs-visual" class="slide level2">
<h2>Editor: source vs visual</h2>
<p>Como se indicaba, tienes dos formas de trabajar: con c√≥digo puro y algo parecido a un Notion (blog)</p>

<img data-src="./img/rstudio-source-visual.png" class="r-stretch"><p>Imagen obtenida de <a href="https://ivelasq.quarto.pub/intro-to-quarto/#/working-with-the-rstudio-visual-editor" class="uri">https://ivelasq.quarto.pub/intro-to-quarto/#/working-with-the-rstudio-visual-editor</a></p>
</section>
<section id="nuestro-primer-informe-3" class="slide level2">
<h2>Nuestro primer informe</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="img/quarto-example.png"></p>
</div><div class="column" style="width:50%;">
<p>Un fichero <code>.qmd</code> se <span class="hl-yellow"><strong>divide b√°sicamente en tres partes</strong></span>:</p>
<ul>
<li><p><span class="hl-yellow"><strong>Cabecera</strong></span>: la parte que tienes al inicio entre <code>---</code>.</p></li>
<li><p><span class="hl-yellow"><strong>Texto</strong></span>: que podremos formatear y mejorar con negritas (escrito como <strong>negritas</strong>, con doble ast√©risco al inicio y final), cursivas (<em>cursivas</em>, con barra baja al inicio y final) o destacar nombres de funciones o variables de R. Puedes a√±adir ecuaciones como <span class="math inline">\(x^2\)</span> (he escrito <code>$x^2$</code>, entre d√≥lares).</p></li>
<li><p><span class="hl-yellow"><strong>C√≥digo R</strong></span></p></li>
</ul>
</div>
</div>
</section>
<section id="cabecera-de-un-qmd" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Cabecera de un qmd</h2>
<p>La <span class="hl-yellow"><strong>cabecera est√°n en formato YAML</strong></span> y contiene los <span class="hl-yellow"><strong>metadatos</strong></span> del documento</p>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li><code>title</code> y <code>subtitle</code>: el t√≠tulo/subt√≠tulo del documento</li>
<li><code>author</code>: autor del mismo</li>
<li><code>format</code>: formato de salida (podremos personalizar)
<ul>
<li><code>theme</code>: si tienes alg√∫n archivo de estilos</li>
<li><code>toc</code>: si quieres √≠ndice o no</li>
<li><code>toc-location</code>: posici√≥n del √≠ndice</li>
<li><code>toc-title</code>: t√≠tulo del √≠ndice</li>
</ul></li>
<li><code>editor</code>: si est√°s en modo visual o source.</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="sourceCode" id="cb108"><pre class="sourceCode numberSource yaml number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode yaml hljs"><span id="cb108-1" class="hljs-ln-code"><a href="#cb108-1"></a><span class="pp">---</span></span>
<span id="cb108-2" class="hljs-ln-code"><a href="#cb108-2"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"prueba"</span></span>
<span id="cb108-3" class="hljs-ln-code"><a href="#cb108-3"></a><span class="fu">format</span><span class="kw">:</span></span>
<span id="cb108-4" class="hljs-ln-code"><a href="#cb108-4"></a><span class="at">  </span><span class="fu">html</span><span class="kw">:</span></span>
<span id="cb108-5" class="hljs-ln-code"><a href="#cb108-5"></a><span class="fu">editor</span><span class="kw">:</span><span class="at"> visual</span></span>
<span id="cb108-6" class="hljs-ln-code"><a href="#cb108-6"></a><span class="pp">---</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="cabecera-de-un-qmd-1" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Cabecera de un qmd</h2>
<p>La <span class="hl-yellow"><strong>cabecera est√°n en formato YAML</strong></span> y contiene los <span class="hl-yellow"><strong>metadatos</strong></span> del documento</p>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li><code>title</code> y <code>subtitle</code>: el t√≠tulo/subt√≠tulo del documento</li>
<li><code>author</code>: autor del mismo</li>
<li><code>format</code>: formato de salida (podremos personalizar)
<ul>
<li><code>theme</code>: si tienes alg√∫n archivo de estilos</li>
<li><code>toc</code>: si quieres √≠ndice o no</li>
<li><code>toc-location</code>: posici√≥n del √≠ndice</li>
<li><code>toc-title</code>: t√≠tulo del √≠ndice</li>
</ul></li>
<li><code>editor</code>: si est√°s en modo visual o source.</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="sourceCode" id="cb109"><pre class="sourceCode numberSource yaml number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode yaml hljs"><span id="cb109-1" class="hljs-ln-code"><a href="#cb109-1"></a><span class="pp">---</span></span>
<span id="cb109-2" class="hljs-ln-code"><a href="#cb109-2"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"prueba"</span></span>
<span id="cb109-3" class="hljs-ln-code"><a href="#cb109-3"></a><span class="fu">author</span><span class="kw">:</span><span class="at"> </span><span class="st">"javier √°lvarez li√©bana"</span></span>
<span id="cb109-4" class="hljs-ln-code"><a href="#cb109-4"></a><span class="fu">format</span><span class="kw">:</span></span>
<span id="cb109-5" class="hljs-ln-code"><a href="#cb109-5"></a><span class="at">  </span><span class="fu">html</span><span class="kw">:</span></span>
<span id="cb109-6" class="hljs-ln-code"><a href="#cb109-6"></a><span class="fu">editor</span><span class="kw">:</span><span class="at"> visual</span></span>
<span id="cb109-7" class="hljs-ln-code"><a href="#cb109-7"></a><span class="pp">---</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="cabecera-de-un-qmd-2" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Cabecera de un qmd</h2>
<p>La <span class="hl-yellow"><strong>cabecera est√°n en formato YAML</strong></span> y contiene los <span class="hl-yellow"><strong>metadatos</strong></span> del documento</p>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li><code>title</code> y <code>subtitle</code>: el t√≠tulo/subt√≠tulo del documento</li>
<li><code>author</code>: autor del mismo</li>
<li><code>format</code>: formato de salida (podremos personalizar)
<ul>
<li><code>theme</code>: si tienes alg√∫n archivo de estilos</li>
<li><code>toc</code>: si quieres √≠ndice o no</li>
<li><code>toc-location</code>: posici√≥n del √≠ndice</li>
<li><code>toc-title</code>: t√≠tulo del √≠ndice</li>
</ul></li>
<li><code>editor</code>: si est√°s en modo visual o source.</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="sourceCode" id="cb110"><pre class="sourceCode numberSource yaml number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode yaml hljs"><span id="cb110-1" class="hljs-ln-code"><a href="#cb110-1"></a><span class="pp">---</span></span>
<span id="cb110-2" class="hljs-ln-code"><a href="#cb110-2"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"prueba"</span></span>
<span id="cb110-3" class="hljs-ln-code"><a href="#cb110-3"></a><span class="fu">author</span><span class="kw">:</span><span class="at"> </span><span class="st">"javier √°lvarez li√©bana"</span></span>
<span id="cb110-4" class="hljs-ln-code"><a href="#cb110-4"></a><span class="fu">format</span><span class="kw">:</span></span>
<span id="cb110-5" class="hljs-ln-code"><a href="#cb110-5"></a><span class="at">  </span><span class="fu">html</span><span class="kw">:</span></span>
<span id="cb110-6" class="hljs-ln-code"><a href="#cb110-6"></a><span class="at">    </span><span class="fu">style</span><span class="kw">:</span><span class="at"> style.css</span></span>
<span id="cb110-7" class="hljs-ln-code"><a href="#cb110-7"></a><span class="at">    </span><span class="fu">toc</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb110-8" class="hljs-ln-code"><a href="#cb110-8"></a><span class="fu">editor</span><span class="kw">:</span><span class="at"> visual</span></span>
<span id="cb110-9" class="hljs-ln-code"><a href="#cb110-9"></a><span class="pp">---</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="cabecera-de-un-qmd-3" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Cabecera de un qmd</h2>
<p>La <span class="hl-yellow"><strong>cabecera est√°n en formato YAML</strong></span> y contiene los <span class="hl-yellow"><strong>metadatos</strong></span> del documento</p>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li><code>title</code> y <code>subtitle</code>: el t√≠tulo/subt√≠tulo del documento</li>
<li><code>author</code>: autor del mismo</li>
<li><code>format</code>: formato de salida (podremos personalizar)
<ul>
<li><code>theme</code>: si tienes alg√∫n archivo de estilos</li>
<li><code>toc</code>: si quieres √≠ndice o no</li>
<li><code>toc-location</code>: posici√≥n del √≠ndice</li>
<li><code>toc-title</code>: t√≠tulo del √≠ndice</li>
</ul></li>
<li><code>editor</code>: si est√°s en modo visual o source.</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="sourceCode" id="cb111"><pre class="sourceCode numberSource yaml number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode yaml hljs"><span id="cb111-1" class="hljs-ln-code"><a href="#cb111-1"></a><span class="pp">---</span></span>
<span id="cb111-2" class="hljs-ln-code"><a href="#cb111-2"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"prueba"</span></span>
<span id="cb111-3" class="hljs-ln-code"><a href="#cb111-3"></a><span class="fu">author</span><span class="kw">:</span><span class="at"> </span><span class="st">"javier √°lvarez li√©bana"</span></span>
<span id="cb111-4" class="hljs-ln-code"><a href="#cb111-4"></a><span class="fu">format</span><span class="kw">:</span></span>
<span id="cb111-5" class="hljs-ln-code"><a href="#cb111-5"></a><span class="at">  </span><span class="fu">html</span><span class="kw">:</span></span>
<span id="cb111-6" class="hljs-ln-code"><a href="#cb111-6"></a><span class="at">    </span><span class="fu">style</span><span class="kw">:</span><span class="at"> style.css</span></span>
<span id="cb111-7" class="hljs-ln-code"><a href="#cb111-7"></a><span class="at">    </span><span class="fu">toc</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb111-8" class="hljs-ln-code"><a href="#cb111-8"></a><span class="at">    </span><span class="fu">toc-location</span><span class="kw">:</span><span class="at"> left</span></span>
<span id="cb111-9" class="hljs-ln-code"><a href="#cb111-9"></a><span class="fu">editor</span><span class="kw">:</span><span class="at"> visual</span></span>
<span id="cb111-10" class="hljs-ln-code"><a href="#cb111-10"></a><span class="pp">---</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="cabecera-de-un-qmd-4" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Cabecera de un qmd</h2>
<p>La <span class="hl-yellow"><strong>cabecera est√°n en formato YAML</strong></span> y contiene los <span class="hl-yellow"><strong>metadatos</strong></span> del documento</p>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li><code>title</code> y <code>subtitle</code>: el t√≠tulo/subt√≠tulo del documento</li>
<li><code>author</code>: autor del mismo</li>
<li><code>format</code>: formato de salida (podremos personalizar)
<ul>
<li><code>theme</code>: si tienes alg√∫n archivo de estilos</li>
<li><code>toc</code>: si quieres √≠ndice o no</li>
<li><code>toc-location</code>: posici√≥n del √≠ndice</li>
<li><code>toc-title</code>: t√≠tulo del √≠ndice</li>
</ul></li>
<li><code>editor</code>: si est√°s en modo visual o source.</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="sourceCode" id="cb112"><pre class="sourceCode numberSource yaml number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode yaml hljs"><span id="cb112-1" class="hljs-ln-code"><a href="#cb112-1"></a><span class="pp">---</span></span>
<span id="cb112-2" class="hljs-ln-code"><a href="#cb112-2"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"prueba"</span></span>
<span id="cb112-3" class="hljs-ln-code"><a href="#cb112-3"></a><span class="fu">author</span><span class="kw">:</span><span class="at"> </span><span class="st">"javier √°lvarez li√©bana"</span></span>
<span id="cb112-4" class="hljs-ln-code"><a href="#cb112-4"></a><span class="fu">format</span><span class="kw">:</span></span>
<span id="cb112-5" class="hljs-ln-code"><a href="#cb112-5"></a><span class="at">  </span><span class="fu">html</span><span class="kw">:</span></span>
<span id="cb112-6" class="hljs-ln-code"><a href="#cb112-6"></a><span class="at">    </span><span class="fu">style</span><span class="kw">:</span><span class="at"> style.css</span></span>
<span id="cb112-7" class="hljs-ln-code"><a href="#cb112-7"></a><span class="at">    </span><span class="fu">toc</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb112-8" class="hljs-ln-code"><a href="#cb112-8"></a><span class="at">    </span><span class="fu">toc-location</span><span class="kw">:</span><span class="at"> left</span></span>
<span id="cb112-9" class="hljs-ln-code"><a href="#cb112-9"></a><span class="at">    </span><span class="fu">toc-title</span><span class="kw">:</span><span class="at"> √çndice</span></span>
<span id="cb112-10" class="hljs-ln-code"><a href="#cb112-10"></a><span class="fu">editor</span><span class="kw">:</span><span class="at"> visual</span></span>
<span id="cb112-11" class="hljs-ln-code"><a href="#cb112-11"></a><span class="pp">---</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="texto-de-un-qmd" class="slide level2">
<h2>Texto de un qmd</h2>
<p>Respecto a la escritura solo hay una <span class="hl-yellow"><strong>cosa importante</strong></span>: salvo que indiquemos lo contrario, <span class="hl-yellow"><strong>TODO lo que vamos a escribir es texto (normal)</strong></span>. No c√≥digo R.</p>
<div class="columns">
<div class="column" style="width:35%;">
<p><img data-src="img/quarto-prueba-qmd2.png" width="350"> <img data-src="img/quarto-prueba-html2.png" width="320"></p>
</div><div class="column" style="width:65%;">
<p>Vamos a empezar escribiendo una secci√≥n al inicio (<code># Intro</code> y detr√°s por ej. la frase</p>
<blockquote>
<p>Este material ha sido dise√±ado por el profesor Javier √Ålvarez Li√©bana, docente en la Universidad Complutense de Madrid</p>
</blockquote>
<p>Adem√°s al <code>Running Code</code> le a√±adiremos una almohadilla <code>#</code>: las <span class="hl-yellow"><strong>almohadillas FUERA DE CHUNKS</strong></span> nos servir√°n para crear <span class="hl-yellow"><strong>ep√≠grafes (secciones)</strong></span> en el documento</p>
</div>
</div>
</section>
<section id="√≠ndice-de-un-qmd" class="slide level2">
<h2>√çndice de un qmd</h2>
<div class="columns">
<div class="column" style="width:40%;">
<p><img data-src="img/quarto-indice-qmd-2.png" width="370"> <img data-src="img/quarto-indice-html2.png" width="370"></p>
</div><div class="column" style="width:60%;">
<p>Para que el <span class="hl-yellow"><strong>√≠ndice capture dichas secciones</strong></span> modificaremos la cabecera del archivo como se observa en la imagen (puedes cambiar la localizaci√≥n del √≠ndice y el t√≠tulo si quieres para probar).</p>
</div>
</div>
</section>
<section id="texto-en-un-qmd" class="slide level2">
<h2>Texto en un qmd</h2>
<p>Vamos a <span class="hl-yellow"><strong>personalizar un poco el texto</strong></span> haciendo lo siguiente:</p>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="img/quarto-texto-mejorado-qmd.png" width="370"> <img data-src="img/quarto-texto-mejorado-html.png" width="370"></p>
</div><div class="column" style="width:50%;">
<ul>
<li><p>Vamos a a√±adir <span class="hl-yellow"><strong>negrita al nombre</strong></span> (poniendo ** al inicio y al final).</p></li>
<li><p>Vamos a√±adir <span class="hl-yellow"><strong>cursiva</strong></span> a la palabra material (poniendo _ al inicio y al final).</p></li>
<li><p>Vamos a√±adir un <span class="hl-yellow"><strong>enlace</strong></span> <a href="https://www.ucm.es" class="uri">https://www.ucm.es</a>, asoci√°ndolo al nombre de la Universidad. Para ello el t√≠tulo lo ponemos entre corchetes y justo detr√°s el enlace entre par√©ntesis <code>[¬´Universidad Complutense de Madrid¬ª](https://www.ucm.es)</code></p></li>
</ul>
</div>
</div>
</section>
<section id="c√≥digo-en-un-qmd" class="slide level2">
<h2>C√≥digo en un qmd</h2>
<p>Para <span class="hl-yellow"><strong>a√±adir c√≥digo R</strong></span> debemos crear nuestras <span class="hl-yellow"><strong>cajas de c√≥digo llamadas chunks</strong></span>: altos en el camino en nuestro texto markdown donde podremos incluir c√≥digo de casi cualquier lenguaje (y sus salidas).</p>
<p>&nbsp;</p>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="img/quarto-chunk-qmd.png" width="470"></p>
</div><div class="column" style="width:50%;">
<p>Para incluir uno deber√° de ir <span class="hl-yellow"><strong>encabezado</strong></span> de la siguiente forma tienes un atajo <code>Command + Option + I</code> (Mac) o <code>Ctrl + Shift + I</code> (Windows)</p>
</div>
</div>
</section>
<section id="c√≥digo-en-un-qmd-1" class="slide level2">
<h2>C√≥digo en un qmd</h2>
<p>Dentro de dicha cajita (que tiene ahora otro color en el documento) <span class="hl-yellow"><strong>escribiremos c√≥digo R</strong></span> como lo ven√≠amos haciendo hasta ahora en los scripts.</p>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="img/quarto-chunk-1-qmd.png" width="410"> <img data-src="img/quarto-chunk-1-html.png" width="410"></p>
</div><div class="column" style="width:50%;">
<p>Vamos por ejemplo a definir dos variables y su suma de la siguiente manera, escribiendo dicho c√≥digo en nuestro <code>.qmd</code> (dentro de ese chunk)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1"></a><span class="co"># C√≥digo R</span></span>
<span id="cb113-2"><a href="#cb113-2"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb113-3"><a href="#cb113-3"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb113-4"><a href="#cb113-4"></a>x <span class="sc">+</span> y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="etiquetando-chunks" class="slide level2">
<h2>Etiquetando chunks</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="img/quarto-tag-chunks-qmd.png" width="400"> <img data-src="img/quarto-tag-chunks-html.png" width="400"></p>
</div><div class="column" style="width:50%;">
<p>Los chunks pueden tener un <span class="hl-yellow"><strong>nombre o etiqueta</strong></span>, de forma que podamos referenciarlos de nuevo para no repetir c√≥digo.</p>
</div>
</div>
</section>
<section id="ejecutando-chunks" class="slide level2">
<h2>Ejecutando chunks</h2>
<div class="columns">
<div class="column" style="width:40%;">
<p><img data-src="img/quarto-inline-qmd.png" width="400"> <img data-src="img/quarto-inline-html.png" width="380"></p>
</div><div class="column" style="width:60%;">
<p>En cada chunk aparecen <span class="hl-yellow"><strong>dos botones</strong></span>:</p>
<ul>
<li><p>bot√≥n de <span class="hl-yellow"><strong>play</strong></span>: activa la <span class="hl-yellow"><strong>ejecuci√≥n y salida de ese chunk particular</strong></span> (lo puedes visualizar dentro de tu propio <code>RStudio</code>)</p></li>
<li><p>bot√≥n de <span class="hl-yellow"><strong>rebobinar</strong></span>: activa la <span class="hl-yellow"><strong>ejecuci√≥n y salida de todos los chunk hasta ese</strong></span> (sin llegar a √©l)</p></li>
</ul>
<p>&nbsp;</p>
<p>Adem√°s podemos <span class="hl-yellow"><strong>incluir c√≥digo R dentro de la l√≠nea de texto</strong></span> (en lugar de mostrar el texto x ejecuta el c√≥digo R mostrando la variable).</p>
</div>
</div>
</section>
<section id="personalizaci√≥n-de-chunks" class="slide level2">
<h2>Personalizaci√≥n de chunks</h2>
<p>Los <span class="hl-yellow"><strong>chunks podemos personalizarlos</strong></span> con opciones al inicio del chunk precedido de <code>#|</code>:</p>
<ul>
<li><p><code>#| echo: false</code>: <span class="hl-green"><strong>ejecuta c√≥digo</strong></span> y se <span class="hl-green"><strong>muestra resultado</strong></span> pero <span class="hl-red"><strong>no visualiza c√≥digo</strong></span> en la salida.</p></li>
<li><p><code>#| include: false</code>: <span class="hl-green"><strong>ejecuta c√≥digo</strong></span> pero <span class="hl-red"><strong>no muestra resultado</strong></span> y <span class="hl-red"><strong>no visualiza c√≥digo</strong></span> en la salida.</p></li>
<li><p><code>#| eval: false</code>: <span class="hl-red"><strong>no ejecuta c√≥digo</strong></span>, <span class="hl-red"><strong>no muestra resultado</strong></span> pero <span class="hl-green"><strong>s√≠ visualiza c√≥digo</strong></span> en la salida.</p></li>
<li><p><code>#| message: false</code>: <span class="hl-green"><strong>ejecuta c√≥digo</strong></span> pero <span class="hl-red"><strong>no muestra mensajes de salida</strong></span>.</p></li>
<li><p><code>#| warning: false</code>: <span class="hl-green"><strong>ejecuta c√≥digo</strong></span> pero <span class="hl-red"><strong>no muestra mensajes de warning</strong></span>.</p></li>
<li><p><code>#| error: true</code>: <span class="hl-green"><strong>ejecuta c√≥digo</strong></span> y <span class="hl-green"><strong>permite que haya errores</strong></span> mostrando el mensaje de error en la salida.</p></li>
</ul>

<img data-src="img/quarto-options-chunk.png" width="380" class="r-stretch"><p>Estas opciones podemos aplicarlas chunk a chunk o fijar los par√°metros de forma global con <code>knitr::opts_chunk$set()</code> al inicio del documento (dentro de un chunk).</p>
</section>
<section id="personalizando-chunks" class="slide level2">
<h2>Personalizando chunks</h2>
<p>Si queremos que aplique la <strong>opci√≥n a todos los chunks por defecto</strong> debemos incluirlo al final de la cabecera, como <span class="hl-yellow"><strong>opciones de ejecuci√≥n</strong></span></p>
<div class="sourceCode" id="cb115"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb115-1"><a href="#cb115-1"></a><span class="pp">---</span></span>
<span id="cb115-2"><a href="#cb115-2"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"¬°Hola!"</span></span>
<span id="cb115-3"><a href="#cb115-3"></a><span class="fu">format</span><span class="kw">:</span><span class="at"> html</span></span>
<span id="cb115-4"><a href="#cb115-4"></a><span class="fu">editor</span><span class="kw">:</span><span class="at"> visual</span></span>
<span id="cb115-5"><a href="#cb115-5"></a><span class="fu">execute</span><span class="kw">:</span></span>
<span id="cb115-6"><a href="#cb115-6"></a><span class="at">  </span><span class="fu">echo</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb115-7"><a href="#cb115-7"></a><span class="pp">---</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="organizando-qmd" class="slide level2">
<h2>Organizando qmd</h2>
<p>Adem√°s de texto y c√≥digo podemos introducir lo siguiente:</p>
<ul>
<li><p><span class="hl-yellow"><strong>Ecuaciones</strong></span>: puedes a√±adir adem√°s ecuaciones como <span class="math inline">\(x^2\)</span> (he escrito <code>$x^2$</code>, la ecuaci√≥n entre d√≥lares).</p></li>
<li><p><span class="hl-yellow"><strong>Listas</strong></span>: puedes itemizar elementos poniendo <code>*</code></p></li>
</ul>
<p><code>* Paso 1: ...</code></p>
<p><code>* Paso 2: ...</code></p>
<ul>
<li><span class="hl-yellow"><strong>Cross-references</strong></span>: puedes etiquetar partes del documento (la etiqueta se construye con <code>{#nombre-seccion}</code>) y llamarlas luego con <code>[Secci√≥n](@nombre-seccion)</code></li>
</ul>
</section>
<section id="gr√°ficasim√°genes-en-qmd" class="slide level2">
<h2>Gr√°ficas/im√°genes en qmd</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="img/quarto-fig-qmd.png" width="340"> <img data-src="img/quarto-fig-html.png" width="390"></p>
</div><div class="column" style="width:50%;">
<p>Por √∫ltimo, tambi√©n podemos <span class="hl-yellow"><strong>a√±adir pies de gr√°ficas o im√°genes</strong></span> a√±adiendo <code>#| fig-cap: "..."</code></p>
</div>
</div>
<div class="fragment">
<div class="columns">
<div class="column" style="width:65%;">
<p>F√≠jate que el <span class="hl-yellow"><strong>caption est√° en el margen</strong></span> (por ejemplo). Puedes cambiarlo introduciendo <span class="hl-yellow"><strong>ajustes en la cabecera</strong></span> (todo lo relativo a figuras empieza por <code>fig-</code>, y puedes ver las opciones tabulando). Tienes m√°s informaci√≥n en <strong><a href="https://quarto.org/" class="uri">https://quarto.org/</a></strong></p>
</div><div class="column" style="width:35%;">
<p><img data-src="img/quarto-cabecera-desplegable.png" width="400"></p>
</div>
</div>
</div>
</section>
<section id="a√±adir-estilos" class="slide level2">
<h2>A√±adir estilos</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="img/quarto-estilos-qmd.png" width="400"> <img data-src="img/quarto-estilos-html.png" width="400"></p>
</div><div class="column" style="width:50%;">
<p>Por √∫ltimo puedes a√±adir un <span class="hl-yellow"><strong>tema personalizado</strong></span> incluyendo un <span class="hl-yellow"><strong>archivo de estilos</strong></span> (archivo en formato <code>.scss</code> o <code>.css</code>). Te he dejado uno en <a href="https://github.com/dadosdelaplace/docencia-R-master-bio-2324/tree/main/material" class="uri">https://github.com/dadosdelaplace/docencia-R-master-bio-2324/tree/main/material</a>.</p>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Importante</strong></p>
</div>
<div class="callout-content">
<p>El archivo de estilos debe estar en la misma carpeta que el archivo <code>.qmd</code></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="a√±adir-estilos-1" class="slide level2">
<h2>A√±adir estilos</h2>
<p>Tambi√©n puedes hacerlo de manera sencilla <span class="hl-yellow"><strong>a√±adiendo a los textos un poco de HTML</strong></span>. Por ejemplo, para personalizar el color de un texto va entre corchetes y justo tras el texto, entre llaves, las opciones de estilo</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb116-1"><a href="#cb116-1"></a>Esta palabra es [roja]{style="color:red;"} ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb117"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb117-1"><a href="#cb117-1"></a>... y esta [verde y en negrita]{style="color:green; font-weight: bold;"}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<p>Esta palabra es <span style="color:red;">roja</span> ‚Ä¶</p>
<p>‚Ä¶ y esta <span style="color:green; font-weight: bold;">verde y en negrita</span></p>
</div>
</section>
<section id="revealjs" class="slide level2">
<h2>Revealjs</h2>
<p>Puedes a√±adir algunas ¬´animaciones¬ª usando lo que se conoce como Revealjs (javascript), especifc√°ndolo en la cabecera y usando <span class="hl-yellow"><strong>bloques</strong></span> de dicho lenguaje delimitados por <code>:::</code> al inicio y final, y la palabra de la ¬´herramienta¬ª a usar. Por ejemplo <code>{.incremental}</code> hace una transici√≥n de los elementos.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb118-1"><a href="#cb118-1"></a><span class="fu">format</span><span class="kw">:</span></span>
<span id="cb118-2"><a href="#cb118-2"></a><span class="at">  revealjs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>&nbsp;</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode numberSource revealjs number-lines code-with-copy"><code class="sourceCode"><span id="cb119-1"><a href="#cb119-1"></a>::: {.incremental}</span>
<span id="cb119-2"><a href="#cb119-2"></a>- Me</span>
<span id="cb119-3"><a href="#cb119-3"></a>- llamo</span>
<span id="cb119-4"><a href="#cb119-4"></a>- Javi</span>
<span id="cb119-5"><a href="#cb119-5"></a>:::</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div>
<ul>
<li class="fragment">Me</li>
<li class="fragment">llamo</li>
<li class="fragment">Javi</li>
</ul>
</div>
</section>
<section id="bloques-de-llamada" class="slide level2">
<h2>Bloques de llamada</h2>
<p>Tambi√©n puedes usar los <span class="hl-yellow"><strong>bloques de llamada</strong></span> que por defecto son <code>note</code>, <code>tip</code>, <code>warning</code>, <code>caution</code> e <code>important</code> (aunque los puedes crear y personalizar). Para ello basta con usar <code>:::{.callout-tipo}</code> y el tipo que quieras</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode numberSource html number-lines code-with-copy"><code class="sourceCode html"><span id="cb120-1"><a href="#cb120-1"></a>:::{.callout-tip}</span>
<span id="cb120-2"><a href="#cb120-2"></a></span>
<span id="cb120-3"><a href="#cb120-3"></a>Note that there are five types of callouts, including: </span>
<span id="cb120-4"><a href="#cb120-4"></a>`note`, `tip`, `warning`, `caution`, and `important`.</span>
<span id="cb120-5"><a href="#cb120-5"></a></span>
<span id="cb120-6"><a href="#cb120-6"></a>:::</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Consejo</strong></p>
</div>
<div class="callout-content">
<p>Recuerda que los 5 tipos son <code>note</code>, <code>tip</code>, <code>warning</code>, <code>caution</code> e <code>important</code>.</p>
</div>
</div>
</div>
</div>
<div class="fragment">
<div class="callout callout-caution callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Peligro</strong></p>
</div>
<div class="callout-content">
<p>√ösalos con cabeza, a veces mucho recursos est√©tico puede marear.</p>
</div>
</div>
</div>
</div>
</section>
<section id="c√≥digo-ajeno-a-r" class="slide level2">
<h2>C√≥digo ajeno a R</h2>
<p>Adem√°s <code>{reticulate}</code> nos permite crear chunks de <code>python</code> dentro de un Quarto en <code>R</code> (ver <a href="https://quarto.org/docs/computations/python.html" class="uri">https://quarto.org/docs/computations/python.html</a> para crear jupyter notebooks directamente desde Quarto)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a><span class="co"># install.packages("reticulate")</span></span>
<span id="cb121-2"><a href="#cb121-2"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb121-3"><a href="#cb121-3"></a></span>
<span id="cb121-4"><a href="#cb121-4"></a><span class="fu">install_python</span>(<span class="st">"3.9.12"</span>) <span class="co"># Instalar python en PC sino lo tienes</span></span>
<span id="cb121-5"><a href="#cb121-5"></a></span>
<span id="cb121-6"><a href="#cb121-6"></a><span class="co"># Instalar paquetes de Python</span></span>
<span id="cb121-7"><a href="#cb121-7"></a>reticulate<span class="sc">::</span><span class="fu">py_install</span>(<span class="st">"numpy"</span>)</span>
<span id="cb121-8"><a href="#cb121-8"></a>reticulate<span class="sc">::</span><span class="fu">py_install</span>(<span class="st">"matplotlib"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb122-2"><a href="#cb122-2"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb122-3"><a href="#cb122-3"></a>r <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">2</span>, <span class="fl">0.05</span>)</span>
<span id="cb122-4"><a href="#cb122-4"></a>theta <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> np.pi <span class="op">*</span> r</span>
<span id="cb122-5"><a href="#cb122-5"></a>fig, ax <span class="op">=</span> plt.subplots(</span>
<span id="cb122-6"><a href="#cb122-6"></a>  subplot_kw <span class="op">=</span> {<span class="st">'projection'</span>: <span class="st">'polar'</span>} </span>
<span id="cb122-7"><a href="#cb122-7"></a>)</span>
<span id="cb122-8"><a href="#cb122-8"></a>ax.plot(theta, r)</span>
<span id="cb122-9"><a href="#cb122-9"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:40%;">

</div>
</div>
</section>
<section id="ejemplo-de-entrega" class="slide level2">
<h2>Ejemplo de entrega</h2>
<p>Vamos a realizar un peque√±o simulacro antes de la entrega usando el dataset <code>starwars</code> del paquete <code>{dplyr}</code></p>

<img data-src="https://sm.ign.com/t/ign_latam/screenshot/default/baby-yoda-nombre_3x56.1280.jpg" class="r-stretch"></section>
<section id="ejemplo-de-entrega-1" class="slide level2">
<h2>Ejemplo de entrega</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb123-2"><a href="#cb123-2"></a>starwars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 87 √ó 14
   name     height  mass hair_color skin_color eye_color birth_year sex   gender
   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
 1 Luke Sk‚Ä¶    172    77 blond      fair       blue            19   male  mascu‚Ä¶
 2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascu‚Ä¶
 3 R2-D2        96    32 &lt;NA&gt;       white, bl‚Ä¶ red             33   none  mascu‚Ä¶
 4 Darth V‚Ä¶    202   136 none       white      yellow          41.9 male  mascu‚Ä¶
 5 Leia Or‚Ä¶    150    49 brown      light      brown           19   fema‚Ä¶ femin‚Ä¶
 6 Owen La‚Ä¶    178   120 brown, gr‚Ä¶ light      blue            52   male  mascu‚Ä¶
 7 Beru Wh‚Ä¶    165    75 brown      light      blue            47   fema‚Ä¶ femin‚Ä¶
 8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascu‚Ä¶
 9 Biggs D‚Ä¶    183    84 black      light      brown           24   male  mascu‚Ä¶
10 Obi-Wan‚Ä¶    182    77 auburn, w‚Ä¶ fair       blue-gray       57   male  mascu‚Ä¶
# ‚Ñπ 77 more rows
# ‚Ñπ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
</div>
<p>En √©l tenemos <strong>diferentes variables de los personajes de Star Wars</strong>, con caracter√≠sticas de su pelo, piel, altura, nombre, etc.</p>
</section>
<section id="ejemplo-de-entrega-2" class="slide level2">
<h2>Ejemplo de entrega</h2>
<blockquote>
<p>Crea un documento <code>.qmd</code> con nombre, t√≠tulo, formato e √≠ndice. Cada ejercicio posterior ser√° una subsecci√≥n del documento. Ejecuta los chunks que consideres y comenta las salidas para responder a cada pregunta</p>
</blockquote>
<div class="fragment">
<blockquote>
<p>Ejercicio 1. ¬øCu√°ntos personajes hay guardados en la base de datos? ¬øCu√°ntas caracter√≠sticas se han medido de cada uno?</p>
</blockquote>
</div>
<div class="fragment">
<blockquote>
<p>Ejercicio 2. Extrae en dos variables distintas <code>nombres</code> y <code>edades</code> las variables correspondientes de la tabla. ¬øDe qu√© tipo es la variable nombre? ¬øY la variable birth_year?</p>
</blockquote>
</div>
<div class="fragment">
<blockquote>
<p>Ejercicio 3. Obt√©n el vector de nombres de los personajes ordenados de mayores a j√≥venes.</p>
</blockquote>
</div>
</section>
<section id="ejemplo-de-entrega-3" class="slide level2">
<h2>Ejemplo de entrega</h2>
<blockquote>
<p>Ejercicio 4. Busca ayuda de la funci√≥n unique(). √ösala para saber que modalidades tiene la variable cualitativa correspondiente al color de ojos. ¬øCu√°ntos distintos hay?</p>
</blockquote>
<div class="fragment">
<blockquote>
<p>Ejercicio 5. ¬øExiste ALG√öN valor ausente en la variable de color ojos?</p>
</blockquote>
</div>
<div class="fragment">
<blockquote>
<p>Ejercicio 6. Calcula la media y desviaci√≥n t√≠pica de las variables de estatura y peso (cuidado con los ausentes). Define un nuevo tibble con esas dos variables e incorpora una tercera variable que se llame ‚ÄúIMC‚Äù que calcule el √≠ndice de masa corporal. Incorpora con <code>$ $</code> la f√≥rmula usada para el IMC.</p>
</blockquote>
</div>
</section>
<section id="estructuras-de-control" class="slide level2">
<h2>Estructuras de control</h2>
<p>Una <span class="hl-yellow"><strong>estructura de control</strong></span> se compone de una serie de comandos orientados a <span class="hl-yellow"><strong>decidir el camino</strong></span> que tu c√≥digo debe recorrer</p>
<ul>
<li><p>Si se cumple la condici√≥n A, ¬øqu√© sucede?</p></li>
<li><p>¬øY si sucede B?</p></li>
<li><p>¬øC√≥mo puedo repetir una misma expresi√≥n (dependiendo de una variable)?</p></li>
</ul>
<div class="fragment">
<p>Si has programado antes, quiz√°s te sea familiar las conocidas como <span class="hl-yellow"><strong>estructuras condicionales</strong></span> tales como <code>if (blabla) {...} else {...}</code> o <span class="hl-yellow"><strong>bucles</strong></span> <code>for/while</code> (a evitar siempre que podamos).</p>
</div>
</section>
<section id="estructura-if" class="slide level2">
<h2>Estructura If</h2>
<p>Una de las estructuras de control m√°s famosas son las conocidas como <span class="hl-yellow"><strong>estructuras condicionales</strong></span> <code>if</code>.</p>
<blockquote>
<p>SI (IF) un conjunto de condiciones se cumple (TRUE), entonces ejecuta lo que haya dentro de las llaves</p>
</blockquote>
<p>Por ejemplo, la estructura <code>if (x == 1) { c√≥digo A }</code> lo que har√° ser√° <span class="hl-yellow"><strong>ejecutar el c√≥digo A entre llaves</strong></span> pero <span class="hl-purple"><strong>SOLO SI</strong></span> la <span class="hl-purple"><strong>condici√≥n entre par√©ntesis es cierta</strong></span> (solo si <code>x</code> es 1). En cualquier otro caso, no har√° nada.</p>
<div class="fragment">
<p>Por ejemplo, definamos un vector de edades de 8 personas</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1"></a>edad <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">14</span>, <span class="dv">17</span>, <span class="dv">24</span>, <span class="dv">56</span>, <span class="dv">31</span>, <span class="dv">20</span>, <span class="dv">87</span>, <span class="dv">73</span>)</span>
<span id="cb125-2"><a href="#cb125-2"></a>edad <span class="sc">&lt;</span> <span class="dv">18</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE</code></pre>
</div>
</div>
</div>
</section>
<section id="estructura-if-1" class="slide level2">
<h2>Estructura If</h2>
<p>Nuestra estructura condicional har√° lo siguiente: <span class="hl-yellow"><strong>si existe alg√∫n menor de edad, imprimir√°</strong></span> por pantalla un mensaje.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1"></a><span class="cf">if</span> (<span class="fu">any</span>(edad <span class="sc">&lt;</span> <span class="dv">18</span>)) { </span>
<span id="cb127-2"><a href="#cb127-2"></a>  </span>
<span id="cb127-3"><a href="#cb127-3"></a>  <span class="fu">print</span>(<span class="st">"Existe alguna persona menor de edad"</span>)</span>
<span id="cb127-4"><a href="#cb127-4"></a>  </span>
<span id="cb127-5"><a href="#cb127-5"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Existe alguna persona menor de edad"</code></pre>
</div>
</div>
</section>
<section id="estructura-if-2" class="slide level2">
<h2>Estructura If</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1"></a><span class="cf">if</span> (<span class="fu">any</span>(edad <span class="sc">&lt;</span> <span class="dv">18</span>)) { </span>
<span id="cb129-2"><a href="#cb129-2"></a>  </span>
<span id="cb129-3"><a href="#cb129-3"></a>  <span class="fu">print</span>(<span class="st">"Existe alguna persona menor de edad"</span>)</span>
<span id="cb129-4"><a href="#cb129-4"></a>  </span>
<span id="cb129-5"><a href="#cb129-5"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En caso de que las <span class="hl-yellow"><strong>condiciones no sean ciertas</strong></span> dentro de <code>if()</code> (<code>FALSE</code>), no sucede nada</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1"></a><span class="cf">if</span> (<span class="fu">all</span>(edad <span class="sc">&gt;=</span> <span class="dv">18</span>)) { </span>
<span id="cb130-2"><a href="#cb130-2"></a>  </span>
<span id="cb130-3"><a href="#cb130-3"></a>  <span class="fu">print</span>(<span class="st">"Todos son mayores de edad"</span>)</span>
<span id="cb130-4"><a href="#cb130-4"></a>  </span>
<span id="cb130-5"><a href="#cb130-5"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>No obtenemos ning√∫n mensaje</strong> porque la condici√≥n <code>all(edad &gt;= 18)</code> no es <code>TRUE</code>, as√≠ que no ejecuta nada.</p>
</section>
<section id="estructura-if-else" class="slide level2">
<h2>Estructura If-else</h2>
<p>La estructura <code>if (condicion) { c√≥digo A }</code> puede combinarse con un <code>else { c√≥digo B }</code>: cuando la <span class="hl-yellow"><strong>condici√≥n no est√° verificada</strong></span>, se <span class="hl-yellow"><strong>ejecutar√° el c√≥digo alternativo B</strong></span> dentro de <code>else { }</code>, permiti√©ndonos decidir que sucede cuando se cumple y cuando no.</p>
<div class="fragment">
<p>Por ejemplo, <code>if (x == 1) { c√≥digo A } else { c√≥digo B }</code> ejecutar√° A si <code>x</code> es igual a 1 y B en cualquier otro caso.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1"></a><span class="cf">if</span> (<span class="fu">all</span>(edad <span class="sc">&gt;=</span> <span class="dv">18</span>)) { </span>
<span id="cb131-2"><a href="#cb131-2"></a>  </span>
<span id="cb131-3"><a href="#cb131-3"></a>  <span class="fu">print</span>(<span class="st">"Todos son mayores de edad"</span>)</span>
<span id="cb131-4"><a href="#cb131-4"></a>  </span>
<span id="cb131-5"><a href="#cb131-5"></a>} <span class="cf">else</span> {</span>
<span id="cb131-6"><a href="#cb131-6"></a>  </span>
<span id="cb131-7"><a href="#cb131-7"></a>  <span class="fu">print</span>(<span class="st">"Existe alguna persona menor de edad"</span>)</span>
<span id="cb131-8"><a href="#cb131-8"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Existe alguna persona menor de edad"</code></pre>
</div>
</div>
</div>
</section>
<section id="estructura-if-else-1" class="slide level2">
<h2>Estructura If-else</h2>
<p>Esta estructura <code>if - else</code> puede ser <span class="hl-yellow"><strong>anidada</strong></span>: imagina que queremos ejecutar un c√≥digo si todos son menores; si no sucede, pero todos son mayores de 16, hacer otra cosa; en cualquier otra cosa, otra acci√≥n.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1"></a><span class="cf">if</span> (<span class="fu">all</span>(edad <span class="sc">&gt;=</span> <span class="dv">18</span>)) { </span>
<span id="cb133-2"><a href="#cb133-2"></a>  </span>
<span id="cb133-3"><a href="#cb133-3"></a>  <span class="fu">print</span>(<span class="st">"Todos son mayores de edad"</span>)</span>
<span id="cb133-4"><a href="#cb133-4"></a>  </span>
<span id="cb133-5"><a href="#cb133-5"></a>} <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">all</span>(edad <span class="sc">&gt;=</span> <span class="dv">16</span>)) {</span>
<span id="cb133-6"><a href="#cb133-6"></a>  </span>
<span id="cb133-7"><a href="#cb133-7"></a>  <span class="fu">print</span>(<span class="st">"Hay alg√∫n menor de edad pero todos con 16 a√±os o m√°s"</span>)</span>
<span id="cb133-8"><a href="#cb133-8"></a>  </span>
<span id="cb133-9"><a href="#cb133-9"></a>} <span class="cf">else</span> { <span class="fu">print</span>(<span class="st">"Hay alguna persona con menos de 16 a√±os"</span>) }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Hay alguna persona con menos de 16 a√±os"</code></pre>
</div>
</div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Truco</strong></p>
</div>
<div class="callout-content">
<p>Puedes <strong>colapsar las estructuras</strong> haciendo click en la flecha a la izquierda que aparece en tu script.</p>
</div>
</div>
</div>
</section>
<section id="if-else-vectorizado" class="slide level2">
<h2>If-else vectorizado</h2>
<p>Esta estructura condicional se puede <span class="hl-yellow"><strong>vectorizar</strong></span> (en una sola l√≠nea) con <code>if_else()</code> (del paquete <code>{dplyr}</code>), cuyos argumentos son</p>
<ul>
<li>la condici√≥n a evaluar</li>
<li>lo que sucede cuando se cumple y cuando no</li>
<li>un argumento opcional para cuando la condici√≥n a evaluar es <code>NA</code></li>
</ul>
<p>Vamos a etiquetar sin son mayores/menores y un ‚Äúdesconocido‚Äù cuando no conocemos</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb135-2"><a href="#cb135-2"></a>edad <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">NA</span>, edad)</span>
<span id="cb135-3"><a href="#cb135-3"></a><span class="fu">if_else</span>(edad <span class="sc">&gt;=</span> <span class="dv">18</span>, <span class="st">"mayor"</span>, <span class="st">"menor"</span>, <span class="at">missing =</span> <span class="st">"desconocido"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "desconocido" "menor"       "menor"       "mayor"       "mayor"      
[6] "mayor"       "mayor"       "mayor"       "mayor"      </code></pre>
</div>
</div>
<p>En <code>R</code> base existe <code>ifelse()</code>: no deja especificar que hacer con los ausentes pero permite especificar distintos tipos de datos en <code>TRUE</code> y en <code>FALSE</code>.</p>
</section>
<section id="bucles" class="slide level2">
<h2>Bucles</h2>
<p>Aunque en la mayor√≠a de ocasiones se pueden reemplazar por otras estructuras m√°s eficientes y legibles, es importante conocer una de las expresiones de control m√°s famosas: los <span class="hl-yellow"><strong>bucles</strong></span>.</p>
<ul>
<li><p><code>for { }</code>: permite <span class="hl-yellow"><strong>repetir el mismo c√≥digo</strong></span> en un <span class="hl-purple"><strong>n√∫mero prefijado y conocido</strong></span> de veces.</p></li>
<li><p><code>while { }</code>: permite <span class="hl-yellow"><strong>repetir el mismo c√≥digo</strong></span> pero en un <span class="hl-purple"><strong>n√∫mero indeterminado de veces</strong></span> (hasta que una <strong>condici√≥n</strong> deje de cumplirse).</p></li>
</ul>
</section>
<section id="bucles-for" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Bucles for</h2>
<p>Un bucle <span class="hl-yellow"><strong>for</strong></span> es una estructura que permite <span class="hl-yellow"><strong>repetir</strong></span> un conjunto de √≥rdenes un n√∫mero <span class="hl-purple"><strong>finito, prefijado y conocido de veces</strong></span> dado un conjunto de √≠ndices.</p>
<p>Vamos a definir un vector <code>x &lt;- c(0, -7, 1, 4)</code> y otra variable vac√≠a <code>y</code>. Tras ello definiremos un bucle for con <code>for () { }</code>: dentro de los par√©ntesis indicaremos un √≠ndice y unos valores a recorrer, dentro de las llaves el c√≥digo a ejecutar en cada iteraci√≥n (en este caso, rellenar <code>y</code> como <code>x + 1</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb137-1" class="hljs-ln-code"><a href="#cb137-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb137-2" class="hljs-ln-code"><a href="#cb137-2"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="bucles-for-1" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Bucles for</h2>
<p>Un bucle <span class="hl-yellow"><strong>for</strong></span> es una estructura que permite <span class="hl-yellow"><strong>repetir</strong></span> un conjunto de √≥rdenes un n√∫mero <span class="hl-purple"><strong>finito, prefijado y conocido de veces</strong></span> dado un conjunto de √≠ndices.</p>
<p>Vamos a definir un vector <code>x &lt;- c(0, -7, 1, 4)</code> y otra variable vac√≠a <code>y</code>. Tras ello definiremos un bucle for con <code>for () { }</code>: dentro de los par√©ntesis indicaremos un √≠ndice y unos valores a recorrer, dentro de las llaves el c√≥digo a ejecutar en cada iteraci√≥n (en este caso, rellenar <code>y</code> como <code>x + 1</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb138-1" class="hljs-ln-code"><a href="#cb138-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb138-2" class="hljs-ln-code"><a href="#cb138-2"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb138-3" class="hljs-ln-code"><a href="#cb138-3"></a></span>
<span id="cb138-4" class="hljs-ln-code"><a href="#cb138-4"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb138-5" class="hljs-ln-code"><a href="#cb138-5"></a>  </span>
<span id="cb138-6" class="hljs-ln-code"><a href="#cb138-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="bucles-for-2" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Bucles for</h2>
<p>Un bucle <span class="hl-yellow"><strong>for</strong></span> es una estructura que permite <span class="hl-yellow"><strong>repetir</strong></span> un conjunto de √≥rdenes un n√∫mero <span class="hl-purple"><strong>finito, prefijado y conocido de veces</strong></span> dado un conjunto de √≠ndices.</p>
<p>Vamos a definir un vector <code>x &lt;- c(0, -7, 1, 4)</code> y otra variable vac√≠a <code>y</code>. Tras ello definiremos un bucle for con <code>for () { }</code>: dentro de los par√©ntesis indicaremos un √≠ndice y unos valores a recorrer, dentro de las llaves el c√≥digo a ejecutar en cada iteraci√≥n (en este caso, rellenar <code>y</code> como <code>x + 1</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb139-1" class="hljs-ln-code"><a href="#cb139-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb139-2" class="hljs-ln-code"><a href="#cb139-2"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb139-3" class="hljs-ln-code"><a href="#cb139-3"></a></span>
<span id="cb139-4" class="hljs-ln-code"><a href="#cb139-4"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb139-5" class="hljs-ln-code"><a href="#cb139-5"></a>  y[i] <span class="ot">&lt;-</span> x[i] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb139-6" class="hljs-ln-code"><a href="#cb139-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="bucles-for-3" class="slide level2">
<h2>Bucles for</h2>
<p>F√≠jate que debido a que <code>R</code> funciona de manera <span class="hl-yellow"><strong>vectorial por defecto</strong></span>, el bucle es lo mismo que hacer <code>x + 1</code> directamente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb140-2"><a href="#cb140-2"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb140-3"><a href="#cb140-3"></a></span>
<span id="cb140-4"><a href="#cb140-4"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb140-5"><a href="#cb140-5"></a>  y[i] <span class="ot">&lt;-</span> x[i] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb140-6"><a href="#cb140-6"></a>}</span>
<span id="cb140-7"><a href="#cb140-7"></a>y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1 -6  2  5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1"></a>y2 <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb142-2"><a href="#cb142-2"></a>y2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1 -6  2  5</code></pre>
</div>
</div>
</section>
<section id="bucles-for-4" class="slide level2">
<h2>Bucles for</h2>
<p>Otra opci√≥n habitual es indicar los √≠ndices de manera ¬´autom√°tica¬ª: desde el primero <code>1</code> hasta el √∫ltimo (que corresponde con la longitud de x <code>length(x)</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb144-2"><a href="#cb144-2"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb144-3"><a href="#cb144-3"></a></span>
<span id="cb144-4"><a href="#cb144-4"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)) {</span>
<span id="cb144-5"><a href="#cb144-5"></a>  y[i] <span class="ot">&lt;-</span> x[i] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb144-6"><a href="#cb144-6"></a>}</span>
<span id="cb144-7"><a href="#cb144-7"></a>y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1 -6  2  5</code></pre>
</div>
</div>
</section>
<section id="bucles-for-5" class="slide level2">
<h2>Bucles for</h2>
<p>As√≠ la <span class="hl-yellow"><strong>estructura general de un bucle for</strong></span> ser√° siempre la siguiente</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1"></a><span class="cf">for</span> (√≠ndice <span class="cf">in</span> conjunto) { </span>
<span id="cb146-2"><a href="#cb146-2"></a>  c√≥digo (dependiente de i)</span>
<span id="cb146-3"><a href="#cb146-3"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="hl-green"><strong>SIEMPRE</strong></span> sabemos cu√°ntas iteraciones tenemos (tantas como elementos haya en el conjunto a indexar)</p>
</section>
<section id="evitando-bucles" class="slide level2">
<h2>Evitando bucles</h2>
<p>Como ya hemos aprendido con el paquete<code>{microbenchmark}</code> podemos chequear como <span class="hl-yellow"><strong>los bucles suelen ser muy ineficientes</strong></span> (de ah√≠ que debamos evitarlos en la mayor√≠a de ocasiones</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1"></a><span class="fu">library</span>(microbenchmark)</span>
<span id="cb147-2"><a href="#cb147-2"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span></span>
<span id="cb147-3"><a href="#cb147-3"></a><span class="fu">microbenchmark</span>(y <span class="ot">&lt;-</span> x<span class="sc">^</span><span class="dv">2</span>, </span>
<span id="cb147-4"><a href="#cb147-4"></a>               <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) { y[i] <span class="ot">&lt;-</span> x[i]<span class="sc">^</span><span class="dv">2</span> },</span>
<span id="cb147-5"><a href="#cb147-5"></a>               <span class="at">times =</span> <span class="dv">500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Unit: microseconds
                                    expr      min       lq        mean   median
                                y &lt;- x^2    1.681    1.927    2.181036    2.009
 for (i in 1:100) {     y[i] &lt;- x[i]^2 } 1362.717 1378.523 1456.189046 1393.365
        uq      max neval
    2.1525    7.339   500
 1413.7415 4750.547   500</code></pre>
</div>
</div>
</section>
<section id="bucles-for-6" class="slide level2">
<h2>Bucles for</h2>
<p>Podemos ver otro ejemplo de bucle <span class="hl-yellow"><strong>combinando n√∫meros y textos</strong></span>: definimos un vector de edades y de nombres, e imprimimos el nombre y edad i-√©sima.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1"></a>nombres <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Javi"</span>, <span class="st">"Sandra"</span>, <span class="st">"Carlos"</span>, <span class="st">"Marcos"</span>, <span class="st">"Marta"</span>)</span>
<span id="cb149-2"><a href="#cb149-2"></a>edades <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">33</span>, <span class="dv">27</span>, <span class="dv">18</span>, <span class="dv">43</span>, <span class="dv">29</span>)</span>
<span id="cb149-3"><a href="#cb149-3"></a><span class="fu">library</span>(glue)</span>
<span id="cb149-4"><a href="#cb149-4"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) { </span>
<span id="cb149-5"><a href="#cb149-5"></a>  </span>
<span id="cb149-6"><a href="#cb149-6"></a>  <span class="fu">print</span>(<span class="fu">glue</span>(<span class="st">"{nombres[i]} tiene {edades[i]} a√±os"</span>)) </span>
<span id="cb149-7"><a href="#cb149-7"></a>  </span>
<span id="cb149-8"><a href="#cb149-8"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Javi tiene 33 a√±os
Sandra tiene 27 a√±os
Carlos tiene 18 a√±os
Marcos tiene 43 a√±os
Marta tiene 29 a√±os</code></pre>
</div>
</div>
</section>
<section id="bucles-for-7" class="slide level2">
<h2>Bucles for</h2>
<p>Aunque normalmente se suelen indexar con vectors num√©ricos, los bucles pueden ser <span class="hl-yellow"><strong>indexados sobre cualquier estructura vectorial</strong></span>, da igual de que tipo sea el conjunto</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb151-2"><a href="#cb151-2"></a>week_days <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"monday"</span>, <span class="st">"tuesday"</span>, <span class="st">"wednesday"</span>, <span class="st">"thursday"</span>,</span>
<span id="cb151-3"><a href="#cb151-3"></a>               <span class="st">"friday"</span>, <span class="st">"saturday"</span>, <span class="st">"sunday"</span>)</span>
<span id="cb151-4"><a href="#cb151-4"></a></span>
<span id="cb151-5"><a href="#cb151-5"></a><span class="cf">for</span> (days <span class="cf">in</span> week_days) {</span>
<span id="cb151-6"><a href="#cb151-6"></a>  </span>
<span id="cb151-7"><a href="#cb151-7"></a>  <span class="fu">print</span>(<span class="fu">str_to_upper</span>(days))</span>
<span id="cb151-8"><a href="#cb151-8"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "MONDAY"
[1] "TUESDAY"
[1] "WEDNESDAY"
[1] "THURSDAY"
[1] "FRIDAY"
[1] "SATURDAY"
[1] "SUNDAY"</code></pre>
</div>
</div>
</section>
<section id="bucles-y-condicionales" class="slide level2">
<h2>Bucles y condicionales</h2>
<p>Vamos a <strong>combinar las estructuras condicionales y los bucles</strong>: usando el conjunto <code>swiss</code> del paquete <code>{datasets}</code>, vamos a asignar <code>NA</code> si los valores de fertilidad son mayores de 80.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(swiss)) {</span>
<span id="cb153-2"><a href="#cb153-2"></a>  </span>
<span id="cb153-3"><a href="#cb153-3"></a>  <span class="cf">if</span> (swiss<span class="sc">$</span>Fertility[i] <span class="sc">&gt;</span> <span class="dv">80</span>) { </span>
<span id="cb153-4"><a href="#cb153-4"></a>    </span>
<span id="cb153-5"><a href="#cb153-5"></a>    swiss<span class="sc">$</span>Fertility[i] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb153-6"><a href="#cb153-6"></a>    </span>
<span id="cb153-7"><a href="#cb153-7"></a>  }</span>
<span id="cb153-8"><a href="#cb153-8"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>Esto es exactamente igual a un <code>if_else()</code> vectorizado</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1"></a><span class="fu">data</span>(<span class="st">"swiss"</span>)</span>
<span id="cb154-2"><a href="#cb154-2"></a>swiss<span class="sc">$</span>Fertility <span class="ot">&lt;-</span> <span class="fu">if_else</span>(swiss<span class="sc">$</span>Fertility <span class="sc">&gt;</span> <span class="dv">80</span>, <span class="cn">NA</span>, swiss<span class="sc">$</span>Fertility)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="bucles-while" class="slide level2">
<h2>Bucles while</h2>
<p>Otra forma de crear un bucle es con la estructura <code>while { }</code>, que nos ejecutar√° un bucle <span class="hl-yellow"><strong>un n√∫mero desconocido de veces</strong></span>, hasta que una condici√≥n <span class="hl-yellow"><strong>deje de cumplirse</strong></span> (de hecho puede que nunca termine). Por ejemplo, vamos a inializar una variable <code>ciclos &lt;- 1</code>, que incrementaremos en cada paso, y no saldremos del bucle hasta que <code>ciclos &gt; 4</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1"></a>ciclos <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb155-2"><a href="#cb155-2"></a><span class="cf">while</span>(ciclos <span class="sc">&lt;=</span> <span class="dv">4</span>) {</span>
<span id="cb155-3"><a href="#cb155-3"></a>  </span>
<span id="cb155-4"><a href="#cb155-4"></a>  <span class="fu">print</span>(<span class="fu">glue</span>(<span class="st">"No todav√≠a, vamos por el ciclo {ciclos}"</span>)) </span>
<span id="cb155-5"><a href="#cb155-5"></a>  ciclos <span class="ot">&lt;-</span> ciclos <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb155-6"><a href="#cb155-6"></a>  </span>
<span id="cb155-7"><a href="#cb155-7"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>No todav√≠a, vamos por el ciclo 1
No todav√≠a, vamos por el ciclo 2
No todav√≠a, vamos por el ciclo 3
No todav√≠a, vamos por el ciclo 4</code></pre>
</div>
</div>
</section>
<section id="bucles-while-1" class="slide level2">
<h2>Bucles while</h2>
<p>Un bucle <code>while</code> ser√° siempre como sigue</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1"></a><span class="cf">while</span>(condici√≥n) {</span>
<span id="cb157-2"><a href="#cb157-2"></a>  </span>
<span id="cb157-3"><a href="#cb157-3"></a>  c√≥digo a hacer mientras la condici√≥n sea <span class="cn">TRUE</span></span>
<span id="cb157-4"><a href="#cb157-4"></a>  <span class="co"># normalmente aqu√≠ se actualiza alguna variable</span></span>
<span id="cb157-5"><a href="#cb157-5"></a>  </span>
<span id="cb157-6"><a href="#cb157-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="bucles-while-2" class="slide level2">
<h2>Bucles while</h2>
<p>¬øQu√© sucede cuando la <span class="hl-yellow"><strong>condici√≥n nunca es FALSE</strong></span>? Pru√©balo tu mismo</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1"></a><span class="cf">while</span> (<span class="dv">1</span> <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb158-2"><a href="#cb158-2"></a>  </span>
<span id="cb158-3"><a href="#cb158-3"></a>  <span class="fu">print</span>(<span class="st">"Presiona ESC para salir del bucle"</span>)</span>
<span id="cb158-4"><a href="#cb158-4"></a>  </span>
<span id="cb158-5"><a href="#cb158-5"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>&nbsp;</p>
<div class="callout callout-warning callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Cuidado</strong></p>
</div>
<div class="callout-content">
<p>Un bucle <code>while { }</code> puede ser bastante ¬´peligroso¬ª sino controlamos bien c√≥mo pararlo.</p>
</div>
</div>
</div>
</section>
<section id="bucles-while-3" class="slide level2">
<h2>Bucles while</h2>
<p>Contamos con dos palabras reservadas para <span class="hl-yellow"><strong>abortar un bucle o forzar su avance</strong></span>:</p>
<ul>
<li><code>break</code>: permite <span class="hl-yellow"><strong>abortar un bucle</strong></span> incluso si no se ha llegado a su final</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb159-2"><a href="#cb159-2"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">3</span>) {</span>
<span id="cb159-3"><a href="#cb159-3"></a>    </span>
<span id="cb159-4"><a href="#cb159-4"></a>    <span class="cf">break</span> <span class="co"># si i = 3, abortamos bucle</span></span>
<span id="cb159-5"><a href="#cb159-5"></a>    </span>
<span id="cb159-6"><a href="#cb159-6"></a>  }</span>
<span id="cb159-7"><a href="#cb159-7"></a>  <span class="fu">print</span>(i)</span>
<span id="cb159-8"><a href="#cb159-8"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1
[1] 2</code></pre>
</div>
</div>
</section>
<section id="bucles-while-4" class="slide level2">
<h2>Bucles while</h2>
<p>Contamos con dos palabras reservadas para <span class="hl-yellow"><strong>abortar un bucle o forzar su avance</strong></span>:</p>
<ul>
<li><code>next</code>: <span class="hl-yellow"><strong>fuerza un bucle a avanzar a la siguiente iteraci√≥n</strong></span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb161-2"><a href="#cb161-2"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">3</span>) {</span>
<span id="cb161-3"><a href="#cb161-3"></a>    </span>
<span id="cb161-4"><a href="#cb161-4"></a>    <span class="cf">next</span> <span class="co"># si i = 3, la obvia y continua al siguiente</span></span>
<span id="cb161-5"><a href="#cb161-5"></a>    </span>
<span id="cb161-6"><a href="#cb161-6"></a>  }</span>
<span id="cb161-7"><a href="#cb161-7"></a>  <span class="fu">print</span>(i)</span>
<span id="cb161-8"><a href="#cb161-8"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1
[1] 2
[1] 4
[1] 5</code></pre>
</div>
</div>
</section>
<section id="tu-turno-1-3" class="slide level2">
<h2>üíª Tu turno</h2>
<p><span style="color:#444442;"><strong>Intenta realizar los siguientes ejercicios sin mirar las soluciones</strong></span></p>
<div class="panel-tabset">
<ul id="tabset-4" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-4-1"><span class="hl-yellow"><strong>Ejercicio 1</strong></span></a></li><li><a href="#tabset-4-2"><span class="hl-yellow"><strong>Ejercicio 2</strong></span></a></li><li><a href="#tabset-4-3"><span class="hl-yellow"><strong>Ejercicio 3</strong></span></a></li><li><a href="#tabset-4-4"><span class="hl-yellow"><strong>Ejercicio 4</strong></span></a></li><li><a href="#tabset-4-5"><span class="hl-yellow"><strong>Ejercicio 5</strong></span></a></li><li><a href="#tabset-4-6"><span class="hl-yellow"><strong>Ejercicio 6</strong></span></a></li><li><a href="#tabset-4-7"><span class="hl-yellow"><strong>Ejercicio 7</strong></span></a></li><li><a href="#tabset-4-8"><span class="hl-yellow"><strong>Ejercicio 8</strong></span></a></li><li><a href="#tabset-4-9"><span class="hl-yellow"><strong>Ejercicio 9</strong></span></a></li><li><a href="#tabset-4-10"><span class="hl-yellow"><strong>Ejercicio 10</strong></span></a></li></ul>
<div class="tab-content">
<div id="tabset-4-1">
<p>üìù ¬øCu√°l es la salida del siguiente c√≥digo?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1"></a><span class="fu">if_else</span>(<span class="fu">sqrt</span>(<span class="dv">9</span>) <span class="sc">&lt;</span> <span class="dv">2</span>, <span class="fu">sqrt</span>(<span class="dv">9</span>), <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1"></a>La salida es <span class="dv">0</span> ya que <span class="fu">sqrt</span>(<span class="dv">9</span>) es igual <span class="dv">3</span>, y dado que no es menor que <span class="dv">2</span>, devuelve el segundo argumento que es <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-4-2">
<p>üìù ¬øCu√°l es la salida del siguiente c√≥digo?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">9</span>)</span>
<span id="cb165-2"><a href="#cb165-2"></a><span class="fu">if_else</span>(<span class="fu">sqrt</span>(x) <span class="sc">&lt;</span> <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1"></a>La salida es el vector <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">1</span>) ya que <span class="fu">sqrt</span>(<span class="dv">1</span>) s√≠ es menor que <span class="dv">2</span>, <span class="fu">sqrt</span>(<span class="dv">9</span>) no lo es, y tanto en el caso de <span class="fu">sqrt</span>(<span class="cn">NA</span>) (ra√≠z de ausente) como <span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">1</span>) (devuelve <span class="cn">NaN</span>, not a number), su ra√≠z cuadrada no puede verificarse si es menor que <span class="dv">2</span> o no, as√≠ que la salida es NA.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-4-3">
<p>üìù Modifica el c√≥digo inferior para que, cuando no se pueda verificar si la ra√≠z cuadrada de un n√∫mero es menor que 2, devuelva -1</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">9</span>)</span>
<span id="cb167-2"><a href="#cb167-2"></a><span class="fu">if_else</span>(<span class="fu">sqrt</span>(x) <span class="sc">&lt;</span> <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">9</span>)</span>
<span id="cb168-2"><a href="#cb168-2"></a><span class="fu">if_else</span>(<span class="fu">sqrt</span>(x) <span class="sc">&lt;</span> <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="at">missing =</span> <span class="sc">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-4-4">
<p>üìù ¬øCu√°l es son los valores de <code>x</code> e <code>y</code> del c√≥digo inferior para <code>z &lt;- 1</code>, <code>z &lt;- -1</code> y <code>z &lt;- -5</code>?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1"></a>z <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb169-2"><a href="#cb169-2"></a><span class="cf">if</span> (z <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb169-3"><a href="#cb169-3"></a>  </span>
<span id="cb169-4"><a href="#cb169-4"></a>  x <span class="ot">&lt;-</span> z<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb169-5"><a href="#cb169-5"></a>  y <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">sqrt</span>(z)</span>
<span id="cb169-6"><a href="#cb169-6"></a>  </span>
<span id="cb169-7"><a href="#cb169-7"></a>} <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">abs</span>(z) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb169-8"><a href="#cb169-8"></a>  </span>
<span id="cb169-9"><a href="#cb169-9"></a>  x <span class="ot">&lt;-</span> z<span class="sc">^</span><span class="dv">4</span></span>
<span id="cb169-10"><a href="#cb169-10"></a>  y <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="sc">-</span>z)</span>
<span id="cb169-11"><a href="#cb169-11"></a>  </span>
<span id="cb169-12"><a href="#cb169-12"></a>} <span class="cf">else</span> {</span>
<span id="cb169-13"><a href="#cb169-13"></a>  </span>
<span id="cb169-14"><a href="#cb169-14"></a>  x <span class="ot">&lt;-</span> z<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb169-15"><a href="#cb169-15"></a>  y <span class="ot">&lt;-</span> <span class="fu">abs</span>(z)</span>
<span id="cb169-16"><a href="#cb169-16"></a>  </span>
<span id="cb169-17"><a href="#cb169-17"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1"></a>En primero caso x <span class="ot">=</span> <span class="dv">1</span> e y <span class="ot">=</span> <span class="sc">-</span><span class="fl">1.</span> En el segundo caso x <span class="ot">=</span> <span class="dv">1</span> e y <span class="ot">=</span> <span class="fl">1.</span> En el tercer caso <span class="sc">-</span><span class="dv">1</span> y <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-4-5">
<p>üìù ¬øQu√© suceder√° si ejecutamos el c√≥digo inferior?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1"></a>z <span class="ot">&lt;-</span> <span class="st">"a"</span></span>
<span id="cb171-2"><a href="#cb171-2"></a><span class="cf">if</span> (z <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb171-3"><a href="#cb171-3"></a>  </span>
<span id="cb171-4"><a href="#cb171-4"></a>  x <span class="ot">&lt;-</span> z<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb171-5"><a href="#cb171-5"></a>  y <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">sqrt</span>(z)</span>
<span id="cb171-6"><a href="#cb171-6"></a>  </span>
<span id="cb171-7"><a href="#cb171-7"></a>} <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">abs</span>(z) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb171-8"><a href="#cb171-8"></a>  </span>
<span id="cb171-9"><a href="#cb171-9"></a>  x <span class="ot">&lt;-</span> z<span class="sc">^</span><span class="dv">4</span></span>
<span id="cb171-10"><a href="#cb171-10"></a>  y <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="sc">-</span>z)</span>
<span id="cb171-11"><a href="#cb171-11"></a>  </span>
<span id="cb171-12"><a href="#cb171-12"></a>} <span class="cf">else</span> {</span>
<span id="cb171-13"><a href="#cb171-13"></a>  </span>
<span id="cb171-14"><a href="#cb171-14"></a>  x <span class="ot">&lt;-</span> z<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb171-15"><a href="#cb171-15"></a>  y <span class="ot">&lt;-</span> <span class="fu">abs</span>(z)</span>
<span id="cb171-16"><a href="#cb171-16"></a>  </span>
<span id="cb171-17"><a href="#cb171-17"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1"></a><span class="co"># dar√° error ya que no es un argumento num√©rico</span></span>
<span id="cb172-2"><a href="#cb172-2"></a>Error <span class="cf">in</span> z<span class="sc">^</span><span class="dv">3</span> <span class="sc">:</span> non<span class="sc">-</span>numeric argument to binary operator</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-4-6">
<p>üìù Del paquete <code>{lubridate}</code>, la funci√≥n <code>hour()</code> nos devuelve la hora de una fecha dada, y la funci√≥n <code>now()</code> nos devuelve fecha y hora del momento actual. Con ambas funciones haz que se imprima por pantalla (<code>cat()</code>) ‚Äúbuenas noches‚Äù solo a partir de las 21 horas.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1"></a><span class="co"># Cargamos librer√≠a</span></span>
<span id="cb173-2"><a href="#cb173-2"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb173-3"><a href="#cb173-3"></a></span>
<span id="cb173-4"><a href="#cb173-4"></a><span class="co"># Fecha-hora actual</span></span>
<span id="cb173-5"><a href="#cb173-5"></a>fecha_actual <span class="ot">&lt;-</span> <span class="fu">now</span>()</span>
<span id="cb173-6"><a href="#cb173-6"></a></span>
<span id="cb173-7"><a href="#cb173-7"></a><span class="co"># Estructura if</span></span>
<span id="cb173-8"><a href="#cb173-8"></a><span class="cf">if</span> (<span class="fu">hour</span>(fecha_actual) <span class="sc">&gt;</span> <span class="dv">21</span>) {</span>
<span id="cb173-9"><a href="#cb173-9"></a>  </span>
<span id="cb173-10"><a href="#cb173-10"></a>  <span class="fu">cat</span>(<span class="st">"Buenas noches"</span>) <span class="co"># print/cat dos formas de imprimir por pantalla</span></span>
<span id="cb173-11"><a href="#cb173-11"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-4-7">
<p>üìù Modifica el c√≥digo inferior para que se imprima un mensaje por pantalla si y solo si todos los datos de <code>airquality</code> son con mes distinto a enero</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1"></a><span class="fu">library</span>(datasets)</span>
<span id="cb174-2"><a href="#cb174-2"></a>months <span class="ot">&lt;-</span> airquality<span class="sc">$</span>Month</span>
<span id="cb174-3"><a href="#cb174-3"></a></span>
<span id="cb174-4"><a href="#cb174-4"></a><span class="cf">if</span> (months <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb174-5"><a href="#cb174-5"></a>  <span class="fu">print</span>(<span class="st">"No hay datos de enero"</span>)</span>
<span id="cb174-6"><a href="#cb174-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1"></a><span class="fu">library</span>(datasets)</span>
<span id="cb175-2"><a href="#cb175-2"></a>months <span class="ot">&lt;-</span> airquality<span class="sc">$</span>Month</span>
<span id="cb175-3"><a href="#cb175-3"></a></span>
<span id="cb175-4"><a href="#cb175-4"></a><span class="cf">if</span> (<span class="fu">all</span>(months <span class="sc">!=</span> <span class="dv">1</span>)) {</span>
<span id="cb175-5"><a href="#cb175-5"></a>  <span class="fu">print</span>(<span class="st">"No hay datos de enero"</span>)</span>
<span id="cb175-6"><a href="#cb175-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-4-8">
<p>üìù Modifica el c√≥digo inferior para guardar en una variable llamada <code>temp_alta</code> un <code>TRUE</code> si alguno de los registros tiene una temperatura superior a 90 grados Farenheit y <code>FALSE</code> en cualquier otro caso</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1"></a>temp <span class="ot">&lt;-</span> airquality<span class="sc">$</span>Temp</span>
<span id="cb176-2"><a href="#cb176-2"></a></span>
<span id="cb176-3"><a href="#cb176-3"></a><span class="cf">if</span> (temp <span class="sc">==</span> <span class="dv">100</span>) {</span>
<span id="cb176-4"><a href="#cb176-4"></a>  <span class="fu">print</span>(<span class="st">"Algunos de los registros tienen temperaturas superiores a 90 grados Farenheit"</span>)</span>
<span id="cb176-5"><a href="#cb176-5"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1"></a><span class="co"># Option 1</span></span>
<span id="cb177-2"><a href="#cb177-2"></a>temp <span class="ot">&lt;-</span> airquality<span class="sc">$</span>Temp</span>
<span id="cb177-3"><a href="#cb177-3"></a>temp_alta <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb177-4"><a href="#cb177-4"></a><span class="cf">if</span> (<span class="fu">any</span>(temp <span class="sc">&gt;</span> <span class="dv">90</span>)) {</span>
<span id="cb177-5"><a href="#cb177-5"></a>   temp_alta <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb177-6"><a href="#cb177-6"></a>}</span>
<span id="cb177-7"><a href="#cb177-7"></a></span>
<span id="cb177-8"><a href="#cb177-8"></a><span class="co"># Option 2</span></span>
<span id="cb177-9"><a href="#cb177-9"></a>temp_alta <span class="ot">&lt;-</span> <span class="fu">any</span>(airquality<span class="sc">$</span>Temp <span class="sc">&gt;</span> <span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-4-9">
<p>üìù Modifica el c√≥digo inferior para dise√±ar un bucle <code>for</code> de 5 iteraciones que solo recorra los primeros 5 impares (y en cada paso del bucle los imprima)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb178-2"><a href="#cb178-2"></a>  </span>
<span id="cb178-3"><a href="#cb178-3"></a>  <span class="fu">print</span>(i)</span>
<span id="cb178-4"><a href="#cb178-4"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>)) {</span>
<span id="cb179-2"><a href="#cb179-2"></a>  </span>
<span id="cb179-3"><a href="#cb179-3"></a>  <span class="fu">print</span>(i)</span>
<span id="cb179-4"><a href="#cb179-4"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-4-10">
<p>üìù Modifica el c√≥digo inferior para dise√±ar un bucle <code>while</code> que empiece con un contador <code>count &lt;- 1</code> y pare cuando llegue a 6</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1"></a>count <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb180-2"><a href="#cb180-2"></a><span class="cf">while</span> (count <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb180-3"><a href="#cb180-3"></a>  </span>
<span id="cb180-4"><a href="#cb180-4"></a>  <span class="fu">print</span>(count)</span>
<span id="cb180-5"><a href="#cb180-5"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1"></a>count <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb181-2"><a href="#cb181-2"></a><span class="cf">while</span> (count <span class="sc">&lt;</span> <span class="dv">6</span>) {</span>
<span id="cb181-3"><a href="#cb181-3"></a>  </span>
<span id="cb181-4"><a href="#cb181-4"></a>  <span class="fu">print</span>(count)</span>
<span id="cb181-5"><a href="#cb181-5"></a>  count <span class="ot">&lt;-</span> count <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb181-6"><a href="#cb181-6"></a>  </span>
<span id="cb181-7"><a href="#cb181-7"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="caso-practico-1-2" class="slide level2">
<h2>üê£ Caso pr√°ctico II</h2>
<p>Intenta responder a las preguntas planteadas en el <a href="https://javieralvarezliebana.quarto.pub/repaso-r-ts/"><strong>workbook</strong></a> donde tendr√°s que dise√±ar algunos estudios de simulaci√≥n haciendo uso de <strong>bucles y estructuras condicionales</strong></p>
</section>
<section id="creando-funciones" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Creando funciones</h2>
<p>No solo podemos usar <strong>funciones predeterminadas</strong> que vienen ya cargadas en paquetes, adem√°s podemos <span class="hl-yellow"><strong>crear nuestras propias funciones</strong></span> para <strong>automatizar tareas</strong>. ¬øC√≥mo <span class="hl-purple"><strong>crear nuestra propia funci√≥n</strong></span>? Veamos su <strong>esquema b√°sico</strong>:</p>
<ul>
<li><p><span class="hl-yellow"><strong>Nombre</strong></span>: por ejemplo <code>name_fun</code> (sin espacios ni caracteres extra√±os). Al nombre le <span class="hl-yellow"><strong>asignamos la palabra reservada</strong></span> <code>function()</code>.</p></li>
<li><p>Definir <span class="hl-yellow"><strong>argumentos de entrada</strong></span> (dentro de <code>function()</code>).</p></li>
<li><p><span class="hl-yellow"><strong>Cuerpo</strong></span> de la funci√≥n dentro de <code>{ }</code>.</p></li>
<li><p>Finalizamos la funci√≥n con los <span class="hl-yellow"><strong>argumentos de salida</strong></span> con <code>return()</code>.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb182-1" class="hljs-ln-code"><a href="#cb182-1"></a>name_fun <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb182-2" class="hljs-ln-code"><a href="#cb182-2"></a>  </span>
<span id="cb182-3" class="hljs-ln-code"><a href="#cb182-3"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creando-funciones-1" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Creando funciones</h2>
<p>No solo podemos usar <strong>funciones predeterminadas</strong> que vienen ya cargadas en paquetes, adem√°s podemos <span class="hl-yellow"><strong>crear nuestras propias funciones</strong></span> para <strong>automatizar tareas</strong>. ¬øC√≥mo <span class="hl-purple"><strong>crear nuestra propia funci√≥n</strong></span>? Veamos su <strong>esquema b√°sico</strong>:</p>
<ul>
<li><p><span class="hl-yellow"><strong>Nombre</strong></span>: por ejemplo <code>name_fun</code> (sin espacios ni caracteres extra√±os). Al nombre le <span class="hl-yellow"><strong>asignamos la palabra reservada</strong></span> <code>function()</code>.</p></li>
<li><p>Definir <span class="hl-yellow"><strong>argumentos de entrada</strong></span> (dentro de <code>function()</code>).</p></li>
<li><p><span class="hl-yellow"><strong>Cuerpo</strong></span> de la funci√≥n dentro de <code>{ }</code>.</p></li>
<li><p>Finalizamos la funci√≥n con los <span class="hl-yellow"><strong>argumentos de salida</strong></span> con <code>return()</code>.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb183-1" class="hljs-ln-code"><a href="#cb183-1"></a>name_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(arg1, arg2, ...) {</span>
<span id="cb183-2" class="hljs-ln-code"><a href="#cb183-2"></a>  </span>
<span id="cb183-3" class="hljs-ln-code"><a href="#cb183-3"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creando-funciones-2" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Creando funciones</h2>
<p>No solo podemos usar <strong>funciones predeterminadas</strong> que vienen ya cargadas en paquetes, adem√°s podemos <span class="hl-yellow"><strong>crear nuestras propias funciones</strong></span> para <strong>automatizar tareas</strong>. ¬øC√≥mo <span class="hl-purple"><strong>crear nuestra propia funci√≥n</strong></span>? Veamos su <strong>esquema b√°sico</strong>:</p>
<ul>
<li><p><span class="hl-yellow"><strong>Nombre</strong></span>: por ejemplo <code>name_fun</code> (sin espacios ni caracteres extra√±os). Al nombre le <span class="hl-yellow"><strong>asignamos la palabra reservada</strong></span> <code>function()</code>.</p></li>
<li><p>Definir <span class="hl-yellow"><strong>argumentos de entrada</strong></span> (dentro de <code>function()</code>).</p></li>
<li><p><span class="hl-yellow"><strong>Cuerpo</strong></span> de la funci√≥n dentro de <code>{ }</code>.</p></li>
<li><p>Finalizamos la funci√≥n con los <span class="hl-yellow"><strong>argumentos de salida</strong></span> con <code>return()</code>.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb184-1" class="hljs-ln-code"><a href="#cb184-1"></a>name_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(arg1, arg2, ...) {</span>
<span id="cb184-2" class="hljs-ln-code"><a href="#cb184-2"></a>  </span>
<span id="cb184-3" class="hljs-ln-code"><a href="#cb184-3"></a>  c√≥digo a ejecutar</span>
<span id="cb184-4" class="hljs-ln-code"><a href="#cb184-4"></a>  </span>
<span id="cb184-5" class="hljs-ln-code"><a href="#cb184-5"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creando-funciones-3" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Creando funciones</h2>
<p>No solo podemos usar <strong>funciones predeterminadas</strong> que vienen ya cargadas en paquetes, adem√°s podemos <span class="hl-yellow"><strong>crear nuestras propias funciones</strong></span> para <strong>automatizar tareas</strong>. ¬øC√≥mo <span class="hl-purple"><strong>crear nuestra propia funci√≥n</strong></span>? Veamos su <strong>esquema b√°sico</strong>:</p>
<ul>
<li><p><span class="hl-yellow"><strong>Nombre</strong></span>: por ejemplo <code>name_fun</code> (sin espacios ni caracteres extra√±os). Al nombre le <span class="hl-yellow"><strong>asignamos la palabra reservada</strong></span> <code>function()</code>.</p></li>
<li><p>Definir <span class="hl-yellow"><strong>argumentos de entrada</strong></span> (dentro de <code>function()</code>).</p></li>
<li><p><span class="hl-yellow"><strong>Cuerpo</strong></span> de la funci√≥n dentro de <code>{ }</code>.</p></li>
<li><p>Finalizamos la funci√≥n con los <span class="hl-yellow"><strong>argumentos de salida</strong></span> con <code>return()</code>.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb185-1" class="hljs-ln-code"><a href="#cb185-1"></a>name_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(arg1, arg2, ...) {</span>
<span id="cb185-2" class="hljs-ln-code"><a href="#cb185-2"></a>  </span>
<span id="cb185-3" class="hljs-ln-code"><a href="#cb185-3"></a>  c√≥digo a ejecutar</span>
<span id="cb185-4" class="hljs-ln-code"><a href="#cb185-4"></a>  </span>
<span id="cb185-5" class="hljs-ln-code"><a href="#cb185-5"></a>  <span class="fu">return</span>(var_salida)</span>
<span id="cb185-6" class="hljs-ln-code"><a href="#cb185-6"></a>  </span>
<span id="cb185-7" class="hljs-ln-code"><a href="#cb185-7"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creando-funciones-4" class="slide level2">
<h2>Creando funciones</h2>
<ul>
<li><p><code>arg1, arg2, ...</code>: ser√°n los <span class="hl-yellow"><strong>argumentos de entrada</strong></span>, los argumentos que toma la funci√≥n para ejecutar el c√≥digo que tiene dentro</p></li>
<li><p><code>c√≥digo</code>: l√≠neas de c√≥digo que queramos que <span class="hl-yellow"><strong>ejecute la funci√≥n</strong></span>.</p></li>
<li><p><code>return(var_salida)</code>: se introducir√°n los <span class="hl-yellow"><strong>argumentos de salida</strong></span>.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1"></a>name_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(arg1, arg2, ...) {</span>
<span id="cb186-2"><a href="#cb186-2"></a>  </span>
<span id="cb186-3"><a href="#cb186-3"></a>  <span class="co"># C√≥digo que queramos ejecutar</span></span>
<span id="cb186-4"><a href="#cb186-4"></a>  c√≥digo</span>
<span id="cb186-5"><a href="#cb186-5"></a>  </span>
<span id="cb186-6"><a href="#cb186-6"></a>  <span class="co"># Salida</span></span>
<span id="cb186-7"><a href="#cb186-7"></a>  <span class="fu">return</span>(var_salida)</span>
<span id="cb186-8"><a href="#cb186-8"></a>  </span>
<span id="cb186-9"><a href="#cb186-9"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Importante</strong></p>
</div>
<div class="callout-content">
<p>Todas las variables que definamos dentro de la funci√≥n son <span class="hl-yellow"><strong>variables LOCALES: solo existir√°n dentro de la funci√≥n</strong></span> salvo que especifiquemos lo contrario.</p>
</div>
</div>
</div>
</section>
<section id="creando-funciones-5" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Creando funciones</h2>
<p>Veamos un ejemplo muy simple de funci√≥n para <span class="hl-yellow"><strong>calcular el √°rea de un rect√°ngulo</strong></span>.</p>
<p>Dado que el √°rea de un rect√°ngulo se calcula como el <strong>producto de sus lados</strong>, necesitaremos precisamente eso, sus lados: esos ser√°n los <span class="hl-yellow"><strong>argumentos de entrada</strong></span> y el <span class="hl-purple"><strong>valor a devolver</strong></span> ser√° justo su <strong>√°rea</strong> (<span class="math inline">\(lado_1 * lado_2\)</span>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb187-1" class="hljs-ln-code"><a href="#cb187-1"></a><span class="co"># Definici√≥n del nombre de funci√≥n y argumentos de entrada</span></span>
<span id="cb187-2" class="hljs-ln-code"><a href="#cb187-2"></a>calcular_area <span class="ot">&lt;-</span> <span class="cf">function</span>(lado_1, lado_2) {</span>
<span id="cb187-3" class="hljs-ln-code"><a href="#cb187-3"></a>  </span>
<span id="cb187-4" class="hljs-ln-code"><a href="#cb187-4"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creando-funciones-6" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Creando funciones</h2>
<p>Veamos un ejemplo muy simple de funci√≥n para <span class="hl-yellow"><strong>calcular el √°rea de un rect√°ngulo</strong></span>.</p>
<p>Dado que el √°rea de un rect√°ngulo se calcula como el <strong>producto de sus lados</strong>, necesitaremos precisamente eso, sus lados: esos ser√°n los <span class="hl-yellow"><strong>argumentos de entrada</strong></span> y el <span class="hl-purple"><strong>valor a devolver</strong></span> ser√° justo su <strong>√°rea</strong> (<span class="math inline">\(lado_1 * lado_2\)</span>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb188-1" class="hljs-ln-code"><a href="#cb188-1"></a><span class="co"># Definici√≥n del nombre de funci√≥n y argumentos de entrada</span></span>
<span id="cb188-2" class="hljs-ln-code"><a href="#cb188-2"></a>calcular_area <span class="ot">&lt;-</span> <span class="cf">function</span>(lado_1, lado_2) {</span>
<span id="cb188-3" class="hljs-ln-code"><a href="#cb188-3"></a>  </span>
<span id="cb188-4" class="hljs-ln-code"><a href="#cb188-4"></a>  area <span class="ot">&lt;-</span> lado_1 <span class="sc">*</span> lado_2</span>
<span id="cb188-5" class="hljs-ln-code"><a href="#cb188-5"></a>  </span>
<span id="cb188-6" class="hljs-ln-code"><a href="#cb188-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creando-funciones-7" class="slide level2" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Creando funciones</h2>
<p>Veamos un ejemplo muy simple de funci√≥n para <span class="hl-yellow"><strong>calcular el √°rea de un rect√°ngulo</strong></span>.</p>
<p>Dado que el √°rea de un rect√°ngulo se calcula como el <strong>producto de sus lados</strong>, necesitaremos precisamente eso, sus lados: esos ser√°n los <span class="hl-yellow"><strong>argumentos de entrada</strong></span> y el <span class="hl-purple"><strong>valor a devolver</strong></span> ser√° justo su <strong>√°rea</strong> (<span class="math inline">\(lado_1 * lado_2\)</span>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode numberSource r number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode r hljs"><span id="cb189-1" class="hljs-ln-code"><a href="#cb189-1"></a><span class="co"># Definici√≥n del nombre de funci√≥n y argumentos de entrada</span></span>
<span id="cb189-2" class="hljs-ln-code"><a href="#cb189-2"></a>calcular_area <span class="ot">&lt;-</span> <span class="cf">function</span>(lado_1, lado_2) {</span>
<span id="cb189-3" class="hljs-ln-code"><a href="#cb189-3"></a>  </span>
<span id="cb189-4" class="hljs-ln-code"><a href="#cb189-4"></a>  area <span class="ot">&lt;-</span> lado_1 <span class="sc">*</span> lado_2</span>
<span id="cb189-5" class="hljs-ln-code"><a href="#cb189-5"></a>  <span class="fu">return</span>(area)</span>
<span id="cb189-6" class="hljs-ln-code"><a href="#cb189-6"></a>  </span>
<span id="cb189-7" class="hljs-ln-code"><a href="#cb189-7"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="uso-de-funciones" class="slide level2">
<h2>Uso de funciones</h2>
<p>Tambi√©n podemos hacer una definici√≥n directa de las variables <strong>sin almacenar por el camino</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1"></a><span class="co"># Definici√≥n del nombre de funci√≥n y argumentos de entrada</span></span>
<span id="cb190-2"><a href="#cb190-2"></a>calcular_area <span class="ot">&lt;-</span> <span class="cf">function</span>(lado_1, lado_2) {</span>
<span id="cb190-3"><a href="#cb190-3"></a>  </span>
<span id="cb190-4"><a href="#cb190-4"></a>  <span class="fu">return</span>(lado_1 <span class="sc">*</span> lado_2)</span>
<span id="cb190-5"><a href="#cb190-5"></a>  </span>
<span id="cb190-6"><a href="#cb190-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p><span class="hl-yellow"><strong>¬øC√≥mo aplicar la funci√≥n?</strong></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1"></a><span class="fu">calcular_area</span>(<span class="dv">5</span>, <span class="dv">3</span>) <span class="co"># √°rea de un rect√°ngulo 5 x 3 </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15</code></pre>
</div>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1"></a><span class="fu">calcular_area</span>(<span class="dv">1</span>, <span class="dv">5</span>) <span class="co"># √°rea de un rect√°ngulo 1 x 5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
</div>
</div>
</section>
<section id="uso-de-funciones-1" class="slide level2">
<h2>Uso de funciones</h2>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Consejo</strong></p>
</div>
<div class="callout-content">
<p>Aunque no sea necesario, es <span class="hl-green"><strong>recomendable hacer expl√≠cita la llamada de los argumentos</strong></span>, especificando en el c√≥digo qu√© valor es para cada argumento para que no dependa de su orden, haciendo el c√≥digo m√°s legible</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1"></a><span class="fu">calcular_area</span>(<span class="at">lado_1 =</span> <span class="dv">5</span>, <span class="at">lado_2 =</span> <span class="dv">3</span>) <span class="co"># √°rea de un rect√°ngulo 5 x 3 </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15</code></pre>
</div>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1"></a><span class="fu">calcular_area</span>(<span class="at">lado_2 =</span> <span class="dv">3</span>, <span class="at">lado_1 =</span> <span class="dv">5</span>) <span class="co"># √°rea de un rect√°ngulo 5 x 3 </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15</code></pre>
</div>
</div>
</section>
<section id="argumentos-por-defecto" class="slide level2">
<h2>Argumentos por defecto</h2>
<p>Imagina ahora que nos damos cuenta que el 90% de las veces usamos dicha funci√≥n para <span class="hl-yellow"><strong>calcular por defecto el √°rea de un cuadrado</strong></span> (es decir, solo necesitamos un lado). Para ello, podemos definir <span class="hl-yellow"><strong>argumentos por defecto</strong></span> en la funci√≥n: tomar√°n dicho valor salvo que le asignemos otro.</p>
<p>¬øPor qu√© no asignar <code>lado_2 = lado_1</code> <strong>por defecto</strong>, para ahorrar l√≠neas de c√≥digo y tiempo?</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1"></a>calcular_area <span class="ot">&lt;-</span> <span class="cf">function</span>(lado_1, <span class="at">lado_2 =</span> lado_1) {</span>
<span id="cb199-2"><a href="#cb199-2"></a>  </span>
<span id="cb199-3"><a href="#cb199-3"></a>  <span class="co"># Cuerpo de la funci√≥n</span></span>
<span id="cb199-4"><a href="#cb199-4"></a>  area <span class="ot">&lt;-</span> lado_1 <span class="sc">*</span> lado_2</span>
<span id="cb199-5"><a href="#cb199-5"></a>  </span>
<span id="cb199-6"><a href="#cb199-6"></a>  <span class="co"># Resultado que devolvemos</span></span>
<span id="cb199-7"><a href="#cb199-7"></a>  <span class="fu">return</span>(area)</span>
<span id="cb199-8"><a href="#cb199-8"></a>  </span>
<span id="cb199-9"><a href="#cb199-9"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="argumentos-por-defecto-1" class="slide level2">
<h2>Argumentos por defecto</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1"></a>calcular_area <span class="ot">&lt;-</span> <span class="cf">function</span>(lado_1, <span class="at">lado_2 =</span> lado_1) {</span>
<span id="cb200-2"><a href="#cb200-2"></a>  </span>
<span id="cb200-3"><a href="#cb200-3"></a>  <span class="co"># Cuerpo de la funci√≥n</span></span>
<span id="cb200-4"><a href="#cb200-4"></a>  area <span class="ot">&lt;-</span> lado_1 <span class="sc">*</span> lado_2</span>
<span id="cb200-5"><a href="#cb200-5"></a>  </span>
<span id="cb200-6"><a href="#cb200-6"></a>  <span class="co"># Resultado que devolvemos</span></span>
<span id="cb200-7"><a href="#cb200-7"></a>  <span class="fu">return</span>(area)</span>
<span id="cb200-8"><a href="#cb200-8"></a>  </span>
<span id="cb200-9"><a href="#cb200-9"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ahora <span class="hl-yellow"><strong>por defecto</strong></span> el segundo lado ser√° igual al primero (si se lo a√±adimos usar√° ambos).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1"></a><span class="fu">calcular_area</span>(<span class="at">lado_1 =</span> <span class="dv">5</span>) <span class="co"># cuadrado</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25</code></pre>
</div>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1"></a><span class="fu">calcular_area</span>(<span class="at">lado_1 =</span> <span class="dv">5</span>, <span class="at">lado_2 =</span> <span class="dv">7</span>) <span class="co"># rect√°ngulo</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 35</code></pre>
</div>
</div>
</section>
<section id="salida-m√∫ltiple" class="slide level2">
<h2>Salida m√∫ltiple</h2>
<p>Compliquemos un poco la funci√≥n y a√±adamos en la salida los valores de cada lado, etiquetados como <code>lado_1</code> y <code>lado_2</code>, <span class="hl-yellow"><strong>empaquetando la salida en una vector</strong></span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb205" data-code-line-numbers="7-8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1"></a><span class="co"># Definici√≥n del nombre de funci√≥n y argumentos de entrada</span></span>
<span id="cb205-2"><a href="#cb205-2"></a>calcular_area <span class="ot">&lt;-</span> <span class="cf">function</span>(lado_1, <span class="at">lado_2 =</span> lado_1) {</span>
<span id="cb205-3"><a href="#cb205-3"></a>  </span>
<span id="cb205-4"><a href="#cb205-4"></a>  <span class="co"># Cuerpo de la funci√≥n</span></span>
<span id="cb205-5"><a href="#cb205-5"></a>  area <span class="ot">&lt;-</span> lado_1 <span class="sc">*</span> lado_2</span>
<span id="cb205-6"><a href="#cb205-6"></a>  </span>
<span id="cb205-7"><a href="#cb205-7"></a>  <span class="co"># Resultado</span></span>
<span id="cb205-8"><a href="#cb205-8"></a>  <span class="fu">return</span>(<span class="fu">c</span>(<span class="st">"area"</span> <span class="ot">=</span> area, <span class="st">"lado_1"</span> <span class="ot">=</span> lado_1, <span class="st">"lado_2"</span> <span class="ot">=</span> lado_2))</span>
<span id="cb205-9"><a href="#cb205-9"></a>  </span>
<span id="cb205-10"><a href="#cb205-10"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="salida-m√∫ltiple-1" class="slide level2">
<h2>Salida m√∫ltiple</h2>
<p>Podemos complicar un poco m√°s la salida a√±adiendo una cuarta variable que nos diga, en funci√≥n de los argumentos, <span class="hl-yellow"><strong>si rect√°ngulo o cuadrado</strong></span>, teniendo que a√±adir en la salida una variable que de tipo caracter (o l√≥gica).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb206" data-code-line-numbers="7-9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1"></a><span class="co"># Definici√≥n del nombre de funci√≥n y argumentos de entrada</span></span>
<span id="cb206-2"><a href="#cb206-2"></a>calcular_area <span class="ot">&lt;-</span> <span class="cf">function</span>(lado_1, <span class="at">lado_2 =</span> lado_1) {</span>
<span id="cb206-3"><a href="#cb206-3"></a>  </span>
<span id="cb206-4"><a href="#cb206-4"></a>  <span class="co"># Cuerpo de la funci√≥n</span></span>
<span id="cb206-5"><a href="#cb206-5"></a>  area <span class="ot">&lt;-</span> lado_1 <span class="sc">*</span> lado_2</span>
<span id="cb206-6"><a href="#cb206-6"></a>  </span>
<span id="cb206-7"><a href="#cb206-7"></a>  <span class="co"># Resultado</span></span>
<span id="cb206-8"><a href="#cb206-8"></a>  <span class="fu">return</span>(<span class="fu">c</span>(<span class="st">"area"</span> <span class="ot">=</span> area, <span class="st">"lado_1"</span> <span class="ot">=</span> lado_1, <span class="st">"lado_2"</span> <span class="ot">=</span> lado_2,</span>
<span id="cb206-9"><a href="#cb206-9"></a>           <span class="st">"tipo"</span> <span class="ot">=</span> <span class="fu">if_else</span>(lado_1 <span class="sc">==</span> lado_2, <span class="st">"cuadrado"</span>, <span class="st">"rect√°ngulo"</span>)))</span>
<span id="cb206-10"><a href="#cb206-10"></a>  </span>
<span id="cb206-11"><a href="#cb206-11"></a>}</span>
<span id="cb206-12"><a href="#cb206-12"></a><span class="fu">calcular_area</span>(<span class="dv">5</span>, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        area       lado_1       lado_2         tipo 
        "15"          "5"          "3" "rect√°ngulo" </code></pre>
</div>
</div>
<div class="fragment">
<p><span class="hl-red"><strong>Problema</strong></span>: al intentar juntar n√∫meros y texto, lo convierte todo a n√∫meros. Podr√≠amos guardarlo todo en un <code>tibble()</code> como hemos aprendido o en un objeto conocido en <code>R</code> como <span class="hl-yellow"><strong>listas</strong></span></p>
</div>
</section>
<section id="orden-de-los-argumentos" class="slide level2">
<h2>Orden de los argumentos</h2>
<p>Antes nos daba igual el orden de los argumentos pero ahora el <span class="hl-yellow"><strong>orden de los argumentos de entrada importa</strong></span>, ya que en la salida incluimos <code>lado_1</code> y <code>lado_2</code>.</p>
<div class="fragment">
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Recomendaci√≥n</strong></p>
</div>
<div class="callout-content">
<p>Como se comentaba, altamente recomendable hacer la llamada a la funci√≥n <span class="hl-yellow"><strong>indicando expl√≠citamente los argumentos</strong></span> para mejorar <strong>legibilidad e interpretabilidad</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1"></a><span class="co"># Equivalente a calcular_area(5, 3)</span></span>
<span id="cb208-2"><a href="#cb208-2"></a><span class="fu">calcular_area</span>(<span class="at">lado_1 =</span> <span class="dv">5</span>, <span class="at">lado_2 =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        area       lado_1       lado_2         tipo 
        "15"          "5"          "3" "rect√°ngulo" </code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="variables-locales-vs-globales" class="slide level2">
<h2>Variables locales vs globales</h2>
<p>Un aspecto importante sobre el que reflexionar con las funciones: ¬øqu√© sucede si <span class="hl-yellow"><strong>nombramos a una variable dentro</strong></span> de una funci√≥n a la que se nos ha <strong>olvidado asignar</strong> un valor dentro de la misma?</p>
<div class="fragment">
<p>Debemos ser cautos al usar funciones en <code>R</code>, ya que debido a la <span class="hl-yellow"><strong>¬´regla lexicogr√°fica¬ª</strong></span>, si una variable no se define dentro de la funci√≥n, <code>R</code> <span class="hl-purple"><strong>buscar√° dicha variable en el entorno</strong></span> de variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb210-2"><a href="#cb210-2"></a>funcion_ejemplo <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb210-3"><a href="#cb210-3"></a>    </span>
<span id="cb210-4"><a href="#cb210-4"></a>  <span class="fu">print</span>(x) <span class="co"># No devuelve nada, solo realiza la acci√≥n </span></span>
<span id="cb210-5"><a href="#cb210-5"></a>}</span>
<span id="cb210-6"><a href="#cb210-6"></a><span class="fu">funcion_ejemplo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
</div>
</section>
<section id="variables-locales-vs-globales-1" class="slide level2">
<h2>Variables locales vs globales</h2>
<p>Si una variable <span class="hl-yellow"><strong>ya est√° definida fuera de la funci√≥n (entorno global)</strong></span>, y adem√°s es usada dentro de cambiando su valor, el valor <span class="hl-yellow"><strong>solo cambia dentro</strong></span> pero <span class="hl-red"><strong>no en el entorno global</strong></span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb212-2"><a href="#cb212-2"></a>funcion_ejemplo <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb212-3"><a href="#cb212-3"></a>    </span>
<span id="cb212-4"><a href="#cb212-4"></a>  x <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb212-5"><a href="#cb212-5"></a>  <span class="fu">print</span>(x) <span class="co"># lo que vale dentro</span></span>
<span id="cb212-6"><a href="#cb212-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1"></a><span class="co"># lo que vale dentro</span></span>
<span id="cb213-2"><a href="#cb213-2"></a><span class="fu">funcion_ejemplo</span>() <span class="co">#&lt;&lt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1"></a><span class="co"># lo que vale fuera</span></span>
<span id="cb215-2"><a href="#cb215-2"></a><span class="fu">print</span>(x) <span class="co">#&lt;&lt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
</section>
<section id="variables-locales-vs-globales-2" class="slide level2">
<h2>Variables locales vs globales</h2>
<p>Si queremos que adem√°s de cambiar localmente lo haga <span class="hl-yellow"><strong>globalmente</strong></span> deberemos usar la <span class="hl-yellow"><strong>doble asignaci√≥n</strong></span> (<code>&lt;&lt;-</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb217-2"><a href="#cb217-2"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb217-3"><a href="#cb217-3"></a>funcion_ejemplo <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb217-4"><a href="#cb217-4"></a>  </span>
<span id="cb217-5"><a href="#cb217-5"></a>  <span class="co"># no cambia globalmente, solo localmente</span></span>
<span id="cb217-6"><a href="#cb217-6"></a>  x <span class="ot">&lt;-</span> <span class="dv">3</span> </span>
<span id="cb217-7"><a href="#cb217-7"></a>  <span class="co"># cambia globalmente</span></span>
<span id="cb217-8"><a href="#cb217-8"></a>  y <span class="ot">&lt;&lt;-</span> <span class="dv">0</span> <span class="co">#&lt;&lt;</span></span>
<span id="cb217-9"><a href="#cb217-9"></a>  </span>
<span id="cb217-10"><a href="#cb217-10"></a>  <span class="fu">print</span>(x)</span>
<span id="cb217-11"><a href="#cb217-11"></a>  <span class="fu">print</span>(y)</span>
<span id="cb217-12"><a href="#cb217-12"></a>}</span>
<span id="cb217-13"><a href="#cb217-13"></a></span>
<span id="cb217-14"><a href="#cb217-14"></a><span class="fu">funcion_ejemplo</span>() <span class="co"># lo que vale dentro</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3
[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1"></a>x <span class="co"># lo que vale fuera</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1"></a>y <span class="co"># lo que vale fuera</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
</section>
<section id="tu-turno-1-4" class="slide level2">
<h2>üíª Tu turno</h2>
<p><span style="color:#444442;"><strong>Intenta realizar los siguientes ejercicios sin mirar las soluciones</strong></span></p>
<div class="panel-tabset">
<ul id="tabset-5" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-5-1"><span class="hl-yellow"><strong>Ej 1</strong></span></a></li><li><a href="#tabset-5-2"><span class="hl-yellow"><strong>Ej 2</strong></span></a></li><li><a href="#tabset-5-3"><span class="hl-yellow"><strong>Ej 3</strong></span></a></li><li><a href="#tabset-5-4"><span class="hl-yellow"><strong>Ej 4</strong></span></a></li><li><a href="#tabset-5-5"><span class="hl-yellow"><strong>Ej 5</strong></span></a></li><li><a href="#tabset-5-6"><span class="hl-yellow"><strong>Ej 6</strong></span></a></li><li><a href="#tabset-5-7"><span class="hl-yellow"><strong>Ej 7</strong></span></a></li></ul>
<div class="tab-content">
<div id="tabset-5-1">
<p>üìù Modifica el c√≥digo inferior para definir una funci√≥n llamada <code>funcion_suma</code>, de forma que dados dos elementos, devuelve su suma.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1"></a>nombre <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb223-2"><a href="#cb223-2"></a>  suma <span class="ot">&lt;-</span> <span class="co"># c√≥digo a ejecutar</span></span>
<span id="cb223-3"><a href="#cb223-3"></a>  <span class="fu">return</span>()</span>
<span id="cb223-4"><a href="#cb223-4"></a>}</span>
<span id="cb223-5"><a href="#cb223-5"></a><span class="co"># Aplicamos la funci√≥n</span></span>
<span id="cb223-6"><a href="#cb223-6"></a><span class="fu">suma</span>(<span class="dv">3</span>, <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1"></a>funcion_suma <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb224-2"><a href="#cb224-2"></a>  suma <span class="ot">&lt;-</span> x <span class="sc">+</span> y</span>
<span id="cb224-3"><a href="#cb224-3"></a>  <span class="fu">return</span>(suma)</span>
<span id="cb224-4"><a href="#cb224-4"></a>}</span>
<span id="cb224-5"><a href="#cb224-5"></a><span class="fu">funcion_suma</span>(<span class="dv">3</span>, <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-5-2">
<p>üìù Modifica el c√≥digo inferior para definir una funci√≥n llamada <code>funcion_producto</code>, de forma que dados dos elementos, devuelve su producto, pero que por defecto calcule el cuadrado</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1"></a>nombre <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb225-2"><a href="#cb225-2"></a>  producto <span class="ot">&lt;-</span> <span class="co"># c√≥digo de la multiplicaci√≥n</span></span>
<span id="cb225-3"><a href="#cb225-3"></a>  <span class="fu">return</span>()</span>
<span id="cb225-4"><a href="#cb225-4"></a>}</span>
<span id="cb225-5"><a href="#cb225-5"></a><span class="fu">producto</span>(<span class="dv">3</span>)</span>
<span id="cb225-6"><a href="#cb225-6"></a><span class="fu">producto</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1"></a>funcion_producto <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">y =</span> x) {</span>
<span id="cb226-2"><a href="#cb226-2"></a>  producto <span class="ot">&lt;-</span> x <span class="sc">*</span> y</span>
<span id="cb226-3"><a href="#cb226-3"></a>  <span class="fu">return</span>(producto)</span>
<span id="cb226-4"><a href="#cb226-4"></a>}</span>
<span id="cb226-5"><a href="#cb226-5"></a><span class="fu">funcion_producto</span>(<span class="dv">3</span>)</span>
<span id="cb226-6"><a href="#cb226-6"></a><span class="fu">funcion_producto</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-5-3">
<p>üìù Define una funci√≥n llamada <code>igualdad_nombres</code> que, dados dos nombres, nos diga si son iguales o no. Hazlo considerando importantes las may√∫sculas, y sin que importen las may√∫sculas. Usa el paquete <code>{stringr}</code>.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1"></a><span class="co"># Distinguiendo may√∫sculas</span></span>
<span id="cb227-2"><a href="#cb227-2"></a>igualdad_nombres <span class="ot">&lt;-</span> <span class="cf">function</span>(persona_1, persona_2) {</span>
<span id="cb227-3"><a href="#cb227-3"></a>  <span class="fu">return</span>(persona_1 <span class="sc">==</span> persona_2)</span>
<span id="cb227-4"><a href="#cb227-4"></a>}</span>
<span id="cb227-5"><a href="#cb227-5"></a><span class="fu">igualdad_nombres</span>(<span class="st">"Javi"</span>, <span class="st">"javi"</span>)</span>
<span id="cb227-6"><a href="#cb227-6"></a><span class="fu">igualdad_nombres</span>(<span class="st">"Javi"</span>, <span class="st">"Luc√≠a"</span>)</span>
<span id="cb227-7"><a href="#cb227-7"></a></span>
<span id="cb227-8"><a href="#cb227-8"></a><span class="co"># Sin importar may√∫sculas</span></span>
<span id="cb227-9"><a href="#cb227-9"></a>igualdad_nombres <span class="ot">&lt;-</span> <span class="cf">function</span>(persona_1, persona_2) {</span>
<span id="cb227-10"><a href="#cb227-10"></a>  <span class="fu">return</span>(<span class="fu">toupper</span>(persona_1) <span class="sc">==</span> <span class="fu">toupper</span>(persona_2))</span>
<span id="cb227-11"><a href="#cb227-11"></a>}</span>
<span id="cb227-12"><a href="#cb227-12"></a><span class="fu">igualdad_nombres</span>(<span class="st">"Javi"</span>, <span class="st">"javi"</span>)</span>
<span id="cb227-13"><a href="#cb227-13"></a><span class="fu">igualdad_nombres</span>(<span class="st">"Javi"</span>, <span class="st">"Luc√≠a"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-5-4">
<p>üìù Crea una funci√≥n llamada <code>calculo_IMC</code> que, dados dos argumentos (peso y estatura en metros) y un nombre, devuelva una lista con el IMC (<span class="math inline">\(peso/(estatura_m^2)\)</span>) y el nombre.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1"></a>calculo_IMC <span class="ot">&lt;-</span> <span class="cf">function</span>(nombre, peso, estatura) {</span>
<span id="cb228-2"><a href="#cb228-2"></a>  </span>
<span id="cb228-3"><a href="#cb228-3"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">"nombre"</span> <span class="ot">=</span> nombre, <span class="st">"IMC"</span> <span class="ot">=</span> peso<span class="sc">/</span>(estatura<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb228-4"><a href="#cb228-4"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-5-5">
<p>üìù Repite el ejercicio anterior pero con otro argumento opcional que se llame unidades (por defecto, <code>unidades = "metros"</code>). Desarrolla la funci√≥n de forma que haga lo correcto si <code>unidades = "metros"</code> y si <code>unidades = "cent√≠metros"</code>.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1"></a>calculo_IMC <span class="ot">&lt;-</span> <span class="cf">function</span>(nombre, peso, estatura, <span class="at">unidades =</span> <span class="st">"metros"</span>) {</span>
<span id="cb229-2"><a href="#cb229-2"></a>  </span>
<span id="cb229-3"><a href="#cb229-3"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">"nombre"</span> <span class="ot">=</span> nombre,</span>
<span id="cb229-4"><a href="#cb229-4"></a>              <span class="st">"IMC"</span> <span class="ot">=</span> peso<span class="sc">/</span>(<span class="fu">if_else</span>(unidades <span class="sc">==</span> <span class="st">"metros"</span>, estatura, estatura<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb229-5"><a href="#cb229-5"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-5-6">
<p>üìù Crea un tibble ficticio de 7 personas, con tres variables (inventa nombre, y simula peso, estatura en cent√≠metros), y aplica la funci√≥n definida de forma que obtengamos una cuarta columna con su IMC.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1"></a>datos <span class="ot">&lt;-</span></span>
<span id="cb230-2"><a href="#cb230-2"></a>  <span class="fu">tibble</span>(<span class="st">"nombres"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"javi"</span>, <span class="st">"sandra"</span>, <span class="st">"laura"</span>,</span>
<span id="cb230-3"><a href="#cb230-3"></a>                       <span class="st">"ana"</span>, <span class="st">"carlos"</span>, <span class="st">"leo"</span>, <span class="cn">NA</span>),</span>
<span id="cb230-4"><a href="#cb230-4"></a>         <span class="st">"peso"</span> <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">7</span>, <span class="at">mean =</span> <span class="dv">70</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb230-5"><a href="#cb230-5"></a>         <span class="st">"estatura"</span> <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">7</span>, <span class="at">mean =</span> <span class="dv">168</span>, <span class="at">sd =</span> <span class="dv">5</span>))</span>
<span id="cb230-6"><a href="#cb230-6"></a></span>
<span id="cb230-7"><a href="#cb230-7"></a>datos <span class="sc">|&gt;</span> </span>
<span id="cb230-8"><a href="#cb230-8"></a>  <span class="fu">mutate</span>(<span class="at">IMC =</span> <span class="fu">calculo_IMC</span>(nombres, peso, estatura, <span class="at">unidades =</span> <span class="st">"cent√≠metros"</span>)<span class="sc">$</span>IMC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-5-7">
<p>üìù Crea una funci√≥n llamada <code>atajo</code> que tenga dos argumentos num√©ricos <code>x</code> e <code>y</code>. Si ambos son iguales, debes devolver <code>"iguales"</code> y hacer que la funci√≥n acaba autom√°ticamente (piensa cu√°ndo una funci√≥n sale). OJO: <code>x</code> e <code>y</code> podr√≠an ser vectores. Si son distintos (de igual de longitud) calcula la proporci√≥n de elementos diferentes. Si son distintos (por ser distinta longitud), devuelve los elementos que no sean comunes.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1"></a>atajo <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb231-2"><a href="#cb231-2"></a>  </span>
<span id="cb231-3"><a href="#cb231-3"></a>  <span class="cf">if</span> (<span class="fu">all</span>(x <span class="sc">==</span> y) <span class="sc">&amp;</span> <span class="fu">length</span>(x) <span class="sc">==</span> <span class="fu">length</span>(y)) { <span class="fu">return</span>(<span class="st">"iguales"</span>) }</span>
<span id="cb231-4"><a href="#cb231-4"></a>  <span class="cf">else</span> {</span>
<span id="cb231-5"><a href="#cb231-5"></a>   </span>
<span id="cb231-6"><a href="#cb231-6"></a>    <span class="cf">if</span> (<span class="fu">length</span>(x) <span class="sc">==</span> <span class="fu">length</span>(y)) {</span>
<span id="cb231-7"><a href="#cb231-7"></a>      </span>
<span id="cb231-8"><a href="#cb231-8"></a>      n_diff <span class="ot">&lt;-</span> <span class="fu">sum</span>(x <span class="sc">!=</span> y) <span class="sc">/</span> <span class="fu">length</span>(x)</span>
<span id="cb231-9"><a href="#cb231-9"></a>      <span class="fu">return</span>(n_diff)</span>
<span id="cb231-10"><a href="#cb231-10"></a>      </span>
<span id="cb231-11"><a href="#cb231-11"></a>    } <span class="cf">else</span> {</span>
<span id="cb231-12"><a href="#cb231-12"></a>      </span>
<span id="cb231-13"><a href="#cb231-13"></a>      diff_elem <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(<span class="fu">setdiff</span>(x, y), <span class="fu">setdiff</span>(y, x)))</span>
<span id="cb231-14"><a href="#cb231-14"></a>      <span class="fu">return</span>(diff_elem)</span>
<span id="cb231-15"><a href="#cb231-15"></a>    }</span>
<span id="cb231-16"><a href="#cb231-16"></a>    </span>
<span id="cb231-17"><a href="#cb231-17"></a>  }</span>
<span id="cb231-18"><a href="#cb231-18"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="r-base-vs-tidyverse" class="slide level2">
<h2>R base vs Tidyverse</h2>
<p>Hasta ahora todo lo que hemos repasado en <code>R</code> lo hemos realizado en el paradigma de programaci√≥n conocido como <span class="hl-yellow"><strong>R base</strong></span>. Y es que cuando <code>R</code> naci√≥ como lenguaje, muchos de los que programaban en √©l imitaron formas y metodolog√≠as heredadas de otros lenguajes, basado en el uso de</p>
<ul>
<li><p>Bucles <span class="hl-yellow"><strong>for</strong></span></p></li>
<li><p>Bucles <span class="hl-yellow"><strong>while</strong></span></p></li>
<li><p>Estructuras <span class="hl-yellow"><strong>if-else</strong></span></p></li>
</ul>
<p>Y aunque conocer dichas estructuras puede sernos en algunos casos interesantes, en la <span class="hl-red"><strong>mayor√≠a de ocasiones han quedado caducas y vamos a poder evitarlas</strong></span> (en especial los bucles) ya que <code>R</code> est√° especialmente <span class="hl-yellow"><strong>dise√±ado para trabajar de manera funcional</strong></span> (en lugar de elemento a elemento).</p>
</section>
<section id="qu√©-es-tidyverse" class="slide level2">
<h2>¬øQu√© es tidyverse?</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="img/tidyverrse_universe.jpg"></p>
</div><div class="column" style="width:50%;">
<p><img data-src="img/flow_tidyverse.jpg"></p>
</div>
</div>
<p>En ese contexto de programaci√≥n funcional, hace una d√©cada nac√≠a <code>{tidyverse}</code>, un <span class="hl-yellow"><strong>¬´universo¬ª de paquetes</strong></span> para garantizar un flujo de trabajo eficiente, coherente y lexicogr√°ficamente sencillo de entender, basado en la idea de que <span class="hl-purple"><strong>nuestros datos est√°n limpios y ordenados (tidy)</strong></span></p>
</section>
<section id="qu√©-es-tidyverse-1" class="slide level2">
<h2>¬øQu√© es tidyverse?</h2>
<div class="columns">
<div class="column" style="width:45%;">
<p><img data-src="img/tidyverrse_universe.jpg"></p>
<ul>
<li><code>{lubridate}</code> manejo de fechas</li>
<li><code>{rvest}</code>: web scraping</li>
<li><code>{tidymodels}</code>: modelizaci√≥n/predicci√≥n</li>
</ul>
</div><div class="column" style="width:55%;">
<ul>
<li><code>{tibble}</code>: optimizando data.frame</li>
<li><code>{tidyr}</code>: limpieza de datos</li>
<li><code>{readr}</code>: carga datos rectangulares (.csv), <code>{readxl}</code> para importar archivos .xls y .xlsx</li>
<li><code>{dplyr}</code>: gram√°tica para depurar</li>
<li><code>{stringr}</code>: manejo de textos</li>
<li><code>{purrr}</code>: manejo de listas</li>
<li><code>{forcats}</code>: manejo de cualitativas</li>
<li><code>{ggplot2}</code>: visualizaci√≥n de datos</li>
</ul>
</div>
</div>
</section>
<section id="qu√©-es-tidyverse-2" class="slide level2">
<h2>¬øQu√© es tidyverse?</h2>
<div class="columns">
<div class="column" style="width:45%;">
<p><img data-src="img/tidyverrse_universe.jpg"></p>
<ul>
<li><code>{lubridate}</code> manejo de fechas</li>
<li><code>{rvest}</code>: web scraping</li>
<li><code>{tidymodels}</code>: modelizaci√≥n/predicci√≥n</li>
</ul>
</div><div class="column" style="width:55%;">
<ul>
<li><code>{tibble}</code>: <span class="hl-yellow"><strong>optimizando data.frame</strong></span></li>
<li><code>{tidyr}</code>: <span class="hl-yellow"><strong>limpieza de datos</strong></span></li>
<li><code>{readr}</code>: carga datos rectangulares (.csv), <code>{readxl}</code> para importar archivos .xls y .xlsx</li>
<li><code>{dplyr}</code>: gram√°tica para depurar</li>
<li><code>{stringr}</code>: manejo de textos</li>
<li><code>{purrr}</code>: manejo de listas</li>
<li><code>{forcats}</code>: manejo de cualitativas</li>
<li><code>{ggplot2}</code>: visualizaci√≥n de datos</li>
</ul>
</div>
</div>
</section>
<section id="filosof√≠a-base-tidy-data" class="slide level2">
<h2>Filosof√≠a base: tidy data</h2>
<blockquote>
<p>Tidy datasets are all alike, but every messy dataset is messy in its own way (Hadley Wickham, Chief Scientist en RStudio)</p>
</blockquote>
<div style="font-size:120px; text-align: center; color:#F8DF58;">
<p><b>TIDY</b><b><span style="color:#CAB0EE;">VERSE</span></b></p>
</div>
<p>El <span class="hl-purple"><strong>universo</strong></span> de paquetes <code>{tidyverse}</code> se basa en la idea introducida por <strong>Hadley Wickham</strong> (el Dios al que rezamos) de <span class="hl-yellow"><strong>estandarizar</strong></span> el formato de los datos para</p>
<div>
<ul>
<li class="fragment"><span class="hl-green"><strong>sistematizar</strong></span> la depuraci√≥n</li>
<li class="fragment">hacer m√°s <span class="hl-green"><strong>sencillo</strong></span> su manipulaci√≥n.</li>
<li class="fragment">c√≥digo <span class="hl-green"><strong>legible</strong></span></li>
</ul>
</div>
</section>
<section id="reglas-del-tidy-data" class="slide level2">
<h2>Reglas del tidy data</h2>
<p>Lo primero por tanto ser√° entender qu√© son los <span class="hl-yellow"><strong>conjuntos tidydata</strong></span> ya que todo <code>{tidyverse}</code> se basa en que los datos est√°n estandarizados.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="fragment fade-in">
<ol type="1">
<li>Cada <span class="hl-yellow"><strong>variable</strong></span> en una <span class="hl-purple"><strong>√∫nica columna</strong></span></li>
</ol>
</div>
<div class="fragment fade-in">
<ol start="2" type="1">
<li>Cada <span class="hl-yellow"><strong>individuo</strong></span> en una <span class="hl-purple"><strong>fila diferente</strong></span></li>
</ol>
</div>
<div class="fragment fade-in">
<ol start="3" type="1">
<li>Cada <span class="hl-yellow"><strong>celda</strong></span> con un <span class="hl-purple"><strong>√∫nico valor</strong></span></li>
</ol>
</div>
<div class="fragment fade-in">
<ol start="4" type="1">
<li>Cada <span class="hl-yellow"><strong>dataset</strong></span> en un <span class="hl-purple"><strong>tibble</strong></span></li>
</ol>
</div>
<div class="fragment fade-in">
<ol start="5" type="1">
<li>Si queremos cruzar <span class="hl-yellow"><strong>m√∫ltiples tablas</strong></span> debemos tener una <span class="hl-purple"><strong>columna com√∫n</strong></span></li>
</ol>
</div>
</div><div class="column" style="width:50%;">
<p><img data-src="img/tidy_def.jpg" style="width:160.0%"></p>
</div>
</div>
</section>
<section id="tuber√≠a-pipe" class="slide level2">
<h2>Tuber√≠a (pipe)</h2>
<p>En <code>{tidyverse}</code> ser√° clave el <span class="hl-yellow"><strong>operador pipe (tuber√≠a)</strong></span> definido como <code>|&gt;</code> (<span class="hl-purple"><strong>ctrl+shift+M</strong></span>): ser√° una <span class="hl-yellow"><strong>tuber√≠a que recorre los datos</strong></span> y los transforma.</p>
<div class="fragment">
<div class="columns">
<div class="column" style="width:50%;">
<p>En R base, si queremos aplicar tres funciones <code>first()</code>, <code>second()</code> y <code>third()</code> en orden, ser√≠a</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1"></a><span class="fu">third</span>(<span class="fu">second</span>(<span class="fu">first</span>(datos)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<p>En <code>{tidyverse}</code> podremos <span class="hl-yellow"><strong>leer de izquierda a derecha</strong></span> y separar los datos de las acciones</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1"></a>datos <span class="sc">|&gt;</span> <span class="fu">first</span>() <span class="sc">|&gt;</span> <span class="fu">second</span>() <span class="sc">|&gt;</span> <span class="fu">third</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="fragment">
<div class="callout callout-caution callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Apunte importante</strong></p>
</div>
<div class="callout-content">
<p>Desde la versi√≥n 4.1.0 de <code>R</code> disponemos de <code>|&gt;</code>, un pipe <strong>nativo</strong> disponible <span class="hl-purple"><strong>fuera de tidyverse</strong></span>, sustituyendo al <span class="hl-red"><strong>antiguo pipe</strong></span> <code>%&gt;%</code> que depend√≠a del paquete <code>{magrittr}</code> (bastante problem√°tico).</p>
</div>
</div>
</div>
</div>
</section>
<section id="tuber√≠a-pipe-1" class="slide level2">
<h2>Tuber√≠a (pipe)</h2>
<p>La principal ventaja es que el <span class="hl-yellow"><strong>c√≥digo sea muy legible (casi literal)</strong></span> pudiendo hacer grandes operaciones con los datos con apenas c√≥digo.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1"></a>datos <span class="sc">|&gt;</span></span>
<span id="cb234-2"><a href="#cb234-2"></a>  <span class="fu">limpio</span>(...) <span class="sc">|&gt;</span></span>
<span id="cb234-3"><a href="#cb234-3"></a>  <span class="fu">filtro</span>(...) <span class="sc">|&gt;</span></span>
<span id="cb234-4"><a href="#cb234-4"></a>  <span class="fu">selecciono</span>(...) <span class="sc">|&gt;</span></span>
<span id="cb234-5"><a href="#cb234-5"></a>  <span class="fu">ordeno</span>(...) <span class="sc">|&gt;</span></span>
<span id="cb234-6"><a href="#cb234-6"></a>  <span class="fu">modifico</span>(...) <span class="sc">|&gt;</span></span>
<span id="cb234-7"><a href="#cb234-7"></a>  <span class="fu">renombro</span>(...) <span class="sc">|&gt;</span></span>
<span id="cb234-8"><a href="#cb234-8"></a>  <span class="fu">agrupo</span>(...) <span class="sc">|&gt;</span></span>
<span id="cb234-9"><a href="#cb234-9"></a>  <span class="fu">cuento</span>(...) <span class="sc">|&gt;</span></span>
<span id="cb234-10"><a href="#cb234-10"></a>  <span class="fu">resumo</span>(...) <span class="sc">|&gt;</span></span>
<span id="cb234-11"><a href="#cb234-11"></a>  <span class="fu">pinto</span>(...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<center>
<img src="img/logo_pipe.png" width="360px">
</center>
</div>
</div>
</section>
<section id="datos-sucios-messy-data" class="slide level2">
<h2>Datos SUCIOS: messy data</h2>
<p>¬øPero qu√© aspecto tienen los <span class="hl-yellow"><strong>datos no tidy</strong></span>? Vamos a cargar la tabla <code>table4a</code> del paquete <code>{tidyr}</code> (ya lo tenemos cargado del entorno tidyverse).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb235-2"><a href="#cb235-2"></a>table4a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 3
  country     `1999` `2000`
  &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;
1 Afghanistan    745   2666
2 Brazil       37737  80488
3 China       212258 213766</code></pre>
</div>
</div>
<p><span class="hl-red"><strong>¬øQu√© puede estar fallando?</strong></span></p>
</section>
<section id="pivotar-pivot_longer" class="slide level2">
<h2>Pivotar: pivot_longer()</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1"></a>table4a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 3
  country     `1999` `2000`
  &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;
1 Afghanistan    745   2666
2 Brazil       37737  80488
3 China       212258 213766</code></pre>
</div>
</div>
</div><div class="column" style="width:60%;">
<p>‚ùé Cada <span class="hl-red"><strong>fila representa dos observaciones</strong></span> (1999 y 2000) ‚Üí las columnas <code>1999</code> y <code>2000</code> en realidad deber√≠an ser en s√≠ <span class="hl-yellow"><strong>valores de una variable</strong></span> y no nombres de columnas.</p>
</div>
</div>
<div class="fragment">
<p>Incluiremos una <span class="hl-yellow"><strong>nueva columna</strong></span> que nos guarde el a√±o y otra que guarde el valor de la variable de inter√©s en cada uno de esos a√±os. Y lo haremos con la funci√≥n <code>pivot_longer()</code>: <span class="hl-yellow"><strong>pivotaremos la tabla</strong></span> a formato long:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1"></a>table4a <span class="sc">|&gt;</span> </span>
<span id="cb239-2"><a href="#cb239-2"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"1999"</span>, <span class="st">"2000"</span>), <span class="at">names_to =</span> <span class="st">"year"</span>, <span class="at">values_to =</span> <span class="st">"cases"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 3
  country     year   cases
  &lt;chr&gt;       &lt;chr&gt;  &lt;dbl&gt;
1 Afghanistan 1999     745
2 Afghanistan 2000    2666
3 Brazil      1999   37737
4 Brazil      2000   80488
5 China       1999  212258
6 China       2000  213766</code></pre>
</div>
</div>
</div>
</section>
<section id="pivotar-pivot_longer-1" class="slide level2">
<h2>Pivotar: pivot_longer()</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1"></a>table4a <span class="sc">|&gt;</span> </span>
<span id="cb241-2"><a href="#cb241-2"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"1999"</span>, <span class="st">"2000"</span>),</span>
<span id="cb241-3"><a href="#cb241-3"></a>               <span class="at">names_to =</span> <span class="st">"year"</span>,</span>
<span id="cb241-4"><a href="#cb241-4"></a>               <span class="at">values_to =</span> <span class="st">"cases"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 3
  country     year   cases
  &lt;chr&gt;       &lt;chr&gt;  &lt;dbl&gt;
1 Afghanistan 1999     745
2 Afghanistan 2000    2666
3 Brazil      1999   37737
4 Brazil      2000   80488
5 China       1999  212258
6 China       2000  213766</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<p><img data-src="img/table4a.jpg"></p>
</div>
</div>
<ul>
<li><code>cols</code>: <span class="hl-yellow"><strong>nombre de las variables a pivotar</strong></span></li>
<li><code>names_to</code>: nombre de la nueva variable a la quemandamos la <span class="hl-yellow"><strong>cabecera</strong></span> de la tabla (los nombres).</li>
<li><code>values_to</code>: nombre de la nueva variable a la que vamos a mandar los <span class="hl-yellow"><strong>datos</strong></span>.</li>
</ul>
</section>
<section id="datos-sucios-messy-data-1" class="slide level2">
<h2>Datos SUCIOS: messy data</h2>
<p>Veamos otro ejemplo con la tabla <code>table2</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1"></a>table2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 √ó 4
   country      year type            count
   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
 1 Afghanistan  1999 cases             745
 2 Afghanistan  1999 population   19987071
 3 Afghanistan  2000 cases            2666
 4 Afghanistan  2000 population   20595360
 5 Brazil       1999 cases           37737
 6 Brazil       1999 population  172006362
 7 Brazil       2000 cases           80488
 8 Brazil       2000 population  174504898
 9 China        1999 cases          212258
10 China        1999 population 1272915272
11 China        2000 cases          213766
12 China        2000 population 1280428583</code></pre>
</div>
</div>
<p><span class="hl-red"><strong>¬øQu√© puede estar fallando?</strong></span></p>
</section>
<section id="pivotar-pivot_wider" class="slide level2">
<h2>Pivotar: pivot_wider()</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 √ó 4
   country      year type            count
   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
 1 Afghanistan  1999 cases             745
 2 Afghanistan  1999 population   19987071
 3 Afghanistan  2000 cases            2666
 4 Afghanistan  2000 population   20595360
 5 Brazil       1999 cases           37737
 6 Brazil       1999 population  172006362
 7 Brazil       2000 cases           80488
 8 Brazil       2000 population  174504898
 9 China        1999 cases          212258
10 China        1999 population 1272915272
11 China        2000 cases          213766
12 China        2000 population 1280428583</code></pre>
</div>
</div>
</div><div class="column" style="width:40%;">
<p>‚ùé Cada <span class="hl-red"><strong>observaci√≥n est√° dividido en dos filas</strong></span> ‚Üí los <span class="hl-yellow"><strong>registros con el mismo a√±o deber√≠an ser el mismo</strong></span></p>
</div>
</div>
<div class="fragment">
<p>Lo que haremos ser√° lo opuesto: con <code>pivot_wider()</code> <span class="hl-yellow"><strong>ensancharemos la tabla</strong></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1"></a>table2 <span class="sc">|&gt;</span>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> type, <span class="at">values_from =</span> count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 4
  country      year  cases population
  &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
1 Afghanistan  1999    745   19987071
2 Afghanistan  2000   2666   20595360
3 Brazil       1999  37737  172006362
4 Brazil       2000  80488  174504898
5 China        1999 212258 1272915272
6 China        2000 213766 1280428583</code></pre>
</div>
</div>
</div>
</section>
<section id="datos-sucios-messy-data-2" class="slide level2">
<h2>Datos SUCIOS: messy data</h2>
<p>Veamos otro ejemplo con la tabla <code>table3</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1"></a>table3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 3
  country      year rate             
  &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;            
1 Afghanistan  1999 745/19987071     
2 Afghanistan  2000 2666/20595360    
3 Brazil       1999 37737/172006362  
4 Brazil       2000 80488/174504898  
5 China        1999 212258/1272915272
6 China        2000 213766/1280428583</code></pre>
</div>
</div>
<p><span class="hl-red"><strong>¬øQu√© puede estar fallando?</strong></span></p>
</section>
<section id="separar-separate" class="slide level2">
<h2>Separar: separate()</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1"></a>table3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 3
  country      year rate             
  &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;            
1 Afghanistan  1999 745/19987071     
2 Afghanistan  2000 2666/20595360    
3 Brazil       1999 37737/172006362  
4 Brazil       2000 80488/174504898  
5 China        1999 212258/1272915272
6 China        2000 213766/1280428583</code></pre>
</div>
</div>
</div><div class="column" style="width:40%;">
<p>‚ùé Cada <span class="hl-red"><strong>celda contiene varios valores</strong></span></p>
</div>
</div>
<div class="fragment">
<p>Lo que haremos ser√° hacer uso de la funci√≥n <code>separate()</code> para mandar <span class="hl-yellow"><strong>separar cada valor</strong></span> a una columna diferente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1"></a>table3 <span class="sc">|&gt;</span> <span class="fu">separate</span>(rate, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"cases"</span>, <span class="st">"pop"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 4
  country      year cases  pop       
  &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     
1 Afghanistan  1999 745    19987071  
2 Afghanistan  2000 2666   20595360  
3 Brazil       1999 37737  172006362 
4 Brazil       2000 80488  174504898 
5 China        1999 212258 1272915272
6 China        2000 213766 1280428583</code></pre>
</div>
</div>
</div>
</section>
<section id="separar-separate-1" class="slide level2">
<h2>Separar: separate()</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1"></a>table3 <span class="sc">|&gt;</span> <span class="fu">separate</span>(rate, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"cases"</span>, <span class="st">"pop"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 4
  country      year cases  pop       
  &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     
1 Afghanistan  1999 745    19987071  
2 Afghanistan  2000 2666   20595360  
3 Brazil       1999 37737  172006362 
4 Brazil       2000 80488  174504898 
5 China        1999 212258 1272915272
6 China        2000 213766 1280428583</code></pre>
</div>
</div>
<p>F√≠jate que los datos, aunque los ha separado, <span class="hl-red"><strong>los ha mantenido como texto</strong></span> cuando en realidad deber√≠an ser variables num√©ricas. Para ello podemos a√±adir el argumento opcional <code>convert = TRUE</code></p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1"></a>table3 <span class="sc">|&gt;</span> <span class="fu">separate</span>(rate, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"cases"</span>, <span class="st">"pop"</span>), <span class="at">convert =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 4
  country      year  cases        pop
  &lt;chr&gt;       &lt;dbl&gt;  &lt;int&gt;      &lt;int&gt;
1 Afghanistan  1999    745   19987071
2 Afghanistan  2000   2666   20595360
3 Brazil       1999  37737  172006362
4 Brazil       2000  80488  174504898
5 China        1999 212258 1272915272
6 China        2000 213766 1280428583</code></pre>
</div>
</div>
</div>
</section>
<section id="datos-sucios-messy-data-3" class="slide level2">
<h2>Datos SUCIOS: messy data</h2>
<p>Veamos el √∫ltimo ejemplo con la tabla <code>table5</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1"></a>table5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 4
  country     century year  rate             
  &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;            
1 Afghanistan 19      99    745/19987071     
2 Afghanistan 20      00    2666/20595360    
3 Brazil      19      99    37737/172006362  
4 Brazil      20      00    80488/174504898  
5 China       19      99    212258/1272915272
6 China       20      00    213766/1280428583</code></pre>
</div>
</div>
<p><span class="hl-red"><strong>¬øQu√© puede estar fallando?</strong></span></p>
</section>
<section id="unir-unite" class="slide level2">
<h2>Unir unite()</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1"></a>table5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 4
  country     century year  rate             
  &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;            
1 Afghanistan 19      99    745/19987071     
2 Afghanistan 20      00    2666/20595360    
3 Brazil      19      99    37737/172006362  
4 Brazil      20      00    80488/174504898  
5 China       19      99    212258/1272915272
6 China       20      00    213766/1280428583</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>‚ùé Tenemos <span class="hl-red"><strong>mismos valores divididos en dos columnas</strong></span></p>
</div>
</div>
<div class="fragment">
<p>Usaremos <code>unite()</code> para <span class="hl-yellow"><strong>unir los valores</strong></span> de siglo y a√±o en una misma columna</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1"></a>table5 <span class="sc">|&gt;</span> <span class="fu">unite</span>(<span class="at">col =</span> year_completo, century, year, <span class="at">sep =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 3
  country     year_completo rate             
  &lt;chr&gt;       &lt;chr&gt;         &lt;chr&gt;            
1 Afghanistan 1999          745/19987071     
2 Afghanistan 2000          2666/20595360    
3 Brazil      1999          37737/172006362  
4 Brazil      2000          80488/174504898  
5 China       1999          212258/1272915272
6 China       2000          213766/1280428583</code></pre>
</div>
</div>
</div>
</section>
<section id="ejemplo-relig_income" class="slide level2">
<h2>Ejemplo: relig_income</h2>
<p>Vamos a realizar un ejemplo juntos con la tabla <code>relig_income</code> del paquete <code>{tidyr}</code>. Como se indica en la ayuda <code>? relig_income</code>, la tabla representa la cantidad de personas que hay en cada tramo de ingresos anuales (20k = 20 000$) y en cada religi√≥n.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1"></a>relig_income</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 √ó 11
   religion `&lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k` `$75-100k`
   &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1 Agnostic      27        34        60        81        76       137        122
 2 Atheist       12        27        37        52        35        70         73
 3 Buddhist      27        21        30        34        33        58         62
 4 Catholic     418       617       732       670       638      1116        949
 5 Don‚Äôt k‚Ä¶      15        14        15        11        10        35         21
 6 Evangel‚Ä¶     575       869      1064       982       881      1486        949
 7 Hindu          1         9         7         9        11        34         47
 8 Histori‚Ä¶     228       244       236       238       197       223        131
 9 Jehovah‚Ä¶      20        27        24        24        21        30         15
10 Jewish        19        19        25        25        30        95         69
11 Mainlin‚Ä¶     289       495       619       655       651      1107        939
12 Mormon        29        40        48        51        56       112         85
13 Muslim         6         7         9        10         9        23         16
14 Orthodox      13        17        23        32        32        47         38
15 Other C‚Ä¶       9         7        11        13        13        14         18
16 Other F‚Ä¶      20        33        40        46        49        63         46
17 Other W‚Ä¶       5         2         3         4         2         7          3
18 Unaffil‚Ä¶     217       299       374       365       341       528        407
# ‚Ñπ 3 more variables: `$100-150k` &lt;dbl&gt;, `&gt;150k` &lt;dbl&gt;,
#   `Don't know/refused` &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="ejemplo-relig_income-1" class="slide level2">
<h2>Ejemplo: relig_income</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1"></a>relig_income</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 √ó 11
   religion `&lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k` `$75-100k`
   &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1 Agnostic      27        34        60        81        76       137        122
 2 Atheist       12        27        37        52        35        70         73
 3 Buddhist      27        21        30        34        33        58         62
 4 Catholic     418       617       732       670       638      1116        949
 5 Don‚Äôt k‚Ä¶      15        14        15        11        10        35         21
 6 Evangel‚Ä¶     575       869      1064       982       881      1486        949
 7 Hindu          1         9         7         9        11        34         47
 8 Histori‚Ä¶     228       244       236       238       197       223        131
 9 Jehovah‚Ä¶      20        27        24        24        21        30         15
10 Jewish        19        19        25        25        30        95         69
11 Mainlin‚Ä¶     289       495       619       655       651      1107        939
12 Mormon        29        40        48        51        56       112         85
13 Muslim         6         7         9        10         9        23         16
14 Orthodox      13        17        23        32        32        47         38
15 Other C‚Ä¶       9         7        11        13        13        14         18
16 Other F‚Ä¶      20        33        40        46        49        63         46
17 Other W‚Ä¶       5         2         3         4         2         7          3
18 Unaffil‚Ä¶     217       299       374       365       341       528        407
# ‚Ñπ 3 more variables: `$100-150k` &lt;dbl&gt;, `&gt;150k` &lt;dbl&gt;,
#   `Don't know/refused` &lt;dbl&gt;</code></pre>
</div>
</div>
<p><span class="hl-yellow"><strong>¬øEs tidydata?</strong></span></p>
</section>
<section id="ejemplo-relig_income-2" class="slide level2">
<h2>Ejemplo: relig_income</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1"></a>relig_income</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 √ó 11
   religion `&lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k` `$75-100k`
   &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1 Agnostic      27        34        60        81        76       137        122
 2 Atheist       12        27        37        52        35        70         73
 3 Buddhist      27        21        30        34        33        58         62
 4 Catholic     418       617       732       670       638      1116        949
 5 Don‚Äôt k‚Ä¶      15        14        15        11        10        35         21
 6 Evangel‚Ä¶     575       869      1064       982       881      1486        949
 7 Hindu          1         9         7         9        11        34         47
 8 Histori‚Ä¶     228       244       236       238       197       223        131
 9 Jehovah‚Ä¶      20        27        24        24        21        30         15
10 Jewish        19        19        25        25        30        95         69
11 Mainlin‚Ä¶     289       495       619       655       651      1107        939
12 Mormon        29        40        48        51        56       112         85
13 Muslim         6         7         9        10         9        23         16
14 Orthodox      13        17        23        32        32        47         38
15 Other C‚Ä¶       9         7        11        13        13        14         18
16 Other F‚Ä¶      20        33        40        46        49        63         46
17 Other W‚Ä¶       5         2         3         4         2         7          3
18 Unaffil‚Ä¶     217       299       374       365       341       528        407
# ‚Ñπ 3 more variables: `$100-150k` &lt;dbl&gt;, `&gt;150k` &lt;dbl&gt;,
#   `Don't know/refused` &lt;dbl&gt;</code></pre>
</div>
</div>
<p>No lo es ya que en realidad <span class="hl-red"><strong>solo deber√≠amos tener una variable de ingresos</strong></span> y la tenemos dividida en 11: todas ellas es la misma variable solo que adopta un valor diferente. <span class="hl-green"><strong>¬øC√≥mo convertirla a tidy data?</strong></span></p>
</section>
<section id="ejemplo-relig_income-3" class="slide level2">
<h2>Ejemplo: relig_income</h2>
<p>La idea es <span class="hl-yellow"><strong>pivotar todas las columnas de ingresos</strong></span> para que acaben en una sola columna llamada <code>income</code>, y los valores (el n√∫mero de personas) en otra llamada <code>people</code> (por ejemplo). La tabla la haremos m√°s larga y menos ancha as√≠ que‚Ä¶</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1"></a>relig_tidy <span class="ot">&lt;-</span></span>
<span id="cb270-2"><a href="#cb270-2"></a>  relig_income <span class="sc">|&gt;</span></span>
<span id="cb270-3"><a href="#cb270-3"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">"&lt;$10k"</span><span class="sc">:</span><span class="st">"Don't know/refused"</span>, <span class="at">names_to =</span> <span class="st">"income"</span>,</span>
<span id="cb270-4"><a href="#cb270-4"></a>               <span class="at">values_to =</span> <span class="st">"people"</span>)</span>
<span id="cb270-5"><a href="#cb270-5"></a>relig_tidy </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 √ó 3
   religion income             people
   &lt;chr&gt;    &lt;chr&gt;               &lt;dbl&gt;
 1 Agnostic &lt;$10k                  27
 2 Agnostic $10-20k                34
 3 Agnostic $20-30k                60
 4 Agnostic $30-40k                81
 5 Agnostic $40-50k                76
 6 Agnostic $50-75k               137
 7 Agnostic $75-100k              122
 8 Agnostic $100-150k             109
 9 Agnostic &gt;150k                  84
10 Agnostic Don't know/refused     96
# ‚Ñπ 170 more rows</code></pre>
</div>
</div>
</div>
</section>
<section id="ejemplo-relig_income-4" class="slide level2">
<h2>Ejemplo: relig_income</h2>
<p>Vamos a hilar m√°s fino: ahora mismo en la variable <code>income</code> en realidad tenemos dos valores, el l√≠mite inferior y el superior de la renta. Vamos a <span class="hl-yellow"><strong>separar dicha variable e ingresos</strong></span> en dos, llamadas <code>income_inf</code> y <code>income_sup</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1"></a>relig_tidy </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 √ó 3
   religion income             people
   &lt;chr&gt;    &lt;chr&gt;               &lt;dbl&gt;
 1 Agnostic &lt;$10k                  27
 2 Agnostic $10-20k                34
 3 Agnostic $20-30k                60
 4 Agnostic $30-40k                81
 5 Agnostic $40-50k                76
 6 Agnostic $50-75k               137
 7 Agnostic $75-100k              122
 8 Agnostic $100-150k             109
 9 Agnostic &gt;150k                  84
10 Agnostic Don't know/refused     96
# ‚Ñπ 170 more rows</code></pre>
</div>
</div>
</section>
<section id="ejemplo-relig_income-5" class="slide level2">
<h2>Ejemplo: relig_income</h2>
<p>Vamos a hilar m√°s fino: ahora mismo en la variable <code>income</code> en realidad tenemos dos valores, el l√≠mite inferior y el superior de la renta. Vamos a <span class="hl-yellow"><strong>separar dicha variable e ingresos</strong></span> en dos, llamadas <code>income_inf</code> y <code>income_sup</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1"></a>relig_tidy <span class="sc">|&gt;</span></span>
<span id="cb274-2"><a href="#cb274-2"></a>  <span class="co"># Separamos por -</span></span>
<span id="cb274-3"><a href="#cb274-3"></a>  <span class="fu">separate</span>(income, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"income_inf"</span>, <span class="st">"income_sup"</span>), <span class="at">sep =</span> <span class="st">"-"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 √ó 4
   religion income_inf         income_sup people
   &lt;chr&gt;    &lt;chr&gt;              &lt;chr&gt;       &lt;dbl&gt;
 1 Agnostic &lt;$10k              &lt;NA&gt;           27
 2 Agnostic $10                20k            34
 3 Agnostic $20                30k            60
 4 Agnostic $30                40k            81
 5 Agnostic $40                50k            76
 6 Agnostic $50                75k           137
 7 Agnostic $75                100k          122
 8 Agnostic $100               150k          109
 9 Agnostic &gt;150k              &lt;NA&gt;           84
10 Agnostic Don't know/refused &lt;NA&gt;           96
# ‚Ñπ 170 more rows</code></pre>
</div>
</div>
<div class="fragment">
<p>¬øEst√° ya bien? F√≠jate bien‚Ä¶</p>
</div>
</section>
<section id="ejemplo-relig_income-6" class="slide level2">
<h2>Ejemplo: relig_income</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1"></a>relig_tidy <span class="sc">|&gt;</span></span>
<span id="cb276-2"><a href="#cb276-2"></a>  <span class="co"># Separamos por -</span></span>
<span id="cb276-3"><a href="#cb276-3"></a>  <span class="fu">separate</span>(income, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"income_inf"</span>, <span class="st">"income_sup"</span>), <span class="at">sep =</span> <span class="st">"-"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 √ó 4
   religion income_inf         income_sup people
   &lt;chr&gt;    &lt;chr&gt;              &lt;chr&gt;       &lt;dbl&gt;
 1 Agnostic &lt;$10k              &lt;NA&gt;           27
 2 Agnostic $10                20k            34
 3 Agnostic $20                30k            60
 4 Agnostic $30                40k            81
 5 Agnostic $40                50k            76
 6 Agnostic $50                75k           137
 7 Agnostic $75                100k          122
 8 Agnostic $100               150k          109
 9 Agnostic &gt;150k              &lt;NA&gt;           84
10 Agnostic Don't know/refused &lt;NA&gt;           96
# ‚Ñπ 170 more rows</code></pre>
</div>
</div>
<p>Si te fijas la primera columna el <code>"$10k"</code> deber√≠a ser una cota superior, no inferior. ¬øC√≥mo indicarle que separe bien ese caso?</p>
</section>
<section id="ejemplo-relig_income-7" class="slide level2">
<h2>Ejemplo: relig_income</h2>
<p>Le indicaremos que separe si encuentra <code>"-"</code> o <code>"&lt;"</code> (usamos <code>|</code> para separar ambas opciones)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1"></a>relig_tidy <span class="sc">|&gt;</span></span>
<span id="cb278-2"><a href="#cb278-2"></a>  <span class="co"># Separamos por -</span></span>
<span id="cb278-3"><a href="#cb278-3"></a>  <span class="fu">separate</span>(income, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"income_inf"</span>, <span class="st">"income_sup"</span>), <span class="at">sep =</span> <span class="st">"-|&lt;"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 √ó 4
   religion income_inf           income_sup people
   &lt;chr&gt;    &lt;chr&gt;                &lt;chr&gt;       &lt;dbl&gt;
 1 Agnostic ""                   $10k           27
 2 Agnostic "$10"                20k            34
 3 Agnostic "$20"                30k            60
 4 Agnostic "$30"                40k            81
 5 Agnostic "$40"                50k            76
 6 Agnostic "$50"                75k           137
 7 Agnostic "$75"                100k          122
 8 Agnostic "$100"               150k          109
 9 Agnostic "&gt;150k"              &lt;NA&gt;           84
10 Agnostic "Don't know/refused" &lt;NA&gt;           96
# ‚Ñπ 170 more rows</code></pre>
</div>
</div>
</section>
<section id="ejemplo-relig_income-8" class="slide level2">
<h2>Ejemplo: relig_income</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1"></a>relig_tidy <span class="ot">&lt;-</span></span>
<span id="cb280-2"><a href="#cb280-2"></a>  relig_tidy <span class="sc">|&gt;</span></span>
<span id="cb280-3"><a href="#cb280-3"></a>  <span class="co"># Separamos por -</span></span>
<span id="cb280-4"><a href="#cb280-4"></a>  <span class="fu">separate</span>(income, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"income_inf"</span>, <span class="st">"income_sup"</span>), <span class="at">sep =</span> <span class="st">"-|&lt;"</span>)</span>
<span id="cb280-5"><a href="#cb280-5"></a>relig_tidy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 √ó 4
   religion income_inf           income_sup people
   &lt;chr&gt;    &lt;chr&gt;                &lt;chr&gt;       &lt;dbl&gt;
 1 Agnostic ""                   $10k           27
 2 Agnostic "$10"                20k            34
 3 Agnostic "$20"                30k            60
 4 Agnostic "$30"                40k            81
 5 Agnostic "$40"                50k            76
 6 Agnostic "$50"                75k           137
 7 Agnostic "$75"                100k          122
 8 Agnostic "$100"               150k          109
 9 Agnostic "&gt;150k"              &lt;NA&gt;           84
10 Agnostic "Don't know/refused" &lt;NA&gt;           96
# ‚Ñπ 170 more rows</code></pre>
</div>
</div>
<p>Piensa ahora como podemos <span class="hl-yellow"><strong>convertir los l√≠mites de ingresos a num√©ricas (eliminando s√≠mbolos, letras, etc)</strong></span></p>
</section>
<section id="ejemplo-relig_income-9" class="slide level2">
<h2>Ejemplo: relig_income</h2>
<p>Para ello usaremos el paquete <code>{stringr}</code>, en concreto la funci√≥n <code>str_remove_all()</code>, a la que le podemos pasar los caracteres que queremos eliminar (f√≠jate que <code>$</code> al ser un caracter reservado en <code>R</code> hay que indic√°rselo con <code>\\$</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1"></a>relig_tidy<span class="sc">$</span>income_inf <span class="ot">&lt;-</span></span>
<span id="cb282-2"><a href="#cb282-2"></a>  <span class="fu">str_remove_all</span>(relig_tidy<span class="sc">$</span>income_inf, <span class="st">"</span><span class="sc">\\</span><span class="st">$|&gt;|k"</span>)</span>
<span id="cb282-3"><a href="#cb282-3"></a>relig_tidy<span class="sc">$</span>income_sup <span class="ot">&lt;-</span></span>
<span id="cb282-4"><a href="#cb282-4"></a>  <span class="fu">str_remove_all</span>(relig_tidy<span class="sc">$</span>income_sup, <span class="st">"</span><span class="sc">\\</span><span class="st">$|&gt;|k"</span>)</span>
<span id="cb282-5"><a href="#cb282-5"></a></span>
<span id="cb282-6"><a href="#cb282-6"></a>relig_tidy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 √ó 4
   religion income_inf          income_sup people
   &lt;chr&gt;    &lt;chr&gt;               &lt;chr&gt;       &lt;dbl&gt;
 1 Agnostic ""                  10             27
 2 Agnostic "10"                20             34
 3 Agnostic "20"                30             60
 4 Agnostic "30"                40             81
 5 Agnostic "40"                50             76
 6 Agnostic "50"                75            137
 7 Agnostic "75"                100           122
 8 Agnostic "100"               150           109
 9 Agnostic "150"               &lt;NA&gt;           84
10 Agnostic "Don't now/refused" &lt;NA&gt;           96
# ‚Ñπ 170 more rows</code></pre>
</div>
</div>
</section>
<section id="ejemplo-relig_income-10" class="slide level2">
<h2>Ejemplo: relig_income</h2>
<p>F√≠jate que tenemos <code>"Don't now/refused"</code>. ¬øQu√© deber√≠amos tener?</p>
<div class="fragment">
<p>Deber√≠a ser un <span class="hl-yellow"><strong>dato ausente</strong></span> as√≠ que usaremos <code>if_else()</code>: si contiene dicha frase, <code>NA</code>, en caso contrario su valor (consejo: <code>str_detect()</code> para detectar patrones en textos, y evitar tener que escribir toda la palabra sin errores)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1"></a>relig_tidy<span class="sc">$</span>income_inf <span class="ot">&lt;-</span></span>
<span id="cb284-2"><a href="#cb284-2"></a>  <span class="fu">if_else</span>(<span class="fu">str_detect</span>(relig_tidy<span class="sc">$</span>income_inf, <span class="st">"refused"</span>), <span class="cn">NA</span>, relig_tidy<span class="sc">$</span>income_inf)</span>
<span id="cb284-3"><a href="#cb284-3"></a>relig_tidy<span class="sc">$</span>income_sup <span class="ot">&lt;-</span></span>
<span id="cb284-4"><a href="#cb284-4"></a>  <span class="fu">if_else</span>(<span class="fu">str_detect</span>(relig_tidy<span class="sc">$</span>income_sup, <span class="st">"refused"</span>), <span class="cn">NA</span>, relig_tidy<span class="sc">$</span>income_sup)</span>
<span id="cb284-5"><a href="#cb284-5"></a>relig_tidy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 √ó 4
   religion income_inf income_sup people
   &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt;
 1 Agnostic ""         10             27
 2 Agnostic "10"       20             34
 3 Agnostic "20"       30             60
 4 Agnostic "30"       40             81
 5 Agnostic "40"       50             76
 6 Agnostic "50"       75            137
 7 Agnostic "75"       100           122
 8 Agnostic "100"      150           109
 9 Agnostic "150"      &lt;NA&gt;           84
10 Agnostic  &lt;NA&gt;      &lt;NA&gt;           96
# ‚Ñπ 170 more rows</code></pre>
</div>
</div>
</div>
</section>
<section id="ejemplo-relig_income-11" class="slide level2">
<h2>Ejemplo: relig_income</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1"></a>relig_tidy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 √ó 4
   religion income_inf income_sup people
   &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt;
 1 Agnostic ""         10             27
 2 Agnostic "10"       20             34
 3 Agnostic "20"       30             60
 4 Agnostic "30"       40             81
 5 Agnostic "40"       50             76
 6 Agnostic "50"       75            137
 7 Agnostic "75"       100           122
 8 Agnostic "100"      150           109
 9 Agnostic "150"      &lt;NA&gt;           84
10 Agnostic  &lt;NA&gt;      &lt;NA&gt;           96
# ‚Ñπ 170 more rows</code></pre>
</div>
</div>
<p>En la primera l√≠nea, ese <code>""</code> tambi√©n deber√≠a ser `NA``</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1"></a>relig_tidy<span class="sc">$</span>income_inf <span class="ot">&lt;-</span></span>
<span id="cb288-2"><a href="#cb288-2"></a>  <span class="fu">if_else</span>(relig_tidy<span class="sc">$</span>income_inf <span class="sc">==</span> <span class="st">""</span>, <span class="cn">NA</span>, relig_tidy<span class="sc">$</span>income_inf)</span>
<span id="cb288-3"><a href="#cb288-3"></a>relig_tidy<span class="sc">$</span>income_suop <span class="ot">&lt;-</span></span>
<span id="cb288-4"><a href="#cb288-4"></a>  <span class="fu">if_else</span>(relig_tidy<span class="sc">$</span>income_sup <span class="sc">==</span> <span class="st">""</span>, <span class="cn">NA</span>, relig_tidy<span class="sc">$</span>income_sup)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ejemplo-relig_income-12" class="slide level2">
<h2>Ejemplo: relig_income</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1"></a>relig_tidy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 √ó 5
   religion income_inf income_sup people income_suop
   &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;      
 1 Agnostic &lt;NA&gt;       10             27 10         
 2 Agnostic 10         20             34 20         
 3 Agnostic 20         30             60 30         
 4 Agnostic 30         40             81 40         
 5 Agnostic 40         50             76 50         
 6 Agnostic 50         75            137 75         
 7 Agnostic 75         100           122 100        
 8 Agnostic 100        150           109 150        
 9 Agnostic 150        &lt;NA&gt;           84 &lt;NA&gt;       
10 Agnostic &lt;NA&gt;       &lt;NA&gt;           96 &lt;NA&gt;       
# ‚Ñπ 170 more rows</code></pre>
</div>
</div>
<p>Adem√°s si te fijas los n√∫meros son en realidad caracteres, as√≠ que vamos a <span class="hl-yellow"><strong>convertirlos a n√∫meros</strong></span></p>
</section>
<section id="ejemplo-relig_income-13" class="slide level2">
<h2>Ejemplo: relig_income</h2>
<p>Adem√°s si te fijas los n√∫meros son en realidad caracteres, as√≠ que vamos a <span class="hl-yellow"><strong>convertirlos a n√∫meros</strong></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1"></a>relig_tidy<span class="sc">$</span>income_inf <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(relig_tidy<span class="sc">$</span>income_inf)</span>
<span id="cb291-2"><a href="#cb291-2"></a>relig_tidy<span class="sc">$</span>income_sup <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(relig_tidy<span class="sc">$</span>income_sup)</span>
<span id="cb291-3"><a href="#cb291-3"></a>relig_tidy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 √ó 5
   religion income_inf income_sup people income_suop
   &lt;chr&gt;         &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;      
 1 Agnostic         NA         10     27 10         
 2 Agnostic         10         20     34 20         
 3 Agnostic         20         30     60 30         
 4 Agnostic         30         40     81 40         
 5 Agnostic         40         50     76 50         
 6 Agnostic         50         75    137 75         
 7 Agnostic         75        100    122 100        
 8 Agnostic        100        150    109 150        
 9 Agnostic        150         NA     84 &lt;NA&gt;       
10 Agnostic         NA         NA     96 &lt;NA&gt;       
# ‚Ñπ 170 more rows</code></pre>
</div>
</div>
</section>
<section id="ejemplo-relig_income-14" class="slide level2">
<h2>Ejemplo: relig_income</h2>
<p>¬øSe te ocurre alguna forma de <strong>¬´cuantificar num√©ricamente¬ª</strong> los valores ausentes que tenemos en este caso?</p>
<div class="fragment">
<p>Si te fijas en realidad cuando hay ausente en el l√≠mite inferior en realidad podr√≠amos poner un 0 (nadie puede ganar menos de eso) y cuando lo tenemos en el l√≠mite superior ser√≠a <code>Inf</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1"></a>relig_tidy<span class="sc">$</span>income_inf <span class="ot">&lt;-</span></span>
<span id="cb293-2"><a href="#cb293-2"></a>  <span class="fu">if_else</span>(<span class="fu">is.na</span>(relig_tidy<span class="sc">$</span>income_inf), <span class="dv">0</span>, relig_tidy<span class="sc">$</span>income_inf)</span>
<span id="cb293-3"><a href="#cb293-3"></a>relig_tidy<span class="sc">$</span>income_sup <span class="ot">&lt;-</span></span>
<span id="cb293-4"><a href="#cb293-4"></a>  <span class="fu">if_else</span>(<span class="fu">is.na</span>(relig_tidy<span class="sc">$</span>income_sup), <span class="cn">Inf</span>, relig_tidy<span class="sc">$</span>income_sup)</span>
<span id="cb293-5"><a href="#cb293-5"></a>relig_tidy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 √ó 5
   religion income_inf income_sup people income_suop
   &lt;chr&gt;         &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;      
 1 Agnostic          0         10     27 10         
 2 Agnostic         10         20     34 20         
 3 Agnostic         20         30     60 30         
 4 Agnostic         30         40     81 40         
 5 Agnostic         40         50     76 50         
 6 Agnostic         50         75    137 75         
 7 Agnostic         75        100    122 100        
 8 Agnostic        100        150    109 150        
 9 Agnostic        150        Inf     84 &lt;NA&gt;       
10 Agnostic          0        Inf     96 &lt;NA&gt;       
# ‚Ñπ 170 more rows</code></pre>
</div>
</div>
</div>
</section>
<section id="ejemplo-relig_income-15" class="slide level2">
<h2>Ejemplo: relig_income</h2>
<p>Aunque nos haya llevado un rato este es el <strong>c√≥digo completo resumido</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1"></a>relig_tidy <span class="ot">&lt;-</span></span>
<span id="cb295-2"><a href="#cb295-2"></a>  relig_income <span class="sc">|&gt;</span></span>
<span id="cb295-3"><a href="#cb295-3"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">"&lt;$10k"</span><span class="sc">:</span><span class="st">"Don't know/refused"</span>, <span class="at">names_to =</span> <span class="st">"income"</span>,</span>
<span id="cb295-4"><a href="#cb295-4"></a>               <span class="at">values_to =</span> <span class="st">"people"</span>) <span class="sc">|&gt;</span></span>
<span id="cb295-5"><a href="#cb295-5"></a>  <span class="fu">separate</span>(income, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"income_inf"</span>, <span class="st">"income_sup"</span>), <span class="at">sep =</span> <span class="st">"-|&lt;"</span>)</span>
<span id="cb295-6"><a href="#cb295-6"></a></span>
<span id="cb295-7"><a href="#cb295-7"></a>relig_tidy<span class="sc">$</span>income_inf <span class="ot">&lt;-</span> <span class="fu">str_remove_all</span>(relig_tidy<span class="sc">$</span>income_inf, <span class="st">"</span><span class="sc">\\</span><span class="st">$|&gt;|k"</span>)</span>
<span id="cb295-8"><a href="#cb295-8"></a>relig_tidy<span class="sc">$</span>income_sup <span class="ot">&lt;-</span> <span class="fu">str_remove_all</span>(relig_tidy<span class="sc">$</span>income_sup, <span class="st">"</span><span class="sc">\\</span><span class="st">$|&gt;|k"</span>)</span>
<span id="cb295-9"><a href="#cb295-9"></a></span>
<span id="cb295-10"><a href="#cb295-10"></a>relig_tidy<span class="sc">$</span>income_inf <span class="ot">&lt;-</span></span>
<span id="cb295-11"><a href="#cb295-11"></a>  <span class="fu">if_else</span>(<span class="fu">str_detect</span>(relig_tidy<span class="sc">$</span>income_inf, <span class="st">"refused"</span>) <span class="sc">|</span></span>
<span id="cb295-12"><a href="#cb295-12"></a>            relig_tidy<span class="sc">$</span>income_inf <span class="sc">==</span> <span class="st">""</span>, <span class="dv">0</span>, <span class="fu">as.numeric</span>(relig_tidy<span class="sc">$</span>income_inf))</span>
<span id="cb295-13"><a href="#cb295-13"></a>relig_tidy<span class="sc">$</span>income_sup <span class="ot">&lt;-</span></span>
<span id="cb295-14"><a href="#cb295-14"></a>  <span class="fu">if_else</span>(<span class="fu">str_detect</span>(relig_tidy<span class="sc">$</span>income_sup, <span class="st">"refused"</span>) <span class="sc">|</span></span>
<span id="cb295-15"><a href="#cb295-15"></a>            relig_tidy<span class="sc">$</span>income_sup <span class="sc">==</span> <span class="st">""</span>, <span class="cn">Inf</span>, <span class="fu">as.numeric</span>(relig_tidy<span class="sc">$</span>income_sup))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ejemplo-relig_income-16" class="slide level2">
<h2>Ejemplo: relig_income</h2>
<p>¬øPor qu√© era <span class="hl-yellow"><strong>importante tenerlo en tidydata</strong></span>? Lo veremos m√°s adelante al visualizar los datos pero esto ya nos permite realizar filtros muy r√°pidos con muy poco c√≥digo.</p>
<p>Por ejemplo: ¬øcu√°ntas personas agn√≥sticas con ingresos superiores (o iguales) a 30 tenemos?</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb296"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1"></a><span class="co"># una l√≠nea de c√≥digo</span></span>
<span id="cb296-2"><a href="#cb296-2"></a><span class="fu">sum</span>(relig_tidy<span class="sc">$</span>people[relig_tidy<span class="sc">$</span>religion <span class="sc">==</span> <span class="st">"Agnostic"</span> <span class="sc">&amp;</span> relig_tidy<span class="sc">$</span>income_inf <span class="sc">&gt;=</span> <span class="dv">30</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 609</code></pre>
</div>
</div>
</div>
</section>
<section id="tu-turno-1-5" class="slide level2">
<h2>üíª Tu turno</h2>
<p><span style="color:#444442;"><strong>Intenta realizar los siguientes ejercicios sin mirar las soluciones</strong></span></p>
<div class="panel-tabset">
<ul id="tabset-6" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-6-1"><span class="hl-yellow"><strong>Ejercicio 1</strong></span></a></li><li><a href="#tabset-6-2"><span class="hl-yellow"><strong>Ejercicio 2</strong></span></a></li><li><a href="#tabset-6-3"><span class="hl-yellow"><strong>Ejercicio 3</strong></span></a></li><li><a href="#tabset-6-4"><span class="hl-yellow"><strong>Ejercicio 4</strong></span></a></li><li><a href="#tabset-6-5"><span class="hl-yellow"><strong>Ejercicio 5</strong></span></a></li></ul>
<div class="tab-content">
<div id="tabset-6-1">
<p>üìù Usa el dataset original <code>relig_income</code> y trata de responder a la √∫ltima pregunta: ¬øcu√°ntas personas agn√≥sticas con ingresos superiores (o iguales) a 30 tenemos? Compara el c√≥digo a realizar cuando tenemos tidydata a cuando no. ¬øCu√°l es m√°s legible si no supieses <code>R</code>? ¬øCu√°l tiene mayor probabilidad de error?</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb298"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1"></a><span class="fu">sum</span>(relig_income[relig_income<span class="sc">$</span>religion <span class="sc">==</span> <span class="st">"Agnostic"</span>,</span>
<span id="cb298-2"><a href="#cb298-2"></a>             <span class="fu">c</span>(<span class="st">"$30-40k"</span>, <span class="st">"$40-50k"</span>, <span class="st">"$50-75k"</span>, <span class="st">"$75-100k"</span>, <span class="st">"$100-150k"</span>, <span class="st">"&gt;150k"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-6-2">
<p>üìù Usando <code>relig_tidy</code> determina qui√©n tiene m√°s ingresos medios, ¬øcat√≥licos (<code>Catholic</code>) o agn√≥sticos (<code>Agnostic</code>)? Crea antes una variable <code>avg_income</code> (ingresos medios por intervalo): si hay 5 personas entre 20 y 30, y 3 personas entre 30 y 50, la media ser√≠a <span class="math inline">\((25*5 + 40*3)/8\)</span> (si es <code>Inf</code> por arriba, <code>NA</code>)</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb299"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1"></a>relig_tidy<span class="sc">$</span>avg_income <span class="ot">&lt;-</span> </span>
<span id="cb299-2"><a href="#cb299-2"></a>  <span class="fu">if_else</span>(<span class="fu">is.infinite</span>(relig_tidy<span class="sc">$</span>income_sup), <span class="cn">NA</span>, (relig_tidy<span class="sc">$</span>income_sup <span class="sc">+</span> relig_tidy<span class="sc">$</span>income_inf)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb299-3"><a href="#cb299-3"></a></span>
<span id="cb299-4"><a href="#cb299-4"></a><span class="co"># Agnosticos vs catolicos</span></span>
<span id="cb299-5"><a href="#cb299-5"></a><span class="fu">sum</span>((relig_tidy<span class="sc">$</span>avg_income[relig_tidy<span class="sc">$</span>religion <span class="sc">==</span> <span class="st">"Agnostic"</span>] <span class="sc">*</span> relig_tidy<span class="sc">$</span>people[relig_tidy<span class="sc">$</span>religion <span class="sc">==</span> <span class="st">"Agnostic"</span>]), <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span></span>
<span id="cb299-6"><a href="#cb299-6"></a>  <span class="fu">sum</span>(relig_tidy<span class="sc">$</span>people[relig_tidy<span class="sc">$</span>religion <span class="sc">==</span> <span class="st">"Agnostic"</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb299-7"><a href="#cb299-7"></a></span>
<span id="cb299-8"><a href="#cb299-8"></a><span class="fu">sum</span>((relig_tidy<span class="sc">$</span>avg_income[relig_tidy<span class="sc">$</span>religion <span class="sc">==</span> <span class="st">"Catholic"</span>] <span class="sc">*</span> relig_tidy<span class="sc">$</span>people[relig_tidy<span class="sc">$</span>religion <span class="sc">==</span> <span class="st">"Catholic"</span>]), <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span></span>
<span id="cb299-9"><a href="#cb299-9"></a>  <span class="fu">sum</span>(relig_tidy<span class="sc">$</span>people[relig_tidy<span class="sc">$</span>religion <span class="sc">==</span> <span class="st">"Catholic"</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-6-3">
<p>üìù Si debemos elegir budismo (<code>Buddhist</code>) e hinduismo (<code>Hindu</code>), ¬øcu√°l de las dos es la religi√≥n mayoritaria entre los que ganan m√°s de 50 000$ anuales?</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1"></a>greatest_income <span class="ot">&lt;-</span></span>
<span id="cb300-2"><a href="#cb300-2"></a>  relig_tidy[relig_tidy<span class="sc">$</span>income_inf <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;</span> relig_tidy<span class="sc">$</span>religion <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Buddhist"</span>, <span class="st">"Hindu"</span>), ]</span>
<span id="cb300-3"><a href="#cb300-3"></a></span>
<span id="cb300-4"><a href="#cb300-4"></a><span class="fu">sum</span>(greatest_income<span class="sc">$</span>people[greatest_income<span class="sc">$</span>religion <span class="sc">==</span> <span class="st">"Buddhist"</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb300-5"><a href="#cb300-5"></a><span class="fu">sum</span>(greatest_income<span class="sc">$</span>people[greatest_income<span class="sc">$</span>religion <span class="sc">==</span> <span class="st">"Hindu"</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-6-4">
<p>üìù Echa un vistazo a la tabla <code>table4b</code> del paquete <code>{tidyr}</code>. ¬øEs tidydata? En caso negativo, ¬øqu√© falla? ¬øC√≥mo convertirla a tidy data en caso de que no lo sea ya?</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb301"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1"></a>table4b <span class="sc">|&gt;</span></span>
<span id="cb301-2"><a href="#cb301-2"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">"1999"</span><span class="sc">:</span><span class="st">"2000"</span>, <span class="at">names_to =</span> <span class="st">"year"</span>,</span>
<span id="cb301-3"><a href="#cb301-3"></a>               <span class="at">values_to =</span> <span class="st">"cases"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-6-5">
<p>üìù Echa un vistazo a la tabla <code>billboard</code> del paquete <code>{tidyr}</code>. ¬øEs tidydata? En caso negativo, ¬øqu√© falla? ¬øC√≥mo convertirla a tidy data en caso de que no lo sea ya?</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1"></a>billboard <span class="sc">|&gt;</span></span>
<span id="cb302-2"><a href="#cb302-2"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">"wk1"</span><span class="sc">:</span><span class="st">"wk76"</span>,</span>
<span id="cb302-3"><a href="#cb302-3"></a>               <span class="at">names_to =</span> <span class="st">"week"</span>,</span>
<span id="cb302-4"><a href="#cb302-4"></a>               <span class="at">names_prefix =</span> <span class="st">"wk"</span>,</span>
<span id="cb302-5"><a href="#cb302-5"></a>               <span class="at">values_to =</span> <span class="st">"position"</span>,</span>
<span id="cb302-6"><a href="#cb302-6"></a>               <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="caso-practico-1-3" class="slide level2">
<h2>üê£ Caso pr√°ctico III</h2>
<p>En el paquete <code>{tidyr}</code> contamos con el dataset <code>who2</code> (dataset de la Organizaci√≥n Mundial de la Salud). Intenta responder a las preguntas planteadas en el <a href="https://javieralvarezliebana.quarto.pub/repaso-r-ts/"><strong>workbook</strong></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb303"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1"></a>who2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7,240 √ó 58
   country      year sp_m_014 sp_m_1524 sp_m_2534 sp_m_3544 sp_m_4554 sp_m_5564
   &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 Afghanistan  1980       NA        NA        NA        NA        NA        NA
 2 Afghanistan  1981       NA        NA        NA        NA        NA        NA
 3 Afghanistan  1982       NA        NA        NA        NA        NA        NA
 4 Afghanistan  1983       NA        NA        NA        NA        NA        NA
 5 Afghanistan  1984       NA        NA        NA        NA        NA        NA
 6 Afghanistan  1985       NA        NA        NA        NA        NA        NA
 7 Afghanistan  1986       NA        NA        NA        NA        NA        NA
 8 Afghanistan  1987       NA        NA        NA        NA        NA        NA
 9 Afghanistan  1988       NA        NA        NA        NA        NA        NA
10 Afghanistan  1989       NA        NA        NA        NA        NA        NA
# ‚Ñπ 7,230 more rows
# ‚Ñπ 50 more variables: sp_m_65 &lt;dbl&gt;, sp_f_014 &lt;dbl&gt;, sp_f_1524 &lt;dbl&gt;,
#   sp_f_2534 &lt;dbl&gt;, sp_f_3544 &lt;dbl&gt;, sp_f_4554 &lt;dbl&gt;, sp_f_5564 &lt;dbl&gt;,
#   sp_f_65 &lt;dbl&gt;, sn_m_014 &lt;dbl&gt;, sn_m_1524 &lt;dbl&gt;, sn_m_2534 &lt;dbl&gt;,
#   sn_m_3544 &lt;dbl&gt;, sn_m_4554 &lt;dbl&gt;, sn_m_5564 &lt;dbl&gt;, sn_m_65 &lt;dbl&gt;,
#   sn_f_014 &lt;dbl&gt;, sn_f_1524 &lt;dbl&gt;, sn_f_2534 &lt;dbl&gt;, sn_f_3544 &lt;dbl&gt;,
#   sn_f_4554 &lt;dbl&gt;, sn_f_5564 &lt;dbl&gt;, sn_f_65 &lt;dbl&gt;, ep_m_014 &lt;dbl&gt;, ‚Ä¶</code></pre>
</div>
</div>
</section></section>
<section>
<section id="clase-3" class="title-slide slide level1 center">
<h1>Clase 3: <span class="flow">introducci√≥n a series</span></h1>
<p><span style="color:#444442;"><strong>Introducci√≥n al an√°lisis descriptivo de series temporales</strong></span></p>
<ul>
<li><a href="#/planificacion">üìÜ Planificaci√≥n</a></li>
</ul>
</section>
<section id="qu√©-es-una-serie-temporal-12" class="slide level2">
<h2>¬øQu√© es una serie temporal?</h2>
<p>Como ya hemos visto, una <span class="hl-yellow"><strong>serie temporal</strong></span> se puede definir de manera informal como una <span class="hl-yellow"><strong>muestra de una variable</strong></span> (usualmente continua) recogida de manera <span class="hl-purple"><strong>secuencial en el tiempo</strong></span></p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb305"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1"></a><span class="fu">ggplot</span>(retiro) <span class="sc">+</span></span>
<span id="cb305-2"><a href="#cb305-2"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fecha, <span class="at">y =</span> tmed), <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb305-3"><a href="#cb305-3"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb305-4"><a href="#cb305-4"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Temperatura media como SERIE TEMPORAL"</span>,</span>
<span id="cb305-5"><a href="#cb305-5"></a>       <span class="at">x =</span> <span class="st">"t (fecha)"</span>, <span class="at">y =</span> <span class="st">"¬∫C (media)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-183-1.png" width="960" class="r-stretch"></section>
<section id="un-poco-de-historia" class="slide level2">
<h2>Un poco de historia</h2>
<p>Las <span class="hl-yellow"><strong>primeras series temporales</strong></span> aparecieron en el siglo XIX, cuando el matem√°tico <strong>Laplace</strong> (matem√°tico, profesor de Napole√≥n y luego ministro) se dedicaba a estudiar la <span class="hl-yellow"><strong>relaci√≥n entre las fases de La Luna y la presi√≥n</strong></span> atmosf√©rica (por el nivel del mar).</p>
<div class="fragment">
<p>Aunque su primera aproximaci√≥n fue un poco chapuza (intent√≥ ajustar una funci√≥n seno sin tener en cuenta el tiempo), <span class="hl-yellow"><strong>Arthur Schuster decidi√≥ aplicar los trabajos de Fourier para que dichas sinusoidales dependiesen del tiempo</strong></span> (Fourier hab√≠a demostrado que toda funci√≥n peri√≥dica pod√≠a descomponerse como suma de senos y cosenos).</p>
</div>
</section>
<section id="un-poco-de-historia-1" class="slide level2">
<h2>Un poco de historia</h2>
<p>Treinta a√±os m√°s tarde, <span class="hl-yellow"><strong>Yule y Slutsky aplicaron las ideas de la regresi√≥n</strong></span> desarrollados por Galton y Pearson al estudio de procesos cuya variable regresora es ella misma en otro instante temporal (<strong>procesos autoregresivos</strong>), aunque no fue hasta la llegada de <strong>Kolmogorov</strong> cuando se formaliz√≥ su definici√≥n matem√°tica en el contexto de los <span class="hl-yellow"><strong>procesos estoc√°sticos</strong></span>.</p>
<div class="fragment">
<p>Tras acabar la Segunda Guerra Mundial quedaron desclasificados algunos trabajos de Wiener, Kolmogorov, Bartlett y Tukey sobre la predicci√≥n de series temporales, as√≠ como su estudio en funci√≥n del an√°lisis de las <span class="hl-yellow"><strong>correlaciones</strong></span>. Tras los trabajos de alisado de Holt y Winter en los a√±os 60, en 1970 <span class="hl-yellow"><strong>Box y Jenkins publican ¬´La Biblia¬ª de las series temporales</strong></span>, un manual donde se presenta una metodolog√≠a para la identificaci√≥n, estimaci√≥n y predicci√≥n de series temporales (los conocidos como <strong>procesos SARIMA</strong>)</p>
</div>
</section>
<section id="m√©todos-de-an√°lisis" class="slide level2">
<h2>M√©todos de an√°lisis</h2>
<ul>
<li><p><span class="hl-yellow"><strong>M√©todos descriptivos o cl√°sicos</strong></span>: desarrollados entre 1940 y 1970, est√°n enfocadas principalmente en la <span class="hl-yellow"><strong>estimaci√≥n de los valores de la serie</strong></span>, siendo bastante <span class="hl-red"><strong>malos en la predicci√≥n futura</strong></span>.</p>
<ul>
<li><span class="hl-purple"><strong>M√©todos de decomposici√≥n</strong></span> (tendencia-estacionalidad-error):
<ul>
<li>Suavizado cl√°sico</li>
<li>STL (seasonal-trend decomposition procedure based on loess)</li>
</ul></li>
<li><span class="hl-purple"><strong>M√©todos de alisado</strong></span> (dependencia del pasado disminuye con el tiempo):
<ul>
<li>Alisado exponencial simple</li>
<li>Alisado doble de Holt y triple de Holt-Winters . . .</li>
</ul></li>
</ul></li>
<li><p><span class="hl-yellow"><strong>M√©todos probabil√≠sticos</strong></span>: enmarcados dentro del an√°lisis de los procesos estoc√°sticos, se considera que la serie temporal observada es solo una muestra de un proceso estoc√°stico. Necesitaremos <strong>hip√≥tesis</strong>.</p></li>
</ul>
</section>
<section id="m√©todos-descriptivos" class="slide level2">
<h2>M√©todos descriptivos</h2>
<p>Los <span class="hl-yellow"><strong>m√©todos descriptivos o cl√°sicos</strong></span> se basan en entender, de manera casi emp√≠rica, el comportamiento de la serie, pareci√©ndose m√°s una interpolaci√≥n que a una metodolog√≠a rigurosa de estimaci√≥n y predicci√≥n.</p>
<p>&nbsp;</p>
<p>Vamos a empezar denotando a la serie como <span class="math inline">\(X = \left\lbrace X_t \right\rbrace_{t}\)</span>, de la cual observamos una <strong>muestra</strong> <span class="math inline">\(\left(x_0, \ldots, x_{T} \right)\)</span>.</p>
<div class="fragment">
<p>¬øCu√°l se te ocurre que ser√≠a el <span class="hl-yellow"><strong>caso m√°s sencillo de serie temporal</strong></span>?</p>
</div>
</section>
<section id="descomposici√≥n-cl√°sica-sin-tendencia" class="slide level2">
<h2>Descomposici√≥n cl√°sica: sin tendencia</h2>
<p>El caso m√°s sencillo es considerar que la serie es <span class="hl-yellow"><strong>completamente aleatoria</strong></span>, es decir <span class="math inline">\(X_t = \varepsilon_t\)</span>.</p>
<div class="fragment">
<p>Al t√©rmino <span class="math inline">\(\left\lbrace \varepsilon_t \right\rbrace_{t \in T}\)</span> le llamaremos <span class="hl-purple"><strong>error o innovaci√≥n</strong></span> y, dado que se supone que no captura ning√∫n patr√≥n y que la serie debe <span class="hl-yellow"><strong>ser finita</strong></span>, tendr√≠amos</p>
<p><span class="math display">\[X_t = \varepsilon_t, \quad {\rm E} \left[X_t \right] = {\rm E} \left[\varepsilon_t \right] = 0, \quad  {\rm Var} \left[\varepsilon_t \right] = \sigma_{\varepsilon}^{2} = cte &lt; \infty\]</span> donde normalmente el error sigue una distribuci√≥n normal de varianza finita.</p>
</div>
<div class="fragment">
<p>Adem√°s dicho t√©rmino de error cumplir√° que el <span class="hl-yellow"><strong>pasado no proporciona ning√∫n tipo de informaci√≥n sobre el futuro</strong></span>, es decir,</p>
<p><span class="math display">\[\varepsilon_{t+1} | \left(\varepsilon_t, \varepsilon_{t-1}, \ldots, \varepsilon_0 \right)  \sim \varepsilon_{t+1} \sim N \left(0, \sigma_{\varepsilon}^{2} \right)\]</span></p>
</div>
</section>
<section id="sin-tendencia" class="slide level2">
<h2>Sin tendencia</h2>
<p>üíª ¬øC√≥mo podr√≠amos simular dicha serie temporal?</p>
<div class="fragment">
<ol type="1">
<li><strong>Paso 1</strong>: construye un tibble de 5 columnas, donde la primera columna contenga los valores <span class="math inline">\(t=1, 2, \ldots, 1000\)</span>; y donde la segunda columna contenga valores simulados seg√∫n una normal <span class="math inline">\(N(0, \sigma = 0.5)\)</span>, la tercera con <span class="math inline">\(\sigma = 1\)</span>, la cuarta con <span class="math inline">\(\sigma = 2\)</span> y la quinta con <span class="math inline">\(\sigma = 4\)</span>.</li>
</ol>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb306"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb306-2"><a href="#cb306-2"></a>datos <span class="ot">&lt;-</span></span>
<span id="cb306-3"><a href="#cb306-3"></a>  <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb306-4"><a href="#cb306-4"></a>         <span class="st">"sd_05"</span> <span class="ot">=</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.5</span>), <span class="st">"sd_1"</span> <span class="ot">=</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb306-5"><a href="#cb306-5"></a>         <span class="st">"sd_2"</span> <span class="ot">=</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">2</span>), <span class="st">"sd_4"</span> <span class="ot">=</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
<section id="sin-tendencia-1" class="slide level2">
<h2>Sin tendencia</h2>
<ol start="2" type="1">
<li><strong>Paso 2</strong>: haz un gr√°fico (¬øcu√°l har√≠as?) solo considerando <span class="math inline">\(t\)</span> y la primera serie <code>sd_05</code></li>
</ol>
<div class="fragment">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb307"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1"></a><span class="fu">ggplot</span>(datos) <span class="sc">+</span></span>
<span id="cb307-2"><a href="#cb307-2"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> sd_05)) <span class="sc">+</span></span>
<span id="cb307-3"><a href="#cb307-3"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb307-4"><a href="#cb307-4"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"t"</span>, <span class="at">y =</span> <span class="st">"X_t"</span>,</span>
<span id="cb307-5"><a href="#cb307-5"></a>       <span class="at">title =</span> <span class="st">"Serie temporal X_t = eps_t con sd = 0.5"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-185-1.png" width="960"></p>
</div>
</div>
</div>
</section>
<section id="sin-tendencia-2" class="slide level2">
<h2>Sin tendencia</h2>
<ol start="3" type="1">
<li><strong>Paso 3</strong>: ¬øc√≥mo deber√≠amos de transformar los datos para poder pintar todas las series a la vez? Hazte un borrador de c√≥mo ser√≠a el c√≥digo de ggplot para dibujarlo.</li>
</ol>
<div class="fragment">
<p>La idea es que si tenemos <span class="math inline">\(p\)</span> series, en lugar de tener <span class="math inline">\(p\)</span> variables distintas, tengamos una serie ¬´debajo de¬ª otra. Por ejemplo, vamos a definir la primera y pongamos debajo al segunda otra.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb308"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb308-2"><a href="#cb308-2"></a>datos <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="st">"X_t"</span> <span class="ot">=</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.5</span>), <span class="st">"sd"</span> <span class="ot">=</span> <span class="st">"sd_0.5"</span>)</span>
<span id="cb308-3"><a href="#cb308-3"></a>datos_tidy <span class="ot">&lt;-</span> </span>
<span id="cb308-4"><a href="#cb308-4"></a>  <span class="fu">rbind</span>(datos, <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="st">"X_t"</span> <span class="ot">=</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>), <span class="st">"sd"</span> <span class="ot">=</span> <span class="st">"sd_1"</span>))</span>
<span id="cb308-5"><a href="#cb308-5"></a>datos_tidy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,000 √ó 3
       t    X_t sd    
   &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt; 
 1     1  0.300 sd_0.5
 2     2  0.263 sd_0.5
 3     3  0.829 sd_0.5
 4     4 -0.597 sd_0.5
 5     5 -0.311 sd_0.5
 6     6  0.133 sd_0.5
 7     7  0.337 sd_0.5
 8     8 -0.878 sd_0.5
 9     9 -0.335 sd_0.5
10    10  0.946 sd_0.5
# ‚Ñπ 1,990 more rows</code></pre>
</div>
</div>
</div>
</section>
<section id="sin-tendencia-3" class="slide level2">
<h2>Sin tendencia</h2>
<p>El resto las iremos concatenando de la misma manera, a√±adiendo filas al <code>datos_tidy</code> que ya tenemos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb310"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1"></a>datos_tidy <span class="ot">&lt;-</span> </span>
<span id="cb310-2"><a href="#cb310-2"></a>  <span class="fu">rbind</span>(datos_tidy, <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="st">"X_t"</span> <span class="ot">=</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">2</span>), <span class="st">"sd"</span> <span class="ot">=</span> <span class="st">"sd_2"</span>))</span>
<span id="cb310-3"><a href="#cb310-3"></a></span>
<span id="cb310-4"><a href="#cb310-4"></a>datos_tidy <span class="ot">&lt;-</span> </span>
<span id="cb310-5"><a href="#cb310-5"></a>  <span class="fu">rbind</span>(datos_tidy, <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="st">"X_t"</span> <span class="ot">=</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">4</span>), <span class="st">"sd"</span> <span class="ot">=</span> <span class="st">"sd_4"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>Lo anterior se pueda hacer m√°s ‚Äúconciso‚Äù con <code>{tidyverse}</code> haciendo uso de <code>pivot_longer()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb311"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb311-1"><a href="#cb311-1"></a>datos_tidy <span class="ot">&lt;-</span></span>
<span id="cb311-2"><a href="#cb311-2"></a>  datos <span class="sc">|&gt;</span></span>
<span id="cb311-3"><a href="#cb311-3"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">"sd_05"</span><span class="sc">:</span><span class="st">"sd_4"</span>, <span class="at">names_to =</span> <span class="st">"sd"</span>, <span class="at">values_to =</span> <span class="st">"X_t"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="sin-tendencia-4" class="slide level2">
<h2>Sin tendencia</h2>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1"></a><span class="fu">ggplot</span>(datos_tidy) <span class="sc">+</span></span>
<span id="cb312-2"><a href="#cb312-2"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t, <span class="at">color =</span> sd),</span>
<span id="cb312-3"><a href="#cb312-3"></a>            <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb312-4"><a href="#cb312-4"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_colorblind</span>() <span class="sc">+</span></span>
<span id="cb312-5"><a href="#cb312-5"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>sd) <span class="sc">+</span></span>
<span id="cb312-6"><a href="#cb312-6"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb312-7"><a href="#cb312-7"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"t"</span>, <span class="at">y =</span> <span class="st">"X_t"</span>, <span class="at">color =</span> <span class="st">"Desv. t√≠pica"</span>,</span>
<span id="cb312-8"><a href="#cb312-8"></a>       <span class="at">title =</span> <span class="st">"Serie temporal X_t = eps_t con distintas varianzas"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-189-1.png" width="960" class="r-stretch"></section>
<section id="sin-tendencia-5" class="slide level2">
<h2>Sin tendencia</h2>
<ol start="4" type="1">
<li><strong>Paso 4</strong>. Para automatizarlo, dise√±a una <strong>funci√≥n</strong> tal que le introduzcas como argumento un tama√±o muestral <span class="math inline">\(n\)</span>, un <span class="math inline">\(t\)</span> y un vector de desviaciones t√≠picas, y devuelva en formato tidy data los valores de las series temporales (tantas series como longitud tenga el vector de desviaciones)</li>
</ol>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb313"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1"></a>time_series_error <span class="ot">&lt;-</span> <span class="cf">function</span>(n, <span class="at">t =</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="at">sd_vec =</span> <span class="dv">1</span>) {</span>
<span id="cb313-2"><a href="#cb313-2"></a>  </span>
<span id="cb313-3"><a href="#cb313-3"></a>  datos_tidy <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb313-4"><a href="#cb313-4"></a>  </span>
<span id="cb313-5"><a href="#cb313-5"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sd_vec)) {</span>
<span id="cb313-6"><a href="#cb313-6"></a>    </span>
<span id="cb313-7"><a href="#cb313-7"></a>    datos_tidy <span class="ot">&lt;-</span> </span>
<span id="cb313-8"><a href="#cb313-8"></a>      datos_tidy <span class="sc">|&gt;</span></span>
<span id="cb313-9"><a href="#cb313-9"></a>      <span class="fu">rbind</span>(datos_tidy,</span>
<span id="cb313-10"><a href="#cb313-10"></a>            <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> t, <span class="st">"sd"</span> <span class="ot">=</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"sd_{sd_vec[i]}"</span>),</span>
<span id="cb313-11"><a href="#cb313-11"></a>                   <span class="st">"X_t"</span> <span class="ot">=</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sd_vec[i])))</span>
<span id="cb313-12"><a href="#cb313-12"></a>  }</span>
<span id="cb313-13"><a href="#cb313-13"></a>  <span class="fu">return</span>(datos_tidy)</span>
<span id="cb313-14"><a href="#cb313-14"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="sin-tendencia-6" class="slide level2">
<h2>Sin tendencia</h2>
<p>Esta serie temporal <span class="math inline">\(X_t = \varepsilon_t\)</span> es la m√°s sencilla que podemos imaginar y <span class="hl-red"><strong>no podemos predecirla</strong></span> ya que no hay ning√∫n tipo de patr√≥n determin√≠stico que podamos capturar.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb314"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">time_series_error</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">sd =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>))</span>
<span id="cb314-2"><a href="#cb314-2"></a><span class="fu">ggplot</span>(datos) <span class="sc">+</span></span>
<span id="cb314-3"><a href="#cb314-3"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t, <span class="at">color =</span> sd), <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb314-4"><a href="#cb314-4"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_colorblind</span>() <span class="sc">+</span></span>
<span id="cb314-5"><a href="#cb314-5"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>sd) <span class="sc">+</span></span>
<span id="cb314-6"><a href="#cb314-6"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb314-7"><a href="#cb314-7"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"t"</span>, <span class="at">y =</span> <span class="st">"X_t"</span>, <span class="at">color =</span> <span class="st">"Desv. t√≠pica"</span>,</span>
<span id="cb314-8"><a href="#cb314-8"></a>       <span class="at">title =</span> <span class="st">"Serie temporal X_t = eps_t con distintas varianzas"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-191-1.png" width="960" class="r-stretch"></section></section>
<section>
<section id="clase-4" class="title-slide slide level1 center">
<h1>Clase 4: <span class="flow">simulaci√≥n error + tendencia</span></h1>
<p><span style="color:#444442;"><strong>Introducci√≥n al an√°lisis descriptivo de series temporales</strong></span></p>
<ul>
<li><a href="#/tu-turno-4-1">üíª Ejercicios de simulaci√≥n</a></li>
<li><a href="#/planificacion">üìÜ Planificaci√≥n</a></li>
</ul>
</section>
<section id="con-tendencia" class="slide level2">
<h2>Con tendencia</h2>
<p>Normalmente una serie temporal suele ser m√°s complejo y lleva al menos incorporada una <span class="hl-yellow"><strong>componente de tendencia o nivel <span class="math inline">\(\mu_t\)</span></strong></span> tal que</p>
<p><span class="math display">\[X_t = f \left(\mu_t, \varepsilon_t\right) =^{*} \mu_t + \varepsilon_t, \quad {\rm E} \left[X_t \right] = \mu_t\]</span> <span class="math inline">\(*\)</span> De momento estamos considerando una <span class="hl-yellow"><strong>descomposici√≥n aditiva</strong></span></p>
<p>&nbsp;</p>
<p>F√≠jate que ahora <span class="math inline">\({\rm E} \left[X_t \right] = \mu_t\)</span> ya que la esperanza de la parte aleatoria (ruido) ser√° asumida siempre nula: <span class="math inline">\(\mu_t\)</span> es el nivel de la serie respecto a la que oscila en el infinito.</p>
</section>
<section id="con-tendencia-1" class="slide level2">
<h2>Con tendencia</h2>
<p><span class="math display">\[X_t = f \left(\mu_t, \varepsilon_t\right) =^{*} \mu_t + \varepsilon_t, \quad {\rm E} \left[X_t \right] = \mu_t\]</span></p>
<p>Dicha tendencia <span class="math inline">\(\mu_t\)</span> puede ser a su vez modelada en funci√≥n de <span class="math inline">\(t\)</span> y de un vector de par√°metros <span class="math inline">\(\beta\)</span> tal que <span class="math inline">\(\mu_t := f \left(t, \beta \right)\)</span>. Esa funci√≥n <span class="math inline">\(f \left( \cdot \right)\)</span> puede ser cualquier funci√≥n que se te ocurre pero algunas de las tendencias m√°s habituales son:</p>
<ul>
<li><p><span class="hl-purple"><strong>Constante</strong></span>: <span class="math inline">\(\mu_t = \beta = \beta_0 = cte\)</span></p></li>
<li><p><span class="hl-purple"><strong>Lineal</strong></span>: <span class="math inline">\(\mu_t = \beta_0 + \beta_1 t\)</span></p></li>
<li><p><span class="hl-purple"><strong>Polin√≥mica (no lineal)</strong></span>: <span class="math inline">\(\mu_t = \beta_0 + \beta_1 t + \ldots + \beta_r t^{r}\)</span></p></li>
<li><p><span class="hl-purple"><strong>No polin√≥mica</strong></span>: <span class="math inline">\(\mu_t = \sin \left(\pi t \right)\)</span></p></li>
</ul>
</section>
<section id="con-tendencia-2" class="slide level2">
<h2>Con tendencia</h2>
<ul>
<li><span class="hl-purple"><strong>Constante</strong></span>: <span class="math inline">\(\mu_t = \beta = \beta_0 = cte\)</span></li>
</ul>
<p><span class="math display">\[X_t = f \left(\mu_t, \varepsilon_t\right) = \beta_0  + \varepsilon_t , \quad {\rm E} \left[X_t \right] = \beta_0, \quad \widehat{X}_{t + k} = \widehat{\beta}_0\]</span></p>

<img data-src="index_files/figure-revealjs/unnamed-chunk-192-1.png" width="960" class="r-stretch"></section>
<section id="con-tendencia-3" class="slide level2">
<h2>Con tendencia</h2>
<ul>
<li><span class="hl-purple"><strong>Lineal</strong></span>: <span class="math inline">\(\mu_t = \beta_0 + \beta_1 t\)</span></li>
</ul>
<p><span class="math display">\[X_t = f \left(\mu_t, \varepsilon_t\right) = \beta_0  + \beta_1 t + \varepsilon_t , \quad {\rm E} \left[X_t \right] = \beta_0  + \beta_1 t \to \pm \infty, \quad \widehat{X}_{t + k} = \widehat{\beta}_0 + \widehat{\beta}_1 \left(t + k \right)\]</span></p>

<img data-src="index_files/figure-revealjs/unnamed-chunk-193-1.png" width="960" class="r-stretch"></section>
<section id="con-tendencia-4" class="slide level2">
<h2>Con tendencia</h2>
<ul>
<li><span class="hl-purple"><strong>Polin√≥mica (no lineal)</strong></span>: <span class="math inline">\(\mu_t = \beta_0 + \beta_1 t + \ldots + \beta_r t^{r}\)</span></li>
</ul>
<p><span class="math display">\[X_t = f \left(\mu_t, \varepsilon_t\right) = \beta_0 + \beta_1 t + \ldots + \beta_r t^{r} + \varepsilon_t , \quad \widehat{X}_{t + k} = \widehat{\beta}_0 + \widehat{\beta}_1 \left(t + k \right) + \ldots + \widehat{\beta}_r \left(t + k \right)^r\]</span></p>

<img data-src="index_files/figure-revealjs/unnamed-chunk-194-1.png" width="960" class="r-stretch"></section>
<section id="con-tendencia-5" class="slide level2">
<h2>Con tendencia</h2>
<p>Si nuestra tendencia est√° definida de forma <strong>param√©trica</strong>, para la predicci√≥n de los valores en un tiempo futuro <span class="math inline">\(t + k\)</span> simplemente necesitamos realizar la <span class="hl-yellow"><strong>estimaci√≥n del vector de par√°metros <span class="math inline">\(\widehat{\beta}\)</span></strong></span>. Para ello recurriremos al <span class="hl-yellow"><strong>m√©todo de los minimos cuadrados</strong></span>. Por ejemplo, en el caso de tendencia polin√≥mica</p>
<p><span class="math display">\[\widehat{\beta} = \arg \min_{\beta \in \mathbb{R}^{r+1}} \sum_{t = 0}^{T} \left(x_t - \widehat{x}_t \right)^2 = \arg \min_{\beta \in \mathbb{R}^{r+1}} \sum_{t = 0}^{T} \left(x_t - \left(\beta_0 + \beta_1 t \ldots \beta_r t^r \right) \right)^2\]</span></p>
<div class="fragment">
<p>Como suele ser habitual, para encontrar el m√≠nimo basta con <strong>derivar respecto a los par√°metros e igualar a 0</strong>. Por ejemplo‚Ä¶</p>
<ul>
<li><span class="hl-purple"><strong>Constante</strong></span>: <span class="math inline">\(\frac{\partial \sum_{t=0}^{T} \left(x_t - \beta_0 \right)^2}{\partial \beta_0} = T \beta_0 - \sum_{t=0}^{T} x_t = 0\)</span> -&gt; <span class="math inline">\(\widehat{\beta}_0 = \overline{x}_{t=0, ..., T}\)</span></li>
</ul>
</div>
</section>
<section id="tu-turno-4-1" class="slide level2">
<h2>üíª Tu turno</h2>
<h3 id="ejercicio-1-4"><span class="hl-yellow"><strong>Ejercicio 1</strong></span></h3>
<p>üíª Si a√∫n no lo has hecho, haz una funci√≥n llamada <code>time_series_error</code> que <span class="hl-yellow"><strong>simule una serie temporal solo con error</strong></span>. Los argumentos deben ser: tama√±o muestral <code>n</code>, un vector temporal <code>t</code> y la desv t√≠pica <code>sd</code> (debes permitir que pueda ser un vector para simular varias a la vez, ya colocadas en tidydata)</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb315"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1"></a>time_series_error <span class="ot">&lt;-</span> <span class="cf">function</span>(n, <span class="at">t =</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="at">sd_vec =</span> <span class="dv">1</span>) {</span>
<span id="cb315-2"><a href="#cb315-2"></a>  </span>
<span id="cb315-3"><a href="#cb315-3"></a>  datos_tidy <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb315-4"><a href="#cb315-4"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sd_vec)) {</span>
<span id="cb315-5"><a href="#cb315-5"></a>    datos_tidy <span class="ot">&lt;-</span> </span>
<span id="cb315-6"><a href="#cb315-6"></a>      datos_tidy <span class="sc">|&gt;</span></span>
<span id="cb315-7"><a href="#cb315-7"></a>      <span class="fu">rbind</span>(datos_tidy,</span>
<span id="cb315-8"><a href="#cb315-8"></a>            <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> t, <span class="st">"sd"</span> <span class="ot">=</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"sd_{sd_vec[i]}"</span>),</span>
<span id="cb315-9"><a href="#cb315-9"></a>                   <span class="st">"X_t"</span> <span class="ot">=</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sd_vec[i])))</span>
<span id="cb315-10"><a href="#cb315-10"></a>  }</span>
<span id="cb315-11"><a href="#cb315-11"></a>  <span class="fu">return</span>(datos_tidy)</span>
<span id="cb315-12"><a href="#cb315-12"></a>}</span>
<span id="cb315-13"><a href="#cb315-13"></a><span class="fu">time_series_error</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">sd =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="tu-turno" class="slide level2">
<h2>üíª Tu turno</h2>
<h3 id="ejercicio-2-4"><span class="hl-yellow"><strong>Ejercicio 2</strong></span></h3>
<p>üíª Usando la funci√≥n anterior, define <code>time_series_trend_error()</code> que simule una serie temporal con <strong>tendencia cte</strong> y error, con solo 4 argumentos: <code>n</code>, <code>t</code>, desviaci√≥n y la constante. Usa dicha funci√≥n y dibuja.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb316"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1"></a>time_series_trend_error <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">t =</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="at">beta_0 =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>) {</span>
<span id="cb316-2"><a href="#cb316-2"></a>  <span class="co"># modo R base</span></span>
<span id="cb316-3"><a href="#cb316-3"></a>  datos <span class="ot">&lt;-</span> <span class="fu">time_series_error</span>(<span class="at">n =</span> n, <span class="at">t =</span> t, <span class="at">sd =</span> sd)</span>
<span id="cb316-4"><a href="#cb316-4"></a>  datos<span class="sc">$</span>X_t <span class="ot">&lt;-</span> datos<span class="sc">$</span>X_t <span class="sc">+</span> beta_0</span>
<span id="cb316-5"><a href="#cb316-5"></a>  </span>
<span id="cb316-6"><a href="#cb316-6"></a>  <span class="co"># modo tidyverse</span></span>
<span id="cb316-7"><a href="#cb316-7"></a>  <span class="co"># datos &lt;- time_series_error(n = n, t = t, sd = sd) |&gt; mutate(X_t = X_t + trend)</span></span>
<span id="cb316-8"><a href="#cb316-8"></a>  <span class="fu">return</span>(datos)</span>
<span id="cb316-9"><a href="#cb316-9"></a>}</span>
<span id="cb316-10"><a href="#cb316-10"></a></span>
<span id="cb316-11"><a href="#cb316-11"></a>datos <span class="ot">&lt;-</span> <span class="fu">time_series_trend_error</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">beta_0 =</span> <span class="dv">3</span>, <span class="at">sd =</span> <span class="fl">0.5</span>)</span>
<span id="cb316-12"><a href="#cb316-12"></a><span class="fu">ggplot</span>(datos, <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t)) <span class="sc">+</span></span>
<span id="cb316-13"><a href="#cb316-13"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb316-14"><a href="#cb316-14"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb316-15"><a href="#cb316-15"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_colorblind</span>() <span class="sc">+</span></span>
<span id="cb316-16"><a href="#cb316-16"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb316-17"><a href="#cb316-17"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"t"</span>, <span class="at">y =</span> <span class="st">"X_t"</span>, <span class="at">title =</span> <span class="st">"Serie temporal X_t = mu_t + eps_t con mu_t = 3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-196-1.png" width="960" class="r-stretch"></section>
<section id="tu-turno-1" class="slide level2">
<h2>üíª Tu turno</h2>
<h3 id="ejercicio-3-4"><span class="hl-yellow"><strong>Ejercicio 3</strong></span></h3>
<p>üíª Generaliza la funci√≥n anterior para simular una <span class="hl-yellow"><strong>serie temporal con error y tendencia lineal</strong></span> (donde antes defin√≠amos solo una constante ahora ser√° un vector de coeficientes). F√≠jate que la <strong>l√≠nea de ajuste de ggplot es literal la estimaci√≥n</strong> que har√≠amos si solo consideramos error + tendencia.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb317"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1"></a>time_series_trend_error <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">t =</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.01</span>), <span class="at">sd =</span> <span class="dv">1</span>) {</span>
<span id="cb317-2"><a href="#cb317-2"></a>  </span>
<span id="cb317-3"><a href="#cb317-3"></a>  datos <span class="ot">&lt;-</span> <span class="fu">time_series_error</span>(<span class="at">n =</span> n, <span class="at">t =</span> t, <span class="at">sd =</span> sd)</span>
<span id="cb317-4"><a href="#cb317-4"></a>  datos<span class="sc">$</span>X_t <span class="ot">&lt;-</span> datos<span class="sc">$</span>X_t <span class="sc">+</span> (beta[<span class="dv">1</span>] <span class="sc">+</span> beta[<span class="dv">2</span>]<span class="sc">*</span>datos<span class="sc">$</span>t)</span>
<span id="cb317-5"><a href="#cb317-5"></a>  <span class="fu">return</span>(datos)</span>
<span id="cb317-6"><a href="#cb317-6"></a>}</span>
<span id="cb317-7"><a href="#cb317-7"></a></span>
<span id="cb317-8"><a href="#cb317-8"></a>datos <span class="ot">&lt;-</span> <span class="fu">time_series_trend_error</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.01</span>), <span class="at">sd =</span> <span class="fl">0.5</span>)</span>
<span id="cb317-9"><a href="#cb317-9"></a><span class="fu">ggplot</span>(datos, <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t)) <span class="sc">+</span></span>
<span id="cb317-10"><a href="#cb317-10"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb317-11"><a href="#cb317-11"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb317-12"><a href="#cb317-12"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_colorblind</span>() <span class="sc">+</span></span>
<span id="cb317-13"><a href="#cb317-13"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb317-14"><a href="#cb317-14"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"t"</span>, <span class="at">y =</span> <span class="st">"X_t"</span>, <span class="at">title =</span> <span class="st">"Serie temporal X_t = mu_t + eps_t con mu_t = 1 - 0.01*t"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-197-1.png" width="960" class="r-stretch"></section></section>
<section>
<section id="clase-5" class="title-slide slide level1 center">
<h1>Clase 5: <span class="flow">simulaci√≥n error + tendencia</span></h1>
<p><span style="color:#444442;"><strong>Introducci√≥n al an√°lisis descriptivo de series temporales</strong></span></p>
<ul>
<li><a href="#/tu-turno-5-1">üíª Ejercicios de simulaci√≥n</a></li>
<li><a href="#/planificacion">üìÜ Planificaci√≥n</a></li>
</ul>
</section>
<section id="tu-turno-5-1" class="slide level2">
<h2>üíª Tu turno</h2>
<h3 id="ejercicio-4-4"><span class="hl-yellow"><strong>Ejercicio 4</strong></span></h3>
<p>üíª Generaliza la funci√≥n anterior de manera que simule una <span class="hl-yellow"><strong>serie temporal con error y tendencia polin√≥mica</strong></span> (que acepte un vector de par√°metros general).</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb318"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1"></a>time_series_trend_error <span class="ot">&lt;-</span></span>
<span id="cb318-2"><a href="#cb318-2"></a>  <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">t =</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.01</span>, <span class="fl">0.001</span>, <span class="sc">-</span><span class="fl">0.0001</span>), <span class="at">sd =</span> <span class="dv">1</span>) {</span>
<span id="cb318-3"><a href="#cb318-3"></a>  </span>
<span id="cb318-4"><a href="#cb318-4"></a>  datos <span class="ot">&lt;-</span> <span class="fu">time_series_error</span>(<span class="at">n =</span> n, <span class="at">t =</span> t, <span class="at">sd =</span> sd)</span>
<span id="cb318-5"><a href="#cb318-5"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(beta)) {</span>
<span id="cb318-6"><a href="#cb318-6"></a>    datos<span class="sc">$</span>X_t <span class="ot">&lt;-</span> datos<span class="sc">$</span>X_t <span class="sc">+</span> beta[i]<span class="sc">*</span>(datos<span class="sc">$</span>t<span class="sc">^</span>(i <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb318-7"><a href="#cb318-7"></a>  } </span>
<span id="cb318-8"><a href="#cb318-8"></a>  <span class="fu">return</span>(datos)</span>
<span id="cb318-9"><a href="#cb318-9"></a>}</span>
<span id="cb318-10"><a href="#cb318-10"></a></span>
<span id="cb318-11"><a href="#cb318-11"></a>datos <span class="ot">&lt;-</span> <span class="fu">time_series_trend_error</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.01</span>, <span class="fl">0.000001</span>, <span class="sc">-</span><span class="fl">0.00000001</span>), <span class="at">sd =</span> <span class="fl">0.5</span>)</span>
<span id="cb318-12"><a href="#cb318-12"></a><span class="fu">ggplot</span>(datos, <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t)) <span class="sc">+</span></span>
<span id="cb318-13"><a href="#cb318-13"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb318-14"><a href="#cb318-14"></a>  <span class="fu">geom_smooth</span>(<span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">3</span>), <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb318-15"><a href="#cb318-15"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_colorblind</span>() <span class="sc">+</span></span>
<span id="cb318-16"><a href="#cb318-16"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb318-17"><a href="#cb318-17"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"t"</span>, <span class="at">y =</span> <span class="st">"X_t"</span>, <span class="at">title =</span> <span class="st">"Serie temporal X_t = mu_t + eps_t con mu_t c√∫bica"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-198-1.png" width="960" class="r-stretch"></section>
<section id="tu-turno-2" class="slide level2">
<h2>üíª Tu turno</h2>
<h3 id="ejercicio-5-4"><span class="hl-yellow"><strong>Ejercicio 5</strong></span></h3>
<p>üíª Dise√±a una funci√≥n <code>estim_ts_trend_error()</code> que, dada una serie (un tibble de dos columnas <code>t</code> y <code>X_t</code>), nos devuelva la misma tabla pero con una <strong>tercera columna con su estimaci√≥n</strong> asumiendo una tendencia polin√≥mica (necesitamos dos argumentos: la tabla y el grado del polinomio; haz uso dentro de <code>poly()</code>, chequea en la ayuda de la funci√≥n <code>? poly()</code>)</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb319"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb319-1"><a href="#cb319-1"></a>estim_ts_trend_error <span class="ot">&lt;-</span> <span class="cf">function</span>(datos, <span class="at">degree =</span> <span class="dv">1</span>) {</span>
<span id="cb319-2"><a href="#cb319-2"></a>  <span class="cf">if</span> (degree <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb319-3"><a href="#cb319-3"></a>    modelo <span class="ot">&lt;-</span> datos <span class="sc">|&gt;</span> <span class="fu">lm</span>(<span class="at">formula =</span> X_t <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb319-4"><a href="#cb319-4"></a>  } <span class="cf">else</span> {</span>
<span id="cb319-5"><a href="#cb319-5"></a>    modelo <span class="ot">&lt;-</span> datos <span class="sc">|&gt;</span> <span class="fu">lm</span>(<span class="at">formula =</span> X_t <span class="sc">~</span> <span class="fu">poly</span>(t, degree, <span class="at">raw =</span> <span class="cn">TRUE</span>))</span>
<span id="cb319-6"><a href="#cb319-6"></a>  }</span>
<span id="cb319-7"><a href="#cb319-7"></a>  datos<span class="sc">$</span>X_hat <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo, <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> datos<span class="sc">$</span>t))</span>
<span id="cb319-8"><a href="#cb319-8"></a>  <span class="fu">return</span>(datos)</span>
<span id="cb319-9"><a href="#cb319-9"></a>}</span>
<span id="cb319-10"><a href="#cb319-10"></a>datos <span class="ot">&lt;-</span> <span class="fu">time_series_trend_error</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.01</span>, <span class="fl">0.000001</span>, <span class="sc">-</span><span class="fl">0.00000001</span>), <span class="at">sd =</span> <span class="fl">0.5</span>)</span>
<span id="cb319-11"><a href="#cb319-11"></a><span class="co"># ajustamos un modelo polin√≥mico de tendencia</span></span>
<span id="cb319-12"><a href="#cb319-12"></a>modelo <span class="ot">&lt;-</span> datos <span class="sc">|&gt;</span> <span class="fu">estim_ts_trend_error</span>(<span class="at">degree =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>

<img data-src="index_files/figure-revealjs/unnamed-chunk-200-1.png" width="960" class="r-stretch"></section>
<section id="caso-real-aemet" class="slide level2">
<h2>Caso real: AEMET</h2>
<p>Como ya te puedes estar imaginando, esta forma de estimar una serie temporal con un polinomio puede ser <span class="hl-red"><strong>bastante imprecisa</strong></span>, m√°xime si aparece en nuestra serie una <span class="hl-yellow"><strong>componente estacional</strong></span> (un patr√≥n peri√≥dico).</p>
<p>Vamos a retomar por ejemplo nuestros <strong>datos de temperatura del AEMET</strong></p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb320"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1"></a><span class="fu">ggplot</span>(retiro) <span class="sc">+</span></span>
<span id="cb320-2"><a href="#cb320-2"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fecha, <span class="at">y =</span> tmed), <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb320-3"><a href="#cb320-3"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb320-4"><a href="#cb320-4"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Temperatura media como SERIE TEMPORAL"</span>,</span>
<span id="cb320-5"><a href="#cb320-5"></a>       <span class="at">x =</span> <span class="st">"t (fecha)"</span>, <span class="at">y =</span> <span class="st">"¬∫C (media)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-201-1.png" width="960" class="r-stretch"></section>
<section id="caso-real-aemet-1" class="slide level2">
<h2>Caso real: AEMET</h2>
<p>üíª Aplica la funci√≥n de estimaci√≥n definida anteriormente a los datos reales del AEMET para incluir 3 nuevas columnas con los 3 m√©todos de estimaci√≥n (tendencia constante, lineal y polin√≥mica de grado 3)</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb321"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb321-1"><a href="#cb321-1"></a>retiro_estim <span class="ot">&lt;-</span></span>
<span id="cb321-2"><a href="#cb321-2"></a>  <span class="fu">tibble</span>(<span class="st">"fecha"</span> <span class="ot">=</span> retiro<span class="sc">$</span>fecha, <span class="st">"t"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(fecha), <span class="st">"X_t"</span> <span class="ot">=</span> retiro<span class="sc">$</span>tmed) <span class="sc">|&gt;</span></span>
<span id="cb321-3"><a href="#cb321-3"></a>  <span class="co"># aplicamos funci√≥n y renombramos variable de salida de la estimaci√≥n</span></span>
<span id="cb321-4"><a href="#cb321-4"></a>  <span class="fu">estim_ts_trend_error</span>(<span class="at">degree =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">X_t_hat_0 =</span> X_hat) <span class="sc">|&gt;</span></span>
<span id="cb321-5"><a href="#cb321-5"></a>  <span class="fu">estim_ts_trend_error</span>(<span class="at">degree =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">X_t_hat_1 =</span> X_hat) <span class="sc">|&gt;</span> </span>
<span id="cb321-6"><a href="#cb321-6"></a>  <span class="fu">estim_ts_trend_error</span>(<span class="at">degree =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">X_t_hat_3 =</span> X_hat) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="caso-real-aemet-2" class="slide level2">
<h2>Caso real: AEMET</h2>
<div class="columns">
<div class="column" style="width:25%;">
<p>Como observas las <span class="hl-red"><strong>predicciones no son precisas cuando hay una componente estacional</strong></span> ya que el ajuste realizado solo se fija en una tendencia con unos <strong>coef ctes</strong>.</p>
<p>&nbsp;</p>
<p>¬øSe te ocurre alguna <strong>idea para mejorar</strong>?</p>
</div><div class="column" style="width:75%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb322"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1"></a><span class="fu">ggplot</span>(retiro_estim <span class="sc">|&gt;</span></span>
<span id="cb322-2"><a href="#cb322-2"></a>         <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(fecha, t), <span class="at">names_to =</span> <span class="st">"type"</span>, <span class="at">values_to =</span> <span class="st">"pred"</span>)) <span class="sc">+</span></span>
<span id="cb322-3"><a href="#cb322-3"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fecha, <span class="at">y =</span> pred, <span class="at">color =</span> type),</span>
<span id="cb322-4"><a href="#cb322-4"></a>            <span class="at">linewidth =</span> <span class="fl">0.4</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb322-5"><a href="#cb322-5"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_colorblind</span>() <span class="sc">+</span></span>
<span id="cb322-6"><a href="#cb322-6"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb322-7"><a href="#cb322-7"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Temperatura media como SERIE TEMPORAL"</span>,</span>
<span id="cb322-8"><a href="#cb322-8"></a>       <span class="at">x =</span> <span class="st">"t (fecha)"</span>, <span class="at">y =</span> <span class="st">"¬∫C (media)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-203-1.png" width="960"></p>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="clase-6" class="title-slide slide level1 center">
<h1>Clase 6: <span class="flow">medias m√≥viles</span></h1>
<p><span style="color:#444442;"><strong>Suavizado por medias m√≥viles</strong></span></p>
<ul>
<li><a href="#/tu-turno-6-1">üíª Ejercicios</a></li>
<li><a href="#/planificacion">üìÜ Planificaci√≥n</a></li>
</ul>
</section>
<section id="recapitulando-1" class="slide level2">
<h2>Recapitulando</h2>
<p>Hasta ahora nos hemos centrado sobre todo en tres cosas</p>
<ul>
<li><p>Repasar lo que supi√©ramos de <code>R</code></p></li>
<li><p>Entender c√≥mo simular y estimar series sencillas</p></li>
<li><p>Visualizar dichas series</p></li>
</ul>
<div class="fragment">
<p>Pero a partir de ahora pulsaremos un poco el acelerador (as√≠ qui√©n tenga muchos problemas en la parte de programaci√≥n, deber√° <strong>empezar a usar del mail y las tutor√≠as</strong>)</p>
</div>
</section>
<section id="recapitulando-2" class="slide level2">
<h2>Recapitulando</h2>
<p>¬øQu√© deber√≠amos saber hasta ahora?</p>
<ul>
<li>Deber√≠amos tener una funci√≥n <code>ts_error()</code> parecida a esta para <span class="hl-yellow"><strong>simular un ruido</strong></span> de una varianza dada.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1"></a>ts_error <span class="ot">&lt;-</span> <span class="cf">function</span>(n, <span class="at">t =</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="at">sd_vec =</span> <span class="dv">1</span>) {</span>
<span id="cb323-2"><a href="#cb323-2"></a>  </span>
<span id="cb323-3"><a href="#cb323-3"></a>  datos_tidy <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb323-4"><a href="#cb323-4"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sd_vec)) {</span>
<span id="cb323-5"><a href="#cb323-5"></a>    datos_tidy <span class="ot">&lt;-</span> </span>
<span id="cb323-6"><a href="#cb323-6"></a>      <span class="fu">rbind</span>(datos_tidy,</span>
<span id="cb323-7"><a href="#cb323-7"></a>            <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> t, <span class="st">"sd"</span> <span class="ot">=</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"sd_{sd_vec[i]}"</span>),</span>
<span id="cb323-8"><a href="#cb323-8"></a>                   <span class="st">"X_t"</span> <span class="ot">=</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sd_vec[i])))</span>
<span id="cb323-9"><a href="#cb323-9"></a>  }</span>
<span id="cb323-10"><a href="#cb323-10"></a>  <span class="fu">return</span>(datos_tidy)</span>
<span id="cb323-11"><a href="#cb323-11"></a>}</span>
<span id="cb323-12"><a href="#cb323-12"></a><span class="fu">ts_error</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">sd =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 200 √ó 3
       t sd         X_t
   &lt;int&gt; &lt;glue&gt;   &lt;dbl&gt;
 1     1 sd_0.5  0.0178
 2     2 sd_0.5  0.450 
 3     3 sd_0.5 -0.987 
 4     4 sd_0.5 -0.251 
 5     5 sd_0.5 -0.0661
 6     6 sd_0.5 -0.508 
 7     7 sd_0.5 -0.148 
 8     8 sd_0.5  0.0904
 9     9 sd_0.5 -0.0447
10    10 sd_0.5  0.920 
# ‚Ñπ 190 more rows</code></pre>
</div>
</div>
</section>
<section id="recapitulando-3" class="slide level2">
<h2>Recapitulando</h2>
<p>¬øQu√© deber√≠amos saber hasta ahora?</p>
<ul>
<li>Deber√≠amos tener una funci√≥n <code>ts_trend_error</code> parecida a esta para <span class="hl-yellow"><strong>simular una serie formada por tendencia polin√≥mica m√°s ruido</strong></span>, con una varianza dada y un vector de coeficientes dado.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb325"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1"></a>ts_trend_error <span class="ot">&lt;-</span></span>
<span id="cb325-2"><a href="#cb325-2"></a>  <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">t =</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.01</span>, <span class="fl">0.001</span>, <span class="sc">-</span><span class="fl">0.0001</span>), <span class="at">sd =</span> <span class="dv">1</span>) {</span>
<span id="cb325-3"><a href="#cb325-3"></a>  </span>
<span id="cb325-4"><a href="#cb325-4"></a>  datos <span class="ot">&lt;-</span> <span class="fu">ts_error</span>(<span class="at">n =</span> n, <span class="at">t =</span> t, <span class="at">sd =</span> sd)</span>
<span id="cb325-5"><a href="#cb325-5"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(beta)) {</span>
<span id="cb325-6"><a href="#cb325-6"></a>    datos<span class="sc">$</span>X_t <span class="ot">&lt;-</span> datos<span class="sc">$</span>X_t <span class="sc">+</span> beta[i]<span class="sc">*</span>(datos<span class="sc">$</span>t<span class="sc">^</span>(i <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb325-7"><a href="#cb325-7"></a>  } </span>
<span id="cb325-8"><a href="#cb325-8"></a>  <span class="fu">return</span>(datos)</span>
<span id="cb325-9"><a href="#cb325-9"></a>}</span>
<span id="cb325-10"><a href="#cb325-10"></a>datos <span class="ot">&lt;-</span> <span class="fu">ts_trend_error</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.01</span>, <span class="fl">0.000001</span>, <span class="sc">-</span><span class="fl">0.00000001</span>), <span class="at">sd =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="recapitulando-4" class="slide level2">
<h2>Recapitulando</h2>
<p>¬øQu√© deber√≠amos saber hasta ahora?</p>
<ul>
<li>Deber√≠as ser capaz de entender c√≥mo <span class="hl-yellow"><strong>organizar los datos</strong></span> de manera que podamos visualizar de manera sencilla.</li>
</ul>
<div class="columns">
<div class="column" style="width:47%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1"></a><span class="fu">ggplot</span>(datos) <span class="sc">+</span></span>
<span id="cb326-2"><a href="#cb326-2"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t),</span>
<span id="cb326-3"><a href="#cb326-3"></a>            <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb326-4"><a href="#cb326-4"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_colorblind</span>() <span class="sc">+</span></span>
<span id="cb326-5"><a href="#cb326-5"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb326-6"><a href="#cb326-6"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"t"</span>, <span class="at">y =</span> <span class="st">"X_t"</span>,</span>
<span id="cb326-7"><a href="#cb326-7"></a>       <span class="at">title =</span> <span class="st">"Serie temporal X_t = mu_t + eps_t (mu_t c√∫bica)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:53%;">
<div class="cell">
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-207-1.png" width="960"></p>
</div>
</div>
</div>
</div>
</section>
<section id="recapitulando-5" class="slide level2">
<h2>Recapitulando</h2>
<ul>
<li>Y por √∫ltimo deber√≠as tener una <code>estim_ts_trend_error()</code> similar a esta para que, dada una <span class="hl-yellow"><strong>serie cualquiera</strong></span>, con dos columnas para <span class="math inline">\(t\)</span> y <span class="math inline">\(X_t\)</span> (con cualquier nombre) haga la estimaci√≥n. <span class="hl-purple"><strong>F√≠jate de los argumentos <code>tag_estim</code> y <code>nuevos_valores</code> que hacen para facilitarnos la vida a futuro</strong></span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb327"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb327-1"><a href="#cb327-1"></a>estim_ts_trend_error <span class="ot">&lt;-</span></span>
<span id="cb327-2"><a href="#cb327-2"></a>  <span class="cf">function</span>(datos, <span class="at">degree =</span> <span class="dv">1</span>, <span class="at">tag_estim =</span> <span class="fu">paste0</span>(<span class="st">"estim_poly_"</span>, degree),</span>
<span id="cb327-3"><a href="#cb327-3"></a>           <span class="at">col_t =</span> <span class="st">"t"</span>, <span class="at">col_X_t =</span> <span class="st">"X_t"</span>, <span class="at">nuevos_valores =</span> <span class="cn">NULL</span>) {</span>
<span id="cb327-4"><a href="#cb327-4"></a>    </span>
<span id="cb327-5"><a href="#cb327-5"></a>    datos <span class="ot">&lt;-</span> <span class="co"># versi√≥n tidyverse</span></span>
<span id="cb327-6"><a href="#cb327-6"></a>      datos <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">all_of</span>(col_t), <span class="fu">all_of</span>(col_X_t)) <span class="sc">|&gt;</span></span>
<span id="cb327-7"><a href="#cb327-7"></a>      <span class="fu">rename</span>(<span class="at">t =</span> <span class="fu">all_of</span>(col_t), <span class="at">X_t =</span> <span class="fu">all_of</span>(col_X_t))</span>
<span id="cb327-8"><a href="#cb327-8"></a>    </span>
<span id="cb327-9"><a href="#cb327-9"></a>    <span class="co"># R base normal</span></span>
<span id="cb327-10"><a href="#cb327-10"></a>    <span class="co"># datos &lt;- datos[, c(col_t, col_X_t)]</span></span>
<span id="cb327-11"><a href="#cb327-11"></a>    <span class="co"># names(datos)[names(datos) == col_t] &lt;- "t"</span></span>
<span id="cb327-12"><a href="#cb327-12"></a>    <span class="co"># names(datos)[names(datos) == col_X_t] &lt;- "X_t"</span></span>
<span id="cb327-13"><a href="#cb327-13"></a></span>
<span id="cb327-14"><a href="#cb327-14"></a>    <span class="cf">if</span> (degree <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb327-15"><a href="#cb327-15"></a>      modelo <span class="ot">&lt;-</span> datos <span class="sc">|&gt;</span> <span class="fu">lm</span>(<span class="at">formula =</span> X_t <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb327-16"><a href="#cb327-16"></a>    } <span class="cf">else</span> {</span>
<span id="cb327-17"><a href="#cb327-17"></a>      modelo <span class="ot">&lt;-</span> datos <span class="sc">|&gt;</span> <span class="fu">lm</span>(<span class="at">formula =</span> X_t <span class="sc">~</span> <span class="fu">poly</span>(t, degree, <span class="at">raw =</span> <span class="cn">TRUE</span>))</span>
<span id="cb327-18"><a href="#cb327-18"></a>    }</span>
<span id="cb327-19"><a href="#cb327-19"></a>    datos[, tag_estim] <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo, <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> datos<span class="sc">$</span>t))</span>
<span id="cb327-20"><a href="#cb327-20"></a>    </span>
<span id="cb327-21"><a href="#cb327-21"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(nuevos_valores)) {</span>
<span id="cb327-22"><a href="#cb327-22"></a>      nuevos_datos <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> nuevos_valores, <span class="st">"X_t"</span> <span class="ot">=</span> <span class="cn">NA</span>)</span>
<span id="cb327-23"><a href="#cb327-23"></a>      nuevos_datos[, tag_estim] <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo, <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> nuevos_datos<span class="sc">$</span>t))</span>
<span id="cb327-24"><a href="#cb327-24"></a>      datos <span class="ot">&lt;-</span> <span class="fu">rbind</span>(datos, nuevos_datos)</span>
<span id="cb327-25"><a href="#cb327-25"></a>    }</span>
<span id="cb327-26"><a href="#cb327-26"></a>    <span class="fu">return</span>(datos)</span>
<span id="cb327-27"><a href="#cb327-27"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="caso-real-aemet-3" class="slide level2">
<h2>Caso real: AEMET</h2>
<p>Con todo esto podemos aplicar nuestras funciones para <span class="hl-yellow"><strong>estimar los datos reales del AEMET</strong></span>, estimando bajo 4 hip√≥tesis: solo ruido, ruido + tendencia cte, ruido + tendencia lineal y ruido + tendencia polin√≥mica de grado 3.</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb328"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1"></a>retiro_estim <span class="ot">&lt;-</span></span>
<span id="cb328-2"><a href="#cb328-2"></a>  <span class="fu">estim_ts_trend_error</span>(retiro[, <span class="fu">c</span>(<span class="st">"fecha"</span>, <span class="st">"tmed"</span>)], <span class="at">degree =</span> <span class="dv">0</span>,</span>
<span id="cb328-3"><a href="#cb328-3"></a>                       <span class="at">col_t =</span> <span class="st">"fecha"</span>, <span class="at">col_X_t =</span> <span class="st">"tmed"</span>)</span>
<span id="cb328-4"><a href="#cb328-4"></a>retiro_estim<span class="sc">$</span>estim_poly_1 <span class="ot">&lt;-</span> </span>
<span id="cb328-5"><a href="#cb328-5"></a>  <span class="fu">estim_ts_trend_error</span>(retiro[, <span class="fu">c</span>(<span class="st">"fecha"</span>, <span class="st">"tmed"</span>)], <span class="at">degree =</span> <span class="dv">1</span>,</span>
<span id="cb328-6"><a href="#cb328-6"></a>                       <span class="at">col_t =</span> <span class="st">"fecha"</span>, <span class="at">col_X_t =</span> <span class="st">"tmed"</span>)<span class="sc">$</span>estim_poly_1</span>
<span id="cb328-7"><a href="#cb328-7"></a>retiro_estim<span class="sc">$</span>estim_poly_3 <span class="ot">&lt;-</span> </span>
<span id="cb328-8"><a href="#cb328-8"></a>  <span class="fu">estim_ts_trend_error</span>(retiro[, <span class="fu">c</span>(<span class="st">"fecha"</span>, <span class="st">"tmed"</span>)], <span class="at">degree =</span> <span class="dv">3</span>,</span>
<span id="cb328-9"><a href="#cb328-9"></a>                       <span class="at">col_t =</span> <span class="st">"fecha"</span>, <span class="at">col_X_t =</span> <span class="st">"tmed"</span>)<span class="sc">$</span>estim_poly_3</span>
<span id="cb328-10"><a href="#cb328-10"></a>retiro_estim<span class="sc">$</span>estim_noise <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># f√≠jate que el ruido la estimaci√≥n es...0</span></span>
<span id="cb328-11"><a href="#cb328-11"></a>retiro_estim_tidy <span class="ot">&lt;-</span></span>
<span id="cb328-12"><a href="#cb328-12"></a>  retiro_estim <span class="sc">|&gt;</span> </span>
<span id="cb328-13"><a href="#cb328-13"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>t, <span class="at">names_to =</span> <span class="st">"serie"</span>, <span class="at">values_to =</span> <span class="st">"X_t"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="caso-real-aemet-4" class="slide level2">
<h2>Caso real: AEMET</h2>
<p>F√≠jate que de cada <code>estim_ts_trend_error()</code> solo nos interesa la propia estimaci√≥n ya que <code>t</code> y <code>X_t</code> es igual siempre, as√≠ que podr√≠amos hacer un <code>left_join()</code> de las diferentes tablas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb329" data-code-line-numbers="4-9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1"></a>retiro_estim <span class="ot">&lt;-</span></span>
<span id="cb329-2"><a href="#cb329-2"></a>  <span class="fu">estim_ts_trend_error</span>(retiro[, <span class="fu">c</span>(<span class="st">"fecha"</span>, <span class="st">"tmed"</span>)], <span class="at">degree =</span> <span class="dv">0</span>,</span>
<span id="cb329-3"><a href="#cb329-3"></a>                       <span class="at">col_t =</span> <span class="st">"fecha"</span>, <span class="at">col_X_t =</span> <span class="st">"tmed"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb329-4"><a href="#cb329-4"></a>  <span class="fu">left_join</span>(<span class="fu">estim_ts_trend_error</span>(retiro[, <span class="fu">c</span>(<span class="st">"fecha"</span>, <span class="st">"tmed"</span>)], <span class="at">degree =</span> <span class="dv">1</span>,</span>
<span id="cb329-5"><a href="#cb329-5"></a>                                 <span class="at">col_t =</span> <span class="st">"fecha"</span>, <span class="at">col_X_t =</span> <span class="st">"tmed"</span>),</span>
<span id="cb329-6"><a href="#cb329-6"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"t"</span>, <span class="st">"X_t"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb329-7"><a href="#cb329-7"></a>  <span class="fu">left_join</span>(<span class="fu">estim_ts_trend_error</span>(retiro[, <span class="fu">c</span>(<span class="st">"fecha"</span>, <span class="st">"tmed"</span>)], <span class="at">degree =</span> <span class="dv">3</span>,</span>
<span id="cb329-8"><a href="#cb329-8"></a>                                 <span class="at">col_t =</span> <span class="st">"fecha"</span>, <span class="at">col_X_t =</span> <span class="st">"tmed"</span>),</span>
<span id="cb329-9"><a href="#cb329-9"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"t"</span>, <span class="st">"X_t"</span>))</span>
<span id="cb329-10"><a href="#cb329-10"></a>retiro_estim<span class="sc">$</span>estim_noise <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># f√≠jate que el ruido la estimaci√≥n es...0</span></span>
<span id="cb329-11"><a href="#cb329-11"></a>retiro_estim_tidy <span class="ot">&lt;-</span></span>
<span id="cb329-12"><a href="#cb329-12"></a>  retiro_estim <span class="sc">|&gt;</span> </span>
<span id="cb329-13"><a href="#cb329-13"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>t, <span class="at">names_to =</span> <span class="st">"serie"</span>, <span class="at">values_to =</span> <span class="st">"X_t"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="caso-real-aemet-5" class="slide level2">
<h2>Caso real: AEMET</h2>
<p>Y tambi√©n deber√≠amos saber ya visualizar todo</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb330"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1"></a><span class="fu">ggplot</span>(retiro_estim_tidy) <span class="sc">+</span></span>
<span id="cb330-2"><a href="#cb330-2"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t, <span class="at">color =</span> serie,</span>
<span id="cb330-3"><a href="#cb330-3"></a>                <span class="at">linewidth =</span> serie, <span class="at">alpha =</span> serie, <span class="at">linetype =</span> serie)) <span class="sc">+</span></span>
<span id="cb330-4"><a href="#cb330-4"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_colorblind</span>() <span class="sc">+</span></span>
<span id="cb330-5"><a href="#cb330-5"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fl">0.85</span>, <span class="fl">0.85</span>, <span class="fl">0.85</span>, <span class="fl">0.85</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb330-6"><a href="#cb330-6"></a>  <span class="fu">scale_linewidth_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fl">1.1</span>, <span class="fl">1.1</span>, <span class="fl">1.1</span>, <span class="fl">1.1</span>, <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb330-7"><a href="#cb330-7"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dotted"</span>, <span class="st">"dotted"</span>, <span class="st">"dotted"</span>, <span class="st">"dotted"</span>, <span class="st">"solid"</span>)) <span class="sc">+</span></span>
<span id="cb330-8"><a href="#cb330-8"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb330-9"><a href="#cb330-9"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"t"</span>, <span class="at">y =</span> <span class="st">"Temperatura (¬∫C)"</span>, <span class="at">title =</span> <span class="st">"Estimaci√≥n serie AEMET"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-211-1.png" width="960" class="r-stretch"></section>
<section id="caso-real-aemet-6" class="slide level2">
<h2>Caso real: AEMET</h2>
<p>La idea de los m√©todos de estimaci√≥n es que podamos usarlos no solo para estimar sino tambi√©n para <span class="hl-yellow"><strong>predecir en instantes temporales futuros</strong></span>, haciendo uso de esos <strong>¬´nuevos valores¬ª</strong> que podemos usar en <code>estim_ts_trend_error()</code>.</p>
<div class="fragment">
<p>Por ejemplo, en los datos tenemos solo hasta el 31 de agosto de 2024: <span class="hl-purple"><strong>¬øcu√°l es la predicci√≥n de los distintos m√©todos para todo el mes de septiembre, octubre y noviembre?</strong></span></p>
</div>
</section>
<section id="caso-real-aemet-7" class="slide level2">
<h2>Caso real: AEMET</h2>
<p>Por ejemplo, en los datos tenemos solo hasta el 31 de agosto de 2024: <span class="hl-purple"><strong>¬øcu√°l es la predicci√≥n de los distintos m√©todos para lo que queda de 2024 y 2025?</strong></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb331" data-code-line-numbers="1,6,9,13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1"></a>nuevos_valores <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as_date</span>(<span class="st">"2024-09-01"</span>), <span class="fu">as_date</span>(<span class="st">"2025-12-31"</span>), <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb331-2"><a href="#cb331-2"></a></span>
<span id="cb331-3"><a href="#cb331-3"></a>retiro_predict <span class="ot">&lt;-</span></span>
<span id="cb331-4"><a href="#cb331-4"></a>  <span class="fu">estim_ts_trend_error</span>(retiro[, <span class="fu">c</span>(<span class="st">"fecha"</span>, <span class="st">"tmed"</span>)], <span class="at">degree =</span> <span class="dv">0</span>,</span>
<span id="cb331-5"><a href="#cb331-5"></a>                       <span class="at">col_t =</span> <span class="st">"fecha"</span>, <span class="at">col_X_t =</span> <span class="st">"tmed"</span>,</span>
<span id="cb331-6"><a href="#cb331-6"></a>                       <span class="at">nuevos_valores =</span> nuevos_valores) <span class="sc">|&gt;</span> </span>
<span id="cb331-7"><a href="#cb331-7"></a>  <span class="fu">left_join</span>(<span class="fu">estim_ts_trend_error</span>(retiro[, <span class="fu">c</span>(<span class="st">"fecha"</span>, <span class="st">"tmed"</span>)], <span class="at">degree =</span> <span class="dv">1</span>,</span>
<span id="cb331-8"><a href="#cb331-8"></a>                                 <span class="at">col_t =</span> <span class="st">"fecha"</span>, <span class="at">col_X_t =</span> <span class="st">"tmed"</span>,</span>
<span id="cb331-9"><a href="#cb331-9"></a>                                 <span class="at">nuevos_valores =</span> nuevos_valores),</span>
<span id="cb331-10"><a href="#cb331-10"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"t"</span>, <span class="st">"X_t"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb331-11"><a href="#cb331-11"></a>  <span class="fu">left_join</span>(<span class="fu">estim_ts_trend_error</span>(retiro[, <span class="fu">c</span>(<span class="st">"fecha"</span>, <span class="st">"tmed"</span>)], <span class="at">degree =</span> <span class="dv">3</span>,</span>
<span id="cb331-12"><a href="#cb331-12"></a>                                 <span class="at">col_t =</span> <span class="st">"fecha"</span>, <span class="at">col_X_t =</span> <span class="st">"tmed"</span>,</span>
<span id="cb331-13"><a href="#cb331-13"></a>                                 <span class="at">nuevos_valores =</span> nuevos_valores),</span>
<span id="cb331-14"><a href="#cb331-14"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"t"</span>, <span class="st">"X_t"</span>))</span>
<span id="cb331-15"><a href="#cb331-15"></a>retiro_predict<span class="sc">$</span>estim_noise <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># f√≠jate que el ruido la predicci√≥n es...0</span></span>
<span id="cb331-16"><a href="#cb331-16"></a></span>
<span id="cb331-17"><a href="#cb331-17"></a>retiro_predict_tidy <span class="ot">&lt;-</span></span>
<span id="cb331-18"><a href="#cb331-18"></a>  retiro_predict <span class="sc">|&gt;</span> </span>
<span id="cb331-19"><a href="#cb331-19"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>t, <span class="at">names_to =</span> <span class="st">"serie"</span>, <span class="at">values_to =</span> <span class="st">"X_t"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="caso-real-aemet-8" class="slide level2">
<h2>Caso real: AEMET</h2>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1"></a><span class="co"># filtro un poco para que se vea mejor</span></span>
<span id="cb332-2"><a href="#cb332-2"></a><span class="fu">ggplot</span>(retiro_predict_tidy <span class="sc">|&gt;</span> </span>
<span id="cb332-3"><a href="#cb332-3"></a>         <span class="fu">filter</span>(t <span class="sc">&gt;</span> <span class="fu">as_date</span>(<span class="st">"2015-01-01"</span>))) <span class="sc">+</span></span>
<span id="cb332-4"><a href="#cb332-4"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t, <span class="at">color =</span> serie,</span>
<span id="cb332-5"><a href="#cb332-5"></a>                <span class="at">linewidth =</span> serie, <span class="at">alpha =</span> serie, <span class="at">linetype =</span> serie)) <span class="sc">+</span></span>
<span id="cb332-6"><a href="#cb332-6"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">max</span>(retiro<span class="sc">$</span>fecha), <span class="at">linetype =</span> <span class="st">"twodash"</span>, <span class="at">color =</span> <span class="st">"#a61d0f"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">linewidth =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb332-7"><a href="#cb332-7"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_colorblind</span>() <span class="sc">+</span></span>
<span id="cb332-8"><a href="#cb332-8"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fl">0.85</span>, <span class="fl">0.85</span>, <span class="fl">0.85</span>, <span class="fl">0.85</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb332-9"><a href="#cb332-9"></a>  <span class="fu">scale_linewidth_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb332-10"><a href="#cb332-10"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dotted"</span>, <span class="st">"dotted"</span>, <span class="st">"dotted"</span>, <span class="st">"dotted"</span>, <span class="st">"solid"</span>)) <span class="sc">+</span></span>
<span id="cb332-11"><a href="#cb332-11"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb332-12"><a href="#cb332-12"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"t"</span>, <span class="at">y =</span> <span class="st">"Temperatura (¬∫C)"</span>, <span class="at">title =</span> <span class="st">"Predicci√≥n serie AEMET"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-213-1.png" width="960" class="r-stretch"></section>
<section id="tendencia-din√°mica" class="slide level2">
<h2>Tendencia ¬´din√°mica¬ª</h2>
<p>El problema del ajuste anterior es que, am√©n de la parte puramente estoc√°stica y la tendencia (m√°s o menos compleja que pueda tener), <span class="hl-yellow"><strong>existe una parte ESTACIONAL</strong></span></p>
<div class="fragment">
<p>Diremos que una serie tiene una <span class="hl-yellow"><strong>componente estacional</strong></span> siempre que presente un <span class="hl-yellow"><strong>patr√≥n que se repite en periodos (aprox.) fijos en el tiempo</strong></span> tal que</p>
<p><span class="math display">\[X_t = f \left(\mu_t, S_t, \varepsilon_t\right) =^{adit} \mu_t + S_t + \varepsilon_t, \quad X_t =^{mult} \mu_t * S_t * \varepsilon_t\]</span></p>
</div>
<div class="fragment">
<p>Trataremos de <strong>manera general con los modelos aditivos</strong> ya que, en caso de ser multiplicativo, <span class="math inline">\(\log \left(X_t\right) =\log \left( \mu_t \right) + \log \left(S_t \right) + \log \left( \varepsilon_t \right)\)</span></p>
</div>
</section>
<section id="medias-m√≥viles" class="slide level2">
<h2>Medias m√≥viles</h2>
<p>Existen diferentes estrategias para tener en cuenta la estacionalidad, muchas de ellas basadas en la idea de considerar que la <span class="hl-yellow"><strong>tendencia no es algo est√°tico</strong></span></p>
<div class="fragment">
<div class="columns">
<div class="column" style="width:35%;">
<p>La m√°s famosa (y sencilla) probablemente sea la idea de <span class="hl-yellow"><strong>suavizado de medias m√≥viles</strong></span>: en lugar de suavizar la serie considerando una media global, vamos <span class="hl-yellow"><strong>mirar la serie por una peque√±a ventana</strong></span> donde para cada <span class="math inline">\(t\)</span> solo observemos un peque√±o trozo de la serie.</p>
</div><div class="column" style="width:65%;">
<p><img data-src="img/window-ma.webp"></p>
</div>
</div>
</div>
</section>
<section id="medias-m√≥viles-1" class="slide level2">
<h2>Medias m√≥viles</h2>
<p>Imagina que tenemos la siguiente serie</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb333"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb333-1"><a href="#cb333-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>,</span>
<span id="cb333-2"><a href="#cb333-2"></a>                <span class="st">"x"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">1.3</span>, <span class="fl">1.6</span>, <span class="fl">1.5</span>, <span class="fl">2.2</span>, <span class="fl">2.3</span>, <span class="fl">2.2</span>, <span class="fl">2.4</span>,</span>
<span id="cb333-3"><a href="#cb333-3"></a>                        <span class="dv">2</span>, <span class="fl">1.5</span>, <span class="fl">1.2</span>, <span class="fl">1.3</span>, <span class="fl">1.2</span>, <span class="dv">1</span>, <span class="fl">0.7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="index_files/figure-revealjs/unnamed-chunk-215-1.png" width="960" class="r-stretch"></section>
<section id="medias-m√≥viles-2" class="slide level2">
<h2>Medias m√≥viles</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb334"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>,</span>
<span id="cb334-2"><a href="#cb334-2"></a>                <span class="st">"x"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">1.3</span>, <span class="fl">1.6</span>, <span class="fl">1.5</span>, <span class="fl">2.2</span>, <span class="fl">2.3</span>, <span class="fl">2.2</span>, <span class="fl">2.4</span>,</span>
<span id="cb334-3"><a href="#cb334-3"></a>                        <span class="dv">2</span>, <span class="fl">1.5</span>, <span class="fl">1.2</span>, <span class="fl">1.3</span>, <span class="fl">1.2</span>, <span class="dv">1</span>, <span class="fl">0.7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La idea de las <span class="hl-yellow"><strong>medias m√≥viles</strong></span> es la siguiente:</p>
<div class="fragment">
<ol type="1">
<li>Decide la <span class="hl-yellow"><strong>anchura de tu ventana</strong></span> (cuantos datos permites que entren), por ejemplo <span class="math inline">\(5\)</span>.</li>
</ol>
</div>
<div class="fragment">
<ol start="2" type="1">
<li>Decide qu√© <span class="hl-yellow"><strong>peso vas a asignar</strong></span> a cada uno de los puntos (por ejemplo, <span class="math inline">\(1/5\)</span> en nuestro caso)</li>
</ol>
</div>
<div class="fragment">
<ol start="3" type="1">
<li><span class="hl-yellow"><strong>Avanza en la serie con tu ventana</strong></span> en cada valor de <span class="math inline">\(t\)</span> y centra la ventana en cada punto (si lo tenemos)</li>
</ol>
</div>
</section>
<section id="medias-m√≥viles-3" class="slide level2">
<h2>Medias m√≥viles</h2>
<p><span class="math inline">\(y_1 = \color{red}{x_1}\)</span></p>
<div class="fragment">
<p><span class="math inline">\(y_2 = \frac{x_1 + \color{red}{x_2} + x_3}{3}\)</span></p>
</div>
<div class="fragment">
<p><span class="math inline">\(y_3 = \frac{x_1 + x_2 + \color{red}{x_3} + x_4 + x_5}{5}\)</span></p>
</div>
<div class="fragment">
<p><span class="math inline">\(y_4 = \frac{x_2 + x_3 + \color{red}{x_4} + x_5 + x_6}{5}\)</span></p>
</div>
<div class="fragment">
<p><span class="math inline">\(y_5 = \frac{x_3 + x_4 + \color{red}{x_5} + x_6 + x_7}{5}\)</span></p>
</div>
<div class="fragment">
<p><span class="math inline">\(y_6 = \frac{x_4 + x_5 + \color{red}{x_6} + x_7 + x_8}{5}\)</span></p>
</div>
<div class="fragment">
<p><span class="math inline">\(y_7 = \frac{x_5 + x_6 + \color{red}{x_7} + x_8 + x_9}{5}\)</span></p>
</div>
<div class="fragment">
<p>En general llamaremos <span class="hl-yellow"><strong>media m√≥vil</strong></span> a la tranformaci√≥n <strong>lineal</strong></p>
<p><span class="math display">\[y_t = \sum_{r = -q}^{s} a_r x_{t+r}, \quad t = q + 1, \ldots, n-s, \quad \sum_{r = -q}^{s} a_r = 1\]</span></p>
</div>
</section>
<section id="medias-m√≥viles-4" class="slide level2">
<h2>Medias m√≥viles</h2>
<p><span class="math display">\[y_t = \sum_{r = -q}^{s} a_r x_{t+r}, \quad t = q + 1, \ldots, n-s, \quad \sum_{r = -q}^{s} a_r = 1\]</span></p>
<p>La transformaci√≥n es una <span class="hl-yellow"><strong>media ponderada</strong></span> de <span class="math inline">\(q + s + 1\)</span> valores donde, seg√∫n avanzamos, se <strong>elimina el dato m√°s antiguo y entra el m√°s nuevo</strong></p>
<div class="fragment">
<ul>
<li>Si los <span class="hl-purple"><strong>pesos son todos iguales</strong></span> <span class="math inline">\(a_j = \frac{1}{N}\)</span>, con <span class="math inline">\(N = q+s+1\)</span>, se conoce como <strong>media m√≥vil de orden N</strong>.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Si <span class="math inline">\(q = s\)</span> tal que <span class="math inline">\(a_{-j} = a_j\)</span>, para todo <span class="math inline">\(j=1,\ldots,q\)</span> tal que <span class="math inline">\(k = 2*q + 1\)</span>, se conoce como <span class="hl-yellow"><strong>k MA (moving average sim√©trica)</strong></span></li>
</ul>
</div>
<div class="fragment">
<ul>
<li>El problema de determinar los primeros/√∫ltimos valores se conoce como <span class="hl-yellow"><strong>problema de los efectos terminales</strong></span></li>
</ul>
</div>
</section>
<section id="medias-m√≥viles-5" class="slide level2">
<h2>Medias m√≥viles</h2>
<p>Para calcular una <span class="hl-yellow"><strong>media m√≥vil de orden <span class="math inline">\(k=2*q+1\)</span></strong></span> en <code>R</code> podemos hacerlo con <code>filter()</code> del paquete <code>{stats}</code> teniendo la variable ya <strong>ordenada</strong> (<span class="hl-red"><strong>¬°cuidado!</strong></span>: si tienes cargado <code>{tidyverse}</code> debes especificar que <code>filter()</code> es)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb335"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1"></a>k <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb335-2"><a href="#cb335-2"></a>datos<span class="sc">$</span>x_linear <span class="ot">&lt;-</span> <span class="fu">predict</span>(datos <span class="sc">|&gt;</span> <span class="fu">lm</span>(<span class="at">formula =</span> x <span class="sc">~</span> t), datos)</span>
<span id="cb335-3"><a href="#cb335-3"></a></span>
<span id="cb335-4"><a href="#cb335-4"></a>datos <span class="ot">&lt;-</span> datos[<span class="fu">order</span>(datos<span class="sc">$</span>t), ]</span>
<span id="cb335-5"><a href="#cb335-5"></a>datos<span class="sc">$</span>x_smooth_3ma <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">filter</span>(datos<span class="sc">$</span>x, <span class="at">filter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span>k, k))</span>
<span id="cb335-6"><a href="#cb335-6"></a>datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 √ó 4
       t     x x_linear x_smooth_3ma
   &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;
 1     1   0.8     1.80       NA    
 2     2   1.3     1.76        1.23 
 3     3   1.6     1.73        1.47 
 4     4   1.5     1.69        1.77 
 5     5   2.2     1.65        2    
 6     6   2.3     1.62        2.23 
 7     7   2.2     1.58        2.3  
 8     8   2.4     1.55        2.2  
 9     9   2       1.51        1.97 
10    10   1.5     1.47        1.57 
11    11   1.2     1.44        1.33 
12    12   1.3     1.40        1.23 
13    13   1.2     1.37        1.17 
14    14   1       1.33        0.967
15    15   0.7     1.29       NA    </code></pre>
</div>
</div>
</section>
<section id="medias-m√≥viles-6" class="slide level2">
<h2>Medias m√≥viles</h2>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb337"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1"></a><span class="fu">ggplot</span>(datos <span class="sc">|&gt;</span></span>
<span id="cb337-2"><a href="#cb337-2"></a>         <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>t, <span class="at">names_to =</span> <span class="st">"var"</span>, <span class="at">values_to =</span> <span class="st">"values"</span>)) <span class="sc">+</span></span>
<span id="cb337-3"><a href="#cb337-3"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> values, <span class="at">color =</span> var, <span class="at">linetype =</span> var),</span>
<span id="cb337-4"><a href="#cb337-4"></a>            <span class="at">linewidth =</span> <span class="fl">0.9</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb337-5"><a href="#cb337-5"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_colorblind</span>() <span class="sc">+</span></span>
<span id="cb337-6"><a href="#cb337-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-218-1.png" width="960" class="r-stretch"><p>F√≠jate c√≥mo ahora la curva queda <span class="hl-yellow"><strong>suavizada pero de manera din√°mica</strong></span></p>
</section>
<section id="medias-m√≥viles-7" class="slide level2">
<h2>Medias m√≥viles</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1"></a>datos<span class="sc">$</span>x_smooth_5ma <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">filter</span>(datos<span class="sc">$</span>x, <span class="at">filter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb338-2"><a href="#cb338-2"></a>datos<span class="sc">$</span>x_smooth_7ma <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">filter</span>(datos<span class="sc">$</span>x, <span class="at">filter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">7</span>, <span class="dv">7</span>))</span>
<span id="cb338-3"><a href="#cb338-3"></a>datos<span class="sc">$</span>x_smooth_9ma <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">filter</span>(datos<span class="sc">$</span>x, <span class="at">filter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">9</span>, <span class="dv">9</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div class="column" style="width:25%;">
<p>F√≠jate que <span class="hl-green"><strong>cuando aumenta <span class="math inline">\(k\)</span>, la serie es m√°s suavizada</strong></span> (m√°s agresiva con las fluctuaciones) pero <span class="hl-red"><strong>hay m√°s datos ausentes</strong></span> (problema de efectos terminales)</p>
</div><div class="column" style="width:75%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb339"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb339-1"><a href="#cb339-1"></a><span class="fu">ggplot</span>(datos <span class="sc">|&gt;</span></span>
<span id="cb339-2"><a href="#cb339-2"></a>         <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>t, <span class="at">names_to =</span> <span class="st">"var"</span>, <span class="at">values_to =</span> <span class="st">"values"</span>)) <span class="sc">+</span></span>
<span id="cb339-3"><a href="#cb339-3"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> values, <span class="at">color =</span> var),</span>
<span id="cb339-4"><a href="#cb339-4"></a>            <span class="at">linewidth =</span> <span class="fl">0.9</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb339-5"><a href="#cb339-5"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_colorblind</span>() <span class="sc">+</span></span>
<span id="cb339-6"><a href="#cb339-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-220-1.png" width="960"></p>
</div>
</div>
</div>
</div>
</section>
<section id="tu-turno-6-1" class="slide level2">
<h2>üíª Tu turno</h2>
<h3 id="ejercicio-1-5"><span class="hl-yellow"><strong>Ejercicio 1</strong></span></h3>
<p>üíª Realiza una estimaci√≥n de la serie aplicando el suavizado de medias m√≥viles con par√°metro <span class="math inline">\(k=7, 14, 28, 365\)</span> a los datos AEMET e incluye las 4 nuevas columnas con los 4 nuevos m√©todos de estimaci√≥n al conjunto <code>retiro_estim</code> que ten√≠amos de clases anteriores. Importante: la serie que le pases a <code>stats::filter()</code> no puede tener ausentes.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb340"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1"></a><span class="co"># versi√≥n tidyverse (en R base tabla$variable_nueva &lt;- valor)</span></span>
<span id="cb340-2"><a href="#cb340-2"></a>retiro_estim <span class="ot">&lt;-</span></span>
<span id="cb340-3"><a href="#cb340-3"></a>  retiro_estim <span class="sc">|&gt;</span>  <span class="fu">drop_na</span>(X_t) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(t) <span class="sc">|&gt;</span> </span>
<span id="cb340-4"><a href="#cb340-4"></a>  <span class="fu">mutate</span>(<span class="at">x_smooth_7ma =</span> stats<span class="sc">::</span><span class="fu">filter</span>(X_t, <span class="at">filter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">7</span>, <span class="dv">7</span>)),</span>
<span id="cb340-5"><a href="#cb340-5"></a>         <span class="at">x_smooth_14ma =</span> stats<span class="sc">::</span><span class="fu">filter</span>(X_t, <span class="at">filter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">14</span>, <span class="dv">14</span>)),</span>
<span id="cb340-6"><a href="#cb340-6"></a>         <span class="at">x_smooth_28ma =</span> stats<span class="sc">::</span><span class="fu">filter</span>(X_t, <span class="at">filter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">28</span>, <span class="dv">28</span>)),</span>
<span id="cb340-7"><a href="#cb340-7"></a>         <span class="at">x_smooth_365ma =</span> stats<span class="sc">::</span><span class="fu">filter</span>(X_t, <span class="at">filter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">365</span>, <span class="dv">365</span>)))</span>
<span id="cb340-8"><a href="#cb340-8"></a></span>
<span id="cb340-9"><a href="#cb340-9"></a><span class="fu">ggplot</span>(retiro_estim <span class="sc">|&gt;</span></span>
<span id="cb340-10"><a href="#cb340-10"></a>         <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(fecha, t), <span class="at">names_to =</span> <span class="st">"type"</span>, <span class="at">values_to =</span> <span class="st">"pred"</span>) <span class="sc">|&gt;</span></span>
<span id="cb340-11"><a href="#cb340-11"></a>         <span class="fu">filter</span>(<span class="fu">between</span>(fecha, <span class="fu">as_date</span>(<span class="st">"2016-01-01"</span>), <span class="fu">as_date</span>(<span class="st">"2022-01-01"</span>)))) <span class="sc">+</span></span>
<span id="cb340-12"><a href="#cb340-12"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fecha, <span class="at">y =</span> pred, <span class="at">color =</span> type),</span>
<span id="cb340-13"><a href="#cb340-13"></a>            <span class="at">linewidth =</span> <span class="fl">0.7</span>, <span class="at">alpha =</span> <span class="fl">0.85</span>) <span class="sc">+</span></span>
<span id="cb340-14"><a href="#cb340-14"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_colorblind</span>() <span class="sc">+</span></span>
<span id="cb340-15"><a href="#cb340-15"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb340-16"><a href="#cb340-16"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Temperatura media como SERIE TEMPORAL"</span>,</span>
<span id="cb340-17"><a href="#cb340-17"></a>       <span class="at">x =</span> <span class="st">"t (fecha)"</span>, <span class="at">y =</span> <span class="st">"¬∫C (media)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section>
<section>
<section id="clase-7" class="title-slide slide level1 center">
<h1>Clase 7: <span class="flow">estacionalidad</span></h1>
<p><span style="color:#444442;"><strong>Introduciendo y estimando la componente estacional</strong></span></p>
<ul>
<li><a href="#/tu-turno-7-1">üíª Ejercicios</a></li>
<li><a href="#/planificacion">üìÜ Planificaci√≥n</a></li>
</ul>
</section>
<section id="componente-estacional" class="slide level2">
<h2>Componente estacional</h2>
<p>El problema todos los ajuste anteriores es que <span class="hl-yellow"><strong>existe una parte ESTACIONAL</strong></span> que estamos ignorandome deliberadamente. Diremos que una serie tiene una <span class="hl-yellow"><strong>componente estacional <span class="math inline">\(S_t\)</span></strong></span> siempre que presente un <span class="hl-yellow"><strong>patr√≥n que se repite en periodos (aprox.) fijos en el tiempo</strong></span> tal que</p>
<p><span class="math display">\[X_t = f \left(\mu_t, S_t, \varepsilon_t\right) =^{adit} \mu_t + S_t + \varepsilon_t, \quad X_t =^{mult} \mu_t * S_t * \varepsilon_t\]</span></p>
<div class="fragment">
<p>Trataremos de <strong>manera general con los modelos aditivos</strong> ya que, en caso de ser multiplicativo, <span class="math inline">\(\log \left(X_t\right) =\log \left( \mu_t \right) + \log \left(S_t \right) + \log \left( \varepsilon_t \right)\)</span></p>
</div>
<div class="fragment">
<p>F√≠jate que ahora <span class="math inline">\({\rm E} \left[X_t \right] = \mu_t + S_t\)</span> y por tanto nuestra <span class="hl-yellow"><strong>estimaci√≥n muestral</strong></span> vendr√° definida como</p>
<p><span class="math display">\[\widehat{X}_t = \widehat{\mu}_t + \widehat{S}_t\]</span></p>
</div>
<div class="fragment">
<p><span class="hl-purple"><strong>¬øQu√© significa que <span class="math inline">\(S_t\)</span> estacional (o peri√≥dico)?</strong></span></p>
</div>
</section>
<section id="componente-estacional-1" class="slide level2">
<h2>Componente estacional</h2>
<p>En general, diremos que una funci√≥n <span class="hl-yellow"><strong><span class="math inline">\(S_t := S(t)\)</span> es estacional (o peri√≥dica) de periodo <span class="math inline">\(s\)</span></strong></span> siempre que <span class="math inline">\(S_t = S_{t + s} = S_{t + 2s}\)</span>: si es estacional de <strong>periodo <span class="math inline">\(s\)</span></strong> significa que, cada <span class="math inline">\(s\)</span> valores, la funci√≥n se repite.</p>
<div class="fragment">
<p>F√≠jate que si <span class="math inline">\(S_t = S_{t + s}\)</span> tambi√©n entonces sucede que <span class="math inline">\(S_t = S_{t - s}\)</span>.</p>
</div>
<div class="fragment">
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Importante</strong></p>
</div>
<div class="callout-content">
<p>Es importante entender que determinar el <strong>periodo</strong> no es solo determinar si es ¬´anual¬ª o ¬´mensual¬ª: el valor <span class="math inline">\(s\)</span> es el <span class="hl-yellow"><strong>n√∫mero de valores de la componente <span class="math inline">\(S_t\)</span> que pasan hasta que se repita</strong></span>. Por ejemplo, una serie puede tener una periodicidad anual pero si los datos son recogidos de manera trimestral, <span class="math inline">\(s = 4\)</span>; la misma periodicidad para unos datos recogidos de manera diaria ser√° <span class="math inline">\(s = 365\)</span>.</p>
<p>En el caso de los datos del AEMET, <span class="math inline">\(s = 365\)</span>, no solo porque la temperatura tengan una periodicidad anual obviamente, sino porque los <strong>datos son diarios</strong> (la misma variable, recogida de manera mensual, tendr√≠a <span class="math inline">\(s = 12\)</span>).</p>
</div>
</div>
</div>
</div>
</section>
<section id="componente-estacional-2" class="slide level2">
<h2>Componente estacional</h2>
<p>¬øC√≥mo <span class="hl-yellow"><strong>estimar dicha componente estacional</strong></span>? Los <span class="hl-yellow"><strong>m√©todos de descomposici√≥n cl√°sica</strong></span> tienen la siguiente estructura:</p>
<ol type="1">
<li><span class="hl-purple"><strong>Estimaci√≥n de la tendencia</strong></span>. Dada la serie original <span class="math inline">\(X_t\)</span> se realiza una estimaci√≥n de su nivel o tendencia <span class="math inline">\(\mu_t\)</span>. Como hemos visto tenemos distintas alternativas:</li>
</ol>
<ul>
<li><strong>medias m√≥viles</strong> (ser√° clave <strong>determinar la ventana <span class="math inline">\(k\)</span></strong>)</li>
<li>tendencia polin√≥mica</li>
<li>regresi√≥n local (conocida como <span class="hl-yellow"><strong>regresi√≥n LOESS o LOWESS</strong></span>: ajusta a los datos una <strong>regresi√≥n polin√≥mica pero de manera LOCAL</strong>, en cada punto solo se utiliza un % de los datos). Ver <a href="https://www.statology.org/lowess-smoothing-r/" class="uri">https://www.statology.org/lowess-smoothing-r/</a></li>
</ul>
<div class="fragment">
<p>Tras estimar la tendencia se construye la <span class="hl-yellow"><strong>serie centrada</strong></span></p>
<p><span class="math display">\[Y_t = X_t - \mu_t = S_t + \varepsilon_t, \quad \hat{Y}_t = X_t - \hat{\mu}_t\]</span></p>
</div>
</section>
<section id="componente-estacional-3" class="slide level2">
<h2>Componente estacional</h2>
<p><span class="math display">\[Y_t = X_t - \mu_t = S_t + \varepsilon_t, \quad \hat{Y}_t = X_t - \hat{\mu}_t\]</span></p>
<p>F√≠jate que <span class="math inline">\(\hat{Y}_t\)</span> es ya una serie sin tendencia, y cuyos <span class="hl-yellow"><strong>valores ya no representan la serie original sino la anomal√≠a</strong></span> que tendr√≠a cada <span class="math inline">\(t\)</span> respecto al nivel global (en el caso de las temperaturas, por ejemplo la anomal√≠a promedio de temperatura entre los distintos d√≠as del a√±o y el nivel general de la serie).</p>
<div class="fragment">
<ol start="2" type="1">
<li><span class="hl-purple"><strong>Estimar los coeficientes estacionales</strong></span>. El objetivo ser√° obtener un conjunto de <span class="math inline">\(s\)</span> coeficientes <span class="math inline">\(\left(S_1, S_2, \ldots, S_{s-2}, S_{s-1}, S_s \right)\)</span> que cumplir√°n por definici√≥n dos condiciones:</li>
</ol>
<ul>
<li><p>Se repiten cada <span class="math inline">\(s\)</span> valores (por solo necesitamos estimar un tramo).</p></li>
<li><p>Su suma es cero (ya que representan las anomal√≠as respecto al nivel general, por lo que si hay valores por encima tienen que existir por debajo)</p></li>
</ul>
</div>
</section>
<section id="componente-estacional-4" class="slide level2">
<h2>Componente estacional</h2>
<ol start="2" type="1">
<li><span class="hl-purple"><strong>Estimar los coeficientes estacionales</strong></span>. El objetivo ser√° obtener un conjunto de <span class="math inline">\(s\)</span> coeficientes <span class="math inline">\(\left(S_1, S_2, \ldots, S_{s-2}, S_{s-1}, S_s \right)\)</span>.</li>
</ol>
<p>Para su estimaci√≥n lo que haremos ser√° calcular, con la serie centrada, la <span class="hl-yellow"><strong>diferencia entre la media de cada periodo estacional</strong></span> y la <strong>media general</strong></p>
<p><span class="math display">\[\widehat{S}_j = \overline{Y}_j - \overline{Y}, \quad \overline{Y}_j = \frac{1}{n} \sum_{i=1}^{n} Y_{s*i + j}, \quad \overline{Y} = \frac{1}{T} \sum_{i=0}^{n-1} \sum_{j=1}^{s} Y_{s*i + j}, \quad j = 1, \ldots, s\]</span></p>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Datos AEMET</strong></p>
</div>
<div class="callout-content">
<p>En el <strong>caso del AEMET</strong>: <span class="math inline">\(\widehat{Y}_j\)</span> representa la media (de la serie centrada) de todos los d√≠as <span class="math inline">\(j=1, \ldots, 365\)</span>, es decir, la media de los 1-enero, sin importar el a√±o; de los 2-enero, ‚Ä¶, de los 31-diciembre (la anomal√≠a de temperatura que en promedio hace el 1-enero respecto a la tendencia general, y as√≠ para cada d√≠a del a√±o). En este caso <span class="math inline">\(n = 45\)</span> ya que tenemos datos de 45 a√±os (salvo el final de 2024).</p>
</div>
</div>
</div>
</section>
<section id="componente-estacional-5" class="slide level2">
<h2>Componente estacional</h2>
<ol start="3" type="1">
<li><span class="hl-purple"><strong>Estimar las innovaciones</strong></span>. Una vez estimada la tendencia y estacionalidad</li>
</ol>
<p><span class="math display">\[\widehat{\varepsilon}_t = X_t - \widehat{X}_t, \quad \widehat{X}_t = \widehat{\mu}_t + \widehat{S}_t\]</span></p>
<div class="fragment">
<p>F√≠jate que la componente estacional estimada cumple tambi√©n que <span class="math inline">\(\widehat{S}_t = \widehat{S}_{t + s}\)</span>, es decir, <strong>solo necesitamos <span class="math inline">\(s\)</span> coeficientes estimados</strong> (f√≠jate en el sub√≠ndice del <span class="math inline">\(\hat{S}\)</span>)</p>
<p><span class="math display">\[\widehat{\varepsilon}_{s*i + j} = X_{s*i + j} - \widehat{X}_{s*i + j}, \quad \widehat{X}_{s*i + j}= \widehat{\mu}_{s*i + j} + \widehat{S}_j, \quad j = 1,\ldots,s\]</span></p>
</div>
<div class="fragment">
<ul>
<li><p><span class="math inline">\(\widehat{Y}_t\)</span> representa la <span class="hl-green"><strong>estimaci√≥n de la serie centrada</strong></span>: lo que falta <span class="hl-yellow"><strong>por modelizar es componente estacional</strong></span></p></li>
<li><p><span class="math inline">\(X_t - \widehat{S}_t\)</span> representa la <span class="hl-green"><strong>estimaci√≥n de la serie DESESTACIONALIZADA</strong></span>: lo que falta <span class="hl-yellow"><strong>por modelizar es tendencia sin tener en cuenta el efecto estacional</strong></span> (ejemplo: tasa de paro sin el efecto que tienen periodos como verano o navidad)</p></li>
</ul>
</div>
</section>
<section id="algunas-observaciones" class="slide level2">
<h2>Algunas observaciones</h2>
<div class="callout callout-warning callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Cuidado</strong></p>
</div>
<div class="callout-content">
<p>El m√©todo descrito se conoce <span class="hl-yellow"><strong>m√©todo cl√°sico de descomposici√≥n</strong></span> (o STL si se usa una regresi√≥n local para estimar la tendencia en lugar de medias m√≥viles) pero la componente estacional podr√≠a ser tambi√©n estimada por <span class="hl-yellow"><strong>cualquier funci√≥n peri√≥dica o arm√≥nica de periodo <span class="math inline">\(s\)</span></strong></span>, por ejemplo, <span class="math inline">\(sin(\frac{2 \pi t}{s})\)</span>, se repite cada <span class="math inline">\(s\)</span> valores).</p>
</div>
</div>
</div>
<p>&nbsp;</p>
<div class="callout callout-warning callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Cuidado</strong></p>
</div>
<div class="callout-content">
<p>Todo lo anterior tambi√©n est√° dise√±ado bajo la <span class="hl-yellow"><strong>hip√≥tesis de que solo tenemos una periodicidad <span class="math inline">\(s\)</span></strong></span>: nuestra serie podr√≠a tener distintas periodicidades superpuestas (Fourier: toda funci√≥n peri√≥dica puede representarse como suma de funciones seno de distinta frecuencia y amplitud). De momento supondremos siempre un <strong>√∫nico ciclo</strong>.</p>
</div>
</div>
</div>
</section>
<section id="tu-turno-7-1" class="slide level2">
<h2>üíª Tu turno</h2>
<h3 id="ejercicio-1-6"><span class="hl-yellow"><strong>Ejercicio 1</strong></span></h3>
<p>üíª Renombra la funci√≥n de estimaci√≥n de la tendencia polin√≥mica que ya tenemos hecha como <code>estim_ts_trend_poly()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb341"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb341-1"><a href="#cb341-1"></a>estim_ts_trend_poly <span class="ot">&lt;-</span></span>
<span id="cb341-2"><a href="#cb341-2"></a>  <span class="cf">function</span>(datos, <span class="at">degree =</span> <span class="dv">1</span>, <span class="at">tag_estim =</span> <span class="fu">paste0</span>(<span class="st">"estim_poly_"</span>, degree),</span>
<span id="cb341-3"><a href="#cb341-3"></a>           <span class="at">col_t =</span> <span class="st">"t"</span>, <span class="at">col_X_t =</span> <span class="st">"X_t"</span>, <span class="at">nuevos_valores =</span> <span class="cn">NULL</span>) {</span>
<span id="cb341-4"><a href="#cb341-4"></a>    </span>
<span id="cb341-5"><a href="#cb341-5"></a>    <span class="co"># R base normal</span></span>
<span id="cb341-6"><a href="#cb341-6"></a>    datos <span class="ot">&lt;-</span> datos[, <span class="fu">c</span>(col_t, col_X_t)]</span>
<span id="cb341-7"><a href="#cb341-7"></a>    <span class="fu">names</span>(datos)[<span class="fu">names</span>(datos) <span class="sc">==</span> col_t] <span class="ot">&lt;-</span> <span class="st">"t"</span></span>
<span id="cb341-8"><a href="#cb341-8"></a>    <span class="fu">names</span>(datos)[<span class="fu">names</span>(datos) <span class="sc">==</span> col_X_t] <span class="ot">&lt;-</span> <span class="st">"X_t"</span></span>
<span id="cb341-9"><a href="#cb341-9"></a></span>
<span id="cb341-10"><a href="#cb341-10"></a>    <span class="cf">if</span> (degree <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb341-11"><a href="#cb341-11"></a>      modelo <span class="ot">&lt;-</span> datos <span class="sc">|&gt;</span> <span class="fu">lm</span>(<span class="at">formula =</span> X_t <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb341-12"><a href="#cb341-12"></a>    } <span class="cf">else</span> {</span>
<span id="cb341-13"><a href="#cb341-13"></a>      modelo <span class="ot">&lt;-</span> datos <span class="sc">|&gt;</span> <span class="fu">lm</span>(<span class="at">formula =</span> X_t <span class="sc">~</span> <span class="fu">poly</span>(t, degree, <span class="at">raw =</span> <span class="cn">TRUE</span>))</span>
<span id="cb341-14"><a href="#cb341-14"></a>    }</span>
<span id="cb341-15"><a href="#cb341-15"></a>    datos[, tag_estim] <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo, <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> datos<span class="sc">$</span>t))</span>
<span id="cb341-16"><a href="#cb341-16"></a>    </span>
<span id="cb341-17"><a href="#cb341-17"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(nuevos_valores)) {</span>
<span id="cb341-18"><a href="#cb341-18"></a>      nuevos_datos <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> nuevos_valores, <span class="st">"X_t"</span> <span class="ot">=</span> <span class="cn">NA</span>)</span>
<span id="cb341-19"><a href="#cb341-19"></a>      nuevos_datos[, tag_estim] <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo, <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> nuevos_datos<span class="sc">$</span>t))</span>
<span id="cb341-20"><a href="#cb341-20"></a>      datos <span class="ot">&lt;-</span> <span class="fu">rbind</span>(datos, nuevos_datos)</span>
<span id="cb341-21"><a href="#cb341-21"></a>    }</span>
<span id="cb341-22"><a href="#cb341-22"></a>    <span class="fu">return</span>(datos)</span>
<span id="cb341-23"><a href="#cb341-23"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tu-turno-3" class="slide level2">
<h2>üíª Tu turno</h2>
<h3 id="ejercicio-2-5"><span class="hl-yellow"><strong>Ejercicio 2</strong></span></h3>
<p>üíª Dise√±a una funci√≥n general <code>estim_ts_trend()</code> que use <code>estim_ts_trend_poly()</code> que ya tenemos hecha. Dicha funci√≥n debe tener los mismos par√°metros que ten√≠amos en esa funci√≥n con dos argumentos extras: <code>tipo_trend_estim</code> (que haga la polin√≥mica si <code>"poly"</code> y medias m√≥viles si <code>"MA"</code>) y <code>k</code> (la anchura de la ventana; la haremos siempre sim√©trica y con pesos uniformes de momento).</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb342"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1"></a>estim_ts_trend <span class="ot">&lt;-</span> </span>
<span id="cb342-2"><a href="#cb342-2"></a>  <span class="cf">function</span>(datos, <span class="at">degree =</span> <span class="dv">1</span>, <span class="at">k =</span> <span class="cn">NA</span>, <span class="at">tipo_trend_estim =</span> <span class="st">"poly"</span>,</span>
<span id="cb342-3"><a href="#cb342-3"></a>           <span class="at">tag_estim =</span></span>
<span id="cb342-4"><a href="#cb342-4"></a>             <span class="fu">paste0</span>(<span class="st">"estim_"</span>, tipo_trend_estim, <span class="fu">if_else</span>(<span class="fu">is.na</span>(k), degree, k)),</span>
<span id="cb342-5"><a href="#cb342-5"></a>           <span class="at">col_t =</span> <span class="st">"t"</span>, <span class="at">col_X_t =</span> <span class="st">"X_t"</span>, <span class="at">nuevos_valores =</span> <span class="cn">NULL</span>) {</span>
<span id="cb342-6"><a href="#cb342-6"></a>    </span>
<span id="cb342-7"><a href="#cb342-7"></a>    <span class="cf">if</span> (tipo_trend_estim <span class="sc">==</span> <span class="st">"poly"</span>) {</span>
<span id="cb342-8"><a href="#cb342-8"></a>      </span>
<span id="cb342-9"><a href="#cb342-9"></a>      estim <span class="ot">&lt;-</span> <span class="fu">estim_ts_trend_poly</span>(datos, degree, tag_estim,</span>
<span id="cb342-10"><a href="#cb342-10"></a>                                   col_t, col_X_t, nuevos_valores)</span>
<span id="cb342-11"><a href="#cb342-11"></a>    } <span class="cf">else</span> <span class="cf">if</span> (tipo_trend_estim <span class="sc">==</span> <span class="st">"MA"</span>) {</span>
<span id="cb342-12"><a href="#cb342-12"></a>      </span>
<span id="cb342-13"><a href="#cb342-13"></a>      estim <span class="ot">&lt;-</span></span>
<span id="cb342-14"><a href="#cb342-14"></a>        datos <span class="sc">|&gt;</span> </span>
<span id="cb342-15"><a href="#cb342-15"></a>        <span class="fu">select</span>(<span class="fu">all_of</span>(col_t), <span class="fu">all_of</span>(col_X_t)) <span class="sc">|&gt;</span> </span>
<span id="cb342-16"><a href="#cb342-16"></a>        <span class="fu">rename</span>(<span class="at">t =</span> col_t, <span class="at">X_t =</span> col_X_t) <span class="sc">|&gt;</span> </span>
<span id="cb342-17"><a href="#cb342-17"></a>        <span class="co"># hay que ordenar!</span></span>
<span id="cb342-18"><a href="#cb342-18"></a>        <span class="fu">arrange</span>(t) <span class="sc">|&gt;</span> </span>
<span id="cb342-19"><a href="#cb342-19"></a>        <span class="co"># con !! + := le indicamos que el nombre sale de una variable</span></span>
<span id="cb342-20"><a href="#cb342-20"></a>        <span class="co"># (es una t√©cnica llamada lazyeval)</span></span>
<span id="cb342-21"><a href="#cb342-21"></a>        <span class="fu">mutate</span>(<span class="sc">!!</span><span class="at">tag_estim :=</span> </span>
<span id="cb342-22"><a href="#cb342-22"></a>                 stats<span class="sc">::</span><span class="fu">filter</span>(X_t, <span class="at">filter =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span>k, k), <span class="at">sides =</span> <span class="dv">2</span>))</span>
<span id="cb342-23"><a href="#cb342-23"></a></span>
<span id="cb342-24"><a href="#cb342-24"></a>    }</span>
<span id="cb342-25"><a href="#cb342-25"></a>    <span class="fu">return</span>(estim)</span>
<span id="cb342-26"><a href="#cb342-26"></a>  }</span>
<span id="cb342-27"><a href="#cb342-27"></a>temp_retiro <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">"./datos/retiro_temp.csv"</span>)</span>
<span id="cb342-28"><a href="#cb342-28"></a>ejemplo1 <span class="ot">&lt;-</span></span>
<span id="cb342-29"><a href="#cb342-29"></a>  temp_retiro <span class="sc">|&gt;</span> <span class="fu">estim_ts_trend</span>(<span class="at">degree =</span> <span class="dv">1</span>, <span class="at">tipo_trend_estim =</span> <span class="st">"poly"</span>, <span class="at">col_t =</span> <span class="st">"fecha"</span>, <span class="at">col_X_t =</span> <span class="st">"tmed"</span>)</span>
<span id="cb342-30"><a href="#cb342-30"></a>ejemplo2 <span class="ot">&lt;-</span></span>
<span id="cb342-31"><a href="#cb342-31"></a>  temp_retiro <span class="sc">|&gt;</span> <span class="fu">estim_ts_trend</span>(<span class="at">k =</span> <span class="dv">7</span>, <span class="at">tipo_trend_estim =</span> <span class="st">"MA"</span>, <span class="at">col_t =</span> <span class="st">"fecha"</span>, <span class="at">col_X_t =</span> <span class="st">"tmed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="tu-turno-4" class="slide level2">
<h2>üíª Tu turno</h2>
<h3 id="ejercicio-3-5"><span class="hl-yellow"><strong>Ejercicio 3</strong></span></h3>
<p>üíª Dise√±a una funci√≥n <code>ts_detrend()</code> que use <code>estim_ts_trend()</code> que ya tenemos hecha (por lo que tendr√° que tener, m√≠nimo, los mismos par√°metros que ten√≠amos en esa funci√≥n), de manera que dado un conjunto de datos, devuelva una nueva columna con la tendencia estimada (seg√∫n el m√©todo que decidamos) y una nueva columna con la serie centrada</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb343"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb343-1"><a href="#cb343-1"></a>ts_detrend <span class="ot">&lt;-</span> </span>
<span id="cb343-2"><a href="#cb343-2"></a>  <span class="cf">function</span>(datos, <span class="at">degree =</span> <span class="dv">1</span>, <span class="at">k =</span> <span class="cn">NA</span>, <span class="at">tipo_trend_estim =</span> <span class="st">"poly"</span>,</span>
<span id="cb343-3"><a href="#cb343-3"></a>           <span class="at">tag_estim =</span> <span class="fu">paste0</span>(<span class="st">"estim_"</span>, tipo_trend_estim, <span class="fu">if_else</span>(<span class="fu">is.na</span>(k), degree, k)),</span>
<span id="cb343-4"><a href="#cb343-4"></a>           <span class="at">col_t =</span> <span class="st">"t"</span>, <span class="at">col_X_t =</span> <span class="st">"X_t"</span>, <span class="at">nuevos_valores =</span> <span class="cn">NULL</span>) {</span>
<span id="cb343-5"><a href="#cb343-5"></a>    </span>
<span id="cb343-6"><a href="#cb343-6"></a>    estim <span class="ot">&lt;-</span></span>
<span id="cb343-7"><a href="#cb343-7"></a>      <span class="co"># estimamos tendencia</span></span>
<span id="cb343-8"><a href="#cb343-8"></a>      <span class="fu">estim_ts_trend</span>(datos, degree, k, tipo_trend_estim, tag_estim,</span>
<span id="cb343-9"><a href="#cb343-9"></a>                     col_t, col_X_t, nuevos_valores) <span class="sc">|&gt;</span> </span>
<span id="cb343-10"><a href="#cb343-10"></a>      <span class="co"># la llamamos siempre estim_trend</span></span>
<span id="cb343-11"><a href="#cb343-11"></a>      <span class="fu">rename</span>(<span class="at">estim_trend =</span> tag_estim) <span class="sc">|&gt;</span> </span>
<span id="cb343-12"><a href="#cb343-12"></a>      <span class="co"># el tipo de estimaci√≥n lo guardamos en otra variable aparte</span></span>
<span id="cb343-13"><a href="#cb343-13"></a>      <span class="fu">mutate</span>(<span class="st">"tipo_trend_estim"</span> <span class="ot">=</span> tag_estim,</span>
<span id="cb343-14"><a href="#cb343-14"></a>             <span class="co"># calculamos serie centrada</span></span>
<span id="cb343-15"><a href="#cb343-15"></a>             <span class="co"># si es NA, ponemos la media global en la estimaci√≥n de la tendencia</span></span>
<span id="cb343-16"><a href="#cb343-16"></a>             <span class="st">"estim_trend"</span> <span class="ot">=</span></span>
<span id="cb343-17"><a href="#cb343-17"></a>               <span class="fu">if_else</span>(<span class="fu">is.na</span>(estim_trend), <span class="fu">mean</span>(X_t, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), estim_trend),</span>
<span id="cb343-18"><a href="#cb343-18"></a>             <span class="st">"detrend"</span> <span class="ot">=</span> X_t <span class="sc">-</span> estim_trend)</span>
<span id="cb343-19"><a href="#cb343-19"></a>    <span class="fu">return</span>(estim)</span>
<span id="cb343-20"><a href="#cb343-20"></a>  }</span>
<span id="cb343-21"><a href="#cb343-21"></a>ejemplo1 <span class="ot">&lt;-</span> temp_retiro <span class="sc">|&gt;</span> <span class="fu">ts_detrend</span>(<span class="at">degree =</span> <span class="dv">1</span>, <span class="at">col_t =</span> <span class="st">"fecha"</span>, <span class="at">col_X_t =</span> <span class="st">"tmed"</span>)</span>
<span id="cb343-22"><a href="#cb343-22"></a>ejemplo2 <span class="ot">&lt;-</span> temp_retiro <span class="sc">|&gt;</span> <span class="fu">ts_detrend</span>(<span class="at">k =</span> <span class="dv">365</span>, <span class="at">tipo_trend_estim =</span> <span class="st">"MA"</span>, <span class="at">col_t =</span> <span class="st">"fecha"</span>, <span class="at">col_X_t =</span> <span class="st">"tmed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section>
<section>
<section id="clase-8" class="title-slide slide level1 center">
<h1>Clase 8: <span class="flow">practicar con funciones</span></h1>
<p><span style="color:#444442;"><strong>Dise√±o de funciones para nuestra descomposici√≥n</strong></span></p>
<ul>
<li><a href="#/tu-turno-8-1">üíª Ejercicios</a></li>
<li><a href="#/planificacion">üìÜ Planificaci√≥n</a></li>
</ul>
</section>
<section id="tu-turno-8-1" class="slide level2">
<h2>üíª Tu turno</h2>
<h3 id="ejercicio-1-7"><span class="hl-yellow"><strong>Ejercicio 1</strong></span></h3>
<p>üíª Dise√±a una funci√≥n <code>ts_deseason()</code> que, dada una serie cualquiera y un periodo <span class="math inline">\(s\)</span>, nos devuelva una nueva columna con los coeficientes estacionales estimados (con el m√©todo visto anteriormente) y una nueva columna con la serie desestacionalizada. Vas a necesitar darle como argumento no solo el nombre de las columnas donde est√© <span class="math inline">\(t\)</span> y <span class="math inline">\(Y_t\)</span> sino como se llamar√° la variable de grupo que debes crear dentro usando <span class="math inline">\(s\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb344"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb344-1"><a href="#cb344-1"></a>ts_deseason <span class="ot">&lt;-</span> <span class="cf">function</span>(datos, s, col_group, <span class="at">col_t =</span> <span class="st">"t"</span>, <span class="at">col_Y_t =</span> <span class="st">"Y_t"</span>) {</span>
<span id="cb344-2"><a href="#cb344-2"></a>  </span>
<span id="cb344-3"><a href="#cb344-3"></a>  <span class="co"># primero renombramos como siempre y ordenamos</span></span>
<span id="cb344-4"><a href="#cb344-4"></a>  estim <span class="ot">&lt;-</span></span>
<span id="cb344-5"><a href="#cb344-5"></a>    datos <span class="sc">|&gt;</span></span>
<span id="cb344-6"><a href="#cb344-6"></a>    <span class="fu">rename</span>(<span class="at">t =</span> col_t, <span class="at">Y_t =</span> col_Y_t) <span class="sc">|&gt;</span> </span>
<span id="cb344-7"><a href="#cb344-7"></a>    <span class="fu">arrange</span>(t)</span>
<span id="cb344-8"><a href="#cb344-8"></a>  </span>
<span id="cb344-9"><a href="#cb344-9"></a>  <span class="co"># Contruimos variable de grupo</span></span>
<span id="cb344-10"><a href="#cb344-10"></a>  estim <span class="ot">&lt;-</span> </span>
<span id="cb344-11"><a href="#cb344-11"></a>    estim <span class="sc">|&gt;</span></span>
<span id="cb344-12"><a href="#cb344-12"></a>    <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">"id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb344-13"><a href="#cb344-13"></a>    <span class="fu">mutate</span>(<span class="sc">!!</span><span class="at">col_group :=</span> ((id <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%%</span> s) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb344-14"><a href="#cb344-14"></a>    <span class="fu">select</span>(<span class="sc">-</span>id)</span>
<span id="cb344-15"><a href="#cb344-15"></a></span>
<span id="cb344-16"><a href="#cb344-16"></a>  <span class="co"># Estimamos la estacionacionalidad</span></span>
<span id="cb344-17"><a href="#cb344-17"></a>  estim_season <span class="ot">&lt;-</span></span>
<span id="cb344-18"><a href="#cb344-18"></a>    estim <span class="sc">|&gt;</span></span>
<span id="cb344-19"><a href="#cb344-19"></a>    <span class="fu">summarise</span>(<span class="st">"season_coef"</span> <span class="ot">=</span> <span class="fu">mean</span>(Y_t, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.by =</span> col_group) <span class="sc">|&gt;</span></span>
<span id="cb344-20"><a href="#cb344-20"></a>    <span class="fu">mutate</span>(<span class="st">"estim_season"</span> <span class="ot">=</span> season_coef <span class="sc">-</span> <span class="fu">mean</span>(season_coef, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb344-21"><a href="#cb344-21"></a>  </span>
<span id="cb344-22"><a href="#cb344-22"></a>  <span class="co"># Lo √∫nimos a los datos</span></span>
<span id="cb344-23"><a href="#cb344-23"></a>  estim <span class="ot">&lt;-</span> </span>
<span id="cb344-24"><a href="#cb344-24"></a>    estim <span class="sc">|&gt;</span> </span>
<span id="cb344-25"><a href="#cb344-25"></a>    <span class="fu">left_join</span>(estim_season, <span class="at">by =</span> col_group) <span class="sc">|&gt;</span> </span>
<span id="cb344-26"><a href="#cb344-26"></a>    <span class="fu">mutate</span>(<span class="st">"tipo_estim_season"</span> <span class="ot">=</span> <span class="st">"clasica"</span>,</span>
<span id="cb344-27"><a href="#cb344-27"></a>           <span class="st">"deseason"</span> <span class="ot">=</span> Y_t <span class="sc">-</span> estim_season) </span>
<span id="cb344-28"><a href="#cb344-28"></a>  </span>
<span id="cb344-29"><a href="#cb344-29"></a>  <span class="fu">return</span>(estim)</span>
<span id="cb344-30"><a href="#cb344-30"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tu-turno-5" class="slide level2">
<h2>üíª Tu turno</h2>
<h3 id="ejercicio-2-6"><span class="hl-yellow"><strong>Ejercicio 2</strong></span></h3>
<p>üíª Tomando los datos de retiro: a) aplica la funci√≥n <code>ts_detrend()</code> de manera que la tendencia sea estimada con <span class="math inline">\(MA(k = 365)\)</span>; b) a esa tabla apl√≠cale <code>ts_deseason()</code> para estimar <span class="math inline">\(S_t\)</span>, donde la variable de grupo se llama <code>"mes_dia"</code>; c) tras acabar renombra <code>Y_t</code> como <code>detrend</code></p>
</section>
<section id="tu-turno-6" class="slide level2">
<h2>üíª Tu turno</h2>
<h3 id="ejercicio-2-7"><span class="hl-yellow"><strong>Ejercicio 2</strong></span></h3>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb345"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb345-1"><a href="#cb345-1"></a>estim_retiro <span class="ot">&lt;-</span></span>
<span id="cb345-2"><a href="#cb345-2"></a>  temp_retiro <span class="sc">|&gt;</span></span>
<span id="cb345-3"><a href="#cb345-3"></a>  <span class="fu">ts_detrend</span>(<span class="at">k =</span> <span class="dv">365</span>, <span class="at">tipo_trend_estim =</span> <span class="st">"MA"</span>, <span class="at">col_t =</span> <span class="st">"fecha"</span>, <span class="at">col_X_t =</span> <span class="st">"tmed"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb345-4"><a href="#cb345-4"></a>  <span class="fu">mutate</span>(<span class="st">"mes_dia"</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">day</span>(t), <span class="st">"-"</span>, <span class="fu">month</span>(t))) <span class="sc">|&gt;</span></span>
<span id="cb345-5"><a href="#cb345-5"></a>  <span class="fu">ts_deseason</span>(<span class="at">s =</span> <span class="dv">365</span>, <span class="at">col_group =</span> <span class="st">"mes_dia"</span>, <span class="at">col_Y_t =</span> <span class="st">"detrend"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb345-6"><a href="#cb345-6"></a>  <span class="fu">rename</span>(<span class="at">detrend =</span> Y_t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="tu-turno-7" class="slide level2">
<h2>üíª Tu turno</h2>
<h3 id="ejercicio-3-6"><span class="hl-yellow"><strong>Ejercicio 3</strong></span></h3>
<p>üíª Con <code>estim_retiro</code> del ejercicio anterior, calcula una √∫ltima columna que sea la estimaci√≥n total de la serie <code>estim_X_t</code> (estimaci√≥n de la tendencia + estimaci√≥n de la estacionalidad). Tras ello pivota como consideres para poder dibujar en la misma gr√°fica la serie real y la estimaci√≥n</p>
</section>
<section id="tu-turno-8" class="slide level2">
<h2>üíª Tu turno</h2>
<h3 id="ejercicio-3-7"><span class="hl-yellow"><strong>Ejercicio 3</strong></span></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb346"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1"></a>estim_retiro <span class="sc">|&gt;</span> </span>
<span id="cb346-2"><a href="#cb346-2"></a>  <span class="fu">mutate</span>(<span class="st">"estim_X_t"</span> <span class="ot">=</span> estim_trend <span class="sc">+</span> estim_season) <span class="sc">|&gt;</span> </span>
<span id="cb346-3"><a href="#cb346-3"></a>  <span class="co"># solo queremos dos de las curvas</span></span>
<span id="cb346-4"><a href="#cb346-4"></a>  <span class="fu">select</span>(t, X_t, estim_X_t) <span class="sc">|&gt;</span> </span>
<span id="cb346-5"><a href="#cb346-5"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>t, <span class="at">names_to =</span> <span class="st">"serie"</span>, <span class="at">values_to =</span> <span class="st">"X_t"</span>) <span class="sc">|&gt;</span></span>
<span id="cb346-6"><a href="#cb346-6"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb346-7"><a href="#cb346-7"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t, <span class="at">color =</span> serie, <span class="at">alpha =</span> serie)) <span class="sc">+</span></span>
<span id="cb346-8"><a href="#cb346-8"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_colorblind</span>() <span class="sc">+</span></span>
<span id="cb346-9"><a href="#cb346-9"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">0.35</span>)) <span class="sc">+</span></span>
<span id="cb346-10"><a href="#cb346-10"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb346-11"><a href="#cb346-11"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"fecha"</span>, <span class="at">y =</span> <span class="st">"Temperatura (¬∫C)"</span>,</span>
<span id="cb346-12"><a href="#cb346-12"></a>       <span class="at">title =</span> <span class="st">"Estimaci√≥n decomposici√≥n cl√°sica"</span>,</span>
<span id="cb346-13"><a href="#cb346-13"></a>       <span class="at">subtitle =</span> <span class="st">"Tendencia estimada con MA(k = 365)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-227-1.png" width="960" class="r-stretch"></section>
<section id="tu-turno-9" class="slide level2">
<h2>üíª Tu turno</h2>
<h3 id="ejercicio-4-5"><span class="hl-yellow"><strong>Ejercicio 4</strong></span></h3>
<p>üíª Con <code>estim_retiro</code> del ejercicio 2, calcula una √∫ltima columna que sea la estimaci√≥n total de la serie <code>estim_X_t</code> (estimaci√≥n de la tendencia + estimaci√≥n de la estacionalidad) pero ahora selecciona y pivota como consideres para poder hacer luego una visualizaci√≥n de 6 gr√°ficas (por separado pero en el mismo plot): i) la serie real, ii) la estimaci√≥n de la tendencia, iii) la estimaci√≥n de la estacionalidad, iv) la serie sin tendencia, v) la serie sin tendencia ni estacionalidad, vi) la estimaci√≥n</p>
</section>
<section id="tu-turno-10" class="slide level2">
<h2>üíª Tu turno</h2>
<h3 id="ejercicio-4-6"><span class="hl-yellow"><strong>Ejercicio 4</strong></span></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb347"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb347-1"><a href="#cb347-1"></a>estim_retiro <span class="sc">|&gt;</span> </span>
<span id="cb347-2"><a href="#cb347-2"></a>  <span class="fu">mutate</span>(<span class="st">"estim_X_t"</span> <span class="ot">=</span> estim_trend <span class="sc">+</span> estim_season) <span class="sc">|&gt;</span> </span>
<span id="cb347-3"><a href="#cb347-3"></a>  <span class="co"># solo queremos dos de las curvas</span></span>
<span id="cb347-4"><a href="#cb347-4"></a>  <span class="fu">select</span>(t, X_t, estim_trend, detrend, estim_season, deseason, estim_X_t) <span class="sc">|&gt;</span> </span>
<span id="cb347-5"><a href="#cb347-5"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>t, <span class="at">names_to =</span> <span class="st">"serie"</span>, <span class="at">values_to =</span> <span class="st">"X_t"</span>) <span class="sc">|&gt;</span></span>
<span id="cb347-6"><a href="#cb347-6"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb347-7"><a href="#cb347-7"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t, <span class="at">color =</span> serie)) <span class="sc">+</span></span>
<span id="cb347-8"><a href="#cb347-8"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_colorblind</span>() <span class="sc">+</span></span>
<span id="cb347-9"><a href="#cb347-9"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>serie, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb347-10"><a href="#cb347-10"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb347-11"><a href="#cb347-11"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"fecha"</span>, <span class="at">y =</span> <span class="st">"Temperatura (¬∫C)"</span>,</span>
<span id="cb347-12"><a href="#cb347-12"></a>       <span class="at">title =</span> <span class="st">"Estimaci√≥n decomposici√≥n cl√°sica"</span>,</span>
<span id="cb347-13"><a href="#cb347-13"></a>       <span class="at">subtitle =</span> <span class="st">"Tendencia estimada con MA(k = 365)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-228-1.png" width="960" class="r-stretch"></section>
<section id="tu-turno-11" class="slide level2">
<h2>üíª Tu turno</h2>
<h3 id="ejercicio-6-3"><span class="hl-yellow"><strong>Ejercicio 6</strong></span></h3>
<p>üíª Repite los ejercicios anteriores pero haciendo una peque√±a modificaci√≥n en la funci√≥n que estima la estacionalidad, permitiendo que pueda estimarla de manera cl√°sica o de manera sinuosoidal <span class="math inline">\(\widehat{S}_t = \sin(2 \pi t/s)\)</span>.</p>
</section></section>
<section id="clase-9a" class="title-slide slide level1 center">
<h1>Clase 9: <span class="flow">m√©tricas de error</span></h1>
<p><span style="color:#444442;"><strong>Calibrando nuestra estimaci√≥n: train/validaci√≥n y errores</strong></span></p>
<ul>
<li><a href="#/tu-turno-8-1">üíª Ejercicios</a></li>
<li><a href="#/planificacion">üìÜ Planificaci√≥n</a></li>
</ul>
</section>

<section>
<section id="clase-10" class="title-slide slide level1 center">
<h1>Clase 10: <span class="flow">m√©todos de alisado</span></h1>

</section>
<section id="limitaciones" class="slide level2">
<h2>Limitaciones</h2>
<p>Hasta ahora todo lo que hemos hecho ha sido suponer que el comportamiento de nuestra <span class="hl-yellow"><strong>serie temporal se pod√≠a explicar en t√©rminos de subpatrones o conductas</strong></span>, que en su forma aditiva, pueden tener la siguiente estructura</p>
<p><span class="math display">\[X_t = T_t + S_t + \varepsilon_t, \quad \widehat{X}_t = \widehat{T}_t + \widehat{S}_t\]</span></p>
<ul>
<li><p><span class="math inline">\(\widehat{T}_t\)</span> la hemos estimado mediante un polinomio o medias m√≥viles</p></li>
<li><p><span class="math inline">\(\widehat{S}_t\)</span> la hemos estimado asumiendo que <strong>solo hay un periodo</strong></p></li>
</ul>
<div class="fragment">
<p>Siempre hemos <span class="hl-red"><strong>ponderado las observaciones por igual</strong></span> pero‚Ä¶¬øno tendr√≠amos que dar <span class="hl-green"><strong>m√°s importancia a los datos m√°s recientes</strong></span>?</p>
</div>
</section>
<section id="clasificaci√≥n-de-pegel" class="slide level2">
<h2>Clasificaci√≥n de Pegel</h2>

<img data-src="img/pegel.jpg" class="r-stretch"><p>Imagen extra√≠da de Gonz√°lez Velasco, M., &amp; Puerto Garc√≠a, I. M. del. (2009). Series temporales. Universidad de Extremadura.</p>
<p><strong>Estacionalidad multiplicativa = serie heteroced√°stica (varianza no constante)</strong></p>
</section>
<section id="alisado-exponencial" class="slide level2">
<h2>Alisado exponencial</h2>
<p>Para superar esas limitaciones, en los a√±os 50 y 60 se propusieron una serie de m√©todos que, m√°s all√° de asumir una estructura en los datos, su objetivo era <span class="hl-yellow"><strong>describir la serie en t√©rminos de sus propios cambios</strong></span>.</p>
<p>&nbsp;</p>
<p>El objetivo de los distintos m√©todos de alisado/suavizado ser√° <span class="hl-yellow"><strong>intuir la inercia de la serie, eliminando sus posibles fluctuaciones aleatorias</strong></span>, asumiendo que si la tendencia de la serie es ascendente, probablemente la serie siga subiendo, teniendo en consideraci√≥n la pendiente con la que crece o decrece.</p>
<div class="fragment">
<p>El nombre de <span class="hl-yellow"><strong>alisado/suavizado EXPONENCIAL</strong></span> se debe a que vamos a ponderar el pasado de la serie con un conjunto de pesos que, normalmente, decrecer√°n de manera exponencial (ejemplo: si la observaci√≥n inmediatamente anterior tiene un peso de <span class="math inline">\(0.5\)</span>, la siguiente tendr√° un peso de <span class="math inline">\(0.5^2 = 0.25\)</span>)</p>
</div>
</section>
<section id="alisado-simple" class="slide level2">
<h2>Alisado simple</h2>
<p>Imagina que tenemos el valor de la serie en <span class="math inline">\(X_t\)</span> y su estimaci√≥n <span class="math inline">\(\widehat{X}_t\)</span>‚Ä¶ ¬øc√≥mo poder <span class="hl-yellow"><strong>predecir <span class="math inline">\(\widehat{X}_{t+1}\)</span> solo usando ambos valores</strong></span>?</p>
<div class="fragment">
<p>La idea que tuvo <strong>Holt (1956)</strong> fue la de hacer una <span class="hl-yellow"><strong>media ponderada del valor real <span class="math inline">\(X_t\)</span> y su estimaci√≥n <span class="math inline">\(\widehat{X}_t\)</span></strong></span></p>
<p><span class="math display">\[\widehat{X}_{t+1} = \theta \widehat{X}_t + \left( 1 - \theta \right)X_t = X_t + \theta \left(\widehat{X}_t - X_t \right) = X_t + \theta \widehat{\varepsilon}_t , \quad 0 &lt; \theta &lt; 1\]</span></p>
</div>
<div class="fragment">
<ul>
<li>Si <span class="hl-purple"><strong><span class="math inline">\(\theta \to 1\)</span></strong></span>, entonces <span class="math inline">\(\widehat{X}_{t+1} \to \widehat{X}_t\)</span> el <span class="hl-yellow"><strong>modelo de alisado produce predicciones casi constantes</strong></span> sin muchas variaciones</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Si <span class="hl-purple"><strong><span class="math inline">\(\theta \to 0\)</span></strong></span>, entonces <span class="math inline">\(\widehat{X}_{t+1} \to X_t\)</span> el <span class="hl-yellow"><strong>modelo de alisado produce predicciones muy variables dependientes del √∫ltimo valor observado</strong></span> (con mucha fluctuaci√≥n causada por la propia aleatoriedad de la serie)</li>
</ul>
</div>
</section>
<section id="alisado-simple-1" class="slide level2">
<h2>Alisado simple</h2>
<p>Si hacemos lo mismo para la estimaci√≥n en <span class="math inline">\(X_t\)</span> tenemos</p>
<p><span class="math display">\[\begin{eqnarray}\widehat{X}_{t+1} &amp;=&amp; \theta \left( \theta \widehat{X}_{t-1} + \left( 1 - \theta \right)X_{t-1} \right) + \left( 1 - \theta \right)X_t \nonumber \\ &amp;=&amp; \theta^2 \widehat{X}_{t-1} + \theta   \left( 1 - \theta \right) X_{t-1}  + \left( 1 - \theta \right) X_t \end{eqnarray}\]</span></p>
<div class="fragment">
<p>Si hacemos lo mismo para la estimaci√≥n en <span class="math inline">\(X_{t-1}\)</span></p>
<p><span class="math display">\[\begin{eqnarray}\widehat{X}_{t+1} &amp;=&amp; \theta^2 \left(\theta \widehat{X}_{t-2} + \left( 1 - \theta \right)X_{t-2} \right) +  \left( 1 - \theta \right) \left(X_t + \theta X_{t-1} \right) \nonumber \\ &amp;=&amp;
\theta^3 \widehat{X}_{t-2} + \theta^2 \left( 1 - \theta \right)X_{t-2} +  \theta \left( 1 - \theta \right)X_{t-1} + \left( 1 - \theta \right) X_t \nonumber \\ &amp;=&amp;
\theta^3 \widehat{X}_{t-2} + \left( 1 - \theta \right) \left(\theta^2 X_{t-2} +  \theta X_{t-1} +  X_t \right) \end{eqnarray}\]</span></p>
</div>
</section>
<section id="alisado-simple-2" class="slide level2">
<h2>Alisado simple</h2>
<p>Si repetimos el <span class="hl-yellow"><strong>proceso iterativo</strong></span> con <span class="math inline">\(\widehat{X}_{t-1}\)</span>, <span class="math inline">\(\widehat{X}_{t-2}\)</span>‚Ä¶</p>
<p><span class="math display">\[\widehat{X}_{t+1} =  \theta^t \widehat{X}_{1} + \left( 1 - \theta \right) \left(X_t + \theta X_{t-1}  +   \ldots + \theta^{t-1} X_{1}\right) = \theta^{t}\widehat{X}_{1} + \left(1 - \theta \right) \sum_{j=0}^{t-1} \theta^{j} X_{t-j}\]</span></p>
<p><span class="hl-yellow"><strong>¬øQu√© sucede cuando <span class="math inline">\(t \to \infty\)</span>?</strong></span></p>
<div class="fragment">
<p>Dado que <span class="math inline">\(\theta &lt; 1\)</span>, entonces</p>
<p><span class="math display">\[\lim_{t \to \infty} \widehat{X}_{t+1} = \left( 1 - \theta \right) \sum_{j=0}^{\infty} \theta^j X_{t-j}\]</span></p>
<p>F√≠jate en la <strong>serie geom√©trica</strong> <span class="math inline">\(\sum_{j=0}^{\infty} \theta^j\)</span>. ¬øRecuerdas cu√°l era la <span class="hl-yellow"><strong>suma de una serie geom√©trica cuya raz√≥n es menor que 1</strong></span>?</p>
</div>
</section>
<section id="alisado-simple-3" class="slide level2">
<h2>Alisado simple</h2>
<p>Dado que <span class="math inline">\(\theta &lt; 1\)</span>, tenemos que <span class="math inline">\(\sum_{j=0}^{\infty} \theta^j = \frac{1}{1 - \theta} \rightarrow \left( 1 - \theta \right) \sum_{j=0}^{\infty} \theta^j = 1\)</span>, as√≠ que <span class="math inline">\(\left( 1 - \theta \right) \sum_{j=0}^{t-1} \theta^j X_{t-j}\)</span> representa una <span class="hl-yellow"><strong>media ponderada del pasado (pesos decrecientes geom√©tricamente con suma 1 en el infinito)</strong></span>.</p>
<div class="fragment">
<div class="columns">
<div class="column" style="width:35%;">
<p>Si te fijas adem√°s <span class="hl-yellow"><strong>todas las observaciones son influyentes</strong></span> pero su influencia va decreciendo.</p>
</div><div class="column" style="width:65%;">
<div class="cell">
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-229-1.png" width="960"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="alisado-simple-4" class="slide level2">
<h2>Alisado simple</h2>
<p>F√≠jate que la f√≥rmula anterior se puede <span class="hl-yellow"><strong>generalizar</strong></span> para <span class="hl-yellow"><strong>predicci√≥n a horizonte <span class="math inline">\(h\)</span></strong></span>: si solo disponemos de informaci√≥n hasta el instante <span class="math inline">\(t\)</span>, tenemos que</p>
<p><span class="math display">\[\begin{eqnarray}\widehat{X}_{t+1|t} &amp;=&amp;  \theta \widehat{X}_{t|t-1} + \left( 1 - \theta \right)X_t = \theta^{t}\widehat{X}_{1} + \left(1 - \theta \right) \sum_{j=0}^{t-1} \theta^{j} X_{t-j}, \nonumber \\ \widehat{X}_{t+2|t} &amp;=&amp;  \theta \widehat{X}_{t+1|t} + \left( 1 - \theta \right)X_{t+1} \simeq \theta \widehat{X}_{t+1|t} + \left( 1 - \theta \right)\widehat{X}_{t+1|t} = \widehat{X}_{t+1|t}, \nonumber \\ ...  \nonumber \\ \widehat{X}_{t+h|t} &amp;=&amp;\widehat{X}_{t+1|t} \quad \text{para todo h}
\end{eqnarray}\]</span></p>
<div class="fragment">
<p>El <span class="hl-yellow"><strong>m√©todo de alisado simple produce ¬´flat predictions¬ª</strong></span>: siempre devuelve a horizonte <span class="math inline">\(h\)</span> el √∫ltimo valor predicho <span class="math inline">\(\widehat{X}_{t+1|t}\)</span> (asume que la tendencia es localmente constante).</p>
</div>
</section>
<section id="alisado-simple-5" class="slide level2">
<h2>Alisado simple</h2>
<p>F√≠jate que el m√©todo de alisado simple es una simple media ponderada, de una forma muy particular, pero que podr√≠amos considerar <span class="hl-yellow"><strong>otro tipo de m√©todos basados en promedios</strong></span>:</p>
<ul>
<li>Si consideramos el conocido como <span class="hl-yellow"><strong>m√©todo naive o trivial</strong></span>, tenemos que la <span class="hl-yellow"><strong>predicci√≥n a horizonte <span class="math inline">\(h\)</span></strong></span> (con la informaci√≥n disponible hasta <span class="math inline">\(t\)</span>) es</li>
</ul>
<p><span class="math display">\[\widehat{X}_{t+h|t} = X_t\]</span></p>
<p>la <strong>√∫nica observaci√≥n importante es la √∫ltima</strong>. Esto es <span class="hl-yellow"><strong>equivalente a un alisado simple con <span class="math inline">\(\theta = 0\)</span></strong></span></p>
</section>
<section id="alisado-simple-6" class="slide level2">
<h2>Alisado simple</h2>
<p>F√≠jate que el m√©todo de alisado simple es una simple media ponderada, de una forma muy particular, pero que podr√≠amos considerar <span class="hl-yellow"><strong>otro tipo de m√©todos basados en promedios</strong></span>:</p>
<ul>
<li>Si consideramos el conocido como <span class="hl-yellow"><strong>mean method</strong></span>, lo que hemos llamado <code>poly0</code> (hace simplemente la media cte de todos los valores), la <span class="hl-yellow"><strong>predicci√≥n a horizonte <span class="math inline">\(h\)</span></strong></span> (con la informaci√≥n disponible hasta <span class="math inline">\(t\)</span>) es</li>
</ul>
<p><span class="math display">\[\widehat{X}_{t+h|t} = \frac{1}{t} \sum_{j=1}^{t}X_j\]</span></p>
<p>todas las observaciones pasadas son <strong>igual de importantes</strong>.</p>
</section>
<section id="alisado-simple-7" class="slide level2">
<h2>Alisado simple</h2>
<p>El modelo de alisado simple anterior en realidad equivale a asumir que la <span class="hl-yellow"><strong>estructura de nuestra serie es localmente constante</strong></span></p>
<p><span class="math display">\[X_t = T_t + \varepsilon_t, \quad T_t - T_{t-1} \simeq cte\]</span></p>
<p>una tendencia que va variando <span class="hl-yellow"><strong>muy lentamente con el tiempo</strong></span> (ya que el futuro se parece m√°s a los valores pasados inmediatos que a los valores m√°s lejanos).</p>
<div class="fragment">
<p>Para el m√©todo de alisado simple <span class="hl-yellow"><strong>necesitamos conocer el valor inicial y encontrar el mejor <span class="math inline">\(\theta\)</span></strong></span> (por ejemplo, mediante m√≠nimos cuadrados de los errores observados para distintos valores).</p>
<p>&nbsp;</p>
<p>Supondremos <span class="hl-yellow"><strong><span class="math inline">\(\theta\)</span> constante</strong></span> pero existen m√©todos (ver <a href="https://robjhyndman.com/forecasting/">aqu√≠</a>) para considerar que <span class="math inline">\(\theta\)</span> se adapta a su vez a lo largo del tiempo</p>
</div>
</section>
<section id="ejemplo-en-r" class="slide level2">
<h2>Ejemplo en R</h2>
<p>Vamos a trabajar con el paquete <code>{tsibbledata}</code> que nos permite usar varios <span class="hl-yellow"><strong>ejemplos de series temporales</strong></span>. En concreto vamos a usar el dataset <code>global_economy</code> que contiene distintas estad√≠sticas econ√≥micas para distintos a√±os pa√≠ses, y nos vamos a centrar solo en <strong>datos de exportaciones de Algeria</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb348"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb348-1"><a href="#cb348-1"></a><span class="fu">library</span>(tsibbledata)</span>
<span id="cb348-2"><a href="#cb348-2"></a><span class="fu">library</span>(tsibble)</span>
<span id="cb348-3"><a href="#cb348-3"></a>algeria_economy <span class="ot">&lt;-</span></span>
<span id="cb348-4"><a href="#cb348-4"></a>  global_economy <span class="sc">|&gt;</span></span>
<span id="cb348-5"><a href="#cb348-5"></a>  <span class="fu">filter</span>(Country <span class="sc">==</span> <span class="st">"Algeria"</span>) <span class="sc">|&gt;</span></span>
<span id="cb348-6"><a href="#cb348-6"></a>  <span class="co"># solo hay un pa√≠s, eliminamos key</span></span>
<span id="cb348-7"><a href="#cb348-7"></a>  <span class="fu">update_tsibble</span>(<span class="at">key =</span> <span class="cn">NULL</span>)</span>
<span id="cb348-8"><a href="#cb348-8"></a>algeria_economy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 58 x 9 [1Y]
   Country Code   Year         GDP Growth   CPI Imports Exports Population
   &lt;fct&gt;   &lt;fct&gt; &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;
 1 Algeria DZA    1960 2723648552.  NA    NA       67.1    39.0   11124888
 2 Algeria DZA    1961 2434776646. -13.6  NA       67.5    46.2   11404859
 3 Algeria DZA    1962 2001468868. -19.7  NA       20.8    19.8   11690153
 4 Algeria DZA    1963 2703014867.  34.3  NA       36.8    24.7   11985136
 5 Algeria DZA    1964 2909351793.   5.84 NA       29.4    25.1   12295970
 6 Algeria DZA    1965 3136258897.   6.21 NA       25.8    22.6   12626952
 7 Algeria DZA    1966 3039834559.  -4.80 NA       24.7    26.0   12980267
 8 Algeria DZA    1967 3370843066.   9.45 NA       21.6    23.4   13354197
 9 Algeria DZA    1968 3852115817.  10.8  NA       24.2    23.1   13744387
10 Algeria DZA    1969 4257218772.   8.43  2.57    28.1    23.8   14144438
# ‚Ñπ 48 more rows</code></pre>
</div>
</div>
</section>
<section id="ejemplo-en-r-1" class="slide level2">
<h2>Ejemplo en R</h2>
<p>Si observamos la serie <span class="hl-yellow"><strong>no se aprecia una tendencia clara ni una estacionalidad evidente</strong></span>, perfecto para nuestro m√©todo de alisado simple.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb350"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb350-1"><a href="#cb350-1"></a><span class="fu">ggplot</span>(algeria_economy) <span class="sc">+</span></span>
<span id="cb350-2"><a href="#cb350-2"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Exports)) <span class="sc">+</span></span>
<span id="cb350-3"><a href="#cb350-3"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb350-4"><a href="#cb350-4"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-231-1.png" width="960" class="r-stretch"></section>
<section id="ejemplo-en-r-2" class="slide level2">
<h2>Ejemplo en R</h2>
<p><span class="hl-yellow"><strong>¬øC√≥mo realizar la estimaci√≥n de alisado simple?</strong></span></p>
<div class="fragment">
<p>Vamos a usar el universo de paquetes <code>{tidyverts}</code> (una forma de trabajar en modo tidyverse con series temporales), de los cuales ya conocemos <code>{tsibbledata}</code> y <code>{tsibble}</code>. Vamos a instalar tambi√©n el paquete <a href="https://fable.tidyverts.org/"><code>{fable}</code></a> que nos <span class="hl-yellow"><strong>proporciona herramientas para la predicci√≥n de series temporales</strong></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb351"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb351-1"><a href="#cb351-1"></a><span class="fu">library</span>(fable)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="ejemplo-en-r-3" class="slide level2">
<h2>Ejemplo en R</h2>
<p>Dentro de este paquete existe una funci√≥n llamada <code>model()</code> que nos permite <span class="hl-yellow"><strong>ajustar distintos modelos a los datos</strong></span>.</p>
<ul>
<li><code>ETS(var_objetivo ~ componentes del modelo)</code>: para ajustar los <span class="hl-yellow"><strong>m√©todos de alisado/suavizado exponencial</strong></span> necesitamos especificarle dentro de <code>model()</code> que nuestro modelo es de tipo <code>ETS()</code> (exponential time-series smoothing model)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb352" data-code-line-numbers="4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb352-1"><a href="#cb352-1"></a><span class="co"># NO EJECUTES QUE EST√Å A√öN SIN COMPLETAR</span></span>
<span id="cb352-2"><a href="#cb352-2"></a>fit_algeria <span class="ot">&lt;-</span></span>
<span id="cb352-3"><a href="#cb352-3"></a>  algeria_economy <span class="sc">|&gt;</span></span>
<span id="cb352-4"><a href="#cb352-4"></a>  <span class="fu">model</span>(<span class="fu">ETS</span>(Exports <span class="sc">~</span> ...))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ejemplo-en-r-4" class="slide level2">
<h2>Ejemplo en R</h2>
<p>Una vez que hemos determinado nuestra variable objetivo, las <span class="hl-yellow"><strong>componentes del modelo se pueden incorporar</strong></span> con las <span class="hl-purple"><strong>funciones <code>error()</code>, <code>trend()</code> y <code>season()</code></strong></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb353" data-code-line-numbers="4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb353-1"><a href="#cb353-1"></a>fit_algeria <span class="ot">&lt;-</span></span>
<span id="cb353-2"><a href="#cb353-2"></a>  algeria_economy <span class="sc">|&gt;</span></span>
<span id="cb353-3"><a href="#cb353-3"></a>  <span class="fu">model</span>(<span class="fu">ETS</span>(Exports <span class="sc">~</span></span>
<span id="cb353-4"><a href="#cb353-4"></a>              <span class="fu">error</span>(tipo) <span class="sc">+</span> <span class="fu">trend</span>(tipo) <span class="sc">+</span> <span class="fu">season</span>(tipo)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>Cada una de las funciones admite dentro los siguientes tipos:</p>
<ul>
<li><code>"A"</code>: <span class="hl-yellow"><strong>aditivo</strong></span></li>
<li><code>"M"</code>: <span class="hl-yellow"><strong>multiplicativo</strong></span></li>
<li><code>"N"</code>: <span class="hl-yellow"><strong>ninguno</strong></span> (sin esa componente)</li>
</ul>
</div>
</section>
<section id="ejemplo-en-r-5" class="slide level2">
<h2>Ejemplo en R</h2>
<p>En nuestro caso hemos visto que el alisado simple es para predecir una serie asumiendo que <strong>no hay tendencia ni estacionalidad</strong> (<code>"N"</code> en ambos)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb354"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1"></a>fit_algeria <span class="ot">&lt;-</span></span>
<span id="cb354-2"><a href="#cb354-2"></a>  algeria_economy <span class="sc">|&gt;</span> <span class="co"># f√≠jate que le podemos poner nombre al modelo</span></span>
<span id="cb354-3"><a href="#cb354-3"></a>  <span class="fu">model</span>(<span class="at">alisado_simple =</span> <span class="fu">ETS</span>(Exports <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"N"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)))</span>
<span id="cb354-4"><a href="#cb354-4"></a>fit_algeria</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 1
  alisado_simple
         &lt;model&gt;
1   &lt;ETS(A,N,N)&gt;</code></pre>
</div>
</div>
</section>
<section id="ejemplo-en-r-6" class="slide level2">
<h2>Ejemplo en R</h2>
<p>Se <span class="hl-yellow"><strong>guarda en un objeto de tipo modelo</strong></span> (<code>mdl_df</code> o <code>mable</code>): para poder ver la info en un <strong>formato tabulado basta hacer <code>augment()</code></strong>: <code>.fitted</code> guarda las estimaciones, <code>.resid</code> residuales estimados (en este caso coincide con <code>.innov</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb356" data-code-line-numbers="2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb356-1"><a href="#cb356-1"></a>fit_algeria <span class="sc">|&gt;</span></span>
<span id="cb356-2"><a href="#cb356-2"></a>  <span class="fu">augment</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 58 x 6 [1Y]
# Key:       .model [1]
   .model          Year Exports .fitted  .resid  .innov
   &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 alisado_simple  1960    39.0    39.5  -0.496  -0.496
 2 alisado_simple  1961    46.2    39.1   7.12    7.12 
 3 alisado_simple  1962    19.8    45.1 -25.3   -25.3  
 4 alisado_simple  1963    24.7    23.8   0.841   0.841
 5 alisado_simple  1964    25.1    24.6   0.534   0.534
 6 alisado_simple  1965    22.6    25.0  -2.39   -2.39 
 7 alisado_simple  1966    26.0    23.0   3.00    3.00 
 8 alisado_simple  1967    23.4    25.5  -2.07   -2.07 
 9 alisado_simple  1968    23.1    23.8  -0.630  -0.630
10 alisado_simple  1969    23.8    23.2   0.552   0.552
# ‚Ñπ 48 more rows</code></pre>
</div>
</div>
</section>
<section id="ejemplo-en-r-7" class="slide level2">
<h2>Ejemplo en R</h2>
<p>Tras modelizar la serie podemos predecir el futuro con <code>forecast(h = n_instantes_futuros)</code> indic√°ndole los <strong>valores futuros</strong> (para convertirlo a un <strong>formato tabla</strong>, dado que ya no es un modelo como antes, debemos convertirlo con <code>as_tibble()</code> o <code>as_tsibble()</code>)</p>
<p>F√≠jate que en el <span class="hl-yellow"><strong>caso de alisado simple todas las predicciones son la misma</strong></span> (ya que asume que es localmente constante)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb358" data-code-line-numbers="3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1"></a>predict_algeria <span class="ot">&lt;-</span></span>
<span id="cb358-2"><a href="#cb358-2"></a>  fit_algeria <span class="sc">|&gt;</span></span>
<span id="cb358-3"><a href="#cb358-3"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">7</span>) <span class="co"># 7 instantes futuros</span></span>
<span id="cb358-4"><a href="#cb358-4"></a>predict_algeria <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A fable: 7 x 4 [1Y]
# Key:     .model [1]
  .model          Year .mean
  &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt;
1 alisado_simple  2018  22.4
2 alisado_simple  2019  22.4
3 alisado_simple  2020  22.4
4 alisado_simple  2021  22.4
5 alisado_simple  2022  22.4
6 alisado_simple  2023  22.4
7 alisado_simple  2024  22.4
# ‚Ñπ 1 more variable: Exports &lt;dist&gt;</code></pre>
</div>
</div>
</section>
<section id="ejemplo-en-r-8" class="slide level2">
<h2>Ejemplo en R</h2>
<p>Podemos <span class="hl-yellow"><strong>visualizar el ajuste (del pasado)</strong></span> haciendo <code>augment() + pivot_longer()</code> (seleccion√°ndole antes las columnas a pivotar)</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb360"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb360-1"><a href="#cb360-1"></a>fit_algeria <span class="sc">|&gt;</span></span>
<span id="cb360-2"><a href="#cb360-2"></a>  <span class="fu">augment</span>() <span class="sc">|&gt;</span></span>
<span id="cb360-3"><a href="#cb360-3"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb360-4"><a href="#cb360-4"></a>  <span class="fu">select</span>(Year, Exports, .fitted) <span class="sc">|&gt;</span> </span>
<span id="cb360-5"><a href="#cb360-5"></a>  <span class="fu">rename</span>(<span class="at">export_real =</span> Exports, <span class="at">export_fit =</span> .fitted) <span class="sc">|&gt;</span> </span>
<span id="cb360-6"><a href="#cb360-6"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">"serie"</span>, <span class="at">values_to =</span> <span class="st">"X_t"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb360-7"><a href="#cb360-7"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb360-8"><a href="#cb360-8"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> X_t, <span class="at">color =</span> serie)) <span class="sc">+</span></span>
<span id="cb360-9"><a href="#cb360-9"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_colorblind</span>() <span class="sc">+</span></span>
<span id="cb360-10"><a href="#cb360-10"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb360-11"><a href="#cb360-11"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb360-12"><a href="#cb360-12"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"% del PIB"</span>, <span class="at">title =</span> <span class="st">"Exports: Algeria"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-239-1.png" width="960" class="r-stretch"><div class="fragment">
<p>F√≠jate como el <span class="hl-red"><strong>alisado simple ‚Äúllega tarde‚Äù a los cambios</strong></span> ya que lo que hace es asumir que todo va a seguir igual</p>
</div>
</section>
<section id="ejemplo-en-r-9" class="slide level2">
<h2>Ejemplo en R</h2>
<p>Podemos <span class="hl-yellow"><strong>unir las predicciones futuras a los valores ajustados del pasado</strong></span> con un <code>full_join()</code> (conviertiendo lsa tablas a tibble, seleccionando las columnas que nos interesa y renombr√°ndolas)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb361" data-code-line-numbers="5-6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb361-1"><a href="#cb361-1"></a>fit_predict_algeria <span class="ot">&lt;-</span></span>
<span id="cb361-2"><a href="#cb361-2"></a>  fit_algeria <span class="sc">|&gt;</span></span>
<span id="cb361-3"><a href="#cb361-3"></a>  <span class="fu">augment</span>() <span class="sc">|&gt;</span></span>
<span id="cb361-4"><a href="#cb361-4"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb361-5"><a href="#cb361-5"></a>  <span class="fu">full_join</span>(predict_algeria <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> <span class="fu">select</span>(Year, .mean),</span>
<span id="cb361-6"><a href="#cb361-6"></a>            <span class="at">by =</span> <span class="st">"Year"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb361-7"><a href="#cb361-7"></a>  <span class="fu">select</span>(Year, Exports, .fitted, .mean) <span class="sc">|&gt;</span> </span>
<span id="cb361-8"><a href="#cb361-8"></a>  <span class="fu">rename</span>(<span class="at">export_real =</span> Exports, <span class="at">export_fit =</span> .fitted, <span class="at">export_predict =</span> .mean)</span>
<span id="cb361-9"><a href="#cb361-9"></a>fit_predict_algeria</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 65 √ó 4
    Year export_real export_fit export_predict
   &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;          &lt;dbl&gt;
 1  1960        39.0       39.5             NA
 2  1961        46.2       39.1             NA
 3  1962        19.8       45.1             NA
 4  1963        24.7       23.8             NA
 5  1964        25.1       24.6             NA
 6  1965        22.6       25.0             NA
 7  1966        26.0       23.0             NA
 8  1967        23.4       25.5             NA
 9  1968        23.1       23.8             NA
10  1969        23.8       23.2             NA
# ‚Ñπ 55 more rows</code></pre>
</div>
</div>
</section>
<section id="ejemplo-en-r-10" class="slide level2">
<h2>Ejemplo en R</h2>
<p>Tras ello podemos visualizar (haciendo un <code>pivot_longer()</code> previo as usual)</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb363"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb363-1"><a href="#cb363-1"></a>fit_predict_algeria <span class="sc">|&gt;</span></span>
<span id="cb363-2"><a href="#cb363-2"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">"serie"</span>, <span class="at">values_to =</span> <span class="st">"X_t"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb363-3"><a href="#cb363-3"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb363-4"><a href="#cb363-4"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> X_t, <span class="at">color =</span> serie)) <span class="sc">+</span></span>
<span id="cb363-5"><a href="#cb363-5"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_colorblind</span>() <span class="sc">+</span></span>
<span id="cb363-6"><a href="#cb363-6"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb363-7"><a href="#cb363-7"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb363-8"><a href="#cb363-8"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"% del PIB"</span>, <span class="at">title =</span> <span class="st">"Exports: Algeria"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-241-1.png" width="960" class="r-stretch"></section>
<section id="ejemplo-en-r-11" class="slide level2">
<h2>Ejemplo en R</h2>
<p>Tambi√©n podemos simplificar el c√≥digo de la visualizaci√≥n haciendo <span class="hl-yellow"><strong>uso de autoplot()</strong></span>, que te incluye adem√°s unos <strong>intervalos de confianza</strong>.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb364"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb364-1"><a href="#cb364-1"></a>predict_algeria <span class="sc">|&gt;</span></span>
<span id="cb364-2"><a href="#cb364-2"></a>  <span class="fu">autoplot</span>(algeria_economy) <span class="sc">+</span></span>
<span id="cb364-3"><a href="#cb364-3"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> fit_algeria <span class="sc">|&gt;</span> <span class="fu">augment</span>(),</span>
<span id="cb364-4"><a href="#cb364-4"></a>            <span class="fu">aes</span>(<span class="at">y =</span> .fitted), <span class="at">col =</span> <span class="st">"#D55E00"</span>) <span class="sc">+</span></span>
<span id="cb364-5"><a href="#cb364-5"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb364-6"><a href="#cb364-6"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb364-7"><a href="#cb364-7"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"% del PIB"</span>, <span class="at">title =</span> <span class="st">"Exports: Algeria"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-242-1.png" width="960" class="r-stretch"></section></section>
<section>
<section id="clase-11" class="title-slide slide level1 center">
<h1>Clase 11: <span class="flow">modelos con fable</span></h1>

</section>
<section id="modelos-con-fable-mean" class="slide level2">
<h2>Modelos con fable: MEAN()</h2>
<p>No solo vamos a poder aplicar el alisado en esta nueva l√≥gica de programaci√≥n, sino que vamos a poder <span class="hl-yellow"><strong>programar de manera sencilla los modelos que hemos investigado hasta ahora</strong></span></p>
<div class="fragment">
<ul>
<li><code>MEAN(var_objetivo)</code>: la predicci√≥n a horizonte <span class="math inline">\(h\)</span> se define como la <span class="hl-yellow"><strong>media de todos los valores</strong></span> conocidos de la serie <span class="math inline">\(\widehat{X}_{t+h|t} = \frac{1}{t} \sum_{j=1}^{t} X_t\)</span> hasta el instante <span class="math inline">\(t\)</span> (predicci√≥n constante, la que antes llam√°bamos <code>poly0</code>)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb365" data-code-line-numbers="5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb365-1"><a href="#cb365-1"></a>airpass <span class="ot">&lt;-</span> AirPassengers <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>()</span>
<span id="cb365-2"><a href="#cb365-2"></a>fit_airpass <span class="ot">&lt;-</span></span>
<span id="cb365-3"><a href="#cb365-3"></a>  airpass <span class="sc">|&gt;</span></span>
<span id="cb365-4"><a href="#cb365-4"></a>  <span class="fu">model</span>(<span class="at">alisado_simple =</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"N"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb365-5"><a href="#cb365-5"></a>        <span class="at">mean_cte =</span> <span class="fu">MEAN</span>(value))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="modelos-con-fable-tslm" class="slide level2">
<h2>Modelos con fable: TSLM()</h2>
<ul>
<li><code>TSLM(var_objetivo ~ formula)</code>: la predicci√≥n a horizonte <span class="math inline">\(h\)</span> se define como una <span class="hl-yellow"><strong>regresi√≥n polin√≥mica</strong></span> tal que <span class="math inline">\(\widehat{X}_{t+h|t} = \beta_0 + \sum_{j=1}^{p} \beta_j (t+h)^p\)</span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb366" data-code-line-numbers="5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb366-1"><a href="#cb366-1"></a>fit_airpass <span class="ot">&lt;-</span></span>
<span id="cb366-2"><a href="#cb366-2"></a>  airpass <span class="sc">|&gt;</span></span>
<span id="cb366-3"><a href="#cb366-3"></a>  <span class="fu">model</span>(<span class="at">alisado_simple =</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"N"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb366-4"><a href="#cb366-4"></a>        <span class="at">mean_cte =</span> <span class="fu">MEAN</span>(value),</span>
<span id="cb366-5"><a href="#cb366-5"></a>        <span class="at">reg_poly =</span> <span class="fu">TSLM</span>(value <span class="sc">~</span> index))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="modelos-con-fable-rw" class="slide level2">
<h2>Modelos con fable: RW()</h2>
<ul>
<li><code>RW(var_objetivo ~ drift())</code>: modelo conocido como <span class="hl-yellow"><strong>random walk</strong></span> o paseo aleatorio con <span class="hl-yellow"><strong>drift o tendencia</strong></span> tal que <span class="math inline">\(X_{t+1} = c + X_{t} + \varepsilon_t\)</span>. La predicci√≥n a horizonte <span class="math inline">\(h\)</span> se define entonces como</li>
</ul>
<p><span class="math display">\[\widehat{X}_{t+h|t} = c + X_{(t+h-1)|t} \simeq c + \widehat{X}_{(t+h-1)|t} \simeq 2*c +  \widehat{X}_{(t+h-2)|t} \simeq ... \simeq c*h + X_{t}\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb367" data-code-line-numbers="6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb367-1"><a href="#cb367-1"></a>fit_airpass <span class="ot">&lt;-</span></span>
<span id="cb367-2"><a href="#cb367-2"></a>  airpass <span class="sc">|&gt;</span></span>
<span id="cb367-3"><a href="#cb367-3"></a>  <span class="fu">model</span>(<span class="at">alisado_simple =</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"N"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb367-4"><a href="#cb367-4"></a>        <span class="at">mean_cte =</span> <span class="fu">MEAN</span>(value),</span>
<span id="cb367-5"><a href="#cb367-5"></a>        <span class="at">reg_poly =</span> <span class="fu">TSLM</span>(value <span class="sc">~</span> index),</span>
<span id="cb367-6"><a href="#cb367-6"></a>        <span class="at">rw_drift =</span> <span class="fu">RW</span>(value <span class="sc">~</span> <span class="fu">drift</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="modelos-con-fable-naive" class="slide level2">
<h2>Modelos con fable: NAIVE()</h2>
<ul>
<li><code>NAIVE(var_objetivo)</code>: el <span class="hl-yellow"><strong>modelo naive o trivial</strong></span> es una simplificaci√≥n del random walk con <span class="math inline">\(c=0\)</span> (sin tendencia, de hecho <code>NAIVE()</code> y <code>RW()</code> sin drift hacen lo mismo. La predicci√≥n a horizonte <span class="math inline">\(h\)</span> se define entonces como simplemente el √∫ltimo valor conocido en tiempo <span class="math inline">\(t\)</span>.</li>
</ul>
<p><span class="math display">\[\widehat{X}_{t+h|t} =  X_{t}\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb368" data-code-line-numbers="7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb368-1"><a href="#cb368-1"></a>fit_airpass <span class="ot">&lt;-</span></span>
<span id="cb368-2"><a href="#cb368-2"></a>  airpass <span class="sc">|&gt;</span></span>
<span id="cb368-3"><a href="#cb368-3"></a>  <span class="fu">model</span>(<span class="at">alisado_simple =</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"N"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb368-4"><a href="#cb368-4"></a>        <span class="at">mean_cte =</span> <span class="fu">MEAN</span>(value),</span>
<span id="cb368-5"><a href="#cb368-5"></a>        <span class="at">reg_poly =</span> <span class="fu">TSLM</span>(value <span class="sc">~</span> index),</span>
<span id="cb368-6"><a href="#cb368-6"></a>        <span class="at">rw_drift =</span> <span class="fu">RW</span>(value <span class="sc">~</span> <span class="fu">drift</span>()),</span>
<span id="cb368-7"><a href="#cb368-7"></a>        <span class="at">naive =</span> <span class="fu">NAIVE</span>(value))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="modelos-con-fable-snaive" class="slide level2">
<h2>Modelos con fable: SNAIVE()</h2>
<ul>
<li><code>SNAIVE(var_objetivo ~ lag())</code>: similar al modelo anterior solo que en lugar de repetir el √∫ltimo valor <span class="hl-yellow"><strong>repite los √∫ltimos valores estacionales</strong></span> (por ejemplo, el √∫ltimo mes, el √∫ltimo a√±o, etc).</li>
</ul>
<p>La predicci√≥n a horizonte <span class="math inline">\(h\)</span> se define entonces como</p>
<p><span class="math display">\[\widehat{X}_{t+h|t} =  X_{\left(t+h \right) - s*(k+1)}\]</span></p>
<ul>
<li><p><span class="math inline">\(s\)</span> es el periodo</p></li>
<li><p><span class="math inline">\(k\)</span> es la parte entera de <span class="math inline">\((h-1)/s\)</span> (el n√∫mero de periodos completos que han pasado hasta <span class="math inline">\(t+h\)</span>). Por ejemplo, si <span class="math inline">\(h = 26\)</span> y <span class="math inline">\(s = 12\)</span>, <span class="math inline">\((h-1)/s = 25/12 = 2.08333\)</span>, cuya parte entera es <span class="math inline">\(k = 2\)</span> (han pasado 2 a√±os completos hasta <span class="math inline">\(h = 26\)</span>). Si <span class="math inline">\(s = 12\)</span>, la predicci√≥n de cualquier de los enero futuros ser√° igual a la predicci√≥n del √∫ltimo enero conocido.</p></li>
</ul>
</section>
<section id="modelos-con-fable-snaive-1" class="slide level2">
<h2>Modelos con fable: SNAIVE()</h2>
<ul>
<li><code>SNAIVE(var_objetivo ~ lag())</code>: similar al modelo anterior solo que en lugar de repetir el √∫ltimo valor <span class="hl-yellow"><strong>repite los √∫ltimos valores estacionales</strong></span> (por ejemplo, el √∫ltimo mes, el √∫ltimo a√±o, etc).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb369" data-code-line-numbers="8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb369-1"><a href="#cb369-1"></a>fit_airpass <span class="ot">&lt;-</span></span>
<span id="cb369-2"><a href="#cb369-2"></a>  airpass <span class="sc">|&gt;</span></span>
<span id="cb369-3"><a href="#cb369-3"></a>  <span class="fu">model</span>(<span class="at">alisado_simple =</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"N"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb369-4"><a href="#cb369-4"></a>        <span class="at">mean_cte =</span> <span class="fu">MEAN</span>(value),</span>
<span id="cb369-5"><a href="#cb369-5"></a>        <span class="at">reg_poly =</span> <span class="fu">TSLM</span>(value <span class="sc">~</span> index),</span>
<span id="cb369-6"><a href="#cb369-6"></a>        <span class="at">rw_drift =</span> <span class="fu">RW</span>(value <span class="sc">~</span> <span class="fu">drift</span>()),</span>
<span id="cb369-7"><a href="#cb369-7"></a>        <span class="at">naive =</span> <span class="fu">NAIVE</span>(value),</span>
<span id="cb369-8"><a href="#cb369-8"></a>        <span class="at">season_naive =</span> <span class="fu">SNAIVE</span>(value <span class="sc">~</span> <span class="fu">lag</span>(<span class="dv">12</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="modelos-con-fable" class="slide level2">
<h2>Modelos con fable</h2>
<p>As√≠ de toda la colecci√≥n anterior de modelos podemos <span class="hl-yellow"><strong>obtener las estimaciones</strong></span> de manera sencilla con <code>augment()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb370"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb370-1"><a href="#cb370-1"></a>estimaciones <span class="ot">&lt;-</span> fit_airpass <span class="sc">|&gt;</span> <span class="fu">augment</span>()</span>
<span id="cb370-2"><a href="#cb370-2"></a></span>
<span id="cb370-3"><a href="#cb370-3"></a><span class="co"># Tenemos 144 estimaciones para cada uno de esos modelos</span></span>
<span id="cb370-4"><a href="#cb370-4"></a>estimaciones <span class="sc">|&gt;</span> </span>
<span id="cb370-5"><a href="#cb370-5"></a>  <span class="fu">count</span>(.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 2
  .model             n
  &lt;chr&gt;          &lt;int&gt;
1 alisado_simple   144
2 mean_cte         144
3 naive            144
4 reg_poly         144
5 rw_drift         144
6 season_naive     144</code></pre>
</div>
</div>
</section>
<section id="modelos-con-fable-1" class="slide level2">
<h2>Modelos con fable</h2>
<p>As√≠ de toda la colecci√≥n anterior de modelos podemos <span class="hl-yellow"><strong>obtener las estimaciones</strong></span> de manera sencilla con <code>augment()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb372"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb372-1"><a href="#cb372-1"></a>estimaciones</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 864 x 6 [1M]
# Key:       .model [6]
   .model            index value .fitted    .resid    .innov
   &lt;chr&gt;             &lt;mth&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 alisado_simple 1949 Jan   112    112.  -0.0948   -0.0948 
 2 alisado_simple 1949 Feb   118    112.   6.00      6.00   
 3 alisado_simple 1949 Mar   132    118.  14.0      14.0    
 4 alisado_simple 1949 Apr   129    132.  -3.00     -3.00   
 5 alisado_simple 1949 May   121    129.  -8.00     -8.00   
 6 alisado_simple 1949 Jun   135    121.  14.0      14.0    
 7 alisado_simple 1949 Jul   148    135.  13.0      13.0    
 8 alisado_simple 1949 Aug   148    148.   0.00130   0.00130
 9 alisado_simple 1949 Sep   136    148. -12.0     -12.0    
10 alisado_simple 1949 Oct   119    136. -17.0     -17.0    
# ‚Ñπ 854 more rows</code></pre>
</div>
</div>
</section>
<section id="visualizaci√≥n-estimaciones" class="slide level2">
<h2>Visualizaci√≥n estimaciones</h2>
<p>Podemos <span class="hl-yellow"><strong>visualizar el ajuste (del pasado)</strong></span></p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb374"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb374-1"><a href="#cb374-1"></a>estimaciones <span class="sc">|&gt;</span></span>
<span id="cb374-2"><a href="#cb374-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb374-3"><a href="#cb374-3"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> value), <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb374-4"><a href="#cb374-4"></a>            <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb374-5"><a href="#cb374-5"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> .fitted, <span class="at">color =</span> .model),</span>
<span id="cb374-6"><a href="#cb374-6"></a>            <span class="at">linewidth =</span> <span class="fl">0.75</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb374-7"><a href="#cb374-7"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> ggthemes<span class="sc">::</span><span class="fu">colorblind_pal</span>()(<span class="dv">7</span>)[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb374-8"><a href="#cb374-8"></a>  <span class="fu">scale_x_yearquarter</span>(<span class="at">date_breaks =</span> <span class="st">"24 months"</span>) <span class="sc">+</span></span>
<span id="cb374-9"><a href="#cb374-9"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-250-1.png" width="960" class="r-stretch"></section>
<section id="visualizaci√≥n-predicciones" class="slide level2">
<h2>Visualizaci√≥n predicciones</h2>
<p>Podemos <span class="hl-yellow"><strong>visualizar las predicciones futuras</strong></span> con <code>forecast() + autoplot()</code> (con <code>level = NULL</code> anulamos los intervalos de confianza).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb375"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb375-1"><a href="#cb375-1"></a>fit_airpass <span class="sc">|&gt;</span></span>
<span id="cb375-2"><a href="#cb375-2"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">24</span>) <span class="sc">|&gt;</span> </span>
<span id="cb375-3"><a href="#cb375-3"></a>  <span class="fu">autoplot</span>(airpass, <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb375-4"><a href="#cb375-4"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> ggthemes<span class="sc">::</span><span class="fu">colorblind_pal</span>()(<span class="dv">7</span>)[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb375-5"><a href="#cb375-5"></a>  <span class="fu">scale_x_yearquarter</span>(<span class="at">date_breaks =</span> <span class="st">"24 months"</span>) <span class="sc">+</span></span>
<span id="cb375-6"><a href="#cb375-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-251-1.png" width="960" class="r-stretch"></section>
<section id="m√©todos-de-decomposici√≥n" class="slide level2">
<h2>M√©todos de decomposici√≥n</h2>
<p>Tambi√©n podemos con el paquete <code>{feasts}</code> hacer uso de las <span class="hl-yellow"><strong>decomposiciones que hemos aprendido</strong></span></p>
<ul>
<li><code>classical_decomposition(var_objetivo ~ season(s),  type = ...)</code>: <span class="hl-yellow"><strong>descomposici√≥n cl√°sica</strong></span> aprendida de tipo multiplicativa o aditiva. La predicci√≥n a horizonte <span class="math inline">\(h\)</span> se define tal que</li>
</ul>
<p><span class="math display">\[\widehat{X}_{t+h|t} = \widehat{T}_{t+h|t} + \widehat{S}_{t+h|t} \quad \text{type = "additive"}\]</span></p>
<p><span class="math display">\[\widehat{X}_{t+h|t} = \widehat{T}_{t+h|t} * \widehat{S}_{t+h|t} \quad \text{type = "mult"}\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb376" data-code-line-numbers="4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb376-1"><a href="#cb376-1"></a><span class="fu">library</span>(feasts)</span>
<span id="cb376-2"><a href="#cb376-2"></a>fit_airpass <span class="ot">&lt;-</span></span>
<span id="cb376-3"><a href="#cb376-3"></a>  airpass <span class="sc">|&gt;</span></span>
<span id="cb376-4"><a href="#cb376-4"></a>  <span class="fu">model</span>(<span class="at">cts =</span> <span class="fu">classical_decomposition</span>(value <span class="sc">~</span> <span class="fu">season</span>(<span class="dv">12</span>), <span class="at">type =</span> <span class="st">"additive"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="m√©todos-de-decomposici√≥n-1" class="slide level2">
<h2>M√©todos de decomposici√≥n</h2>
<p>Para este tipo particular de m√©todos (<strong>m√©todos de decomposici√≥n</strong>) existe una funci√≥n <code>components()</code> que autom√°ticamente nos devuelve la tendencia estimada (<code>trend</code>), la estacionalidad (<code>seasonal</code>), el residuo estimado (<code>random</code>) y la serie desestacionalizada (<code>season_adjust</code>, serie - seasonal)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb377" data-code-line-numbers="4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb377-1"><a href="#cb377-1"></a>fit_airpass <span class="ot">&lt;-</span></span>
<span id="cb377-2"><a href="#cb377-2"></a>  airpass <span class="sc">|&gt;</span></span>
<span id="cb377-3"><a href="#cb377-3"></a>  <span class="fu">model</span>(<span class="at">cts =</span> <span class="fu">classical_decomposition</span>(value <span class="sc">~</span> <span class="fu">season</span>(<span class="dv">12</span>), <span class="at">type =</span> <span class="st">"additive"</span>))</span>
<span id="cb377-4"><a href="#cb377-4"></a>fit_airpass <span class="sc">|&gt;</span> <span class="fu">components</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A dable: 144 x 7 [1M]
# Key:     .model [1]
# :        value = trend + seasonal + random
   .model    index value trend seasonal random season_adjust
   &lt;chr&gt;     &lt;mth&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;         &lt;dbl&gt;
 1 cts    1949 Jan   112   NA    -24.7   NA            137. 
 2 cts    1949 Feb   118   NA    -36.2   NA            154. 
 3 cts    1949 Mar   132   NA     -2.24  NA            134. 
 4 cts    1949 Apr   129   NA     -8.04  NA            137. 
 5 cts    1949 May   121   NA     -4.51  NA            126. 
 6 cts    1949 Jun   135   NA     35.4   NA             99.6
 7 cts    1949 Jul   148  127.    63.8  -42.6           84.2
 8 cts    1949 Aug   148  127.    62.8  -42.1           85.2
 9 cts    1949 Sep   136  128.    16.5   -8.48         119. 
10 cts    1949 Oct   119  129.   -20.6   11.1          140. 
# ‚Ñπ 134 more rows</code></pre>
</div>
</div>
</section>
<section id="m√©todos-de-decomposici√≥n-2" class="slide level2">
<h2>M√©todos de decomposici√≥n</h2>
<p>Con <code>autoplot()</code> nos <span class="hl-yellow"><strong>visualiza cada componente</strong></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb379" data-code-line-numbers="5-6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb379-1"><a href="#cb379-1"></a>fit_airpass <span class="ot">&lt;-</span></span>
<span id="cb379-2"><a href="#cb379-2"></a>  airpass <span class="sc">|&gt;</span></span>
<span id="cb379-3"><a href="#cb379-3"></a>  <span class="fu">model</span>(<span class="at">cts =</span> <span class="fu">classical_decomposition</span>(value  <span class="sc">~</span> <span class="fu">season</span>(<span class="dv">12</span>), <span class="at">type =</span> <span class="st">"additive"</span>))</span>
<span id="cb379-4"><a href="#cb379-4"></a>fit_airpass <span class="sc">|&gt;</span></span>
<span id="cb379-5"><a href="#cb379-5"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span> </span>
<span id="cb379-6"><a href="#cb379-6"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-254-1.png" width="960" class="r-stretch"></section>
<section id="m√©todos-de-decomposici√≥n-3" class="slide level2">
<h2>M√©todos de decomposici√≥n</h2>
<p>As√≠ quedar√≠a en <span class="hl-yellow"><strong>modo multiplicativo</strong></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb380" data-code-line-numbers="3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb380-1"><a href="#cb380-1"></a>fit_airpass <span class="ot">&lt;-</span></span>
<span id="cb380-2"><a href="#cb380-2"></a>  airpass <span class="sc">|&gt;</span></span>
<span id="cb380-3"><a href="#cb380-3"></a>  <span class="fu">model</span>(<span class="at">cts =</span> <span class="fu">classical_decomposition</span>(value <span class="sc">~</span> <span class="fu">season</span>(<span class="dv">12</span>), <span class="at">type =</span> <span class="st">"mult"</span>))</span>
<span id="cb380-4"><a href="#cb380-4"></a>fit_airpass <span class="sc">|&gt;</span></span>
<span id="cb380-5"><a href="#cb380-5"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span> </span>
<span id="cb380-6"><a href="#cb380-6"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-255-1.png" width="960" class="r-stretch"></section>
<section id="m√©todos-de-decomposici√≥n-4" class="slide level2">
<h2>M√©todos de decomposici√≥n</h2>
<p>F√≠jate que el <span class="hl-yellow"><strong>modo multiplicativo es equivalente a tomar el logaritmo del valor objetivo</strong></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb381" data-code-line-numbers="3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb381-1"><a href="#cb381-1"></a>fit_airpass <span class="ot">&lt;-</span></span>
<span id="cb381-2"><a href="#cb381-2"></a>  airpass <span class="sc">|&gt;</span></span>
<span id="cb381-3"><a href="#cb381-3"></a>  <span class="fu">model</span>(<span class="at">cts =</span> <span class="fu">classical_decomposition</span>(<span class="fu">log</span>(value) <span class="sc">~</span> <span class="fu">season</span>(<span class="dv">12</span>), <span class="at">type =</span> <span class="st">"additive"</span>))</span>
<span id="cb381-4"><a href="#cb381-4"></a>fit_airpass <span class="sc">|&gt;</span></span>
<span id="cb381-5"><a href="#cb381-5"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span> </span>
<span id="cb381-6"><a href="#cb381-6"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-256-1.png" width="960" class="r-stretch"></section>
<section id="m√©todos-de-decomposici√≥n-5" class="slide level2">
<h2>M√©todos de decomposici√≥n</h2>
<ul>
<li><code>STL(var_objetivo ~ trend(window = ..., degre = ...) + season(period = ..., window = "periodic"))</code>: la predicci√≥n a horizonte <span class="math inline">\(h\)</span> se define tambi√©n como una <span class="hl-yellow"><strong>descomposici√≥n cl√°sica en tendencia y estacionalidad</strong></span> pero ahora la <span class="hl-yellow"><strong>tendencia es estimada mediante una regresi√≥n local</strong></span> conocida como <strong>regresi√≥n LOESS o LOWESS</strong>. Dicha regresi√≥n ajusta a los datos una <strong>regresi√≥n polin√≥mica (degree) pero de manera LOCAL</strong>, en cada punto solo se utiliza un n√∫mero <code>window</code> de observaciones).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb382" data-code-line-numbers="4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb382-1"><a href="#cb382-1"></a><span class="fu">library</span>(feasts)</span>
<span id="cb382-2"><a href="#cb382-2"></a>fit_airpass <span class="ot">&lt;-</span></span>
<span id="cb382-3"><a href="#cb382-3"></a>  airpass <span class="sc">|&gt;</span></span>
<span id="cb382-4"><a href="#cb382-4"></a>  <span class="fu">model</span>(<span class="at">stl =</span> <span class="fu">STL</span>(value <span class="sc">~</span> <span class="fu">trend</span>(<span class="at">window =</span> <span class="dv">7</span>, <span class="at">degree =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="at">period =</span> <span class="dv">12</span>, <span class="at">window =</span> <span class="st">"periodic"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="m√©todos-de-decomposici√≥n-6" class="slide level2">
<h2>M√©todos de decomposici√≥n</h2>
<p>Para este tipo particular de m√©todos (<strong>m√©todos de decomposici√≥n STL</strong>) <code>components()</code> nos devuelve la tendencia estimada (<code>trend</code>), la estacionalidad (<code>season_s</code>), el residuo estimado (<code>remainder</code>) y la serie desestacionalizada (<code>season_adjust</code>, serie - season_s)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb383" data-code-line-numbers="4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb383-1"><a href="#cb383-1"></a>fit_airpass <span class="ot">&lt;-</span></span>
<span id="cb383-2"><a href="#cb383-2"></a>  airpass <span class="sc">|&gt;</span></span>
<span id="cb383-3"><a href="#cb383-3"></a>  <span class="fu">model</span>(<span class="at">stl =</span> <span class="fu">STL</span>(<span class="fu">log</span>(value) <span class="sc">~</span> <span class="fu">trend</span>(<span class="at">window =</span> <span class="dv">7</span>, <span class="at">degree =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="at">period =</span> <span class="dv">12</span>, <span class="at">window =</span> <span class="st">"periodic"</span>)))</span>
<span id="cb383-4"><a href="#cb383-4"></a>fit_airpass <span class="sc">|&gt;</span> <span class="fu">components</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A dable: 144 x 7 [1M]
# Key:     .model [1]
# :        log(value) = trend + season_12 + remainder
   .model    index `log(value)` trend season_12 remainder season_adjust
   &lt;chr&gt;     &lt;mth&gt;        &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
 1 stl    1949 Jan         4.72  4.87   -0.105   -0.0448           4.82
 2 stl    1949 Feb         4.77  4.87   -0.142    0.0408           4.91
 3 stl    1949 Mar         4.88  4.87   -0.0118   0.0213           4.89
 4 stl    1949 Apr         4.86  4.87   -0.0337   0.0256           4.89
 5 stl    1949 May         4.80  4.84   -0.0261  -0.0154           4.82
 6 stl    1949 Jun         4.91  4.81    0.106   -0.00733          4.80
 7 stl    1949 Jul         5.00  4.79    0.220   -0.0149           4.78
 8 stl    1949 Aug         5.00  4.80    0.221   -0.0198           4.78
 9 stl    1949 Sep         4.91  4.81    0.0864   0.0188           4.83
10 stl    1949 Oct         4.78  4.82   -0.0417  -0.00306          4.82
# ‚Ñπ 134 more rows</code></pre>
</div>
</div>
</section>
<section id="m√©todos-de-decomposici√≥n-7" class="slide level2">
<h2>M√©todos de decomposici√≥n</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb385" data-code-line-numbers="3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb385-1"><a href="#cb385-1"></a>fit_airpass <span class="sc">|&gt;</span></span>
<span id="cb385-2"><a href="#cb385-2"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span> </span>
<span id="cb385-3"><a href="#cb385-3"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-259-1.png" width="960" class="r-stretch"></section>
<section id="m√©todos-de-decomposici√≥n-8" class="slide level2">
<h2>M√©todos de decomposici√≥n</h2>
<p>F√≠jate que a menor valor en <code>window = ...</code> m√°s err√°tica es la tendencia‚Ä¶</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb386" data-code-line-numbers="3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1"></a>fit_airpass <span class="ot">&lt;-</span></span>
<span id="cb386-2"><a href="#cb386-2"></a>  airpass <span class="sc">|&gt;</span></span>
<span id="cb386-3"><a href="#cb386-3"></a>  <span class="fu">model</span>(<span class="at">stl =</span> <span class="fu">STL</span>(<span class="fu">log</span>(value) <span class="sc">~</span> <span class="fu">trend</span>(<span class="at">window =</span> <span class="dv">3</span>, <span class="at">degree =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="at">period =</span> <span class="dv">12</span>, <span class="at">window =</span> <span class="st">"periodic"</span>)))</span>
<span id="cb386-4"><a href="#cb386-4"></a>fit_airpass <span class="sc">|&gt;</span></span>
<span id="cb386-5"><a href="#cb386-5"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span> </span>
<span id="cb386-6"><a href="#cb386-6"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-260-1.png" width="960" class="r-stretch"></section>
<section id="m√©todos-de-decomposici√≥n-9" class="slide level2">
<h2>M√©todos de decomposici√≥n</h2>
<p>‚Ä¶ y a mayor valor en <code>window = ...</code> m√°s ‚Äúrecta‚Äù se convierte.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb387" data-code-line-numbers="3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb387-1"><a href="#cb387-1"></a>fit_airpass <span class="ot">&lt;-</span></span>
<span id="cb387-2"><a href="#cb387-2"></a>  airpass <span class="sc">|&gt;</span></span>
<span id="cb387-3"><a href="#cb387-3"></a>  <span class="fu">model</span>(<span class="at">stl =</span> <span class="fu">STL</span>(<span class="fu">log</span>(value) <span class="sc">~</span> <span class="fu">trend</span>(<span class="at">window =</span> <span class="dv">30</span>, <span class="at">degree =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="at">period =</span> <span class="dv">12</span>, <span class="at">window =</span> <span class="st">"periodic"</span>)))</span>
<span id="cb387-4"><a href="#cb387-4"></a>fit_airpass <span class="sc">|&gt;</span></span>
<span id="cb387-5"><a href="#cb387-5"></a>  <span class="fu">components</span>() <span class="sc">|&gt;</span> </span>
<span id="cb387-6"><a href="#cb387-6"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-261-1.png" width="960" class="r-stretch"></section>
<section id="tu-turno-12" class="slide level2">
<h2>üíª Tu turno</h2>
<h3 id="ejercicio-1-8"><span class="hl-yellow"><strong>Ejercicio 1</strong></span></h3>
<p>üíª Repite el proceso de creaci√≥n de modelos (los fable y los feast) y predicci√≥n (y su visualizaci√≥n) para los conjuntos de datos</p>
<ul>
<li><code>retiro</code></li>
<li><code>global_economy</code> (solo para Espa√±a) del paquete <code>{tsibbledata}</code></li>
<li><code>beer_ts</code> del paquete <code>{timeSeriesDataSets}</code></li>
<li><code>elec_ts</code> del paquete <code>{timeSeriesDataSets}</code></li>
<li><code>pedestrian</code> (variable <code>count</code>) del paquete <code>{timeSeriesDataSets}</code></li>
</ul>
<p>Determina a cual de los 9 tipos de series de Pegel pertenece cada una.</p>
</section></section>
<section>
<section id="clase-12" class="title-slide slide level1 center">
<h1>Clase 12: <span class="flow">m√©todos de alisado</span></h1>

</section>
<section id="alisado-doble-lineal-de-holt" class="slide level2">
<h2>Alisado doble (lineal) de Holt</h2>
<p>Como hemos visto el m√©todo anterior de alisado solo ajusta bien la <span class="hl-yellow"><strong>hip√≥tesis de que nuestros datos son localmente constantes</strong></span> tal que</p>
<p><span class="math display">\[\widehat{X}_{t+1|t} = \theta \widehat{X}_{t|t-1} + \left( 1 - \theta \right)X_t = \theta^{t}\widehat{X}_{1} + \left(1 - \theta \right) \sum_{j=0}^{t-1} \theta^{j} X_{t-j}\]</span></p>
<div class="fragment">
<p>A ese <strong>primer valor</strong> disponible se le conoce como <span class="hl-yellow"><strong>nivel de la serie</strong></span> y lo denotaremos como <span class="math inline">\(\ell_0\)</span></p>
<p><span class="math display">\[\widehat{X}_{t+1|t} = \theta^{t}\widehat{X}_{1} + \left(1 - \theta \right) \sum_{j=0}^{t-1} \theta^{j} X_{t-j} = \theta^{t}\ell_0 +  \sum_{j=0}^{t-1} \left(1 - \theta \right) \theta^{j} X_{t-j}\]</span></p>
</div>
</section>
<section id="alisado-doble-lineal-de-holt-1" class="slide level2">
<h2>Alisado doble (lineal) de Holt</h2>
<p><span class="math display">\[\widehat{X}_{t+1|t} = \theta^{t}\widehat{X}_{1} + \left(1 - \theta \right) \sum_{j=0}^{t-1} \theta^{j} X_{t-j} = \theta^{t}\ell_0 +  \sum_{j=0}^{t-1} \left(1 - \theta \right) \theta^{j} X_{t-j}\]</span></p>
<p>La ecuaci√≥n anterior la podemos <span class="hl-yellow"><strong>expresar de manera iterativa</strong></span> como</p>
<p><span class="math display">\[\begin{eqnarray}\widehat{X}_{t+h|t} &amp;=&amp; \ell_t \quad \text{predicci√≥n en base a componentes} \nonumber \\ \ell_t &amp;=&amp; \theta \ell_{t-1}+ \left( 1 - \theta \right)X_t \quad \text{suavizado de componentes} \end{eqnarray}\]</span></p>
</section>
<section id="alisado-doble-lineal-de-holt-2" class="slide level2">
<h2>Alisado doble (lineal) de Holt</h2>
<p><span class="math display">\[\begin{eqnarray}\widehat{X}_{t+h|t} &amp;=&amp; \ell_t \quad \text{predicci√≥n (en base a componentes)} \nonumber \\ \ell_t &amp;=&amp; \theta \ell_{t-1}+ \left( 1 - \theta \right)X_t \quad \text{suavizado de componentes} \end{eqnarray}\]</span></p>
<p>En 1957 Holt propuso extender este m√©todo a <span class="hl-yellow"><strong>datos con tendencia</strong></span>, incluyendo ahora dos componentes: nivel <span class="math inline">\(\ell_t\)</span> y tendencia <span class="math inline">\(\mu_t\)</span> (realizando un <span class="hl-yellow"><strong>doble suavizado iterativo</strong></span>)</p>
<p><span class="math display">\[\begin{eqnarray}\color{red}{\widehat{X}_{t+h|t}} &amp;=&amp; \color{red}{\ell_t + h*\mu_t} \quad \text{predicci√≥n (en base a componentes)} \nonumber \\ \color{purple}{\ell_{t}} &amp;=&amp; \color{purple}{\theta_1 \widehat{X}_{t|t-1} + \left( 1 - \theta_1 \right)X_t = \theta_1 \left( \ell_{t-1}+ \mu_{t-1} \right) + \left( 1 - \theta_1 \right)X_t} \quad \text{suavizado nivel} \nonumber \\ \color{green}{\mu_{t}} &amp;=&amp; \color{green}{\theta_2 \mu_{t-1}  + \left( 1 - \theta_2 \right)\widehat{\mu}_{t} = \theta_2 \mu_{t-1}  + \left( 1 - \theta_2 \right) \left( \ell_t - \ell_{t-1} \right)} \quad \text{suavizado tendencia} \end{eqnarray}\]</span></p>
</section>
<section id="alisado-doble-lineal-de-holt-3" class="slide level2">
<h2>Alisado doble (lineal) de Holt</h2>
<p><span class="math display">\[\begin{eqnarray}\color{red}{\widehat{X}_{t+h|t}} &amp;=&amp; \color{red}{\ell_t + h*\mu_t} \quad \text{predicci√≥n (en base a componentes)} \nonumber \\ \color{purple}{\ell_{t}} &amp;=&amp; \color{purple}{\theta_1 \widehat{X}_{t|t-1} + \left( 1 - \theta_1 \right)X_t = \theta_1 \left( \ell_{t-1}+ \mu_{t-1} \right) + \left( 1 - \theta_1 \right)X_t} \quad \text{suavizado nivel} \nonumber \\ \color{green}{\mu_{t}} &amp;=&amp; \color{green}{\theta_2 \mu_{t-1}  + \left( 1 - \theta_2 \right)\widehat{\mu}_{t} = \theta_2 \mu_{t-1}  + \left( 1 - \theta_2 \right) \left( \ell_t - \ell_{t-1} \right)} \quad \text{suavizado tendencia} \end{eqnarray}\]</span></p>
<div class="fragment">
<ul>
<li><span class="hl-red"><strong>Predicci√≥n a horizonte <span class="math inline">\(h\)</span></strong></span>: √∫ltimo nivel conocido m√°s <span class="math inline">\(h\)</span> veces la √∫ltima tendencia conocida (en <span class="math inline">\(h\)</span> instantes avanza <span class="math inline">\(h\)</span> veces la tendencia)</li>
</ul>
</div>
<div class="fragment">
<ul>
<li><span class="hl-purple"><strong>Estimaci√≥n nivel</strong></span>: media ponderada entre el √∫ltimo valor de la serie y <span class="math inline">\(\widehat{X}_{t|t-1}\)</span> (predicci√≥n a horizonte <span class="math inline">\(h = 1\)</span> en tiempo <span class="math inline">\(t\)</span>)</li>
</ul>
</div>
<div class="fragment">
<ul>
<li><span class="hl-green"><strong>Estimaci√≥n tendencia</strong></span>: media ponderada entre el √∫ltimo valor de la tendencia y la estimaci√≥n de la tendencia a tiempo <span class="math inline">\(t\)</span> (diferencia de nivel <span class="math inline">\(\ell_t\)</span> y <span class="math inline">\(\ell_{t-1}\)</span>)</li>
</ul>
</div>
</section>
<section id="alisado-doble-lineal-de-holt-4" class="slide level2">
<h2>Alisado doble (lineal) de Holt</h2>
<p>Para ello simplemente debemos usar <code>ETS()</code> incluyendo ahora tendencia aditiva <code>trend("A")</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb388"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1"></a>airpass <span class="ot">&lt;-</span> AirPassengers <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>()</span>
<span id="cb388-2"><a href="#cb388-2"></a>fit_airpass <span class="ot">&lt;-</span></span>
<span id="cb388-3"><a href="#cb388-3"></a>  airpass <span class="sc">|&gt;</span></span>
<span id="cb388-4"><a href="#cb388-4"></a>  <span class="fu">model</span>(<span class="at">alisado_simple =</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"N"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb388-5"><a href="#cb388-5"></a>        <span class="at">alisado_doble =</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)))</span>
<span id="cb388-6"><a href="#cb388-6"></a></span>
<span id="cb388-7"><a href="#cb388-7"></a>estimaciones <span class="ot">&lt;-</span> fit_airpass <span class="sc">|&gt;</span> <span class="fu">augment</span>()</span>
<span id="cb388-8"><a href="#cb388-8"></a>predicciones <span class="ot">&lt;-</span> fit_airpass <span class="sc">|&gt;</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">12</span>)</span>
<span id="cb388-9"><a href="#cb388-9"></a>estimaciones</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 288 x 6 [1M]
# Key:       .model [2]
   .model            index value .fitted    .resid    .innov
   &lt;chr&gt;             &lt;mth&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 alisado_simple 1949 Jan   112    112.  -0.0948   -0.0948 
 2 alisado_simple 1949 Feb   118    112.   6.00      6.00   
 3 alisado_simple 1949 Mar   132    118.  14.0      14.0    
 4 alisado_simple 1949 Apr   129    132.  -3.00     -3.00   
 5 alisado_simple 1949 May   121    129.  -8.00     -8.00   
 6 alisado_simple 1949 Jun   135    121.  14.0      14.0    
 7 alisado_simple 1949 Jul   148    135.  13.0      13.0    
 8 alisado_simple 1949 Aug   148    148.   0.00130   0.00130
 9 alisado_simple 1949 Sep   136    148. -12.0     -12.0    
10 alisado_simple 1949 Oct   119    136. -17.0     -17.0    
# ‚Ñπ 278 more rows</code></pre>
</div>
</div>
</section>
<section id="alisado-doble-lineal-de-holt-5" class="slide level2">
<h2>Alisado doble (lineal) de Holt</h2>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb390"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb390-1"><a href="#cb390-1"></a>predicciones <span class="sc">|&gt;</span> </span>
<span id="cb390-2"><a href="#cb390-2"></a>  <span class="fu">autoplot</span>(airpass, <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb390-3"><a href="#cb390-3"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> estimaciones, <span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> .fitted, <span class="at">color =</span> .model)) <span class="sc">+</span></span>
<span id="cb390-4"><a href="#cb390-4"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> predicciones, <span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> .mean, <span class="at">color =</span> .model)) <span class="sc">+</span></span>
<span id="cb390-5"><a href="#cb390-5"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> ggthemes<span class="sc">::</span><span class="fu">colorblind_pal</span>()(<span class="dv">3</span>)[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb390-6"><a href="#cb390-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-263-1.png" width="960" class="r-stretch"></section>
<section id="alisado-doble-de-gardner-mckenzie" class="slide level2">
<h2>Alisado doble de Gardner-McKenzie</h2>
<p>Las predicciones generadas por el alisado doble de Holt nos dan una <span class="hl-yellow"><strong>tendencia constante (creciente o decreciente) indefinidamente hacia el infinito</strong></span>. Sin embargo, la evidencia emp√≠rica indica que estos m√©todos <span class="hl-yellow"><strong>tienden a sobrepronosticar a horizontes de previsi√≥n m√°s largos</strong></span>.</p>
<div class="fragment">
<p>Para solventar esto Gardner y McKenzie (1985) introdujeron un <span class="hl-yellow"><strong>par√°metro de amortiguaci√≥n <span class="math inline">\(\phi\)</span></strong></span>: la <span class="hl-yellow"><strong>predicci√≥n a futuro empieza siendo una l√≠nea recta que termina dobl√°ndose</strong></span> hasta acabar en una recta.</p>
</div>
</section>
<section id="alisado-doble-de-gardner-mckenzie-1" class="slide level2">
<h2>Alisado doble de Gardner-McKenzie</h2>
<p><span class="math display">\[\begin{eqnarray}\color{red}{\widehat{X}_{t+h|t}} &amp;=&amp; \color{red}{\ell_t} + \color{blue}{\left( \phi+\phi^2 + \dots + \phi^{h}\right)*\mu_t} \quad \text{predicci√≥n (en base a componentes)} \nonumber \\ \color{purple}{\ell_{t}} &amp;=&amp; \color{purple}{\theta_1 ( \ell_{t-1}+} \color{blue}{\phi}\color{purple}{\mu_{t-1} ) + \left( 1 - \theta_1 \right)X_t} \quad \text{suavizado nivel} \nonumber \\ \color{green}{\mu_{t}} &amp;=&amp; \color{green}{\theta_2} \color{blue}{\phi\mu_{t-1}} \color{green}{+ \left( 1 - \theta_2 \right) \left( \ell_t - \ell_{t-1} \right)} \quad \text{suavizado tendencia} \end{eqnarray}\]</span></p>
<p>con <span class="math inline">\(\color{blue}{0 &lt; \phi &lt; 1}\)</span>.</p>
<div class="fragment">
<ul>
<li><span class="hl-red"><strong>Predicci√≥n a horizonte <span class="math inline">\(h\)</span></strong></span>: √∫ltimo nivel conocido m√°s un amortiguamiento de nivel <span class="math inline">\(h\)</span> de la √∫ltima tendencia conocida</li>
</ul>
<p>As√≠ cuando <span class="math inline">\(h \to infty\)</span> tenemos que la predicci√≥n acaba siendo una constante.</p>
<p><span class="math display">\[\begin{eqnarray}\lim_{h \to \infty} \widehat{X}_{t+h|t} &amp;=&amp; \ell_t + \lim_{h \to \infty} \left( \phi+\phi^2 + \dots + \phi^{h}\right)*\mu_t \nonumber \\
&amp;=&amp; \ell_t + \frac{\phi}{1-\phi}\mu_t\end{eqnarray}\]</span></p>
</div>
</section>
<section id="alisado-doble-de-gardner-mckenzie-2" class="slide level2">
<h2>Alisado doble de Gardner-McKenzie</h2>
<p>Para ello simplemente debemos usar <code>ETS()</code> incluyendo ahora tendencia aditiva <code>trend("Ad")</code> (additive dumped)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb391"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb391-1"><a href="#cb391-1"></a>airpass <span class="ot">&lt;-</span> AirPassengers <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>()</span>
<span id="cb391-2"><a href="#cb391-2"></a>fit_airpass <span class="ot">&lt;-</span></span>
<span id="cb391-3"><a href="#cb391-3"></a>  airpass <span class="sc">|&gt;</span></span>
<span id="cb391-4"><a href="#cb391-4"></a>  <span class="fu">model</span>(<span class="at">alisado_simple =</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"N"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb391-5"><a href="#cb391-5"></a>        <span class="at">alisado_doble =</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb391-6"><a href="#cb391-6"></a>        <span class="at">alisado_doble_amortiguado =</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"Ad"</span>, <span class="at">phi =</span> <span class="fl">0.4</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)))</span>
<span id="cb391-7"><a href="#cb391-7"></a></span>
<span id="cb391-8"><a href="#cb391-8"></a>estimaciones <span class="ot">&lt;-</span> fit_airpass <span class="sc">|&gt;</span> <span class="fu">augment</span>()</span>
<span id="cb391-9"><a href="#cb391-9"></a>predicciones <span class="ot">&lt;-</span> fit_airpass <span class="sc">|&gt;</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">8</span>)</span>
<span id="cb391-10"><a href="#cb391-10"></a>estimaciones</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 432 x 6 [1M]
# Key:       .model [3]
   .model            index value .fitted    .resid    .innov
   &lt;chr&gt;             &lt;mth&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 alisado_simple 1949 Jan   112    112.  -0.0948   -0.0948 
 2 alisado_simple 1949 Feb   118    112.   6.00      6.00   
 3 alisado_simple 1949 Mar   132    118.  14.0      14.0    
 4 alisado_simple 1949 Apr   129    132.  -3.00     -3.00   
 5 alisado_simple 1949 May   121    129.  -8.00     -8.00   
 6 alisado_simple 1949 Jun   135    121.  14.0      14.0    
 7 alisado_simple 1949 Jul   148    135.  13.0      13.0    
 8 alisado_simple 1949 Aug   148    148.   0.00130   0.00130
 9 alisado_simple 1949 Sep   136    148. -12.0     -12.0    
10 alisado_simple 1949 Oct   119    136. -17.0     -17.0    
# ‚Ñπ 422 more rows</code></pre>
</div>
</div>
</section>
<section id="alisado-doble-de-gardner-mckenzie-3" class="slide level2">
<h2>Alisado doble de Gardner-McKenzie</h2>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb393"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb393-1"><a href="#cb393-1"></a>predicciones <span class="sc">|&gt;</span> </span>
<span id="cb393-2"><a href="#cb393-2"></a>  <span class="fu">autoplot</span>(airpass, <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb393-3"><a href="#cb393-3"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> estimaciones, <span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> .fitted, <span class="at">color =</span> .model)) <span class="sc">+</span></span>
<span id="cb393-4"><a href="#cb393-4"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> predicciones, <span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> .mean, <span class="at">color =</span> .model)) <span class="sc">+</span></span>
<span id="cb393-5"><a href="#cb393-5"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> ggthemes<span class="sc">::</span><span class="fu">colorblind_pal</span>()(<span class="dv">4</span>)[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb393-6"><a href="#cb393-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-265-1.png" width="960" class="r-stretch"></section></section>
<section>
<section id="clase-13" class="title-slide slide level1 center">
<h1>Clase 13: <span class="flow">m√©todos de alisado</span></h1>

</section>
<section id="alisado-triple-de-holt-winters" class="slide level2">
<h2>Alisado triple de Holt-Winters</h2>
<p>Veamos un <strong>repaso de los m√©todos de alisado</strong> explicados.</p>
<div class="fragment">
<ul>
<li><span class="hl-yellow"><strong>Alisado simple</strong></span>: la predicci√≥n de la serie a horizonte <span class="math inline">\(h\)</span> es el √∫ltimo nivel de la serie estimado (donde se estim√≥ que la serie la √∫ltima vez). Dicho nivel se obtiene de manera iterativa <span class="hl-yellow"><strong>ponderando el nivel previo (la estimaci√≥n anterior) y la √∫ltima observaci√≥n real</strong></span></li>
</ul>
<p><span class="math display">\[\begin{eqnarray}\color{red}{\widehat{X}_{t+h|t}} &amp;=&amp; \color{purple}{\ell_t} \quad \text{predicci√≥n (en base a componentes)} \nonumber \\ \color{purple}{\ell_t} &amp;=&amp; \theta \color{purple}{\ell_{t-1}}+ \left( 1 - \theta \right)X_t \quad \text{suavizado de componentes} \end{eqnarray}\]</span></p>
</div>
</section>
<section id="alisado-triple-de-holt-winters-1" class="slide level2">
<h2>Alisado triple de Holt-Winters</h2>
<ul>
<li><span class="hl-yellow"><strong>Alisado doble</strong></span>: la predicci√≥n de la serie a horizonte <span class="math inline">\(h\)</span> es el <span class="hl-yellow"><strong>√∫ltimo nivel de la serie estimado (donde se estim√≥ la serie la √∫ltima vez) y la √∫ltima pendiente estimada</strong></span>: para predecir donde estar√° en la carretera a las 5h uso donde estaba a las 4h y la pendiente de la carretera en ese momento.</li>
</ul>
<p>Como antes, el nivel se obtiene iterativamente <strong>ponderando el nivel previo (estimaci√≥n anterior) y la √∫ltima observaci√≥n</strong>. La pendiente se estima de la misma forma, usando la predicci√≥n de la estimaci√≥n y la √∫ltima estimaci√≥n disponible.</p>
<p><span class="math display">\[\begin{eqnarray}\color{red}{\widehat{X}_{t+h|t}} &amp;=&amp; \color{purple}{\ell_t} + h*\color{green}{\mu_t} \quad \text{predicci√≥n (en base a componentes)} \nonumber \\ \color{purple}{\ell_{t}} &amp;=&amp; \theta_1 \color{red}{\widehat{X}_{t|t-1}} + \left( 1 - \theta_1 \right)X_t = \theta_1 \left( \color{purple}{\ell_{t-1}}+ \color{green}{\mu_{t-1}} \right) + \left( 1 - \theta_1 \right)X_t \quad \text{suavizado nivel} \nonumber \\ \color{green}{\mu_{t}} &amp;=&amp; \theta_2 \widehat{\mu}_{t}   + \left( 1 - \theta_2 \right) \color{green}{\mu_{t-1}}= \theta_2 \left( \color{purple}{\ell_t - \ell_{t-1}} \right)   + \left( 1 - \theta_2 \right) \color{green}{\mu_{t-1}} \quad \text{suavizado tendencia} \end{eqnarray}\]</span></p>
</section>
<section id="alisado-triple-de-holt-winters-2" class="slide level2">
<h2>Alisado triple de Holt-Winters</h2>
<p>Unos a√±os m√°s tarde, Holt y Winters (1960) ampliaron los m√©todos anteriores para <span class="hl-yellow"><strong>poder capturar la estacionalidad</strong></span>. Se conoce como <span class="hl-yellow"><strong>alisado triple</strong></span> ya que tendremos ahora tres ecuaciones de suavizado: suavizado del nivel, suavizado de la tendencia y suavizado de la componente estacional.</p>
<div class="fragment">
<p>Ahora tendremos 4 par√°metros:</p>
<ul>
<li><p>par√°metros de suavizado <span class="math inline">\(\left(\theta_1, \theta_2, \theta_3 \right)\)</span></p></li>
<li><p>par√°metro de estacionalidad <span class="math inline">\(s\)</span></p></li>
</ul>
</div>
<div class="fragment">
<p>Y tendremos <span class="hl-yellow"><strong>dos tipos de formas de incluir la estacionalidad</strong></span>: aditivo (varianza constante a lo largo del tiempo, la componente estacional se expresa en t√©rminos absolutos) y multiplicativo (la componente estacional se expresa en t√©rminos relativos, en porcentajes).</p>
</div>
</section>
<section id="alisado-triple-de-holt-winters-3" class="slide level2">
<h2>Alisado triple de Holt-Winters</h2>
<p>La idea es que ahora, al nivel y la tendencia, para predecir la serie a horizonte <span class="math inline">\(h\)</span> le sumaremos una <span class="hl-yellow"><strong>componente estacional</strong></span>. Imagina que tenemos una serie mensual con <span class="math inline">\(s= 12\)</span> (periodicidad anual). ¬øCu√°nto valdr√° la predicci√≥n de <span class="math inline">\(t+1\)</span> con los datos hasta <span class="math inline">\(t\)</span>?</p>
<div class="fragment">
<p><span class="math display">\[\color{red}{\widehat{X}_{t+1|t}} = \color{purple}{\ell_t} + \color{green}{\mu_t} + \color{blue}{s_{t+1}}\]</span></p>
<p>¬øY en <span class="math inline">\(t+2\)</span>?</p>
</div>
<div class="fragment">
<p><span class="math display">\[\color{red}{\widehat{X}_{t+2|t}} = \color{purple}{\ell_t} + 2*\color{green}{\mu_t} + \color{blue}{s_{t+2}}\]</span></p>
<p>F√≠jate que en el <span class="hl-yellow">**nivel y la tendencia el valor m√°s reciente que podemos usar es <span class="math inline">\(t\)</span>*</span> pero <span class="math inline">\(s_{t+2}\)</span> s√≠ est√° disponible ya que es peri√≥dica, es decir, <span class="math inline">\(s_{t+2} = s_{(t+2) - s}\)</span></p>
</div>
<div class="fragment">
<p>¬øY si <span class="math inline">\(h = 13\)</span>?</p>
</div>
</section>
<section id="alisado-triple-de-holt-winters-4" class="slide level2">
<h2>Alisado triple de Holt-Winters</h2>
<p><span class="math display">\[\color{red}{\widehat{X}_{t+13|t}} = \color{purple}{\ell_t} + 13*\color{green}{\mu_t} + \color{blue}{s_{t+13}}\]</span> Pero como tenemos una periodicidad <span class="math inline">\(s = 12\)</span>, entonces <span class="math inline">\(s_{t+13} = s_{t+13-12} = s_{t+1}\)</span>: le <span class="hl-yellow"><strong>hemos restado la cantidad de a√±os completos que hab√≠a en <span class="math inline">\(h = 13\)</span></strong></span>.</p>
<div class="fragment">
<p>De manera coloquial podemos expresarlo de manera general como</p>
<p><span class="math display">\[\color{red}{\widehat{X}_{t+h|t}} = \color{purple}{\ell_t} + h*\color{green}{\mu_t} + \color{blue}{s_{(t+h) - s*per.comp}}\]</span></p>
<p>donde <span class="math inline">\(per.comp\)</span> es el n√∫mero de <strong>periodos completos</strong> (en este caso a√±os) que han pasado en tiempo <span class="math inline">\(h\)</span>. Matem√°ticamente es</p>
<p><span class="math display">\[\color{red}{\widehat{X}_{t+h|t}} = \color{purple}{\ell_t} + h*\color{green}{\mu_t} + \color{blue}{s_{(t+h) - s*(k + 1)}}, \quad k = \lfloor \frac{h-1}{s} \rfloor\]</span></p>
</div>
</section>
<section id="alisado-triple-de-holt-winters-5" class="slide level2">
<h2>Alisado triple de Holt-Winters</h2>
<p><span class="math display">\[\color{red}{\widehat{X}_{t+h|t}} = \color{purple}{\ell_t} + h*\color{green}{\mu_t} + \color{blue}{s_{(t+h) - s*per.comp}}\]</span> Se conoce como <span class="hl-yellow"><strong>alisado triple</strong></span> ya que tendremos que suavizar de manera iterativa tres componentes: nivel, tendencia y estacionalidad.</p>
<div class="fragment">
<p>Si entendemos el <strong>nivel como ¬´en que punto est√° la serie¬ª</strong>, y dado que la componente estacional es c√≠clica (¬´por d√≥nde va la tasa de paro¬ª deber√≠a ser ajeno a si es navidad o verano), el <span class="hl-yellow"><strong>nivel ser√° suavizado ponderando la √∫ltima predicci√≥n y la serie desestacionalizada por el periodo previo</strong></span></p>
<p><span class="math display">\[\begin{eqnarray}\color{red}{\widehat{X}_{t+h|t}} &amp;=&amp; \color{purple}{\ell_t} + h*\color{green}{\mu_t} + \color{blue}{s_{(t+h) - s*per.comp}} \nonumber \\ \color{purple}{\ell_{t}} &amp;=&amp; \theta_1 \color{red}{\widehat{X}_{t|t-1}} + \left( 1 - \theta_1 \right)X_t = \theta_1 \left( \color{purple}{\ell_{t-1}}+ \color{green}{\mu_{t-1}} \right) + \left( 1 - \theta_1 \right) \left(X_t - \color{blue}{s_{t-s}} \right) \nonumber \\ \color{green}{\mu_{t}} &amp;=&amp; \theta_2 \widehat{\mu}_{t}   + \left( 1 - \theta_2 \right) \color{green}{\mu_{t-1}}= \theta_2 \left( \color{purple}{\ell_t - \ell_{t-1}} \right)   + \left( 1 - \theta_2 \right) \color{green}{\mu_{t-1}}\end{eqnarray}\]</span></p>
</div>
</section>
<section id="alisado-triple-de-holt-winters-6" class="slide level2">
<h2>Alisado triple de Holt-Winters</h2>
<p>Por √∫ltimo, el suavizado de la estacionalidad ser√° similar: una <span class="hl-yellow"><strong>ponderaci√≥n entre la estimaci√≥n de la misma</strong></span> y la <span class="hl-yellow"><strong>√∫ltima estacionalidad (hace s periodos)</strong></span></p>
<p><span class="math display">\[\begin{eqnarray}\color{red}{\widehat{X}_{t+h|t}} &amp;=&amp; \color{purple}{\ell_t} + h*\color{green}{\mu_t} + \color{blue}{s_{(t+h) - s*per.comp}} \nonumber \\ \color{purple}{\ell_{t}} &amp;=&amp; \theta_1 \color{red}{\widehat{X}_{t|t-1}} + \left( 1 - \theta_1 \right)X_t = \theta_1 \left( \color{purple}{\ell_{t-1}}+ \color{green}{\mu_{t-1}} \right) + \left( 1 - \theta_1 \right) \left(X_t - \color{blue}{s_{t-s}} \right) \nonumber \\ \color{green}{\mu_{t}} &amp;=&amp; \theta_2 \widehat{\mu}_{t}   + \left( 1 - \theta_2 \right) \color{green}{\mu_{t-1}}= \theta_2 \left( \color{purple}{\ell_t - \ell_{t-1}} \right)   + \left( 1 - \theta_2 \right) \color{green}{\mu_{t-1}} \nonumber \\ \color{blue}{s_{t}} &amp;=&amp; \theta_3 \color{blue}{\widehat{s}_{t}} + \left( 1 - \theta_3 \right) \color{blue}{s_{t-s}} = \theta_3(X_{t}-\color{purple}{\ell_{t-1}} - \color{green}{\mu_{t-1}}) + \left( 1 - \theta_3 \right) \color{blue}{s_{t-s}},\end{eqnarray}\]</span></p>
</section>
<section id="alisado-triple-de-holt-winters-7" class="slide level2">
<h2>Alisado triple de Holt-Winters</h2>
<p>Para realizar el triple alisado simplemente debemos usar <code>ETS()</code> incluyendo ahora estacionalidad (aditiva <code>season("A")</code> o multiplicativa <code>season("M")</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb394"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb394-1"><a href="#cb394-1"></a>airpass <span class="ot">&lt;-</span> AirPassengers <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>()</span>
<span id="cb394-2"><a href="#cb394-2"></a>fit_airpass <span class="ot">&lt;-</span></span>
<span id="cb394-3"><a href="#cb394-3"></a>  airpass <span class="sc">|&gt;</span></span>
<span id="cb394-4"><a href="#cb394-4"></a>  <span class="fu">model</span>(<span class="st">"alisado_simple"</span> <span class="ot">=</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"N"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb394-5"><a href="#cb394-5"></a>        <span class="st">"alisado_doble"</span> <span class="ot">=</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb394-6"><a href="#cb394-6"></a>        <span class="st">"alisado_triple"</span> <span class="ot">=</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"A"</span>)))</span>
<span id="cb394-7"><a href="#cb394-7"></a></span>
<span id="cb394-8"><a href="#cb394-8"></a>estimaciones <span class="ot">&lt;-</span> fit_airpass <span class="sc">|&gt;</span> <span class="fu">augment</span>()</span>
<span id="cb394-9"><a href="#cb394-9"></a>predicciones <span class="ot">&lt;-</span> fit_airpass <span class="sc">|&gt;</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">36</span>)</span>
<span id="cb394-10"><a href="#cb394-10"></a>estimaciones</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 432 x 6 [1M]
# Key:       .model [3]
   .model            index value .fitted    .resid    .innov
   &lt;chr&gt;             &lt;mth&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 alisado_simple 1949 Jan   112    112.  -0.0948   -0.0948 
 2 alisado_simple 1949 Feb   118    112.   6.00      6.00   
 3 alisado_simple 1949 Mar   132    118.  14.0      14.0    
 4 alisado_simple 1949 Apr   129    132.  -3.00     -3.00   
 5 alisado_simple 1949 May   121    129.  -8.00     -8.00   
 6 alisado_simple 1949 Jun   135    121.  14.0      14.0    
 7 alisado_simple 1949 Jul   148    135.  13.0      13.0    
 8 alisado_simple 1949 Aug   148    148.   0.00130   0.00130
 9 alisado_simple 1949 Sep   136    148. -12.0     -12.0    
10 alisado_simple 1949 Oct   119    136. -17.0     -17.0    
# ‚Ñπ 422 more rows</code></pre>
</div>
</div>
</section>
<section id="alisado-triple-de-holt-winters-8" class="slide level2">
<h2>Alisado triple de Holt-Winters</h2>
<p>F√≠jate que las ¬´monta√±itas¬ª ahora suben pero no incrementan su altura, simplemente acaban un poco m√°s arriba ya que tenemos una componente de tendencia.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb396"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb396-1"><a href="#cb396-1"></a>predicciones <span class="sc">|&gt;</span> </span>
<span id="cb396-2"><a href="#cb396-2"></a>  <span class="fu">autoplot</span>(airpass, <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb396-3"><a href="#cb396-3"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> estimaciones, <span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> .fitted, <span class="at">color =</span> .model)) <span class="sc">+</span></span>
<span id="cb396-4"><a href="#cb396-4"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> predicciones, <span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> .mean, <span class="at">color =</span> .model)) <span class="sc">+</span></span>
<span id="cb396-5"><a href="#cb396-5"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> ggthemes<span class="sc">::</span><span class="fu">colorblind_pal</span>()(<span class="dv">4</span>)[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb396-6"><a href="#cb396-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-267-1.png" width="960" class="r-stretch"></section>
<section id="alisado-triple-de-holt-winters-9" class="slide level2">
<h2>Alisado triple de Holt-Winters</h2>
<p><span class="math display">\[\begin{eqnarray}\color{red}{\widehat{X}_{t+h|t}} &amp;=&amp; \color{purple}{\ell_t} + h*\color{green}{\mu_t} + \color{blue}{s_{(t+h) - s*per.comp}} \nonumber \\ \color{purple}{\ell_{t}} &amp;=&amp; \theta_1 \color{red}{\widehat{X}_{t|t-1}} + \left( 1 - \theta_1 \right)X_t = \theta_1 \left( \color{purple}{\ell_{t-1}}+ \color{green}{\mu_{t-1}} \right) + \left( 1 - \theta_1 \right) \left(X_t - \color{blue}{s_{t-s}} \right) \nonumber \\ \color{green}{\mu_{t}} &amp;=&amp; \theta_2 \widehat{\mu}_{t}   + \left( 1 - \theta_2 \right) \color{green}{\mu_{t-1}}= \theta_2 \left( \color{purple}{\ell_t - \ell_{t-1}} \right)   + \left( 1 - \theta_2 \right) \color{green}{\mu_{t-1}} \nonumber \\ \color{blue}{s_{t}} &amp;=&amp; \theta_3 \color{blue}{\widehat{s}_{t}} + \left( 1 - \theta_3 \right) \color{blue}{s_{t-s}} = \theta_3(X_{t}-\color{purple}{\ell_{t-1}} - \color{green}{\mu_{t-1}}) + \left( 1 - \theta_3 \right) \color{blue}{s_{t-s}},\end{eqnarray}\]</span></p>
<p>La <span class="hl-yellow"><strong>versi√≥n multiplicativa</strong></span> ser√≠a realizar el mismo alisado pero la estacionalidad ahora <span class="hl-yellow"><strong>siempre aparece multiplicando</strong></span></p>
<div class="fragment">
<p><span class="math display">\[\begin{eqnarray}\color{red}{\widehat{X}_{t+h|t}} &amp;=&amp; \left(\color{purple}{\ell_t} + h*\color{green}{\mu_t} \right) \color{blue}{s_{(t+h) - s*per.comp}} \nonumber \\ \color{purple}{\ell_{t}} &amp;=&amp; \theta_1 \color{red}{\widehat{X}_{t|t-1}} + \left( 1 - \theta_1 \right)X_t = \theta_1 \left( \color{purple}{\ell_{t-1}}+ \color{green}{\mu_{t-1}} \right) + \left( 1 - \theta_1 \right) \frac{X_t}{\color{blue}{s_{t-s}}} \nonumber \\ \color{green}{\mu_{t}} &amp;=&amp; \theta_2 \widehat{\mu}_{t}   + \left( 1 - \theta_2 \right) \color{green}{\mu_{t-1}}= \theta_2 \left( \color{purple}{\ell_t - \ell_{t-1}} \right)   + \left( 1 - \theta_2 \right) \color{green}{\mu_{t-1}} \nonumber \\ \color{blue}{s_{t}} &amp;=&amp; \theta_3 \color{blue}{\widehat{s}_{t}} + \left( 1 - \theta_3 \right) \color{blue}{s_{t-s}} = \theta_3\left(\frac{X_{t}}{\color{purple}{\ell_{t-1}} + \color{green}{\mu_{t-1}}} \right) + \left( 1 - \theta_3 \right) \color{blue}{s_{t-s}},\end{eqnarray}\]</span></p>
</div>
</section>
<section id="alisado-triple-de-holt-winters-10" class="slide level2">
<h2>Alisado triple de Holt-Winters</h2>
<p>Si <code>season("M")</code> el residuo tambi√©n ser√° multiplicativo <code>error("M")</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb397"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb397-1"><a href="#cb397-1"></a>airpass <span class="ot">&lt;-</span> AirPassengers <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>()</span>
<span id="cb397-2"><a href="#cb397-2"></a>fit_airpass <span class="ot">&lt;-</span></span>
<span id="cb397-3"><a href="#cb397-3"></a>  airpass <span class="sc">|&gt;</span></span>
<span id="cb397-4"><a href="#cb397-4"></a>  <span class="fu">model</span>(<span class="st">"alisado_simple"</span> <span class="ot">=</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"N"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb397-5"><a href="#cb397-5"></a>        <span class="st">"alisado_doble"</span> <span class="ot">=</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb397-6"><a href="#cb397-6"></a>        <span class="st">"alisado_triple_ad"</span> <span class="ot">=</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"A"</span>)),</span>
<span id="cb397-7"><a href="#cb397-7"></a>        <span class="st">"alisado_triple_mult"</span> <span class="ot">=</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"M"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"M"</span>)))</span>
<span id="cb397-8"><a href="#cb397-8"></a></span>
<span id="cb397-9"><a href="#cb397-9"></a>estimaciones <span class="ot">&lt;-</span> fit_airpass <span class="sc">|&gt;</span> <span class="fu">augment</span>()</span>
<span id="cb397-10"><a href="#cb397-10"></a>predicciones <span class="ot">&lt;-</span> fit_airpass <span class="sc">|&gt;</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">36</span>)</span>
<span id="cb397-11"><a href="#cb397-11"></a>estimaciones</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 576 x 6 [1M]
# Key:       .model [4]
   .model            index value .fitted    .resid    .innov
   &lt;chr&gt;             &lt;mth&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 alisado_simple 1949 Jan   112    112.  -0.0948   -0.0948 
 2 alisado_simple 1949 Feb   118    112.   6.00      6.00   
 3 alisado_simple 1949 Mar   132    118.  14.0      14.0    
 4 alisado_simple 1949 Apr   129    132.  -3.00     -3.00   
 5 alisado_simple 1949 May   121    129.  -8.00     -8.00   
 6 alisado_simple 1949 Jun   135    121.  14.0      14.0    
 7 alisado_simple 1949 Jul   148    135.  13.0      13.0    
 8 alisado_simple 1949 Aug   148    148.   0.00130   0.00130
 9 alisado_simple 1949 Sep   136    148. -12.0     -12.0    
10 alisado_simple 1949 Oct   119    136. -17.0     -17.0    
# ‚Ñπ 566 more rows</code></pre>
</div>
</div>
</section>
<section id="alisado-triple-de-holt-winters-11" class="slide level2">
<h2>Alisado triple de Holt-Winters</h2>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb399"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb399-1"><a href="#cb399-1"></a>predicciones <span class="sc">|&gt;</span> </span>
<span id="cb399-2"><a href="#cb399-2"></a>  <span class="fu">autoplot</span>(airpass, <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb399-3"><a href="#cb399-3"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> estimaciones, <span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> .fitted, <span class="at">color =</span> .model)) <span class="sc">+</span></span>
<span id="cb399-4"><a href="#cb399-4"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> predicciones, <span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> .mean, <span class="at">color =</span> .model)) <span class="sc">+</span></span>
<span id="cb399-5"><a href="#cb399-5"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> ggthemes<span class="sc">::</span><span class="fu">colorblind_pal</span>()(<span class="dv">5</span>)[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb399-6"><a href="#cb399-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-269-1.png" width="960" class="r-stretch"></section></section>
<section>
<section id="clase-14" class="title-slide slide level1 center">
<h1>Clase 14: <span class="flow">evaluaci√≥n</span></h1>

</section>
<section id="diagnosis-errores" class="slide level2">
<h2>Diagnosis errores</h2>
<p>Como ya hicimos una vez en clase, es importante realizar una <span class="hl-yellow"><strong>diagnosis correcta de los residuales</strong></span>. Para ello tenemos la funci√≥n <code>gg_tsresiduals()</code> del paquete <code>{feasts}</code> que nos permite visualizar su <strong>evoluci√≥n temporal</strong>, sus <strong>autocorrelaciones</strong> y su <strong>distribuci√≥n</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb400"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb400-1"><a href="#cb400-1"></a>alisado_simple <span class="ot">&lt;-</span></span>
<span id="cb400-2"><a href="#cb400-2"></a>  airpass <span class="sc">|&gt;</span></span>
<span id="cb400-3"><a href="#cb400-3"></a>  <span class="fu">model</span>(<span class="st">"alisado_simple"</span> <span class="ot">=</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"N"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)))</span>
<span id="cb400-4"><a href="#cb400-4"></a></span>
<span id="cb400-5"><a href="#cb400-5"></a>alisado_simple <span class="sc">|&gt;</span></span>
<span id="cb400-6"><a href="#cb400-6"></a>  <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="diagnosis-errores-1" class="slide level2">
<h2>Diagnosis errores</h2>
<p>Por ejemplo en el caso del alisado simple observamos como los <span class="hl-red"><strong>errores van aumentando seg√∫n avanza el tiempo debido a la heterocedasticidad</strong></span> de la serie, con magnitudes muy elevadas, y teniendo adem√°s unas autocorrelaciones muy altas en algunos retardos.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb401"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb401-1"><a href="#cb401-1"></a>alisado_simple <span class="ot">&lt;-</span></span>
<span id="cb401-2"><a href="#cb401-2"></a>  airpass <span class="sc">|&gt;</span></span>
<span id="cb401-3"><a href="#cb401-3"></a>  <span class="fu">model</span>(<span class="st">"alisado_simple"</span> <span class="ot">=</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"N"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)))</span>
<span id="cb401-4"><a href="#cb401-4"></a></span>
<span id="cb401-5"><a href="#cb401-5"></a>alisado_simple <span class="sc">|&gt;</span></span>
<span id="cb401-6"><a href="#cb401-6"></a>  <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-271-1.png" width="960" class="r-stretch"></section>
<section id="diagnosis-errores-2" class="slide level2">
<h2>Diagnosis errores</h2>
<p>En el caso del alisado triple multiplicativo observamos como los <span class="hl-green"><strong>errores ya no aumentan seg√∫n avanza el tiempo (magnitudes peque√±as)</strong></span>, y teniendo adem√°s unas autocorrelaciones casi todas dentro de la banda.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb402"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb402-1"><a href="#cb402-1"></a>alisado_triple_mult <span class="ot">&lt;-</span></span>
<span id="cb402-2"><a href="#cb402-2"></a>  airpass <span class="sc">|&gt;</span></span>
<span id="cb402-3"><a href="#cb402-3"></a>  <span class="fu">model</span>(<span class="st">"alisado_triple_mult"</span> <span class="ot">=</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"M"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"M"</span>)))</span>
<span id="cb402-4"><a href="#cb402-4"></a></span>
<span id="cb402-5"><a href="#cb402-5"></a>alisado_triple_mult <span class="sc">|&gt;</span></span>
<span id="cb402-6"><a href="#cb402-6"></a>  <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-272-1.png" width="960" class="r-stretch"></section>
<section id="train-vs-test" class="slide level2">
<h2>Train vs test</h2>

<img data-src="https://otexts.com/fpp3/fpp_files/figure-html/traintest-1.png" class="r-stretch"><p>Como sucede en otro tipo de modelos, es importante darse cuenta de que a la hora de <span class="hl-yellow"><strong>evaluar un modelo</strong></span> tendremos que considerar dos aspectos diferentes:</p>
<ul>
<li><p>¬øC√≥mo funciona el modelo con los <span class="hl-yellow"><strong>datos que conoce</strong></span>? Es lo que hemos llamado hasta ahora estimaciones.</p></li>
<li><p>¬øC√≥mo funcionar√≠a el modelo con unos <span class="hl-purple"><strong>datos que no conoce</strong></span>? Es lo que hemos llamado hasta ahora predicciones</p></li>
</ul>
<div class="fragment">
<p>El problema es que las <span class="hl-red"><strong>predicciones hasta ahora no pod√≠amos evaluarlas</strong></span> ya que el dato real del futuro no lo tenemos‚Ä¶¬øY si <span class="hl-yellow"><strong>partimos nuestras series (train y test)</strong></span> de forma que solo le dejamos usar una parte de la informaci√≥n para dise√±ar el modelo, y as√≠ poder evaluarlo en el otro subconjunto?</p>
</div>
</section>
<section id="train-vs-test-1" class="slide level2">
<h2>Train vs test</h2>
<p>Vamos a <span class="hl-yellow"><strong>dividir nuestra serie temporal de pasajeros a√©reos</strong></span> en train y test. Normalmente el <span class="hl-yellow"><strong>% de datos en test es igual al horizonte al que queremos evaluar</strong></span> c√≥mo funciona (por ejemplo, si <span class="math inline">\(h = 24\)</span>, usaremos los 2 √∫ltimos a√±os como test).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb403"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb403-1"><a href="#cb403-1"></a>airpass_train <span class="ot">&lt;-</span></span>
<span id="cb403-2"><a href="#cb403-2"></a>  airpass <span class="sc">|&gt;</span> </span>
<span id="cb403-3"><a href="#cb403-3"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(index) <span class="sc">&lt;=</span> <span class="dv">1958</span>)</span>
<span id="cb403-4"><a href="#cb403-4"></a></span>
<span id="cb403-5"><a href="#cb403-5"></a>airpass_test <span class="ot">&lt;-</span></span>
<span id="cb403-6"><a href="#cb403-6"></a>  airpass <span class="sc">|&gt;</span> </span>
<span id="cb403-7"><a href="#cb403-7"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(index) <span class="sc">&gt;</span> <span class="dv">1958</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="evaluaci√≥n-1" class="slide level2">
<h2>Evaluaci√≥n</h2>
<p>Lo que haremos por tanto ser√° <span class="hl-yellow"><strong>pasarle solo la info de <code>airpass_train</code> al modelo</strong></span>. Tras ello <span class="hl-yellow"><strong>predeciremos a horizonte <span class="math inline">\(h = 24\)</span></strong></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb404"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb404-1"><a href="#cb404-1"></a>airpass_fit <span class="ot">&lt;-</span></span>
<span id="cb404-2"><a href="#cb404-2"></a>  airpass_train <span class="sc">|&gt;</span></span>
<span id="cb404-3"><a href="#cb404-3"></a>  <span class="fu">model</span>(<span class="st">"mean_cte"</span> <span class="ot">=</span> <span class="fu">MEAN</span>(value),</span>
<span id="cb404-4"><a href="#cb404-4"></a>        <span class="st">"alisado_simple"</span> <span class="ot">=</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"N"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb404-5"><a href="#cb404-5"></a>        <span class="st">"alisado_doble"</span> <span class="ot">=</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb404-6"><a href="#cb404-6"></a>        <span class="st">"alisado_triple_ad"</span> <span class="ot">=</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"A"</span>)),</span>
<span id="cb404-7"><a href="#cb404-7"></a>        <span class="st">"alisado_triple_mult"</span> <span class="ot">=</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"M"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"M"</span>)))</span>
<span id="cb404-8"><a href="#cb404-8"></a>estimaciones <span class="ot">&lt;-</span> airpass_fit <span class="sc">|&gt;</span> <span class="fu">augment</span>()</span>
<span id="cb404-9"><a href="#cb404-9"></a>predicciones <span class="ot">&lt;-</span> airpass_fit <span class="sc">|&gt;</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">24</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="evaluaci√≥n-2" class="slide level2">
<h2>Evaluaci√≥n</h2>
<p>En el gr√°fico le indicaremos las <strong>predicciones futuras</strong> (de datos que tenemos guardados en el <strong>dataset completo airpass</strong>)</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb405"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb405-1"><a href="#cb405-1"></a>predicciones <span class="sc">|&gt;</span> </span>
<span id="cb405-2"><a href="#cb405-2"></a>  <span class="fu">autoplot</span>(airpass, <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb405-3"><a href="#cb405-3"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> estimaciones,</span>
<span id="cb405-4"><a href="#cb405-4"></a>            <span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> .fitted, <span class="at">color =</span> .model), <span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb405-5"><a href="#cb405-5"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> ggthemes<span class="sc">::</span><span class="fu">colorblind_pal</span>()(<span class="dv">6</span>)[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb405-6"><a href="#cb405-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-275-1.png" width="960" class="r-stretch"></section>
<section id="evaluaci√≥n-3" class="slide level2">
<h2>Evaluaci√≥n</h2>
<p>Con la funci√≥n <code>accuracy(estimaciones)</code> y <code>accuracy(predicciones, datos_test)</code> podemos evaluar <strong>m√©tricas de error</strong> en test</p>
<p><span class="math display">\[\widehat{\varepsilon}_{t+h|t} = X_{t+h|t} - \widehat{X}_{t+h|t}\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb406"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb406-1"><a href="#cb406-1"></a><span class="fu">accuracy</span>(fit_airpass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 √ó 10
  .model              .type       ME  RMSE   MAE    MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;               &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 alisado_simple      Training 2.22   33.6 25.7   0.375  8.96 0.802 0.925 0.303
2 alisado_doble       Training 0.568  33.5 25.6  -0.362  9.00 0.800 0.923 0.302
3 alisado_triple_ad   Training 0.964  17.0 12.8   0.354  5.22 0.400 0.469 0.188
4 alisado_triple_mult Training 1.66   11.3  7.91  0.410  2.80 0.247 0.310 0.256</code></pre>
</div>
<div class="sourceCode cell-code" id="cb408"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb408-1"><a href="#cb408-1"></a><span class="fu">accuracy</span>(predicciones, airpass_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 10
  .model              .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;               &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 alisado_doble       Test   93.2 117.   93.2 18.8  18.8    NaN   NaN 0.708
2 alisado_simple      Test  115.  137.  115.  23.6  23.6    NaN   NaN 0.728
3 alisado_triple_ad   Test   79.3  91.2  79.3 16.5  16.5    NaN   NaN 0.720
4 alisado_triple_mult Test   34.6  39.9  34.8  7.54  7.58   NaN   NaN 0.566
5 mean_cte            Test  206.  219.  206.  44.2  44.2    NaN   NaN 0.728</code></pre>
</div>
</div>
</section>
<section id="evaluaci√≥n-4" class="slide level2">
<h2>Evaluaci√≥n</h2>
<p><span class="math display">\[\widehat{\varepsilon}_{t+h|t} = X_{t+h|t} - \widehat{X}_{t+h|t}\]</span></p>
<ul>
<li><p><span class="hl-yellow"><strong>Error medio (ME)</strong></span>: definido como <span class="math inline">\(\frac{1}{n} \sum_{t=1}^{n} \widehat{\varepsilon}_{t}\)</span></p></li>
<li><p><span class="hl-yellow"><strong>Error medio absoluto (MAE)</strong></span>: definido como <span class="math inline">\(\frac{1}{n} \sum_{t=1}^{n} \left| \widehat{\varepsilon}_{t} \right|\)</span></p></li>
<li><p><span class="hl-yellow"><strong>Error cuadr√°tico medio (RSME)</strong></span>: definido como <span class="math inline">\(\frac{1}{n} \sum_{t=1}^{n} \widehat{\varepsilon}_{t}^2\)</span></p></li>
</ul>
<p>Ambos <span class="hl-red"><strong>dependen de la escala de los datos</strong></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb410"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb410-1"><a href="#cb410-1"></a><span class="fu">accuracy</span>(predicciones, airpass_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 10
  .model              .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;               &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 alisado_doble       Test   93.2 117.   93.2 18.8  18.8    NaN   NaN 0.708
2 alisado_simple      Test  115.  137.  115.  23.6  23.6    NaN   NaN 0.728
3 alisado_triple_ad   Test   79.3  91.2  79.3 16.5  16.5    NaN   NaN 0.720
4 alisado_triple_mult Test   34.6  39.9  34.8  7.54  7.58   NaN   NaN 0.566
5 mean_cte            Test  206.  219.  206.  44.2  44.2    NaN   NaN 0.728</code></pre>
</div>
</div>
</section>
<section id="evaluaci√≥n-5" class="slide level2">
<h2>Evaluaci√≥n</h2>
<p><span class="math display">\[\widehat{\varepsilon}_{t+h|t} = X_{t+h|t} - \widehat{X}_{t+h|t}\]</span></p>
<ul>
<li><p><span class="hl-yellow"><strong>Error medio porcentual (MPE)</strong></span>: definido como <span class="math inline">\(\frac{1}{n} \sum_{t=1}^{n} 100* \frac{\widehat{\varepsilon}_{t} }{X_t}\)</span></p></li>
<li><p><span class="hl-yellow"><strong>Error absoluto medio porcentual (MAPE)</strong></span>: definido como</p></li>
</ul>
<p><span class="math display">\[\frac{1}{n} \sum_{t=1}^{n}  100*\left| \frac{\widehat{\varepsilon}_{t} }{X_t}\right|\]</span></p>
<p>Ambos son <span class="hl-green"><strong>adimensionales</strong></span> pero <span class="hl-red"><strong>pueden tender a infinito si <span class="math inline">\(X_t \to 0\)</span></strong></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb412"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb412-1"><a href="#cb412-1"></a><span class="fu">accuracy</span>(predicciones, airpass_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 10
  .model              .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;               &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 alisado_doble       Test   93.2 117.   93.2 18.8  18.8    NaN   NaN 0.708
2 alisado_simple      Test  115.  137.  115.  23.6  23.6    NaN   NaN 0.728
3 alisado_triple_ad   Test   79.3  91.2  79.3 16.5  16.5    NaN   NaN 0.720
4 alisado_triple_mult Test   34.6  39.9  34.8  7.54  7.58   NaN   NaN 0.566
5 mean_cte            Test  206.  219.  206.  44.2  44.2    NaN   NaN 0.728</code></pre>
</div>
</div>
</section>
<section id="validaci√≥n-cruzada" class="slide level2">
<h2>Validaci√≥n cruzada</h2>
<p>Como suele ser habitual en el campo de la calibraci√≥n de modelos, una opci√≥n muy habitual es la de la <span class="hl-yellow"><strong>validaci√≥n</strong></span>:</p>
<ol type="1">
<li><p>Construir distintos modelos con la informaci√≥n de train</p></li>
<li><p>Usar los <span class="hl-yellow"><strong>conjuntos de la validaci√≥n para evaluar los modelos (o qu√© configuraci√≥n de hiperpar√°metros)</strong></span> y decidir cu√°l de ellos es mejor</p></li>
<li><p>Una vez elegido el modelo, volver a lanzarlo y evaluarlo en test</p></li>
</ol>
</section>
<section id="validaci√≥n-cruzada-1" class="slide level2">
<h2>Validaci√≥n cruzada</h2>
<p>Una de las formas de validaci√≥n m√°s habitual es la <span class="hl-yellow"><strong>validaci√≥n cruzada</strong></span>: las observaciones del conjunto de train van <span class="hl-yellow"><strong>rotando su rol</strong></span>.</p>
<div class="fragment">
<p>Por ejemplo, si tenemos 100 observaciones en train, podemos hacer 100 iteraciones de validaci√≥n, de manera que en cada una entrenamos el modelo con 99 de ellas y otra queda reservada solo para evaluar los modelos.</p>
<p><img data-src="https://interactivechaos.com/sites/default/files/styles/max_800_px/public/2023-03/tutorial_ml_0237.png"></p>
</div>
</section>
<section id="validaci√≥n-cruzada-2" class="slide level2">
<h2>Validaci√≥n cruzada</h2>
<p>En el caso de las series temporales una estrategia habitual suele ser la siguiente:</p>
<ol type="1">
<li><p>Descartar las primeras <span class="math inline">\(n\)</span> observaciones para validaci√≥n: habr√° un conjunto m√≠nimo que siempre formar√° parte de train</p></li>
<li><p>Iteraci√≥n i: entrenamos con las primeras <span class="math inline">\(n+i\)</span> observaciones, evaluamos con una √∫nica observaci√≥n <span class="math inline">\(n+i+1\)</span>.</p></li>
<li><p>Realizamos el promedio de las m√©tricas de evaluaci√≥n obtenidas de los conjuntos de validaci√≥n.</p></li>
</ol>

<img data-src="https://otexts.com/fpp3/fpp_files/figure-html/cv1-1.png" class="r-stretch"></section>
<section id="validaci√≥n-cruzada-3" class="slide level2">
<h2>Validaci√≥n cruzada</h2>
<p>F√≠jate que lo anterior est√° basado en una <span class="hl-yellow"><strong>one-step forecast</strong></span> (predicci√≥n a horizonte <span class="math inline">\(h = 1\)</span>), pero quiz√°s nuestro inter√©s est√© en ver c√≥mo funciona nuestro m√©todo a <strong>horizontes de predicci√≥n mayores</strong></p>
<div class="fragment">
<ol type="1">
<li><p>Descartar las primeras <span class="math inline">\(n\)</span> observaciones para validaci√≥n: habr√° un conjunto m√≠nimo que siempre formar√° parte de train</p></li>
<li><p>Iteraci√≥n i: entrenamos con las primeras <span class="math inline">\(n+i\)</span> observaciones, evaluamos con una √∫nica observaci√≥n <span class="math inline">\(n+i+h\)</span>.</p></li>
<li><p>Realizamos el promedio de las m√©tricas de evaluaci√≥n obtenidas de los conjuntos de validaci√≥n.</p></li>
</ol>
</div>
</section>
<section id="validaci√≥n-cruzada-4" class="slide level2">
<h2>Validaci√≥n cruzada</h2>
<p>El ejemplo inferior es para <span class="math inline">\(h = 4\)</span>.</p>

<img data-src="https://otexts.com/fpp3/fpp_files/figure-html/cv4-1.png" class="r-stretch"></section>
<section id="validaci√≥n-cruzada-5" class="slide level2">
<h2>Validaci√≥n cruzada</h2>
<p>Para generar los subconjuntos vamos primero como antes a dividir nuestro dataset en train y test.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb414"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb414-1"><a href="#cb414-1"></a>airpass_train <span class="ot">&lt;-</span></span>
<span id="cb414-2"><a href="#cb414-2"></a>  airpass <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">year</span>(index) <span class="sc">&lt;</span> <span class="dv">1958</span>)</span>
<span id="cb414-3"><a href="#cb414-3"></a></span>
<span id="cb414-4"><a href="#cb414-4"></a>airpass_test <span class="ot">&lt;-</span></span>
<span id="cb414-5"><a href="#cb414-5"></a>  airpass <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">year</span>(index) <span class="sc">&gt;=</span> <span class="dv">1958</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="validaci√≥n-cruzada-6" class="slide level2">
<h2>Validaci√≥n cruzada</h2>
<p>Tras ello vamos a <span class="hl-yellow"><strong>generar los subconjuntos de validaci√≥n usando trian</strong></span> con <code>stretch_tsibble()</code>, indic√°ndole el n√∫mero de valores iniciales que siempre estar√°n en train, el tama√±o que queremos incrementar los sucesivos conjuntos y un identificador de cada slot</p>
<p>Por ejemplo, vamos a reservar los 2 primeros a√±os y vamos a avanzar a horizonte 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb415"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb415-1"><a href="#cb415-1"></a>airpass_cv <span class="ot">&lt;-</span></span>
<span id="cb415-2"><a href="#cb415-2"></a>  airpass_train <span class="sc">|&gt;</span> </span>
<span id="cb415-3"><a href="#cb415-3"></a>  <span class="fu">stretch_tsibble</span>(<span class="at">.init =</span> <span class="dv">24</span>, <span class="at">.step =</span> <span class="dv">1</span>, <span class="at">.id =</span> <span class="st">"cv"</span>)</span>
<span id="cb415-4"><a href="#cb415-4"></a>airpass_cv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 5,610 x 3 [1M]
# Key:       cv [85]
      index value    cv
      &lt;mth&gt; &lt;dbl&gt; &lt;int&gt;
 1 1949 Jan   112     1
 2 1949 Feb   118     1
 3 1949 Mar   132     1
 4 1949 Apr   129     1
 5 1949 May   121     1
 6 1949 Jun   135     1
 7 1949 Jul   148     1
 8 1949 Aug   148     1
 9 1949 Sep   136     1
10 1949 Oct   119     1
# ‚Ñπ 5,600 more rows</code></pre>
</div>
</div>
</section>
<section id="validaci√≥n-cruzada-7" class="slide level2">
<h2>Validaci√≥n cruzada</h2>
<p>Tras generar los slots de validaci√≥n <span class="hl-yellow"><strong>entrenamos los modelos con dichos datos</strong></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb417"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb417-1"><a href="#cb417-1"></a>airpass_fit <span class="ot">&lt;-</span></span>
<span id="cb417-2"><a href="#cb417-2"></a>  airpass_cv <span class="sc">|&gt;</span></span>
<span id="cb417-3"><a href="#cb417-3"></a>  <span class="fu">model</span>(<span class="st">"alisado_simple"</span> <span class="ot">=</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"N"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb417-4"><a href="#cb417-4"></a>        <span class="st">"alisado_doble"</span> <span class="ot">=</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb417-5"><a href="#cb417-5"></a>        <span class="st">"alisado_triple_ad"</span> <span class="ot">=</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"A"</span>)),</span>
<span id="cb417-6"><a href="#cb417-6"></a>        <span class="st">"alisado_triple_mult"</span> <span class="ot">=</span> <span class="fu">ETS</span>(value <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"M"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"M"</span>)))</span>
<span id="cb417-7"><a href="#cb417-7"></a>estimaciones <span class="ot">&lt;-</span> airpass_fit <span class="sc">|&gt;</span> <span class="fu">augment</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="validaci√≥n-cruzada-8" class="slide level2">
<h2>Validaci√≥n cruzada</h2>
<p>Tendremos las <span class="hl-yellow"><strong>m√©tricas para cada modelo y cada slot de cv</strong></span> que podemos promediar</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb418"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb418-1"><a href="#cb418-1"></a>airpass_fit <span class="sc">|&gt;</span> </span>
<span id="cb418-2"><a href="#cb418-2"></a>  <span class="fu">accuracy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb418-3"><a href="#cb418-3"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(ME, RMSE, MAE, MPE, MAPE), mean), <span class="at">.by =</span> .model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 √ó 6
  .model                   ME  RMSE   MAE     MPE  MAPE
  &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 alisado_simple      2.13    18.5  15.0   0.709   8.46
2 alisado_doble       0.00132 18.4  15.1  -0.611   8.60
3 alisado_triple_ad   0.0603   7.51  6.03 -0.119   3.41
4 alisado_triple_mult 0.376    6.76  5.28  0.0779  2.93</code></pre>
</div>
<div class="sourceCode cell-code" id="cb420"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb420-1"><a href="#cb420-1"></a>airpass_fit <span class="sc">|&gt;</span></span>
<span id="cb420-2"><a href="#cb420-2"></a>  <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb420-3"><a href="#cb420-3"></a>  <span class="fu">accuracy</span>(airpass_test) <span class="sc">|&gt;</span> </span>
<span id="cb420-4"><a href="#cb420-4"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(ME, RMSE, MAE, MPE, MAPE), mean), <span class="at">.by =</span> .model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 √ó 6
  .model                 ME  RMSE   MAE    MPE  MAPE
  &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 alisado_doble        2.03  2.03  2.03  0.596 0.596
2 alisado_simple       4.00  4.00  4.00  1.18  1.18 
3 alisado_triple_ad    2.23  2.23  2.23  0.655 0.655
4 alisado_triple_mult -1.71  1.71  1.71 -0.503 0.503</code></pre>
</div>
</div>
</section>
<section id="validaci√≥n-cruzada-9" class="slide level2">
<h2>Validaci√≥n cruzada</h2>
<p>¬øC√≥mo <span class="hl-yellow"><strong>visualizar las m√©tricas de validaci√≥n cruzada</strong></span></p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb422"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb422-1"><a href="#cb422-1"></a>airpass_fit <span class="sc">|&gt;</span></span>
<span id="cb422-2"><a href="#cb422-2"></a>  <span class="fu">accuracy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb422-3"><a href="#cb422-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .model, <span class="at">y =</span> RMSE, <span class="at">fill =</span> .model, <span class="at">color =</span> .model)) <span class="sc">+</span></span>
<span id="cb422-4"><a href="#cb422-4"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb422-5"><a href="#cb422-5"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.25</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb422-6"><a href="#cb422-6"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_colorblind</span>() <span class="sc">+</span></span>
<span id="cb422-7"><a href="#cb422-7"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_fill_colorblind</span>() <span class="sc">+</span></span>
<span id="cb422-8"><a href="#cb422-8"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-283-1.png" width="960" class="r-stretch"></section>
<section id="ejemplo-real-aemet-again" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<ol type="1">
<li><span class="hl-yellow"><strong>Cargamos</strong></span> los datos</li>
</ol>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb423"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb423-1"><a href="#cb423-1"></a><span class="fu">library</span>(readr) <span class="co"># de tidyverse</span></span>
<span id="cb423-2"><a href="#cb423-2"></a>retiro <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">"./datos/retiro_temp.csv"</span>)</span>
<span id="cb423-3"><a href="#cb423-3"></a>retiro</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16,314 √ó 8
   fecha      id_station nombre         provincia altitud  tmed  tmin  tmax
   &lt;date&gt;          &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 2000-01-01       3195 MADRID, RETIRO MADRID        667   5.4   0.3  10.4
 2 2000-01-02       3195 MADRID, RETIRO MADRID        667   5     0.3   9.6
 3 2000-01-03       3195 MADRID, RETIRO MADRID        667   3.5   0.1   6.9
 4 2000-01-04       3195 MADRID, RETIRO MADRID        667   4.3   1.4   7.2
 5 2000-01-05       3195 MADRID, RETIRO MADRID        667   0.6  -0.4   1.6
 6 2000-01-06       3195 MADRID, RETIRO MADRID        667   3.8  -1.1   8.8
 7 2000-01-07       3195 MADRID, RETIRO MADRID        667   6.2   0.6  11.7
 8 2000-01-08       3195 MADRID, RETIRO MADRID        667   5.4  -0.1  11  
 9 2000-01-09       3195 MADRID, RETIRO MADRID        667   5.5   3     8  
10 2000-01-10       3195 MADRID, RETIRO MADRID        667   4.8   1.8   7.8
# ‚Ñπ 16,304 more rows</code></pre>
</div>
</div>
</section>
<section id="ejemplo-real-aemet-again-1" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<ol type="1">
<li><span class="hl-yellow"><strong>Convertimos a tsibble</strong></span> los datos</li>
</ol>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb425"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb425-1"><a href="#cb425-1"></a>retiro_ts <span class="ot">&lt;-</span></span>
<span id="cb425-2"><a href="#cb425-2"></a>  retiro <span class="sc">|&gt;</span></span>
<span id="cb425-3"><a href="#cb425-3"></a>  <span class="co"># index: variable temporal</span></span>
<span id="cb425-4"><a href="#cb425-4"></a>  <span class="co"># key: si tuvi√©ramos varias series a la vez (varias estaciones)</span></span>
<span id="cb425-5"><a href="#cb425-5"></a>  <span class="co"># regular = TRUE: regular time interval (para que detecte</span></span>
<span id="cb425-6"><a href="#cb425-6"></a>  <span class="co"># adecuadamente la periodicidad de la serie, en este caso [1D])</span></span>
<span id="cb425-7"><a href="#cb425-7"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> fecha, <span class="at">key =</span> <span class="cn">NULL</span>, <span class="at">regular =</span> <span class="cn">TRUE</span>)</span>
<span id="cb425-8"><a href="#cb425-8"></a>retiro_ts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 16,314 x 8 [1D]
   fecha      id_station nombre         provincia altitud  tmed  tmin  tmax
   &lt;date&gt;          &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 1980-01-01       3195 MADRID, RETIRO MADRID        667  12.5   9.7  15.3
 2 1980-01-02       3195 MADRID, RETIRO MADRID        667   8.4   5    11.8
 3 1980-01-03       3195 MADRID, RETIRO MADRID        667   5.5   1    10  
 4 1980-01-04       3195 MADRID, RETIRO MADRID        667   5.5   1.2   9.8
 5 1980-01-05       3195 MADRID, RETIRO MADRID        667   5.6   0.8  10.4
 6 1980-01-06       3195 MADRID, RETIRO MADRID        667   2.7   0.6   4.8
 7 1980-01-07       3195 MADRID, RETIRO MADRID        667   3     0.6   5.4
 8 1980-01-08       3195 MADRID, RETIRO MADRID        667   2.3  -2     6.6
 9 1980-01-09       3195 MADRID, RETIRO MADRID        667   3.8   0.8   6.8
10 1980-01-10       3195 MADRID, RETIRO MADRID        667   5.6   1.8   9.4
# ‚Ñπ 16,304 more rows</code></pre>
</div>
</div>
</section>
<section id="ejemplo-real-aemet-again-2" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<ol start="2" type="1">
<li><span class="hl-yellow"><strong>Preprocesamos</strong></span> los datos. ¬øHay huecos?</li>
</ol>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb427"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb427-1"><a href="#cb427-1"></a>retiro_ts <span class="sc">|&gt;</span> </span>
<span id="cb427-2"><a href="#cb427-2"></a>  <span class="fu">count</span>(<span class="fu">year</span>(fecha)) <span class="sc">|&gt;</span> </span>
<span id="cb427-3"><a href="#cb427-3"></a>  <span class="fu">arrange</span>(n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="fragment">
<p>Vemos que, am√©n de los datos que faltan (l√≥gicamente) en 2024, hay datos que faltan en 2022, as√≠ que antes <span class="hl-yellow"><strong>debemos rellenar los huecos</strong></span>: primero creando la fila (con valores vac√≠os) y luego rellenando la variable objetivo</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb428"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb428-1"><a href="#cb428-1"></a>retiro_ts <span class="ot">&lt;-</span></span>
<span id="cb428-2"><a href="#cb428-2"></a>  retiro_ts <span class="sc">|&gt;</span> </span>
<span id="cb428-3"><a href="#cb428-3"></a>  <span class="fu">fill_gaps</span>() <span class="sc">|&gt;</span> </span>
<span id="cb428-4"><a href="#cb428-4"></a>  <span class="fu">fill</span>(tmed, <span class="at">.direction =</span> <span class="st">"down"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="ejemplo-real-aemet-again-3" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<ol start="3" type="1">
<li><span class="hl-yellow"><strong>Visualizamos</strong></span> los datos.</li>
</ol>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb429"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb429-1"><a href="#cb429-1"></a><span class="fu">ggplot</span>(retiro_ts) <span class="sc">+</span></span>
<span id="cb429-2"><a href="#cb429-2"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> fecha, <span class="at">y =</span> tmed)) <span class="sc">+</span></span>
<span id="cb429-3"><a href="#cb429-3"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-289-1.png" width="960" class="r-stretch"></section>
<section id="ejemplo-real-aemet-again-4" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<ol start="3" type="1">
<li><span class="hl-yellow"><strong>¬øTiene tendencia?</strong></span></li>
</ol>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb430"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb430-1"><a href="#cb430-1"></a><span class="fu">ggplot</span>(retiro_ts, <span class="fu">aes</span>(<span class="at">x =</span> fecha, <span class="at">y =</span> tmed)) <span class="sc">+</span></span>
<span id="cb430-2"><a href="#cb430-2"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb430-3"><a href="#cb430-3"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb430-4"><a href="#cb430-4"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-290-1.png" width="960" class="r-stretch"><p>(en caso de existir desde luego es <strong>aditiva</strong>)</p>
</section>
<section id="ejemplo-real-aemet-again-5" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<ol start="3" type="1">
<li><span class="hl-yellow"><strong>¬øTiene tendencia?</strong></span></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb431"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb431-1"><a href="#cb431-1"></a><span class="fu">lm</span>(<span class="at">data =</span> retiro_ts, <span class="at">formula =</span> tmed <span class="sc">~</span> fecha) <span class="sc">|&gt;</span> </span>
<span id="cb431-2"><a href="#cb431-2"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = tmed ~ fecha, data = retiro_ts)

Residuals:
     Min       1Q   Median       3Q      Max 
-19.6320  -6.3365  -0.9928   6.5248  17.4104 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 1.392e+01  1.594e-01  87.307   &lt;2e-16 ***
fecha       1.242e-04  1.254e-05   9.901   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 7.543 on 16313 degrees of freedom
Multiple R-squared:  0.005974,  Adjusted R-squared:  0.005913 
F-statistic: 98.04 on 1 and 16313 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Existe una <strong>d√©bil (pero significativa) tendencia positiva</strong></p>
</section>
<section id="ejemplo-real-aemet-again-6" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<ol start="3" type="1">
<li>Determinar <span class="hl-yellow"><strong>homocedasticidad/heterocedasticidad</strong></span> y c√≥mo evoluciona su varianza.</li>
</ol>
<p>Una primera opci√≥n es <span class="hl-yellow"><strong>visualizaci√≥n de la dispersi√≥n</strong></span> por periodos (por ejemplo, por meses)</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb433"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb433-1"><a href="#cb433-1"></a>retiro_ts <span class="ot">&lt;-</span></span>
<span id="cb433-2"><a href="#cb433-2"></a>  retiro_ts <span class="sc">|&gt;</span> </span>
<span id="cb433-3"><a href="#cb433-3"></a>  <span class="fu">mutate</span>(<span class="st">"year_month"</span> <span class="ot">=</span> <span class="fu">yearmonth</span>(fecha))</span>
<span id="cb433-4"><a href="#cb433-4"></a>resumen_var <span class="ot">&lt;-</span></span>
<span id="cb433-5"><a href="#cb433-5"></a>  retiro_ts <span class="sc">|&gt;</span></span>
<span id="cb433-6"><a href="#cb433-6"></a>  <span class="fu">index_by</span>(year_month) <span class="sc">|&gt;</span> </span>
<span id="cb433-7"><a href="#cb433-7"></a>  <span class="fu">summarise</span>(<span class="st">"dispersion"</span> <span class="ot">=</span> <span class="fu">sd</span>(tmed) <span class="sc">/</span> <span class="fu">mean</span>(tmed))</span>
<span id="cb433-8"><a href="#cb433-8"></a></span>
<span id="cb433-9"><a href="#cb433-9"></a><span class="fu">ggplot</span>(resumen_var, <span class="fu">aes</span>(<span class="at">x =</span> year_month, <span class="at">y =</span> dispersion)) <span class="sc">+</span></span>
<span id="cb433-10"><a href="#cb433-10"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb433-11"><a href="#cb433-11"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb433-12"><a href="#cb433-12"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-292-1.png" width="960" class="r-stretch"><div class="fragment">
<p>Al margen de posibles outliers: <span class="hl-yellow"><strong>no hay un patr√≥n ni tendencia en la varianza</strong></span></p>
</div>
</section>
<section id="ejemplo-real-aemet-again-7" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<p>De hecho si realizamos el <span class="hl-yellow"><strong>ajuste de un recta a la propia varianza agrupada</strong></span> vemos que no es significativo: no hay evidencias de que exista una tendencia en la varianza.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb434"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb434-1"><a href="#cb434-1"></a><span class="fu">lm</span>(<span class="at">data =</span> resumen_var, <span class="at">formula =</span> dispersion <span class="sc">~</span> year_month) <span class="sc">|&gt;</span></span>
<span id="cb434-2"><a href="#cb434-2"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = dispersion ~ year_month, data = resumen_var)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.16829 -0.08274 -0.02334  0.05620  0.87227 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  2.448e-01  1.414e-02  17.315   &lt;2e-16 ***
year_month  -1.808e-06  1.113e-06  -1.624    0.105    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1214 on 534 degrees of freedom
Multiple R-squared:  0.004916,  Adjusted R-squared:  0.003053 
F-statistic: 2.638 on 1 and 534 DF,  p-value: 0.1049</code></pre>
</div>
</div>
</section>
<section id="ejemplo-real-aemet-again-8" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<p>Recuerda que <span class="hl-yellow"><strong>si tuvi√©ramos heterocedasticidad tendr√≠amos que aplicar alg√∫n tipo de transformaci√≥n</strong></span> a los datos, conocidas como <span class="hl-yellow"><strong>transformaciones Box-Cox</strong></span> (adaptadas por <a href="https://www.tandfonline.com/doi/abs/10.1080/01621459.1981.10477649">Bickel y Doksum (1981)</a> para valores negativos):</p>
<p><span class="math display">\[\begin{equation}\widetilde{X}_t  = \begin{cases}  \log(X_t) &amp; \text{si } \lambda=0  \nonumber \\ \frac{\text{sign}(X_t)|X_t|^\lambda-1}{\lambda} &amp; \text{en otro caso} \end{cases}\end{equation}\]</span></p>
<div class="fragment">
<p>¬øQu√© <span class="math inline">\(\lambda\)</span> ser√≠a <strong>si no tuvi√©ramos que hacer ninguna transformaci√≥n (es decir, homoced√°stica)</strong>?</p>
</div>
</section>
<section id="ejemplo-real-aemet-again-9" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<p>Para calcularlo vamos a usar <code>features(variable, features = ...)</code> del paquete <code>{fabletools}</code> (ya cargado en <code>{fable}</code>). En <code>features = ...</code> vamos a especificar la opci√≥n <code>guerrero</code> (un m√©todo para elegir el <span class="math inline">\(\lambda\)</span> √≥ptimo del paquete <code>{feasts}</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb436"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb436-1"><a href="#cb436-1"></a><span class="fu">library</span>(fable)</span>
<span id="cb436-2"><a href="#cb436-2"></a><span class="fu">library</span>(feasts)</span>
<span id="cb436-3"><a href="#cb436-3"></a>retiro_ts <span class="sc">|&gt;</span></span>
<span id="cb436-4"><a href="#cb436-4"></a>  <span class="fu">features</span>(tmed, <span class="at">features =</span> guerrero)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 1
  lambda_guerrero
            &lt;dbl&gt;
1           0.922</code></pre>
</div>
</div>
<div class="fragment">
<p>Ese valor est√° muy cerca de <span class="math inline">\(1\)</span> lo que apoya lo anterior: salvo outliers, no tenemos heterocedasticidad.</p>
</div>
</section>
<section id="ejemplo-real-aemet-again-10" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<ol start="4" type="1">
<li><span class="hl-yellow"><strong>Determinar periodicidad</strong></span> <span class="math inline">\(s\)</span></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb438"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb438-1"><a href="#cb438-1"></a><span class="fu">pacf</span>(retiro_ts<span class="sc">$</span>tmed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-295-1.png" width="960" class="r-stretch"><p>No vemos a priori estacionalidad‚Ä¶porque recuerda que aqu√≠ tenemos datos diarios. ¬øY si aumentamos el n√∫mero de retardos?</p>
</section>
<section id="ejemplo-real-aemet-again-11" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb439"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb439-1"><a href="#cb439-1"></a><span class="fu">pacf</span>(retiro_ts<span class="sc">$</span>tmed, <span class="at">lag.max =</span> <span class="dv">365</span><span class="sc">*</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-296-1.png" width="960" class="r-stretch"><p>Cuesta verlo pero‚Ä¶¬øves esa peque√±a monta√±ita en el 365?</p>
</section>
<section id="ejemplo-real-aemet-again-12" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<p>Esto tambi√©n lo podemos <span class="hl-yellow"><strong>visualizar de manera conjunta</strong></span> con <code>gg_tsdisplay()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb440"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb440-1"><a href="#cb440-1"></a>retiro_ts <span class="sc">|&gt;</span> </span>
<span id="cb440-2"><a href="#cb440-2"></a>  <span class="fu">gg_tsdisplay</span>(<span class="at">y =</span> tmed, <span class="at">lag =</span> <span class="dv">365</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-297-1.png" width="960" class="r-stretch"><div class="fragment">
<p>F√≠jate que adem√°s de mostrarnos un <strong>patr√≥n en las autocorrelaciones cada 365 valores</strong> nos pinta la serie cada a√±o (cada 365 valores corta una curva) y vemos que <span class="hl-yellow"><strong>efectivamente comparten un patr√≥n</strong></span></p>
</div>
</section>
<section id="ejemplo-real-aemet-again-13" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<p>Otra forma de comprobar que efectivamente es estacional <span class="math inline">\(s = 365\)</span> es haciendo una <span class="hl-yellow"><strong>diferenciaci√≥n estacional de la serie</strong></span>: a cada valor le vamos a restar su valor <span class="math inline">\(s\)</span> periodos previos.</p>
<p>&nbsp;</p>
<p>La funci√≥n que nos lo permite se llama <code>difference()</code> (del paquete <code>{tsibble}</code>)</p>
</section>
<section id="ejemplo-real-aemet-again-14" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<ul>
<li>Si <span class="math inline">\(s\)</span> est√° <span class="hl-red"><strong>mal elegido seguir√° presentando ese patr√≥n</strong></span> (o uno a√∫n m√°s extra√±o)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb441"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb441-1"><a href="#cb441-1"></a>retiro_ts <span class="sc">|&gt;</span></span>
<span id="cb441-2"><a href="#cb441-2"></a>  <span class="fu">gg_tsdisplay</span>(<span class="fu">difference</span>(tmed, <span class="dv">123</span>), <span class="at">lag =</span> <span class="dv">365</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-298-1.png" width="960" class="r-stretch"></section>
<section id="ejemplo-real-aemet-again-15" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<ul>
<li>Si <span class="math inline">\(s\)</span> est√° <span class="hl-green"><strong>bien elegido las autocorrelaciones deber√≠a de desplomarse</strong></span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb442"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb442-1"><a href="#cb442-1"></a>retiro_ts <span class="sc">|&gt;</span></span>
<span id="cb442-2"><a href="#cb442-2"></a>  <span class="fu">gg_tsdisplay</span>(<span class="fu">difference</span>(tmed, <span class="dv">365</span>), <span class="at">lag =</span> <span class="dv">365</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-299-1.png" width="960" class="r-stretch"></section>
<section id="ejemplo-real-aemet-again-16" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<ul>
<li>Si <span class="math inline">\(s\)</span> est√° <span class="hl-green"><strong>bien elegido las autocorrelaciones deber√≠a de desplomarse</strong></span></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb443"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb443-1"><a href="#cb443-1"></a>retiro_ts <span class="sc">|&gt;</span></span>
<span id="cb443-2"><a href="#cb443-2"></a>  <span class="fu">gg_tsdisplay</span>(<span class="fu">difference</span>(tmed, <span class="dv">365</span>), <span class="at">lag =</span> <span class="dv">365</span>,</span>
<span id="cb443-3"><a href="#cb443-3"></a>               <span class="at">plot_type =</span> <span class="st">"partial"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-300-1.png" width="960" class="r-stretch"></section>
<section id="ejemplo-real-aemet-again-17" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<p>Una vez que tenemos que <span class="math inline">\(s = 365\)</span> vamos a <span class="hl-yellow"><strong>separar la muestra de momento solo en train-test</strong></span>, por ejemplo para evaluar c√≥mo funcionan los modelos a 3 a√±os vista (es decir, usando los √∫ltimos 3 a√±os como test, en los que tenemos <span class="math inline">\(h = 974\)</span> valores)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb444"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb444-1"><a href="#cb444-1"></a>retiro_ts_train <span class="ot">&lt;-</span></span>
<span id="cb444-2"><a href="#cb444-2"></a>  retiro_ts <span class="sc">|&gt;</span> </span>
<span id="cb444-3"><a href="#cb444-3"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(fecha) <span class="sc">&lt;</span> <span class="dv">2022</span>)</span>
<span id="cb444-4"><a href="#cb444-4"></a></span>
<span id="cb444-5"><a href="#cb444-5"></a>retiro_ts_test <span class="ot">&lt;-</span></span>
<span id="cb444-6"><a href="#cb444-6"></a>  retiro_ts <span class="sc">|&gt;</span> </span>
<span id="cb444-7"><a href="#cb444-7"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(fecha) <span class="sc">&gt;=</span> <span class="dv">2022</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ejemplo-real-aemet-again-18" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<p>Vamos a realizar los 4 <span class="hl-yellow"><strong>m√©todos de alisado</strong></span> disponibles (simple-doble-triple aditivo-triple multiplicativo)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb445"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb445-1"><a href="#cb445-1"></a>fit_retiro <span class="ot">&lt;-</span></span>
<span id="cb445-2"><a href="#cb445-2"></a>  <span class="co"># entrenamos SOLO con train</span></span>
<span id="cb445-3"><a href="#cb445-3"></a>  retiro_ts_train <span class="sc">|&gt;</span> </span>
<span id="cb445-4"><a href="#cb445-4"></a>   <span class="fu">model</span>(<span class="st">"alisado_simple"</span> <span class="ot">=</span> <span class="fu">ETS</span>(tmed <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"N"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb445-5"><a href="#cb445-5"></a>        <span class="st">"alisado_doble"</span> <span class="ot">=</span> <span class="fu">ETS</span>(tmed <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb445-6"><a href="#cb445-6"></a>        <span class="st">"alisado_triple_ad"</span> <span class="ot">=</span> <span class="fu">ETS</span>(tmed <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"A"</span>, <span class="at">period =</span> <span class="st">"1 year"</span>)),</span>
<span id="cb445-7"><a href="#cb445-7"></a>        <span class="st">"alisado_triple_m"</span> <span class="ot">=</span> <span class="fu">ETS</span>(tmed <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"M"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"M"</span>, <span class="at">period =</span> <span class="st">"1 year"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si te fijas sale un error ya que los <span class="hl-red"><strong>alisados en <code>model()</code> tienen una limitaci√≥n</strong></span>: no permite un <span class="math inline">\(s\)</span> mayor de 24</p>
</section>
<section id="ejemplo-real-aemet-again-19" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<p>Para poder solventarlo (veremos los ARIMA para poder usarlos) de momento vamos a <span class="hl-yellow"><strong>resumir la serie, realizando un resumen mensual de la temperatura</strong></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb446"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb446-1"><a href="#cb446-1"></a>retiro_ts_monthly_train <span class="ot">&lt;-</span></span>
<span id="cb446-2"><a href="#cb446-2"></a>  retiro_ts_train <span class="sc">|&gt;</span></span>
<span id="cb446-3"><a href="#cb446-3"></a>  <span class="fu">index_by</span>(<span class="st">"year_month"</span> <span class="ot">=</span> <span class="fu">yearmonth</span>(fecha)) <span class="sc">|&gt;</span></span>
<span id="cb446-4"><a href="#cb446-4"></a>  <span class="fu">summarise</span>(<span class="st">"tmed"</span> <span class="ot">=</span> <span class="fu">mean</span>(tmed))</span>
<span id="cb446-5"><a href="#cb446-5"></a></span>
<span id="cb446-6"><a href="#cb446-6"></a>retiro_ts_monthly_test <span class="ot">&lt;-</span></span>
<span id="cb446-7"><a href="#cb446-7"></a>  retiro_ts_test <span class="sc">|&gt;</span></span>
<span id="cb446-8"><a href="#cb446-8"></a>  <span class="fu">index_by</span>(<span class="st">"year_month"</span> <span class="ot">=</span> <span class="fu">yearmonth</span>(fecha)) <span class="sc">|&gt;</span></span>
<span id="cb446-9"><a href="#cb446-9"></a>  <span class="fu">summarise</span>(<span class="st">"tmed"</span> <span class="ot">=</span> <span class="fu">mean</span>(tmed))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb447"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb447-1"><a href="#cb447-1"></a><span class="co"># code-fold: true</span></span>
<span id="cb447-2"><a href="#cb447-2"></a><span class="fu">ggplot</span>(retiro_ts_monthly_train) <span class="sc">+</span></span>
<span id="cb447-3"><a href="#cb447-3"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> year_month, <span class="at">y =</span> tmed)) <span class="sc">+</span></span>
<span id="cb447-4"><a href="#cb447-4"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-304-1.png" width="960" class="r-stretch"></section>
<section id="ejemplo-real-aemet-again-20" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb448"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb448-1"><a href="#cb448-1"></a>fit_retiro <span class="ot">&lt;-</span></span>
<span id="cb448-2"><a href="#cb448-2"></a>  <span class="co"># entrenamos SOLO con train</span></span>
<span id="cb448-3"><a href="#cb448-3"></a>  retiro_ts_monthly_train <span class="sc">|&gt;</span> </span>
<span id="cb448-4"><a href="#cb448-4"></a>   <span class="fu">model</span>(<span class="st">"alisado_simple"</span> <span class="ot">=</span> <span class="fu">ETS</span>(tmed <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"N"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb448-5"><a href="#cb448-5"></a>        <span class="st">"alisado_doble"</span> <span class="ot">=</span> <span class="fu">ETS</span>(tmed <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb448-6"><a href="#cb448-6"></a>        <span class="st">"alisado_triple_ad"</span> <span class="ot">=</span> <span class="fu">ETS</span>(tmed <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"A"</span>, <span class="at">period =</span> <span class="st">"1 year"</span>)),</span>
<span id="cb448-7"><a href="#cb448-7"></a>        <span class="st">"alisado_triple_m"</span> <span class="ot">=</span> <span class="fu">ETS</span>(tmed <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"M"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"M"</span>, <span class="at">period =</span> <span class="st">"1 year"</span>)))</span>
<span id="cb448-8"><a href="#cb448-8"></a>estimaciones <span class="ot">&lt;-</span> fit_retiro <span class="sc">|&gt;</span> <span class="fu">augment</span>()</span>
<span id="cb448-9"><a href="#cb448-9"></a>predicciones <span class="ot">&lt;-</span> fit_retiro <span class="sc">|&gt;</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">12</span><span class="sc">*</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ejemplo-real-aemet-again-21" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb449"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb449-1"><a href="#cb449-1"></a>predicciones <span class="sc">|&gt;</span> </span>
<span id="cb449-2"><a href="#cb449-2"></a>  <span class="fu">autoplot</span>(retiro_ts <span class="sc">|&gt;</span></span>
<span id="cb449-3"><a href="#cb449-3"></a>             <span class="fu">index_by</span>(<span class="st">"year_month"</span> <span class="ot">=</span> <span class="fu">yearmonth</span>(fecha)) <span class="sc">|&gt;</span></span>
<span id="cb449-4"><a href="#cb449-4"></a>             <span class="fu">summarise</span>(<span class="st">"tmed"</span> <span class="ot">=</span> <span class="fu">mean</span>(tmed)), <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb449-5"><a href="#cb449-5"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> estimaciones, <span class="fu">aes</span>(<span class="at">x =</span> year_month, <span class="at">y =</span> .fitted, <span class="at">color =</span> .model)) <span class="sc">+</span></span>
<span id="cb449-6"><a href="#cb449-6"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> predicciones, <span class="fu">aes</span>(<span class="at">x =</span> year_month, <span class="at">y =</span> .mean, <span class="at">color =</span> .model)) <span class="sc">+</span></span>
<span id="cb449-7"><a href="#cb449-7"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> ggthemes<span class="sc">::</span><span class="fu">colorblind_pal</span>()(<span class="dv">5</span>)[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb449-8"><a href="#cb449-8"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-306-1.png" width="960" class="r-stretch"></section>
<section id="ejemplo-real-aemet-again-22" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<p>La evaluaci√≥n num√©rica la haremos con <code>accuracy()</code>: el <strong>triple aditivo funciona ligeramente mejor en train pero ligeramente peor en test</strong>. Dado que funcionan similar y el aditivo es m√°s simple, por principio de parsimonia, nos quedamos con el triple aditivo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb450"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb450-1"><a href="#cb450-1"></a><span class="fu">accuracy</span>(fit_retiro)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 √ó 10
  .model            .type          ME  RMSE   MAE   MPE  MAPE  MASE RMSSE  ACF1
  &lt;chr&gt;             &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 alisado_simple    Training  0.00644  4.08  3.43 -4.61 25.9  2.13  2.07  0.583
2 alisado_doble     Training -0.0322   4.08  3.44 -5.01 26.1  2.14  2.08  0.581
3 alisado_triple_ad Training -0.0190   1.42  1.13 -1.33  9.24 0.704 0.722 0.182
4 alisado_triple_m  Training -0.0264   1.46  1.17 -1.73  9.39 0.726 0.742 0.201</code></pre>
</div>
<div class="sourceCode cell-code" id="cb452"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb452-1"><a href="#cb452-1"></a><span class="fu">accuracy</span>(predicciones, retiro_ts_monthly_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 √ó 10
  .model            .type    ME  RMSE   MAE   MPE  MAPE  MASE RMSSE    ACF1
  &lt;chr&gt;             &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 alisado_doble     Test  7.46  10.5   8.16 30.3  40.1    NaN   NaN  0.788 
2 alisado_simple    Test  7.93  10.9   8.48 33.6  41.5    NaN   NaN  0.784 
3 alisado_triple_ad Test  0.872  1.58  1.33  4.46  8.70   NaN   NaN -0.0169
4 alisado_triple_m  Test  0.654  1.40  1.17  3.88  8.12   NaN   NaN -0.0341</code></pre>
</div>
</div>
</section>
<section id="ejemplo-real-aemet-again-23" class="slide level2">
<h2>Ejemplo real: AEMET again</h2>
<p>El <span class="hl-yellow"><strong>diagn√≥stico de los residuos</strong></span> (de momento solo visual, ya veremos con lso ARIMA como testar que los residuos son como los queremos, normales, etc) lo haremos con <code>gg_tsresiduals()</code> sobre el modelo ‚Äúganador‚Äù</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb454"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb454-1"><a href="#cb454-1"></a>retiro_ts_monthly_train <span class="sc">|&gt;</span> </span>
<span id="cb454-2"><a href="#cb454-2"></a>   <span class="fu">model</span>(<span class="st">"alisado_triple_ad"</span> <span class="ot">=</span> <span class="fu">ETS</span>(tmed <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"A"</span>, <span class="at">period =</span> <span class="st">"1 year"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb454-3"><a href="#cb454-3"></a>  <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-308-1.png" width="960" class="r-stretch"></section>
<section id="casos-reales" class="slide level2">
<h2>Casos reales</h2>
<p>Practica para a <span class="hl-yellow"><strong>ejecutar todo el proceso</strong></span> con estas series</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb455"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb455-1"><a href="#cb455-1"></a>datos <span class="ot">&lt;-</span> tsibbledata<span class="sc">::</span>gafa_stock <span class="sc">|&gt;</span> <span class="fu">filter</span>(Symbol <span class="sc">==</span> <span class="st">"GOOG"</span>)</span>
<span id="cb455-2"><a href="#cb455-2"></a>datos <span class="ot">&lt;-</span> timeSeriesDataSets<span class="sc">::</span>beer_ts <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>()</span>
<span id="cb455-3"><a href="#cb455-3"></a>datos <span class="ot">&lt;-</span> timeSeriesDataSets<span class="sc">::</span>co2_ts <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li><p>Preprocesa los datos de manera adecuada</p></li>
<li><p>An√°lisis y visualizaci√≥n descriptiva. Determinar si/no tendencia (y de qu√© tipo)</p></li>
<li><p>Determinar homocedasticidad/heterocedasticidad y c√≥mo evoluciona su varianza. En caso necesario aplicar transformaci√≥n.</p></li>
</ol>
</section>
<section id="casos-reales-1" class="slide level2">
<h2>Casos reales</h2>
<p>Prueba a <span class="hl-yellow"><strong>ejecutar todo el proceso</strong></span> con estas series</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb456"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb456-1"><a href="#cb456-1"></a>datos <span class="ot">&lt;-</span> tsibbledata<span class="sc">::</span>gafa_stock <span class="sc">|&gt;</span> <span class="fu">filter</span>(Symbol <span class="sc">==</span> <span class="st">"GOOG"</span>)</span>
<span id="cb456-2"><a href="#cb456-2"></a>datos <span class="ot">&lt;-</span> timeSeriesDataSets<span class="sc">::</span>beer_ts <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>()</span>
<span id="cb456-3"><a href="#cb456-3"></a>datos <span class="ot">&lt;-</span> timeSeriesDataSets<span class="sc">::</span>co2_ts <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li><p>Determinar periodicidad <span class="math inline">\(s\)</span></p></li>
<li><p>Realizar todos los m√©todos de alisado conocidos as√≠ como otros modelos que sepas de fable. Pensar ANTES de ver su resultado c√≥mo crees que van a funcionar y por qu√©</p></li>
<li><p>Evaluarlos en train-test</p></li>
<li><p>Usa el mejor de los m√©todos posibles en cada datasets y ahora ajustarlo pero con distintos valores de los par√°metros <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span> y <span class="math inline">\(\gamma\)</span> y decidir los 3 mejores modelos haciendo uso de la validaci√≥n cruzada</p></li>
</ol>
</section>
<section id="casos-reales-acciones-de-google" class="slide level2">
<h2>Casos reales: acciones de google</h2>
<p>Vamos a ilustrar el inicio de c√≥mo trabajar con la <span class="hl-yellow"><strong>serie temporal que captura el precio de cierre de las acciones de Google</strong></span> (variable <code>Close</code> del paquete <code>{tsibbledata::gafa_stock}</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb457"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb457-1"><a href="#cb457-1"></a>datos <span class="ot">&lt;-</span> tsibbledata<span class="sc">::</span>gafa_stock <span class="sc">|&gt;</span> <span class="fu">filter</span>(Symbol <span class="sc">==</span> <span class="st">"GOOG"</span>)</span>
<span id="cb457-2"><a href="#cb457-2"></a>datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 1,258 x 8 [!]
# Key:       Symbol [1]
   Symbol Date        Open  High   Low Close Adj_Close  Volume
   &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 GOOG   2014-01-02  554.  555.  551.  553.      553. 3666400
 2 GOOG   2014-01-03  554.  555.  549.  549.      549. 3355000
 3 GOOG   2014-01-06  553.  556.  550.  555.      555. 3561600
 4 GOOG   2014-01-07  559.  566.  557.  566.      566. 5138400
 5 GOOG   2014-01-08  569.  570.  563.  567.      567. 4514100
 6 GOOG   2014-01-09  568.  568.  559.  561.      561. 4196000
 7 GOOG   2014-01-10  566.  566.  557.  561.      561. 4314700
 8 GOOG   2014-01-13  560.  570.  555.  558.      558. 4869100
 9 GOOG   2014-01-14  565.  572.  560.  571.      571. 4997400
10 GOOG   2014-01-15  573.  574.  568.  571.      571. 3925700
# ‚Ñπ 1,248 more rows</code></pre>
</div>
</div>
</section>
<section id="acciones-de-google" class="slide level2">
<h2>Acciones de google</h2>
<ol type="1">
<li><span class="hl-yellow"><strong>Preprocesa los datos</strong></span> de manera adecuada</li>
</ol>
<p>¬øHay huecos?</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb459"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb459-1"><a href="#cb459-1"></a>datos <span class="sc">|&gt;</span> </span>
<span id="cb459-2"><a href="#cb459-2"></a>  <span class="fu">count</span>(<span class="fu">year</span>(Date)) <span class="sc">|&gt;</span> </span>
<span id="cb459-3"><a href="#cb459-3"></a>  <span class="fu">arrange</span>(n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Si te fijas <span class="hl-red"><strong>ning√∫n a√±o tiene 365 valores</strong></span> ya que los mercados burs√°tiles cierran los fines de semana.</p>
</section>
<section id="acciones-de-google-1" class="slide level2">
<h2>Acciones de google</h2>
<p>Para <span class="hl-yellow"><strong>rellenar los huecos</strong></span> vamos a usar primero <code>fill_gaps()</code> rellenando las fechas que no tenemos (con valores vac√≠os) y luego <code>fill(..., .direction = "down")</code> para <strong>rellenar la variable objetivo</strong> con los valores previos (el s√°badon y domingo ser√° el valor de cierre del viernes).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb460"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb460-1"><a href="#cb460-1"></a>datos  <span class="ot">&lt;-</span></span>
<span id="cb460-2"><a href="#cb460-2"></a>  datos <span class="sc">|&gt;</span> </span>
<span id="cb460-3"><a href="#cb460-3"></a>  <span class="fu">fill_gaps</span>() <span class="sc">|&gt;</span> </span>
<span id="cb460-4"><a href="#cb460-4"></a>  <span class="fu">fill</span>(Close, <span class="at">.direction =</span> <span class="st">"down"</span>)</span>
<span id="cb460-5"><a href="#cb460-5"></a></span>
<span id="cb460-6"><a href="#cb460-6"></a>datos <span class="sc">|&gt;</span> </span>
<span id="cb460-7"><a href="#cb460-7"></a>  <span class="fu">count</span>(<span class="fu">year</span>(Date)) <span class="sc">|&gt;</span> </span>
<span id="cb460-8"><a href="#cb460-8"></a>  <span class="fu">arrange</span>(n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 2
  `year(Date)`     n
         &lt;dbl&gt; &lt;int&gt;
1         2017   251
2         2018   251
3         2014   252
4         2015   252
5         2016   252</code></pre>
</div>
</div>
<p>Si te fijas‚Ä¶<span class="hl-red"><strong>¬°no hecho absolutamente nada!</strong></span></p>
</section>
<section id="acciones-de-google-2" class="slide level2">
<h2>Acciones de google</h2>
<p>Si te fijas lo primero que estamos pidiendo es <code>fill_gaps()</code>: rellena huecos entre fechas. Por ejemplo, si los datos son diarios, debe buscar huecos entre d√≠as, pero para eso lo primero que tiene que saber es que la <span class="hl-yellow"><strong>serie es diaria</strong></span> y saber c√≥mo debe rellenar huecos.</p>
<div class="fragment">
<p>Si te fijas en la <span class="hl-yellow"><strong>cabecera del <code>tsibble</code></strong></span> aparece esto:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb462"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb462-1"><a href="#cb462-1"></a><span class="co"># A tsibble: 1,258 x 8 [!]</span></span>
<span id="cb462-2"><a href="#cb462-2"></a><span class="co"># Key:       Symbol [1]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment">
<p>En <code>Key:</code> no deber√≠a figurar nada (ya que no tenemos distintas series al haber filtrado una sola) pero sobre todo‚Ä¶en [!]<code>deber√≠a figurar</code>[1D]` <span class="hl-red"><strong>¬°pero no figura nada!</strong></span></p>
</div>
</section>
<section id="acciones-de-google-3" class="slide level2">
<h2>Acciones de google</h2>
<p>Para arreglarlo vamos a <span class="hl-yellow"><strong>redefinir el objeto de serie temporal</strong></span> indic√°ndole dentro de <code>as_tsibble()</code> que</p>
<ul>
<li><code>index</code> variable temporal</li>
<li><code>key</code>: si tuvi√©ramos varias series a la vez (en este caso <code>NULL</code>)</li>
<li><code>regular = TRUE</code>: regular time interval (para que detecte adecuadamente la periodicidad de la serie, en este caso <code>[1D]</code>)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb463"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb463-1"><a href="#cb463-1"></a>datos <span class="ot">&lt;-</span></span>
<span id="cb463-2"><a href="#cb463-2"></a>  datos <span class="sc">|&gt;</span></span>
<span id="cb463-3"><a href="#cb463-3"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> Date, <span class="at">key =</span> <span class="cn">NULL</span>, <span class="at">regular =</span> <span class="cn">TRUE</span>)</span>
<span id="cb463-4"><a href="#cb463-4"></a>datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 1,258 x 8 [1D]
   Symbol Date        Open  High   Low Close Adj_Close  Volume
   &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 GOOG   2014-01-02  554.  555.  551.  553.      553. 3666400
 2 GOOG   2014-01-03  554.  555.  549.  549.      549. 3355000
 3 GOOG   2014-01-06  553.  556.  550.  555.      555. 3561600
 4 GOOG   2014-01-07  559.  566.  557.  566.      566. 5138400
 5 GOOG   2014-01-08  569.  570.  563.  567.      567. 4514100
 6 GOOG   2014-01-09  568.  568.  559.  561.      561. 4196000
 7 GOOG   2014-01-10  566.  566.  557.  561.      561. 4314700
 8 GOOG   2014-01-13  560.  570.  555.  558.      558. 4869100
 9 GOOG   2014-01-14  565.  572.  560.  571.      571. 4997400
10 GOOG   2014-01-15  573.  574.  568.  571.      571. 3925700
# ‚Ñπ 1,248 more rows</code></pre>
</div>
</div>
</section>
<section id="acciones-de-google-4" class="slide level2">
<h2>Acciones de google</h2>
<p>Ahora ya s√≠ podemos <span class="hl-yellow"><strong>rellenar los huecos</strong></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb465"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb465-1"><a href="#cb465-1"></a>datos  <span class="ot">&lt;-</span></span>
<span id="cb465-2"><a href="#cb465-2"></a>  datos <span class="sc">|&gt;</span> </span>
<span id="cb465-3"><a href="#cb465-3"></a>  <span class="fu">fill_gaps</span>() <span class="sc">|&gt;</span> </span>
<span id="cb465-4"><a href="#cb465-4"></a>  <span class="fu">fill</span>(Close, <span class="at">.direction =</span> <span class="st">"down"</span>)</span>
<span id="cb465-5"><a href="#cb465-5"></a></span>
<span id="cb465-6"><a href="#cb465-6"></a>datos <span class="sc">|&gt;</span> </span>
<span id="cb465-7"><a href="#cb465-7"></a>  <span class="fu">count</span>(<span class="fu">year</span>(Date)) <span class="sc">|&gt;</span> </span>
<span id="cb465-8"><a href="#cb465-8"></a>  <span class="fu">arrange</span>(n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 2
  `year(Date)`     n
         &lt;dbl&gt; &lt;int&gt;
1         2014   364
2         2015   365
3         2017   365
4         2018   365
5         2016   366</code></pre>
</div>
</div>
</section>
<section id="acciones-de-google-5" class="slide level2">
<h2>Acciones de google</h2>
<ol start="2" type="1">
<li><span class="hl-yellow"><strong>Visualizamos</strong></span> los datos. <span class="hl-yellow"><strong>¬øTiene tendencia?</strong></span></li>
</ol>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb467"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb467-1"><a href="#cb467-1"></a><span class="fu">ggplot</span>(datos, <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> Close)) <span class="sc">+</span></span>
<span id="cb467-2"><a href="#cb467-2"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb467-3"><a href="#cb467-3"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb467-4"><a href="#cb467-4"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-317-1.png" width="960" class="r-stretch"><p>Parece que s√≠, que <span class="hl-yellow"><strong>existe una tendencia positiva</strong></span></p>
</section>
<section id="acciones-de-google-6" class="slide level2">
<h2>Acciones de google</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb468"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb468-1"><a href="#cb468-1"></a>ajuste_lineal <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> datos, <span class="at">formula =</span> Close <span class="sc">~</span> Date)</span>
<span id="cb468-2"><a href="#cb468-2"></a>ajuste_lineal <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Close ~ Date, data = datos)

Residuals:
    Min      1Q  Median      3Q     Max 
-162.04  -53.29  -14.68   48.75  188.99 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -5.796e+03  5.134e+01  -112.9   &lt;2e-16 ***
Date         3.876e-01  3.021e-03   128.3   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 68 on 1823 degrees of freedom
Multiple R-squared:  0.9003,    Adjusted R-squared:  0.9002 
F-statistic: 1.646e+04 on 1 and 1823 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Existe una <strong>muy fuerte tendencia positiva</strong>. Si te fijas <span class="math inline">\(R^2 = 0.9\)</span> y los contrastes son todos apoyando rechazar la hip√≥tesis nula as√≠ parece que tiene sentido que la <span class="hl-yellow"><strong>tendencia sea lineal (es decir, ADITIVA)</strong></span></p>
</section>
<section id="acciones-de-google-7" class="slide level2">
<h2>Acciones de google</h2>
<p>Una forma de chequear si es aditiva o no es ver los <span class="hl-yellow"><strong>errores tras ajustar tendencia</strong></span>: no se observa ning√∫n patr√≥n evidente que falte por modelizar (si fuese multiplicativa se ver√≠a una tendencia todav√≠a)</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb470"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb470-1"><a href="#cb470-1"></a><span class="fu">ggplot</span>(<span class="fu">tibble</span>(<span class="st">"fecha"</span> <span class="ot">=</span> datos<span class="sc">$</span>Date, <span class="st">"res"</span> <span class="ot">=</span> ajuste_lineal<span class="sc">$</span>residuals),</span>
<span id="cb470-2"><a href="#cb470-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span> fecha, <span class="at">y =</span> res)) <span class="sc">+</span></span>
<span id="cb470-3"><a href="#cb470-3"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb470-4"><a href="#cb470-4"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-319-1.png" width="960" class="r-stretch"></section>
<section id="acciones-de-google-8" class="slide level2">
<h2>Acciones de google</h2>
<ol start="3" type="1">
<li>Determinar <span class="hl-yellow"><strong>homocedasticidad/heterocedasticidad</strong></span> y c√≥mo evoluciona su varianza. En caso necesario aplicar transformaci√≥n.</li>
</ol>
<p>Una primera opci√≥n es <span class="hl-yellow"><strong>visualizaci√≥n de la dispersi√≥n</strong></span> por periodos (por ejemplo, por meses)</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb471"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb471-1"><a href="#cb471-1"></a>datos <span class="ot">&lt;-</span></span>
<span id="cb471-2"><a href="#cb471-2"></a>  datos <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="st">"year_month"</span> <span class="ot">=</span> <span class="fu">yearmonth</span>(Date))</span>
<span id="cb471-3"><a href="#cb471-3"></a>resumen_var <span class="ot">&lt;-</span></span>
<span id="cb471-4"><a href="#cb471-4"></a>  datos <span class="sc">|&gt;</span></span>
<span id="cb471-5"><a href="#cb471-5"></a>  <span class="fu">index_by</span>(year_month) <span class="sc">|&gt;</span> </span>
<span id="cb471-6"><a href="#cb471-6"></a>  <span class="fu">summarise</span>(<span class="st">"dispersion"</span> <span class="ot">=</span> <span class="fu">sd</span>(Close) <span class="sc">/</span> <span class="fu">mean</span>(Close))</span>
<span id="cb471-7"><a href="#cb471-7"></a></span>
<span id="cb471-8"><a href="#cb471-8"></a><span class="fu">ggplot</span>(resumen_var, <span class="fu">aes</span>(<span class="at">x =</span> year_month, <span class="at">y =</span> dispersion)) <span class="sc">+</span></span>
<span id="cb471-9"><a href="#cb471-9"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb471-10"><a href="#cb471-10"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb471-11"><a href="#cb471-11"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-320-1.png" width="960" class="r-stretch"><div class="fragment">
<p>Al margen de posibles outliers: <span class="hl-yellow"><strong>no hay un patr√≥n ni tendencia en la varianza</strong></span></p>
</div>
</section>
<section id="acciones-de-google-9" class="slide level2">
<h2>Acciones de google</h2>
<p>De hecho si realizamos el <span class="hl-yellow"><strong>ajuste de un recta a la propia varianza agrupada</strong></span> vemos que no es significativo: no hay evidencias de que exista una varianza que cambien con el tiempo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb472"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb472-1"><a href="#cb472-1"></a><span class="fu">lm</span>(<span class="at">data =</span> resumen_var, <span class="at">formula =</span> dispersion <span class="sc">~</span> year_month) <span class="sc">|&gt;</span></span>
<span id="cb472-2"><a href="#cb472-2"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = dispersion ~ year_month, data = resumen_var)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.015438 -0.008556 -0.003433  0.006435  0.078257 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)
(Intercept) 1.982e-02  5.878e-02   0.337    0.737
year_month  1.864e-07  3.462e-06   0.054    0.957

Residual standard error: 0.01414 on 58 degrees of freedom
Multiple R-squared:  4.995e-05, Adjusted R-squared:  -0.01719 
F-statistic: 0.002897 on 1 and 58 DF,  p-value: 0.9573</code></pre>
</div>
</div>
</section>
<section id="acciones-de-google-10" class="slide level2">
<h2>Acciones de google</h2>
<ol start="4" type="1">
<li><span class="hl-yellow"><strong>Determinar periodicidad</strong></span> <span class="math inline">\(s\)</span></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb474"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb474-1"><a href="#cb474-1"></a><span class="fu">pacf</span>(datos<span class="sc">$</span>Close)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-322-1.png" width="960" class="r-stretch"><p>No vemos a priori estacionalidad‚Ä¶porque recuerda que aqu√≠ tenemos datos diarios. ¬øY si aumentamos el n√∫mero de retardos?</p>
</section>
<section id="acciones-de-google-11" class="slide level2">
<h2>Acciones de google</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb475"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb475-1"><a href="#cb475-1"></a><span class="fu">pacf</span>(datos<span class="sc">$</span>Close, <span class="at">lag.max =</span> <span class="dv">365</span><span class="sc">*</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-323-1.png" width="960" class="r-stretch"><p><span class="hl-yellow"><strong>No se aprecia patr√≥n estacional</strong></span></p>
</section>
<section id="acciones-de-google-12" class="slide level2">
<h2>Acciones de google</h2>
<p>Esto tambi√©n lo podemos <span class="hl-yellow"><strong>visualizar de manera conjunta</strong></span> con <code>gg_tsdisplay()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb476"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb476-1"><a href="#cb476-1"></a>datos <span class="sc">|&gt;</span> </span>
<span id="cb476-2"><a href="#cb476-2"></a>  <span class="fu">gg_tsdisplay</span>(<span class="at">y =</span> Close, <span class="at">lag =</span> <span class="dv">365</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-324-1.png" width="960" class="r-stretch"><div class="fragment">
<p>F√≠jate que adem√°s de no mostrarnos un <strong>patr√≥n en las autocorrelaciones</strong> al pedirle que la serie cada a√±o (cada 365 valores corta una curva) y vemos que <span class="hl-yellow"><strong>efectivamente no comparten ning√∫n patr√≥n anual</strong></span></p>
</div>
</section>
<section id="acciones-de-google-13" class="slide level2">
<h2>Acciones de google</h2>
<p>Otra forma de comprobar que efectivamente no es estacionales haciendo una <span class="hl-yellow"><strong>diferenciaci√≥n estacional de la serie</strong></span>: a cada valor le vamos a restar su valor <span class="math inline">\(s\)</span> periodos previos.</p>
<p>&nbsp;</p>
<p>La funci√≥n que nos lo permite se llama <code>difference()</code> (del paquete <code>{tsibble}</code>)</p>
</section>
<section id="acciones-de-google-14" class="slide level2">
<h2>Acciones de google</h2>
<ul>
<li>Si <span class="math inline">\(s\)</span> est√° <span class="hl-red"><strong>mal elegido seguir√° presentando ese patr√≥n</strong></span> (o uno a√∫n m√°s extra√±o)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb477"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb477-1"><a href="#cb477-1"></a>datos <span class="sc">|&gt;</span></span>
<span id="cb477-2"><a href="#cb477-2"></a>  <span class="fu">gg_tsdisplay</span>(<span class="fu">difference</span>(Close, <span class="dv">30</span>), <span class="at">lag_max =</span> <span class="dv">365</span><span class="sc">*</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-325-1.png" width="960" class="r-stretch"></section>
<section id="acciones-de-google-15" class="slide level2">
<h2>Acciones de google</h2>
<ul>
<li>Si <span class="math inline">\(s\)</span> est√° <span class="hl-red"><strong>mal elegido seguir√° presentando ese patr√≥n</strong></span> (o uno a√∫n m√°s extra√±o)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb478"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb478-1"><a href="#cb478-1"></a>datos <span class="sc">|&gt;</span></span>
<span id="cb478-2"><a href="#cb478-2"></a>  <span class="fu">gg_tsdisplay</span>(<span class="fu">difference</span>(Close, <span class="dv">180</span>), <span class="at">lag_max =</span> <span class="dv">365</span><span class="sc">*</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-326-1.png" width="960" class="r-stretch"></section>
<section id="acciones-de-google-16" class="slide level2">
<h2>Acciones de google</h2>
<ul>
<li>Si <span class="math inline">\(s\)</span> est√° <span class="hl-red"><strong>mal elegido seguir√° presentando ese patr√≥n</strong></span> (o uno a√∫n m√°s extra√±o)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb479"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb479-1"><a href="#cb479-1"></a>datos <span class="sc">|&gt;</span></span>
<span id="cb479-2"><a href="#cb479-2"></a>  <span class="fu">gg_tsdisplay</span>(<span class="fu">difference</span>(Close, <span class="dv">365</span>), <span class="at">lag_max =</span> <span class="dv">365</span><span class="sc">*</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-327-1.png" width="960" class="r-stretch"></section>
<section id="acciones-de-google-17" class="slide level2">
<h2>Acciones de google</h2>
<p>A partir de aqu√≠ todo tuyo. Piensa:</p>
<ul>
<li><p>Dividir train/test</p></li>
<li><p>¬øQu√© modelos podr√≠an tener sentido y por qu√©? ¬øAlg√∫n alisado? ¬øAlguno de los dem√°s vistos en <code>{fable}</code>?</p></li>
<li><p>¬øC√≥mo evaluar los modelos?</p></li>
</ul>
</section></section>
<section>
<section id="clase-16" class="title-slide slide level1 center">
<h1>Clases 16: <span class="flow">procesos estacionarios</span></h1>

</section>
<section id="modelos-arima" class="slide level2">
<h2>Modelos ARIMA</h2>
<p>En los a√±os 50 y 60 las matem√°ticas y la probabilidad entraron de lleno (a√∫n m√°s) en el campo de las series temporales, introduciendo el concepto de <span class="hl-yellow"><strong>proceso estoc√°stico</strong></span>.</p>
<div class="fragment">
<p>La idea es que la serie temporal <span class="math inline">\(X_t\)</span> que observamos en un instante temporal <span class="math inline">\(t\)</span> no es m√°s que la <span class="hl-yellow"><strong>realizaci√≥n de una variable aleatoria</strong></span> definida en dicho instante: el valor que observamos es un <strong>valor particular de los infinitos valores que podr√≠a haber tomado</strong>.</p>
</div>
<div class="fragment">
<p>Veamos un ejemplo simulado</p>
</div>
</section>
<section id="proceso-estoc√°stico" class="slide level2">
<h2>Proceso estoc√°stico</h2>
<p>Vamos a simular la siguiente serie temporal (lo que se conoce como <span class="hl-yellow"><strong>paseo aleatorio</strong></span>: el valor anterior m√°s una perturbaci√≥n aleatoria)</p>
<p><span class="math display">\[X_t = X_{t-1} + \varepsilon_t, \quad X_1 = 0, \quad \varepsilon \sim \mathcal{N} \left(0, \sigma^2 \right)\]</span></p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb480"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb480-1"><a href="#cb480-1"></a>n <span class="ot">&lt;-</span> <span class="dv">300</span></span>
<span id="cb480-2"><a href="#cb480-2"></a>sigma <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb480-3"><a href="#cb480-3"></a></span>
<span id="cb480-4"><a href="#cb480-4"></a>serie <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="st">"X_t"</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, n))</span>
<span id="cb480-5"><a href="#cb480-5"></a></span>
<span id="cb480-6"><a href="#cb480-6"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb480-7"><a href="#cb480-7"></a>  serie<span class="sc">$</span>X_t[i] <span class="ot">&lt;-</span> serie<span class="sc">$</span>X_t[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, sigma)</span>
<span id="cb480-8"><a href="#cb480-8"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>¬øQu√© <strong>patr√≥n</strong> tendr√≠a al visualizalro?</p>
</section>
<section id="proceso-estoc√°stico-1" class="slide level2">
<h2>Proceso estoc√°stico</h2>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb481"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb481-1"><a href="#cb481-1"></a><span class="fu">ggplot</span>(serie) <span class="sc">+</span></span>
<span id="cb481-2"><a href="#cb481-2"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t)) <span class="sc">+</span></span>
<span id="cb481-3"><a href="#cb481-3"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-329-1.png" width="960" class="r-stretch"></section>
<section id="proceso-estoc√°stico-2" class="slide level2">
<h2>Proceso estoc√°stico</h2>
<p>Al ser <span class="hl-yellow"><strong>aleatorio</strong></span> si nosotros volvi√©semos a generar el proceso obtendr√≠amos otro paseo aleatorio distinto</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb482"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb482-1"><a href="#cb482-1"></a>serie <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="st">"X_t"</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, n))</span>
<span id="cb482-2"><a href="#cb482-2"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb482-3"><a href="#cb482-3"></a>  serie<span class="sc">$</span>X_t[i] <span class="ot">&lt;-</span> serie<span class="sc">$</span>X_t[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, sigma)</span>
<span id="cb482-4"><a href="#cb482-4"></a>}</span>
<span id="cb482-5"><a href="#cb482-5"></a><span class="fu">ggplot</span>(serie) <span class="sc">+</span></span>
<span id="cb482-6"><a href="#cb482-6"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t)) <span class="sc">+</span></span>
<span id="cb482-7"><a href="#cb482-7"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-330-1.png" width="960" class="r-stretch"></section>
<section id="proceso-estoc√°stico-3" class="slide level2">
<h2>Proceso estoc√°stico</h2>
<p>¬øQu√© pasar√≠a si yo genero <strong>50 realizaciones de dicho paseo aleatorio</strong>?</p>
<div class="fragment">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb483"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb483-1"><a href="#cb483-1"></a>serie_total <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb483-2"><a href="#cb483-2"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>) {</span>
<span id="cb483-3"><a href="#cb483-3"></a>  serie <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"id_serie"</span> <span class="ot">=</span> <span class="fu">as.character</span>(j), <span class="st">"t"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="st">"X_t"</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, n))</span>
<span id="cb483-4"><a href="#cb483-4"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb483-5"><a href="#cb483-5"></a>    serie<span class="sc">$</span>X_t[i] <span class="ot">&lt;-</span> serie<span class="sc">$</span>X_t[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, sigma)</span>
<span id="cb483-6"><a href="#cb483-6"></a>  }</span>
<span id="cb483-7"><a href="#cb483-7"></a>  serie_total <span class="ot">&lt;-</span> </span>
<span id="cb483-8"><a href="#cb483-8"></a>    serie_total <span class="sc">|&gt;</span> </span>
<span id="cb483-9"><a href="#cb483-9"></a>    <span class="fu">bind_rows</span>(serie)</span>
<span id="cb483-10"><a href="#cb483-10"></a>}</span>
<span id="cb483-11"><a href="#cb483-11"></a><span class="fu">ggplot</span>(serie_total) <span class="sc">+</span></span>
<span id="cb483-12"><a href="#cb483-12"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t, <span class="at">color =</span> id_serie),</span>
<span id="cb483-13"><a href="#cb483-13"></a>            <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb483-14"><a href="#cb483-14"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb483-15"><a href="#cb483-15"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-331-1.png" width="960"></p>
</div>
</div>
</div>
</section>
<section id="proceso-estoc√°stico-4" class="slide level2">
<h2>Proceso estoc√°stico</h2>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb484"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb484-1"><a href="#cb484-1"></a>serie_total <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb484-2"><a href="#cb484-2"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>) {</span>
<span id="cb484-3"><a href="#cb484-3"></a>  serie <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"id_serie"</span> <span class="ot">=</span> <span class="fu">as.character</span>(j), <span class="st">"t"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="st">"X_t"</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, n))</span>
<span id="cb484-4"><a href="#cb484-4"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb484-5"><a href="#cb484-5"></a>    serie<span class="sc">$</span>X_t[i] <span class="ot">&lt;-</span> serie<span class="sc">$</span>X_t[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, sigma)</span>
<span id="cb484-6"><a href="#cb484-6"></a>  }</span>
<span id="cb484-7"><a href="#cb484-7"></a>  serie_total <span class="ot">&lt;-</span> </span>
<span id="cb484-8"><a href="#cb484-8"></a>    serie_total <span class="sc">|&gt;</span> </span>
<span id="cb484-9"><a href="#cb484-9"></a>    <span class="fu">bind_rows</span>(serie)</span>
<span id="cb484-10"><a href="#cb484-10"></a>}</span>
<span id="cb484-11"><a href="#cb484-11"></a>gg1 <span class="ot">&lt;-</span> </span>
<span id="cb484-12"><a href="#cb484-12"></a>  <span class="fu">ggplot</span>(serie_total) <span class="sc">+</span></span>
<span id="cb484-13"><a href="#cb484-13"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t, <span class="at">color =</span> id_serie),</span>
<span id="cb484-14"><a href="#cb484-14"></a>            <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb484-15"><a href="#cb484-15"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>, <span class="dv">250</span>),</span>
<span id="cb484-16"><a href="#cb484-16"></a>             <span class="at">color =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"orange"</span>, <span class="st">"darkgreen"</span>,</span>
<span id="cb484-17"><a href="#cb484-17"></a>                       <span class="st">"purple"</span>, <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb484-18"><a href="#cb484-18"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb484-19"><a href="#cb484-19"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb484-20"><a href="#cb484-20"></a></span>
<span id="cb484-21"><a href="#cb484-21"></a>gg2 <span class="ot">&lt;-</span> </span>
<span id="cb484-22"><a href="#cb484-22"></a>  <span class="fu">ggplot</span>(serie_total <span class="sc">|&gt;</span></span>
<span id="cb484-23"><a href="#cb484-23"></a>           <span class="fu">select</span>(t, X_t) <span class="sc">|&gt;</span></span>
<span id="cb484-24"><a href="#cb484-24"></a>           <span class="fu">filter</span>(t <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>, <span class="dv">250</span>)) <span class="sc">|&gt;</span></span>
<span id="cb484-25"><a href="#cb484-25"></a>           <span class="fu">mutate</span>(<span class="at">t =</span> <span class="fu">factor</span>(t))) <span class="sc">+</span></span>
<span id="cb484-26"><a href="#cb484-26"></a>  ggridges<span class="sc">::</span><span class="fu">geom_density_ridges</span>(<span class="fu">aes</span>(<span class="at">y=</span> t, <span class="at">x =</span> X_t, <span class="at">fill =</span> t),</span>
<span id="cb484-27"><a href="#cb484-27"></a>                                <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb484-28"><a href="#cb484-28"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"orange"</span>, <span class="st">"darkgreen"</span>,</span>
<span id="cb484-29"><a href="#cb484-29"></a>                       <span class="st">"purple"</span>, <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb484-30"><a href="#cb484-30"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb484-31"><a href="#cb484-31"></a>  <span class="fu">theme_minimal</span>() </span>
<span id="cb484-32"><a href="#cb484-32"></a></span>
<span id="cb484-33"><a href="#cb484-33"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb484-34"><a href="#cb484-34"></a>gg1 <span class="sc">+</span> gg2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-332-1.png" width="960" class="r-stretch"><p>La <span class="hl-yellow"><strong>serie temporal que observamos no es m√°s que una de las infinitas realizaciones</strong></span> que podr√≠a haber tomado</p>
</section>
<section id="proceso-estoc√°stico-5" class="slide level2">
<h2>Proceso estoc√°stico</h2>

<img data-src="index_files/figure-revealjs/unnamed-chunk-333-1.png" width="960" class="r-stretch"><ul>
<li><span class="hl-yellow"><strong>Proceso estoc√°stico</strong></span>: un conjunto de variables aleatorias <span class="math inline">\(\left\lbrace X_t \right\rbrace_{t \in T}\)</span> definidas sobre el mismo espacio de probabilidades <span class="math inline">\(\left(\Omega, \mathcal{A}, P \right)\)</span>. El conjunto de √≠ndices <span class="math inline">\(T\)</span> suele ser un <strong>espacio temporal continuo</strong>.</li>
</ul>
<p>En el gr√°fico: <span class="hl-purple"><strong>todo en su conjunto</strong></span></p>
</section>
<section id="proceso-estoc√°stico-6" class="slide level2">
<h2>Proceso estoc√°stico</h2>

<img data-src="index_files/figure-revealjs/unnamed-chunk-334-1.png" width="960" class="r-stretch"><p>Dado que <span class="math inline">\(\left\lbrace X_t \right\rbrace_{t \in T}\)</span> es un conjunto de variables aleatorias, dependientes tambi√©n de un espacio temporal, tendremos que</p>
<p><span class="math display">\[\begin{eqnarray}X: ~T \times \Omega &amp; \to &amp; S \nonumber \\  (t, \omega) &amp; \to &amp; X(t, \omega)\nonumber\end{eqnarray}\]</span></p>
<p>donde <span class="math inline">\(S\)</span> es el espacio de estados (valores posibles que puede tomar).</p>
</section>
<section id="proceso-estoc√°stico-7" class="slide level2">
<h2>Proceso estoc√°stico</h2>

<img data-src="index_files/figure-revealjs/unnamed-chunk-335-1.png" width="960" class="r-stretch"><ul>
<li><span class="hl-yellow"><strong>Realizaci√≥n o trayectoria de un proceso estoc√°stico</strong></span>: si fijamos <span class="math inline">\(\omega \in \Omega\)</span> (una aleatoriedad), tenemos</li>
</ul>
<p><span class="math display">\[\begin{eqnarray}X\left(\cdot, \omega \right): ~T  &amp; \to &amp; S \nonumber \\  t &amp; \to &amp; X_t (\omega) ~ \text{ una realizaci√≥n}\nonumber\end{eqnarray}\]</span> En el gr√°fico: <span class="hl-purple"><strong>si interpretamos una sola curva y vemos su evoluci√≥n en el tiempo</strong></span></p>
</section>
<section id="proceso-estoc√°stico-8" class="slide level2">
<h2>Proceso estoc√°stico</h2>

<img data-src="index_files/figure-revealjs/unnamed-chunk-336-1.png" width="960" class="r-stretch"><ul>
<li><span class="hl-yellow"><strong>Distribucion de probabilidad a tiempo t</strong></span>: si fijamos <span class="math inline">\(t \in T\)</span></li>
</ul>
<p><span class="math display">\[\begin{eqnarray}X\left(t, \cdot \right): ~\Omega  &amp; \to &amp; S \nonumber \\  \omega &amp; \to &amp; X_t (\cdot) ~ \text{ una distribuci√≥n aleatoria}\nonumber\end{eqnarray}\]</span></p>
<p>En el gr√°fico: <span class="hl-purple"><strong>si interpretamos la distribuci√≥n de todas las posibles curvas en un instante dado</strong></span></p>
</section>
<section id="proceso-estoc√°stico-9" class="slide level2">
<h2>Proceso estoc√°stico</h2>
<p><span class="math display">\[\begin{eqnarray}X: ~T \times \Omega &amp; \to &amp; S \nonumber \\  (t, \omega) &amp; \to &amp; X(t, \omega)\nonumber\end{eqnarray}\]</span></p>
<p>Dado que para cada instante <span class="math inline">\(t\)</span> tenemos una distribuci√≥n de probabilidad, podremos <span class="hl-yellow"><strong>caracterizar la serie con algunos de sus par√°metros poblacionales</strong></span>:</p>
<div class="columns">
<div class="column" style="width:40%;">
<ul>
<li><span class="hl-yellow"><strong>Media del proceso</strong></span>: fijado un <span class="math inline">\(t\)</span> tenemos que <span class="math inline">\(\mu_t = E \left[X_t \right]\)</span> (si es constante en el tiempo ‚Äì&gt; sin tendencia)</li>
</ul>
</div><div class="column" style="width:60%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb485"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb485-1"><a href="#cb485-1"></a><span class="fu">ggplot</span>(serie_total) <span class="sc">+</span></span>
<span id="cb485-2"><a href="#cb485-2"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t, <span class="at">color =</span> id_serie),</span>
<span id="cb485-3"><a href="#cb485-3"></a>            <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb485-4"><a href="#cb485-4"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> serie_total <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="st">"mu_t"</span> <span class="ot">=</span> <span class="fu">mean</span>(X_t), <span class="at">.by =</span> t),</span>
<span id="cb485-5"><a href="#cb485-5"></a>            <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> mu_t), <span class="at">linewidth =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb485-6"><a href="#cb485-6"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb485-7"><a href="#cb485-7"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-337-1.png" width="960"></p>
</div>
</div>
</div>
</div>
</section>
<section id="proceso-estoc√°stico-10" class="slide level2">
<h2>Proceso estoc√°stico</h2>
<p><span class="math display">\[\begin{eqnarray}X: ~T \times \Omega &amp; \to &amp; S \nonumber \\  (t, \omega) &amp; \to &amp; X(t, \omega)\nonumber\end{eqnarray}\]</span></p>
<p>Dado que para cada instante <span class="math inline">\(t\)</span> tenemos una distribuci√≥n de probabilidad, podremos <span class="hl-yellow"><strong>caracterizar la serie con algunos de sus par√°metros poblacionales</strong></span>:</p>
<div class="columns">
<div class="column" style="width:40%;">
<ul>
<li><span class="hl-yellow"><strong>Varianza del proceso</strong></span>: fijado un <span class="math inline">\(t\)</span> tenemos que <span class="math inline">\(\sigma_{t}^{2} = Var \left[X_t \right]\)</span> (si es constante en el tiempo ‚Äì&gt; homoced√°stica)</li>
</ul>
</div><div class="column" style="width:60%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb486"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb486-1"><a href="#cb486-1"></a><span class="fu">ggplot</span>(serie_total) <span class="sc">+</span></span>
<span id="cb486-2"><a href="#cb486-2"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t, <span class="at">color =</span> id_serie),</span>
<span id="cb486-3"><a href="#cb486-3"></a>            <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb486-4"><a href="#cb486-4"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> serie_total <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="st">"var_t"</span> <span class="ot">=</span> <span class="fu">sd</span>(X_t), <span class="at">.by =</span> t),</span>
<span id="cb486-5"><a href="#cb486-5"></a>            <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> var_t), <span class="at">linewidth =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb486-6"><a href="#cb486-6"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb486-7"><a href="#cb486-7"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-338-1.png" width="960"></p>
</div>
</div>
</div>
</div>
</section>
<section id="proceso-estoc√°stico-11" class="slide level2">
<h2>Proceso estoc√°stico</h2>
<p>Mientras que en los <span class="hl-red"><strong>modelos de descomposici√≥n y en los alisados exponencial simplemente realizamos un ajuste de una curva observada</strong></span> (sin tener en cuenta su distribuci√≥n estoc√°stica subyacente), en el momento en el que consideramos <span class="hl-yellow"><strong>modelos ARIMA</strong></span> (la serie como una realizaci√≥n de un conjunto de variables aleatorias correladas en el tiempo) ser√° importante su <span class="hl-yellow"><strong>estructura de autocorrelaci√≥n</strong></span>: las <span class="hl-yellow"><strong>diferentes distribuciones del proceso estoc√°stico dependen entre s√≠</strong></span> para distintos <span class="math inline">\(t\)</span>.</p>
<div class="fragment">
<p>Dados <span class="math inline">\(t_1\)</span> y <span class="math inline">\(t_2\)</span>, llamaremos <span class="hl-yellow"><strong>funci√≥n de autocovarianzas</strong></span> a</p>
<p><span class="math display">\[\gamma_{t_1, t_2} = Cov \left( X_{t_1}, X_{t_2} \right) = E \left[\left(X_{t_1} - \mu_{t_1} \right) \left(X_{t_2} - \mu_{t_2} \right) \right]\]</span></p>
<p>Dados <span class="math inline">\(t_1\)</span> y <span class="math inline">\(t_2\)</span>, llamaremos <span class="hl-yellow"><strong>funci√≥n de autocorrelaci√≥n</strong></span> a</p>
<p><span class="math display">\[\rho_{t_1, t_2} = Cor \left( X_{t_1}, X_{t_2} \right) = \frac{\gamma_{t_1, t_2}}{\sqrt{\sigma_{t_{1}}^{2}\sigma_{t_{1}}^{2}
}}\]</span></p>
</div>
</section>
<section id="proceso-estacionario" class="slide level2">
<h2>Proceso estacionario</h2>

<img data-src="index_files/figure-revealjs/unnamed-chunk-339-1.png" width="960" class="r-stretch"><p>Todo lo anterior es sobre la base de que yo <span class="hl-yellow"><strong>pudiese generar una colecci√≥n de curvas</strong></span> de manera que puedo observarlas de manera longitudinal (tiempo) o transversal (distribuci√≥n probabil√≠stica a un tiempo dado).</p>
</section>
<section id="proceso-estacionario-1" class="slide level2">
<h2>Proceso estacionario</h2>

<img data-src="index_files/figure-revealjs/unnamed-chunk-340-1.png" width="960" class="r-stretch"><p>El <span class="hl-red"><strong>problema</strong></span> es que normalmente es <span class="hl-red"><strong>inviable obtener varias realizaciones</strong></span>: si tengo una serie temporal de las temperaturas a lo largo del a√±o, esas temperaturas podr√≠an haber sido otras pero no puedo volver al pasado y generar otras nuevas.</p>
<div class="fragment">
<p>As√≠ la √∫nica forma de <span class="hl-yellow"><strong>estimar las caracter√≠sticas transversales (media, varianza, etc)</strong></span> de una serie haciendo uso de su evoluci√≥n longitudinal es <span class="hl-gren"><strong>suponer que esas propiedades transversales (distribuci√≥n) en cada instante temporal son estables</strong></span> (no var√≠an)</p>
</div>
</section>
<section id="proceso-estacionario-2" class="slide level2">
<h2>Proceso estacionario</h2>
<p>Por lo tanto el primer <span class="hl-yellow"><strong>requisito</strong></span> que necesitaremos para la introducci√≥n de modelos ARIMA o modelos probabl√≠sticos ser√° el <span class="hl-yellow"><strong>concepto de estacionariedad</strong></span>: algo de la serie que <strong>no var√≠e con el tiempo</strong></p>
<div class="fragment">
<p>Diremos que <span class="math inline">\(\left\lbrace X_{t} \right\rbrace\)</span> es un <span class="hl-yellow"><strong>proceso estacionario (en el tiempo)</strong></span> cuando sus <span class="hl-yellow"><strong>propiedades no dependen del instante <span class="math inline">\(t\)</span> en el que las medimos</strong></span>. Dicho de manera informal, una serie ser√° estacionaria cuando mire donde mire veo <em>lo mismo</em>, cuyo <span class="hl-yellow"><strong>patr√≥n no puede ser predicho</strong></span></p>
</div>
<div class="fragment">
<p>Desde un punto de vista matem√°tico es <span class="hl-yellow"><strong>estrictamente estacionario</strong></span> si para cualquier conjunto de instantes temporales y retardo <span class="math inline">\(h &gt; 0\)</span>, tenemos que <span class="math inline">\(\left(X_{t_{1}}, \ldots, X_{t_{n}} \right)\)</span> y <span class="math inline">\(\left(X_{t_{1}+h}, \ldots, X_{t_{n}+h} \right)\)</span> tienen la <strong>misma distribuci√≥n conjunta</strong>: son indistinguibles.</p>
</div>
</section>
<section id="proceso-estacionario-3" class="slide level2">
<h2>Proceso estacionario</h2>
<p>Dado que est√° condici√≥n es <strong>demasiado estricta</strong> (nos obligar√≠a a saber su distribuci√≥n, si es una normal, una chi-cuadrado, etc), trabajaremos con <span class="hl-yellow"><strong>procesos d√©bilmente estacionarios</strong></span></p>
<ol type="1">
<li><p><span class="hl-yellow"><strong>Media constante</strong></span>: <span class="math inline">\(\mu_{t} = \mu_{t+h} = cte\)</span> para cualquier instante <span class="math inline">\(t\)</span> y retardo <span class="math inline">\(h\)</span>.</p></li>
<li><p><span class="hl-yellow"><strong>Varianza constante</strong></span>: <span class="math inline">\(\sigma_{t}^{2} = \sigma_{t+h}^{2}\)</span> para cualquier instante <span class="math inline">\(t\)</span> y retardo <span class="math inline">\(h\)</span>.</p></li>
<li><p><span class="hl-yellow"><strong>Autocovarianzas independiente de t</strong></span>: <span class="math inline">\(\gamma_{s, t} = \gamma_{s+h, t+h} = \gamma_h\)</span> la <span class="hl-yellow"><strong>dependencia entre dos instantes solo depende de su distancia</strong></span>, al margen de en qu√© punto lo medimos.</p></li>
</ol>
</section>
<section id="proceso-estacionario-4" class="slide level2">
<h2>Proceso estacionario</h2>
<p>De lo anterior se derivan algunas <span class="hl-yellow"><strong>propiedades sobre las autocorrelaciones</strong></span> (las barras que nos dibuja el acf)</p>
<ul>
<li>Solo nos importan los <span class="math inline">\(\gamma_h = \gamma_{t, t+h}\)</span> para cada <span class="math inline">\(h=0, 1, 2, ...\)</span>, tal que <span class="math inline">\(\gamma_h = \gamma_{-h}\)</span></li>
</ul>
<div class="fragment">
<ul>
<li>De la misma forma <span class="math inline">\(\rho_h = \rho_{t, t+h} = \frac{\gamma_{t, t+h}}{\sigma_{t} \sigma_{t+h}} = \frac{\gamma_{t, t+h}}{\sigma^2} = \frac{\gamma_{h}}{\gamma_0}\)</span> tal que <span class="math inline">\(\rho_{h} = \rho_{-h}\)</span> y <span class="math inline">\(\rho_0 = 1\)</span>.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Dado que <span class="math inline">\(\left| \rho_{h} \right| \leq 1\)</span> entonces <span class="math inline">\(\left|\gamma_h \right| = \left| \rho_h \right| * \gamma_0 \leq \gamma_0\)</span> para todo <span class="math inline">\(h\)</span> (por eso decrecen las barras del acf)</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Si <span class="math inline">\(\left\lbrace X_t \right\rbrace\)</span> es un proceso estacionario entonces su diferencia <span class="math inline">\(X_{t} - X_{t-1}\)</span> tambi√©n lo es.</li>
</ul>
</div>
</section>
<section id="ruido-blanco" class="slide level2">
<h2>Ruido blanco</h2>
<p>Uno de los <span class="hl-yellow"><strong>procesos estoc√°sticos m√°s importantes</strong></span> es el conocido como <span class="hl-yellow"><strong>ruido blanco</strong></span></p>
<ol type="1">
<li><p><span class="hl-yellow"><strong>Media 0</strong></span>: <span class="math inline">\(\mu_{t} = \mu_{t+h} = 0\)</span> para cualquier instante <span class="math inline">\(t\)</span> y retardo <span class="math inline">\(h\)</span>.</p></li>
<li><p><span class="hl-yellow"><strong>Varianza constante</strong></span>: <span class="math inline">\(\sigma_{t}^{2} = \sigma_{t+h}^{2} = \sigma \neq 0\)</span> para cualquier instante <span class="math inline">\(t\)</span> y retardo <span class="math inline">\(h\)</span>.</p></li>
<li><p><span class="hl-yellow"><strong>Incorrelados temporalmente</strong></span>: <span class="math inline">\(\gamma_{s, t} = \gamma_{s+h, t+h} = \gamma_h = 0\)</span> si <span class="math inline">\(h\neq 0\)</span> (si <span class="math inline">\(h=0\)</span>, <span class="math inline">\(\gamma_0 = \sigma_t \neq 0\)</span>)</p></li>
</ol>
<div class="fragment">
<p>Este proceso estacionario ser√° importante ya que, <span class="hl-green"><strong>si he modelizado bien mi serie</strong></span>, el <span class="hl-yellow"><strong>residuo que queda sin explicar deber√≠a ser ruido blanco</strong></span></p>
</div>
</section>
<section id="diagn√≥stico-de-residuos" class="slide level2">
<h2>Diagn√≥stico de residuos</h2>
<p>Veamos un ejemplo con la serie de Google</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb487"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb487-1"><a href="#cb487-1"></a><span class="fu">library</span>(tsibble)</span>
<span id="cb487-2"><a href="#cb487-2"></a><span class="fu">library</span>(tsibbledata)</span>
<span id="cb487-3"><a href="#cb487-3"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb487-4"><a href="#cb487-4"></a><span class="fu">library</span>(feasts)</span>
<span id="cb487-5"><a href="#cb487-5"></a>google <span class="ot">&lt;-</span></span>
<span id="cb487-6"><a href="#cb487-6"></a>  gafa_stock <span class="sc">|&gt;</span></span>
<span id="cb487-7"><a href="#cb487-7"></a>  <span class="fu">filter</span>(Symbol <span class="sc">==</span> <span class="st">"GOOG"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb487-8"><a href="#cb487-8"></a>  <span class="fu">as_tsibble</span>(<span class="at">regular =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb487-9"><a href="#cb487-9"></a>  <span class="fu">fill_gaps</span>() <span class="sc">|&gt;</span> </span>
<span id="cb487-10"><a href="#cb487-10"></a>  <span class="fu">fill</span>(Close)</span>
<span id="cb487-11"><a href="#cb487-11"></a>google</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 1,825 x 8 [1D]
# Key:       Symbol [1]
   Symbol Date        Open  High   Low Close Adj_Close  Volume
   &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 GOOG   2014-01-02  554.  555.  551.  553.      553. 3666400
 2 GOOG   2014-01-03  554.  555.  549.  549.      549. 3355000
 3 GOOG   2014-01-04   NA    NA    NA   549.       NA       NA
 4 GOOG   2014-01-05   NA    NA    NA   549.       NA       NA
 5 GOOG   2014-01-06  553.  556.  550.  555.      555. 3561600
 6 GOOG   2014-01-07  559.  566.  557.  566.      566. 5138400
 7 GOOG   2014-01-08  569.  570.  563.  567.      567. 4514100
 8 GOOG   2014-01-09  568.  568.  559.  561.      561. 4196000
 9 GOOG   2014-01-10  566.  566.  557.  561.      561. 4314700
10 GOOG   2014-01-11   NA    NA    NA   561.       NA       NA
# ‚Ñπ 1,815 more rows</code></pre>
</div>
</div>
</section>
<section id="diagn√≥stico-de-residuos-1" class="slide level2">
<h2>Diagn√≥stico de residuos</h2>
<p>Ya vimos en su momento que tiene tendencia, por lo que <span class="hl-yellow"><strong>no es un proceso estacionario</strong></span> ya que su distribuci√≥n es distinta en distintos instantes temporales</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb489"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb489-1"><a href="#cb489-1"></a><span class="fu">ggplot</span>(google) <span class="sc">+</span></span>
<span id="cb489-2"><a href="#cb489-2"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> Close)) <span class="sc">+</span></span>
<span id="cb489-3"><a href="#cb489-3"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-342-1.png" width="960" class="r-stretch"></section>
<section id="diagn√≥stico-de-residuos-2" class="slide level2">
<h2>Diagn√≥stico de residuos</h2>
<p>Si pintamos las <span class="hl-yellow"><strong>estimaciones muestrales (insesgadsa) de las autocorrelaciones</strong></span> tenemos que <span class="hl-red"><strong>no decrecen</strong></span>, es decir, no es ruido blanco (queda algo por modelizar)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb490"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb490-1"><a href="#cb490-1"></a><span class="co"># alternativa a acf(google$Close) en forma gpglot</span></span>
<span id="cb490-2"><a href="#cb490-2"></a>google <span class="sc">|&gt;</span></span>
<span id="cb490-3"><a href="#cb490-3"></a>  <span class="fu">ACF</span>(Close, <span class="at">lag_max =</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb490-4"><a href="#cb490-4"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb490-5"><a href="#cb490-5"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Google closing stock price"</span>,</span>
<span id="cb490-6"><a href="#cb490-6"></a>       <span class="at">y =</span> <span class="st">"Estimaci√≥n muestral de autocorrelaciones"</span>,</span>
<span id="cb490-7"><a href="#cb490-7"></a>       <span class="at">x =</span> <span class="st">"Retardos"</span>) <span class="sc">+</span></span>
<span id="cb490-8"><a href="#cb490-8"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-343-1.png" width="960" class="r-stretch"></section>
<section id="diagn√≥stico-de-residuos-3" class="slide level2">
<h2>Diagn√≥stico de residuos</h2>
<p>Para tener una cuantificaci√≥n inferencial m√°s rigurosa sobre si es o no ruido blanco podemos realizar el <span class="hl-yellow"><strong>test de Ljung-Box que nos contrasta si un grupo cualquiera de autocorrelaciones son diferentes de cero</strong></span> (se conoce como contrastes Portmanteau a aquellos que en lugar de probar la aleatoriedad en cada retardo distinto, prueba la aleatoriedad ‚Äúen general‚Äù)</p>
<p>Para ello usaremos <code>features()</code> con la opci√≥n <code>ljung_box</code> (ya la usamos para las transformaciones Box-Cox)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb491"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb491-1"><a href="#cb491-1"></a>google <span class="sc">|&gt;</span></span>
<span id="cb491-2"><a href="#cb491-2"></a>  <span class="fu">features</span>(Close, ljung_box, <span class="at">lag =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 3
  Symbol lb_stat lb_pvalue
  &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 GOOG    17980.         0</code></pre>
</div>
</div>
<p>Seg√∫n el contraste hay <span class="hl-red"><strong>evidencia suficientes para rechazar que sean cero</strong></span> -&gt; no es ruido blanco</p>
</section>
<section id="diagn√≥stico-de-residuos-4" class="slide level2">
<h2>Diagn√≥stico de residuos</h2>
<p>¬øPero qu√© pasa si yo <span class="hl-yellow"><strong>diferencio la serie</strong></span> (resto a cada valor su instante anterior)? Si ahora te diese dos fotos de la serie, ¬øsabr√≠as ahora <span class="hl-yellow"><strong>distinguir su instante temporal</strong></span>?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb493"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb493-1"><a href="#cb493-1"></a><span class="fu">ggplot</span>(google) <span class="sc">+</span></span>
<span id="cb493-2"><a href="#cb493-2"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> <span class="fu">difference</span>(Close))) <span class="sc">+</span></span>
<span id="cb493-3"><a href="#cb493-3"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-345-1.png" width="960" class="r-stretch"></section>
<section id="diagn√≥stico-de-residuos-5" class="slide level2">
<h2>Diagn√≥stico de residuos</h2>
<p>¬°Todas se desploman!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb494"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb494-1"><a href="#cb494-1"></a><span class="co"># alternativa a acf(google$Close) en forma gpglot</span></span>
<span id="cb494-2"><a href="#cb494-2"></a>google <span class="sc">|&gt;</span></span>
<span id="cb494-3"><a href="#cb494-3"></a>  <span class="fu">ACF</span>(<span class="fu">difference</span>(Close), <span class="at">lag_max =</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb494-4"><a href="#cb494-4"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb494-5"><a href="#cb494-5"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Google closing stock price"</span>,</span>
<span id="cb494-6"><a href="#cb494-6"></a>       <span class="at">subtitle =</span> <span class="st">"Serie diferenciada"</span>,</span>
<span id="cb494-7"><a href="#cb494-7"></a>       <span class="at">y =</span> <span class="st">"Estimaci√≥n muestral de autocorrelaciones"</span>,</span>
<span id="cb494-8"><a href="#cb494-8"></a>       <span class="at">x =</span> <span class="st">"Retardos"</span>) <span class="sc">+</span></span>
<span id="cb494-9"><a href="#cb494-9"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-346-1.png" width="960" class="r-stretch"></section>
<section id="diagn√≥stico-de-residuos-6" class="slide level2">
<h2>Diagn√≥stico de residuos</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb495"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb495-1"><a href="#cb495-1"></a>google <span class="sc">|&gt;</span></span>
<span id="cb495-2"><a href="#cb495-2"></a>  <span class="fu">mutate</span>(<span class="at">diff_close =</span> <span class="fu">difference</span>(Close)) <span class="sc">|&gt;</span></span>
<span id="cb495-3"><a href="#cb495-3"></a>  <span class="fu">features</span>(diff_close, ljung_box, <span class="at">lag =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 3
  Symbol lb_stat lb_pvalue
  &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 GOOG      31.7  0.000442</code></pre>
</div>
</div>
<p>Simplemente aplicando una diferenciaci√≥n nuestro proceso se ha <span class="hl-yellow"><strong>convertido en ruido blanco</strong></span></p>
</section></section>
<section>
<section id="clase-17" class="title-slide slide level1 center">
<h1>Clases 17: <span class="flow">procesos MA</span></h1>

</section>
<section id="correlogramas" class="slide level2">
<h2>Correlogramas</h2>
<p>Como hemos comentado los <span class="hl-yellow"><strong>correlogramas</strong></span> van a ser ahora fundamentales ya que os da informaci√≥n de la estructura del proceso estoc√°stico subyacente.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb497"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb497-1"><a href="#cb497-1"></a>google <span class="sc">|&gt;</span></span>
<span id="cb497-2"><a href="#cb497-2"></a>  <span class="fu">ACF</span>(Close, <span class="at">lag_max =</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb497-3"><a href="#cb497-3"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb497-4"><a href="#cb497-4"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Estimaci√≥n muestral de autocorrelaciones"</span>,</span>
<span id="cb497-5"><a href="#cb497-5"></a>       <span class="at">x =</span> <span class="st">"Retardos"</span>) <span class="sc">+</span></span>
<span id="cb497-6"><a href="#cb497-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-348-1.png" width="960"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb498"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb498-1"><a href="#cb498-1"></a>google <span class="sc">|&gt;</span></span>
<span id="cb498-2"><a href="#cb498-2"></a>  <span class="fu">ACF</span>(<span class="fu">difference</span>(Close), <span class="at">lag_max =</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb498-3"><a href="#cb498-3"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb498-4"><a href="#cb498-4"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Estimaci√≥n muestral de autocorrelaciones"</span>,</span>
<span id="cb498-5"><a href="#cb498-5"></a>       <span class="at">x =</span> <span class="st">"Retardos"</span>) <span class="sc">+</span></span>
<span id="cb498-6"><a href="#cb498-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-349-1.png" width="960"></p>
</div>
</div>
</div>
</div>
</section>
<section id="correlogramas-1" class="slide level2">
<h2>Correlogramas</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-350-1.png" width="960"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-351-1.png" width="960"></p>
</div>
</div>
</div>
</div>
<p>En lineas generales diremos que</p>
<ul>
<li><p><span class="hl-yellow"><strong>Series con tendencia</strong></span> presentar√°n una ca√≠da muy lenta de las autocorrelaciones (la tendencia implica que el valor <span class="math inline">\(t+1\)</span> depende del <span class="math inline">\(t, t-1, t-2, ...\)</span>)</p></li>
<li><p><span class="hl-yellow"><strong>Series con estacionalidad</strong></span> presentar√°n un patr√≥n c√≠clico de ca√≠da a lo largo del tiempo.</p></li>
</ul>
</section>
<section id="correlogramas-2" class="slide level2">
<h2>Correlogramas</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb499"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb499-1"><a href="#cb499-1"></a>datos <span class="ot">&lt;-</span> timeSeriesDataSets<span class="sc">::</span>a10_ts <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>(<span class="at">regular =</span> <span class="cn">TRUE</span>)</span>
<span id="cb499-2"><a href="#cb499-2"></a><span class="fu">ggplot</span>(datos) <span class="sc">+</span></span>
<span id="cb499-3"><a href="#cb499-3"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb499-4"><a href="#cb499-4"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-352-1.png" width="960"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb500"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb500-1"><a href="#cb500-1"></a>datos <span class="sc">|&gt;</span></span>
<span id="cb500-2"><a href="#cb500-2"></a>  <span class="fu">ACF</span>(value, <span class="at">lag_max =</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb500-3"><a href="#cb500-3"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb500-4"><a href="#cb500-4"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Estimaci√≥n muestral de autocorrelaciones"</span>,</span>
<span id="cb500-5"><a href="#cb500-5"></a>       <span class="at">x =</span> <span class="st">"Retardos"</span>) <span class="sc">+</span></span>
<span id="cb500-6"><a href="#cb500-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-353-1.png" width="960"></p>
</div>
</div>
</div>
</div>
</section>
<section id="correlogramas-3" class="slide level2">
<h2>Correlogramas</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb501"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb501-1"><a href="#cb501-1"></a>datos <span class="ot">&lt;-</span> timeSeriesDataSets<span class="sc">::</span>beer_ts <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>(<span class="at">regular =</span> <span class="cn">TRUE</span>)</span>
<span id="cb501-2"><a href="#cb501-2"></a><span class="fu">ggplot</span>(datos) <span class="sc">+</span></span>
<span id="cb501-3"><a href="#cb501-3"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb501-4"><a href="#cb501-4"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-354-1.png" width="960"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb502"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb502-1"><a href="#cb502-1"></a>datos <span class="sc">|&gt;</span></span>
<span id="cb502-2"><a href="#cb502-2"></a>  <span class="fu">ACF</span>(value, <span class="at">lag_max =</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb502-3"><a href="#cb502-3"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb502-4"><a href="#cb502-4"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Estimaci√≥n muestral de autocorrelaciones"</span>,</span>
<span id="cb502-5"><a href="#cb502-5"></a>       <span class="at">x =</span> <span class="st">"Retardos"</span>) <span class="sc">+</span></span>
<span id="cb502-6"><a href="#cb502-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-355-1.png" width="960"></p>
</div>
</div>
</div>
</div>
</section>
<section id="correlogramas-4" class="slide level2">
<h2>Correlogramas</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb503"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb503-1"><a href="#cb503-1"></a>datos <span class="ot">&lt;-</span> timeSeriesDataSets<span class="sc">::</span>elec_ts <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>(<span class="at">regular =</span> <span class="cn">TRUE</span>)</span>
<span id="cb503-2"><a href="#cb503-2"></a><span class="fu">ggplot</span>(datos) <span class="sc">+</span></span>
<span id="cb503-3"><a href="#cb503-3"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb503-4"><a href="#cb503-4"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-356-1.png" width="960"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb504"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb504-1"><a href="#cb504-1"></a>datos <span class="sc">|&gt;</span></span>
<span id="cb504-2"><a href="#cb504-2"></a>  <span class="fu">ACF</span>(value, <span class="at">lag_max =</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb504-3"><a href="#cb504-3"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb504-4"><a href="#cb504-4"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Estimaci√≥n muestral de autocorrelaciones"</span>,</span>
<span id="cb504-5"><a href="#cb504-5"></a>       <span class="at">x =</span> <span class="st">"Retardos"</span>) <span class="sc">+</span></span>
<span id="cb504-6"><a href="#cb504-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-357-1.png" width="960"></p>
</div>
</div>
</div>
</div>
</section>
<section id="procesos-lineales" class="slide level2">
<h2>Procesos lineales</h2>
<p>En las pr√≥ximas clases trabajaremos siempre suponiendo que nuestros procesos ya son <span class="hl-yellow"><strong>estacionarios</strong></span>. Veremos m√°s adelante qu√© hacer cuando <span class="hl-yellow"><strong>no son estacionarios en media</strong></span> o <span class="hl-yellow"><strong>en varianza</strong></span></p>
<div class="fragment">
<p>Un resultado importante (se conoce como Teorema de descomposici√≥n de Wald) es que <span class="hl-yellow"><strong>cualquier proceso estacionario puede transformado en un proceso lineal</strong></span> definido como</p>
<p><span class="math display">\[X_t = \mu  + \sum_{j = -\infty}^{j=\infty} \Psi_j \varepsilon_{t-j} \quad \sum_{j = -\infty}^{j=\infty} \left| \Psi_j \right| &lt; \infty, \quad \left\lbrace \varepsilon_{t} \right\rbrace \text{ ruido blanco}\]</span> Un proceso lineal es por tanto la <span class="hl-yellow"><strong>combinaci√≥n lineal de instantes de ruido blanco</strong></span> tal que los coeficientes sean absolutamente sumables.</p>
</div>
</section>
<section id="procesos-lineales-1" class="slide level2">
<h2>Procesos lineales</h2>
<p><span class="math display">\[X_t = \mu + \sum_{j = -\infty}^{j=\infty} \Psi_j \varepsilon_{t-j}, \quad \sum_{j = -\infty}^{j=\infty} \left| \Psi_j \right| &lt; \infty, \quad \left\lbrace \varepsilon_{t} \right\rbrace \text{ ruido blanco}\]</span> Si te fijas hay una <span class="hl-yellow"><strong>constante inicial <span class="math inline">\(\mu\)</span> que representa la media (a largo plazo)</strong></span> del proceso ya que, dado que la esperanza es lineal y <span class="math inline">\(\left\lbrace \varepsilon_{t} \right\rbrace\)</span> es ruido blanco, entonces</p>
<p><span class="math display">\[E \left[ X_t \right] = \mu + \sum_{j = -\infty}^{j=\infty} \Psi_j E \left[ \varepsilon_{t-j} \right] = \mu\]</span></p>
<div class="fragment">
<p>De ahora en adelante <span class="hl-yellow"><strong>asumiremos que <span class="math inline">\(\mu = 0\)</span> (proceso centrado)</strong></span> ya que sino lo fuese basta con usar <span class="math inline">\(X_t = X_t - \mu\)</span></p>
</div>
</section>
<section id="procesos-ma" class="slide level2">
<h2>Procesos MA</h2>
<p><span class="math display">\[X_t = \sum_{j = -\infty}^{j=\infty} \Psi_j \varepsilon_{t-j}, \quad \sum_{j = -\infty}^{j=\infty} \left| \Psi_j \right| &lt; \infty, \quad  \text{proceso lineal}\]</span></p>
<p>Uno de los tipos de procesos lineales m√°s importantes son los conocidos como <span class="hl-yellow"><strong>procesos de medias moviles (MA)</strong></span> definidos como</p>
<p><span class="math display">\[X_t = \varepsilon_t - \theta_1 \varepsilon_{t-1} - \ldots - \theta_q \varepsilon_{t-q} \quad q \geq 1, \quad \left\lbrace \varepsilon_{t} \right\rbrace \text{ ruido blanco}\]</span></p>
<p>donde <span class="math inline">\(q\)</span> ser√° el <strong>orden</strong> (lo llamaremos <span class="hl-yellow"><strong>procesos de medias moviles de orden q o MA(q)</strong></span>). Si te fijas es un <strong>caso particular de proceso lineal</strong> donde todos los coeficientes son 0 salvo <span class="hl-green"><strong><span class="math inline">\(\left(\Psi_0 = 1, \Psi_1 = -\theta_1,\ldots, \Psi_q = -\theta_q \right)\)</span></strong></span>.</p>
</section>
<section id="procesos-ma-1" class="slide level2">
<h2>Procesos MA</h2>
<p><span class="math display">\[X_t = \varepsilon_t - \theta_1 \varepsilon_{t-1} - \ldots - \theta_q \varepsilon_{t-q} , \quad q \geq 1, \quad \left\lbrace \varepsilon_{t} \right\rbrace \text{ ruido blanco}\]</span></p>
<p>Los procesos <span class="math inline">\(MA(q)\)</span> son procesos cuyo <span class="hl-yellow"><strong>futuro se describe promediando los errores del pasado</strong></span> y son tremendamente √∫tiles para modelizar fen√≥menos influenciados por sucesos que producen un efecto inmediato de corta duracci√≥n (por ejemplo, variables econ√≥micas).</p>
</section>
<section id="operador-de-retardos" class="slide level2">
<h2>Operador de retardos</h2>
<p><span class="math display">\[X_t = \varepsilon_t - \theta_1 \varepsilon_{t-1} - \ldots - \theta_q \varepsilon_{t-q} , \quad q \geq 1, \quad \left\lbrace \varepsilon_{t} \right\rbrace \text{ ruido blanco}\]</span></p>
<p>Para simplificar notaci√≥n llamaremos <span class="hl-yellow"><strong>operador de retardos</strong></span> al operador</p>
<p><span class="math display">\[B \left( X_t \right) := B  X_t = X_{t-1}\]</span></p>
<div class="fragment">
<p>De esta forma, si queremos el <strong>retardo s</strong> de la serie basta con hacer</p>
<p><span class="math display">\[B^s(X_t) = B^{s-1} (X_{t-1})  = B^{s-2} \left(  X_{t-2} \right) = B^{s-3} \left(  X_{t-3} \right)  = ... = X_{t-s}\]</span></p>
</div>
</section>
<section id="operador-de-retardos-1" class="slide level2">
<h2>Operador de retardos</h2>
<p><span class="math display">\[X_t = \varepsilon_t - \theta_1 \varepsilon_{t-1} - \ldots - \theta_q \varepsilon_{t-q} , \quad q \geq 1, \quad \left\lbrace \varepsilon_{t} \right\rbrace \text{ ruido blanco}\]</span></p>
<p>El proceso anteriormente definido como <span class="math inline">\(MA(q)\)</span> se puede por tanto <span class="hl-yellow"><strong>expresar en funci√≥n del operador de retardos</strong></span> como</p>
<p><span class="math display">\[\begin{eqnarray}X_t &amp;=&amp; \varepsilon_t - \theta_1 \varepsilon_{t-1} - \ldots - \theta_q \varepsilon_{t-q}  = \varepsilon_{t} - \theta_1 B\varepsilon_t - \ldots -  \theta_q B^{q}\varepsilon_t \nonumber \\ &amp;=&amp; \left( 1 -\theta_1 B - \ldots - \theta_q B^{q} \right)\varepsilon_t = \Theta_{q} \left(B \right)\varepsilon_t, \quad \left\lbrace \varepsilon_{t} \right\rbrace \text{ ruido blanco} \nonumber \end{eqnarray}\]</span></p>
<div class="fragment">
<p>El <span class="hl-yellow"><strong>polinomio de retardos o polinomio de media m√≥vil de orden <span class="math inline">\(q\)</span></strong></span> <span class="math inline">\(\Theta_{q} \left(B \right)\)</span> ser√° el que defina nuestro proceso</p>
<p><span class="math display">\[\Theta_{q} \left(B \right) = \displaystyle \sum_{j=0}^{\infty} \Psi_j B^{j}, \quad \Psi_0 = 1,~\Psi_j = -\theta_j ~(j =1, \ldots,q),\quad \Psi_j = 0 ~(j &gt; q)\]</span></p>
</div>
</section>
<section id="proceso-ma" class="slide level2">
<h2>Proceso MA</h2>
<p><span class="math display">\[X_t = \varepsilon_t - \theta_1 \varepsilon_{t-1} - \ldots - \theta_q \varepsilon_{t-q}  = \left( 1 - \theta_1 B - \ldots - \theta_q B^{q} \right)\varepsilon_t = \Theta_q \left(B \right)\varepsilon_t\]</span></p>
<p>Dale valores <span class="math inline">\(q=1, 2, 3, 4\)</span> y escribe c√≥mo quedar√≠a el proceso</p>
<div class="fragment">
<ul>
<li><p><strong>MA(1)</strong>: <span class="math inline">\(X_t = \Theta_1 \left(B \right)\varepsilon_t = \left(1 - \theta_1 B \right)\varepsilon_t = \varepsilon_t - \theta_1 \varepsilon_{t-1}\)</span></p></li>
<li><p><strong>MA(2)</strong>: <span class="math inline">\(X_t = \Theta_2 \left(B \right)\varepsilon_t = \left(1 - \theta_1 B - \theta_2 B^2 \right)\varepsilon_t = \varepsilon_t - \theta_1 \varepsilon_{t-1} - \theta_2 \varepsilon_{t-2}\)</span></p></li>
<li><p><strong>MA(3)</strong>: <span class="math inline">\(X_t = \Theta_3 \left(B \right)\varepsilon_t = \left(1 - \theta_1 B - \theta_2 B^2 - \theta_3 B^3 \right)\varepsilon_t = \varepsilon_t - \theta_1 \varepsilon_{t-1} - \theta_2 \varepsilon_{t-2} - \theta_3 \varepsilon_{t-3}\)</span></p></li>
<li><p><strong>MA(4)</strong>: <span class="math inline">\(X_t = \Theta_4 \left(B \right)\varepsilon_t = \left(1 - \theta_1 B - \theta_2 B^2 - \theta_3 B^3 - \theta_4 B^4 \right)\varepsilon_t = \varepsilon_t - \theta_1 \varepsilon_{t-1} - \theta_2 \varepsilon_{t-2} - \theta_3 \varepsilon_{t-3} - \theta_4 \varepsilon_{t-4}\)</span></p></li>
</ul>
</div>
</section>
<section id="proceso-ma-1" class="slide level2">
<h2>Proceso MA</h2>
<p><span class="math display">\[X_t = \varepsilon_t - \theta_1 \varepsilon_{t-1} - \ldots - \theta_q \varepsilon_{t-q}   = \Theta_q \left(B \right)\varepsilon_t, \quad \left\lbrace \varepsilon_{t} \right\rbrace \text{ ruido blanco}\]</span></p>
<p><span class="hl-yellow"><strong>¬øEs un proceso estacionario?</strong></span></p>
</section>
<section id="proceso-ma-2" class="slide level2">
<h2>Proceso MA</h2>
<p><span class="math display">\[X_t = \varepsilon_t - \theta_1 \varepsilon_{t-1} - \ldots - \theta_q \varepsilon_{t-q}   = \Theta_q \left(B \right)\varepsilon_t, \quad \left\lbrace \varepsilon_{t} \right\rbrace \text{ ruido blanco}\]</span></p>
<ol type="1">
<li><span class="hl-yellow"><strong>Media</strong></span>: dado que <span class="math inline">\(\left\lbrace \varepsilon_{t} \right\rbrace\)</span> es ruido blanco</li>
</ol>
<p><span class="math display">\[\begin{eqnarray}E\left[X_t \right] &amp;=&amp; \left(E\left[ \varepsilon_{t} \right] - \theta_1 E\left[ \varepsilon_{t-1} \right]  - \ldots - \theta_q E\left[ \varepsilon_{t-q} \right] \right) \nonumber \\ &amp;=&amp; \left( 1 - \theta_1  - \ldots - \theta_q \right)E\left[ \varepsilon_{t} \right] = 0  \quad \text{(o bien } \mu \text{ si no est√° centrado)}\end{eqnarray}\]</span></p>
<div class="fragment">
<p><span class="hl-green"><strong>‚úÖ Media constante en el tiempo</strong></span></p>
</div>
</section>
<section id="proceso-ma-3" class="slide level2">
<h2>Proceso MA</h2>
<p><span class="math display">\[X_t = \varepsilon_t - \theta_1 \varepsilon_{t-1} - \ldots - \theta_q \varepsilon_{t-q}   = \Theta_q \left(B \right)\varepsilon_t, \quad \left\lbrace \varepsilon_{t} \right\rbrace \text{ ruido blanco}\]</span></p>
<ol start="2" type="1">
<li><span class="hl-yellow"><strong>Varianza</strong></span>: dado que <span class="math inline">\(\left\lbrace \varepsilon_{t} \right\rbrace\)</span> es ruido blanco</li>
</ol>
<p><span class="math display">\[\begin{eqnarray}Var\left[X_t \right] &amp;=&amp; \left(Var\left[\varepsilon_{t}\right] + \theta_{1}^{2} Var\left[\varepsilon_{t-1}\right] + \ldots + \theta_{q}^2  Var\left[\varepsilon_{t-1}\right] \right)  \nonumber \\ &amp;=&amp; \left(1 + \theta_{1}^{2} + \ldots + \theta_{q}^2  \right) \sigma_{\varepsilon}^2 = cte \quad \text{¬øpero finita?}\end{eqnarray}\]</span></p>
<div class="fragment">
<p><span class="math display">\[\left(1 + \theta_{1}^{2} + \ldots + \theta_{q}^2  \right)  &lt; \infty \iff q &lt; \infty \quad \text{y adem√°s} \quad \left| \theta_j \right| &lt; \infty\]</span></p>
<p><span class="hl-green"><strong>‚úÖ Varianza constante (y finita) en el tiempo</strong></span></p>
</div>
</section>
<section id="proceso-ma-4" class="slide level2">
<h2>Proceso MA</h2>
<p><span class="math display">\[X_t = \varepsilon_t - \theta_1 \varepsilon_{t-1} - \ldots - \theta_q \varepsilon_{t-q}   = \Theta_q \left(B \right)\varepsilon_t, \quad \left\lbrace \varepsilon_{t} \right\rbrace \text{ ruido blanco}\]</span></p>
<ol start="3" type="1">
<li><span class="hl-yellow"><strong>Autocovarianzas</strong></span>:</li>
</ol>
<p><span class="math display">\[\begin{eqnarray}\gamma_h &amp;=&amp; Cov \left( X_t, X_{t+h} \right) = E \left[ \left( \varepsilon_t - \theta_1 \varepsilon_{t-1} - \ldots - \theta_q \varepsilon_{t-q}\right) \left( \varepsilon_{t+h} - \theta_1 \varepsilon_{t+h-1} - \ldots - \theta_q \varepsilon_{t+h-q}\right)  \right] \nonumber \\ &amp;=&amp; E \left[ \varepsilon_t \varepsilon_{t+h} \right]  - \theta_1 E \left[ \varepsilon_{t}  \varepsilon_{t+h-1} \right] - \ldots  - \theta_q E \left[ \varepsilon_{t}  \varepsilon_{t+h-q} \right] \nonumber \\ &amp;-&amp; \theta_1 E \left[ \varepsilon_{t-1} \varepsilon_{t+h} \right]  + \theta_{1}^2 E \left[ \varepsilon_{t-1}  \varepsilon_{t+h-1} \right] + \ldots  + \theta_1\theta_q E \left[ \varepsilon_{t-1}  \varepsilon_{t+h-q} \right] \nonumber \\ &amp; &amp; ... \nonumber \\ &amp;-&amp; \theta_q E \left[ \varepsilon_{t-q} \varepsilon_{t+h} \right]  + \theta_{1}\theta_{q} E \left[ \varepsilon_{t-q}  \varepsilon_{t+h-1} \right] + \ldots  + \theta_{q}^{2} E \left[ \varepsilon_{t-q}  \varepsilon_{t+h-q} \right]\end{eqnarray}\]</span></p>
<div class="fragment">
<p>Para verlo m√°s sencillo analicemos primero <span class="hl-yellow"><strong>los casos particulares <span class="math inline">\(q=1\)</span> y <span class="math inline">\(q=2\)</span></strong></span></p>
</div>
</section>
<section id="ma1" class="slide level2">
<h2>MA(1)</h2>
<p><span class="math display">\[X_t =  \Theta_1 \left(B \right)\varepsilon_t = \varepsilon_t -\theta_1 \varepsilon_{t-1}, \quad \left\lbrace \varepsilon_{t} \right\rbrace \text{ ruido blanco} \nonumber\]</span></p>
<ol start="3" type="1">
<li><span class="hl-yellow"><strong>Autocovarianzas</strong></span>:</li>
</ol>
<p><span class="math display">\[\begin{eqnarray}\gamma_h &amp;=&amp; Cov \left( X_t, X_{t+h} \right) = E \left[ \left( \varepsilon_t - \theta_1 \varepsilon_{t-1}\right) \left( \varepsilon_{t+h} - \theta_1 \varepsilon_{t+h-1}\right)\right] \nonumber \\ &amp;=&amp; E \left[ \varepsilon_t \varepsilon_{t+h} \right]  - \theta_1 E \left[ \varepsilon_{t-1}  \varepsilon_{t+h} \right] - \theta_1 E \left[ \varepsilon_{t}  \varepsilon_{t+h-1} \right] + \theta_{1}^2 E \left[ \varepsilon_{t-1}  \varepsilon_{t+h-1} \right]\end{eqnarray}\]</span></p>
<ul>
<li><p><span class="hl-purple"><strong><span class="math inline">\(h = 0\)</span></strong></span> ‚Äì&gt; <span class="math inline">\(\gamma_0 = E \left[ \varepsilon_t \varepsilon_t \right] + \theta_{1}^ 2E \left[ \varepsilon_{t-1} \varepsilon_{t-1} \right] = \sigma^2 + \theta_{1}^2 \sigma^2 = \left(1 + \theta_{1}^2 \right) \sigma^2\)</span></p></li>
<li><p><span class="hl-purple"><strong><span class="math inline">\(h = 1\)</span></strong></span> ‚Äì&gt; <span class="math inline">\(\gamma_1 = -\theta_1 \sigma^2\)</span></p></li>
<li><p><span class="hl-purple"><strong><span class="math inline">\(h &gt; 1\)</span></strong></span> ‚Äì&gt; <span class="math inline">\(\gamma_h = 0\)</span></p></li>
</ul>
</section>
<section id="ma1-1" class="slide level2">
<h2>MA(1)</h2>
<p><span class="math display">\[X_t = \varepsilon_t - \theta_1 \varepsilon_{t-1}, \quad \left\lbrace \varepsilon_{t} \right\rbrace \text{ ruido blanco con var } \sigma^2 \nonumber\]</span></p>
<ol start="3" type="1">
<li><span class="hl-yellow"><strong>Autocorrelaciones</strong></span>:</li>
</ol>
<p><span class="math display">\[\begin{eqnarray}\rho_h = \frac{\gamma_h}{\gamma_0} = \begin{cases} \frac{\gamma_0}{\gamma_0} = 1 \quad &amp; &amp;h = 0, \nonumber \\ \frac{\gamma_1}{\gamma_0} = \frac{-\theta_1 \sigma^2}{\left(1 + \theta_{1}^2 \right) \sigma^2} = \frac{-\theta_1}{1 + \theta_{1}^2}\quad &amp; &amp;h = 1, \nonumber \\ 0  \quad &amp; &amp;h &gt; 1\end{cases}\end{eqnarray}\]</span></p>
<p>F√≠jate que el <span class="hl-yellow"><strong>signo de <span class="math inline">\(\rho_h\)</span> ser√° el contrario al signo de <span class="math inline">\(\theta_1\)</span></strong></span> y que, a partir de <span class="math inline">\(q\)</span>, las autocorrelaciones son 0 (se dice que es <span class="hl-yellow"><strong>q-correlacionado</strong></span>)</p>
</section>
<section id="ma1-2" class="slide level2">
<h2>MA(1)</h2>
<p><span class="hl-yellow"><strong>üíª Dise√±a una funci√≥n</strong></span> para simular <span class="math inline">\(n\)</span> trayectorias de un <span class="math inline">\(MA(1)\)</span> en funci√≥n de <span class="math inline">\(\left(n,~\sigma,~\theta_1, \varepsilon_1\right)\)</span></p>
<p><span class="math display">\[X_t = \varepsilon_t - \theta_1 \varepsilon_{t-1}, \quad \left\lbrace \varepsilon_{t} \right\rbrace \text{ ruido blanco con varianza } \sigma^2 \nonumber\]</span></p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb505"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb505-1"><a href="#cb505-1"></a>MA_1_simul <span class="ot">&lt;-</span> <span class="cf">function</span>(n, sigma, theta_1, eps_1) {</span>
<span id="cb505-2"><a href="#cb505-2"></a>  </span>
<span id="cb505-3"><a href="#cb505-3"></a>  </span>
<span id="cb505-4"><a href="#cb505-4"></a>  eps <span class="ot">&lt;-</span> <span class="fu">c</span>(eps_1, <span class="fu">rnorm</span>(<span class="at">n =</span> n <span class="sc">-</span> <span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma))</span>
<span id="cb505-5"><a href="#cb505-5"></a>  X_t <span class="ot">&lt;-</span> eps_1</span>
<span id="cb505-6"><a href="#cb505-6"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb505-7"><a href="#cb505-7"></a>    X_t[i] <span class="ot">&lt;-</span> eps[i] <span class="sc">-</span> theta_1<span class="sc">*</span>eps[i <span class="sc">-</span> <span class="dv">1</span>]</span>
<span id="cb505-8"><a href="#cb505-8"></a>  }</span>
<span id="cb505-9"><a href="#cb505-9"></a>  ts <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="st">"X_t"</span> <span class="ot">=</span> X_t) <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>(<span class="at">index =</span> t)</span>
<span id="cb505-10"><a href="#cb505-10"></a>  <span class="fu">return</span>(ts)</span>
<span id="cb505-11"><a href="#cb505-11"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="ma1-3" class="slide level2">
<h2>MA(1)</h2>
<p>üíª <span class="hl-yellow"><strong>Aplica dicha funci√≥n</strong></span> para <span class="math inline">\(n = 300\)</span>, <span class="math inline">\(\sigma = 3\)</span>, <span class="math inline">\(\varepsilon_1 = 0\)</span> y <span class="math inline">\(\theta_1 = (-0.3, -1.5)\)</span></p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb506"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb506-1"><a href="#cb506-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb506-2"><a href="#cb506-2"></a><span class="fu">ggplot</span>(<span class="fu">MA_1_simul</span>(<span class="dv">300</span>, <span class="dv">3</span>, <span class="sc">-</span><span class="fl">0.3</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb506-3"><a href="#cb506-3"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t)) <span class="sc">+</span></span>
<span id="cb506-4"><a href="#cb506-4"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"MA(1) con theta_1 = -0.3 y sigma = 3"</span>) <span class="sc">+</span></span>
<span id="cb506-5"><a href="#cb506-5"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-359-1.png" width="960"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb507"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb507-1"><a href="#cb507-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb507-2"><a href="#cb507-2"></a><span class="fu">ggplot</span>(<span class="fu">MA_1_simul</span>(<span class="dv">300</span>, <span class="dv">3</span>, <span class="sc">-</span><span class="fl">1.5</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb507-3"><a href="#cb507-3"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t)) <span class="sc">+</span></span>
<span id="cb507-4"><a href="#cb507-4"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"MA(1) con theta_1 = -1.5 y sigma = 3"</span>) <span class="sc">+</span></span>
<span id="cb507-5"><a href="#cb507-5"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-360-1.png" width="960"></p>
</div>
</div>
</div>
</div>
<div class="fragment">
<p>¬øTe has fijado en que <span class="hl-yellow"><strong>cuando <span class="math inline">\(\theta_1 = -1.5\)</span> la serie explota</strong></span>?</p>
</div>
</section>
<section id="ma1-4" class="slide level2">
<h2>MA(1)</h2>
<p>üíª <span class="hl-yellow"><strong>Calcula las ACF de ambas series</strong></span></p>
<div class="fragment">
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb508"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb508-1"><a href="#cb508-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb508-2"><a href="#cb508-2"></a><span class="fu">MA_1_simul</span>(<span class="dv">300</span>, <span class="dv">3</span>, <span class="sc">-</span><span class="fl">0.3</span>, <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb508-3"><a href="#cb508-3"></a>  <span class="fu">ACF</span>(X_t) <span class="sc">|&gt;</span> </span>
<span id="cb508-4"><a href="#cb508-4"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb508-5"><a href="#cb508-5"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"MA(1) con theta_1 = -0.3 y sigma = 3"</span>) <span class="sc">+</span></span>
<span id="cb508-6"><a href="#cb508-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-361-1.png" width="960"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb509"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb509-1"><a href="#cb509-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb509-2"><a href="#cb509-2"></a><span class="fu">MA_1_simul</span>(<span class="dv">300</span>, <span class="dv">3</span>, <span class="sc">-</span><span class="fl">1.5</span>, <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb509-3"><a href="#cb509-3"></a>  <span class="fu">ACF</span>(X_t) <span class="sc">|&gt;</span> </span>
<span id="cb509-4"><a href="#cb509-4"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb509-5"><a href="#cb509-5"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"MA(1) con theta_1 = -1.5 y sigma = 3"</span>) <span class="sc">+</span></span>
<span id="cb509-6"><a href="#cb509-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-362-1.png" width="960"></p>
</div>
</div>
</div>
</div>
<p>¬øTe has fijado en que <span class="hl-yellow"><strong>las correlaciones caen a partir de <span class="math inline">\(q\)</span></strong></span> (q-correlacionado poblacionalmente aunque a nivel muestral puedan caer algunas todav√≠a fuera de la banda de significaci√≥n)?</p>
</div>
</section>
<section id="ma1-5" class="slide level2">
<h2>MA(1)</h2>
<p><span class="hl-red"><strong>¬øPor qu√© en funci√≥n de <span class="math inline">\(\theta_1\)</span> el proceso es explosivo?</strong></span></p>
<div class="fragment">
<p>Si te fijas, dado que <span class="math inline">\(X_t = \varepsilon_t - \theta_1 \varepsilon_{t-1}\)</span>, tenemos entonces que <span class="math inline">\(\varepsilon_t = X_t + \theta_1 \varepsilon_{t-1}\)</span> por lo que sustituyendo tenemos que</p>
<p><span class="math display">\[\begin{eqnarray}X_t &amp;=&amp; \varepsilon_t + \theta_1  \varepsilon_{t-1} = \varepsilon_t + \theta_1 \left( X_{t-1} + \theta_1 \varepsilon_{t-2} \right) = \varepsilon_t + \theta_1  X_{t-1} + \theta_{1}^2 \varepsilon_{t-2} \nonumber \\ &amp;=&amp; \varepsilon_t + \theta_1  X_{t-1} + \theta_{1}^2 X_{t-2} + \theta_{1}^{3} \varepsilon_{t-3} = ... \nonumber \\ &amp;=&amp; \varepsilon_{t} + \sum_{j=0}^{\infty} \theta_{1}^{j} X_{t-j}\end{eqnarray}\]</span></p>
</div>
<div class="fragment">
<p>El <strong>futuro</strong> de la serie acaba siendo modelizado con el √∫ltimo error y una ponderaci√≥n del pasado, y dado que parece razonable <span class="hl-yellow"><strong>asumir que los valores m√°s cercanos influyan m√°s que los valores m√°s lejanos</strong></span> los pesos <span class="math inline">\(\left| \theta_{1}\right|^{j}\)</span> deben disminuir con el retardo: <span class="hl-yellow"><strong>necesitamos que <span class="math inline">\(\left| \theta_{1}\right| &lt; 1\)</span></strong></span></p>
</div>
</section>
<section id="condici√≥n-de-invertibilidad" class="slide level2">
<h2>Condici√≥n de invertibilidad</h2>
<p>Esta <span class="hl-yellow"><strong>condici√≥n de invertibilidad</strong></span> ser√° fundamental en los procesos MA ya que, aunque la funci√≥n de autocorrelaci√≥n ser√° importante, tenemos un <span class="hl-red"><strong>problema de identificaci√≥n</strong></span>: dada una funci√≥n de autocorrelaci√≥n <span class="hl-red"><strong>no existe un √∫nico proceso asociado</strong></span></p>
<div class="fragment">
<p>Hagamos un ejercicio r√°pido con dos <span class="math inline">\(MA(1)\)</span> distintos</p>
<p><span class="math display">\[X_t = \varepsilon_t - \theta_1 \varepsilon_{t-1}, \quad X_t = \varepsilon_t - \frac{1}{\theta_1} \varepsilon_{t-1}\]</span> ¬øCu√°les son sus autocorrelaciones?</p>
</div>
</section>
<section id="condici√≥n-de-invertibilidad-1" class="slide level2">
<h2>Condici√≥n de invertibilidad</h2>
<p><span class="math display">\[X_t = \varepsilon_t - \theta_1 \varepsilon_{t-1}, \quad X_t = \varepsilon_t - \frac{1}{\theta_1} \varepsilon_{t-1}\]</span></p>
<p>En el primer caso</p>
<p><span class="math display">\[\begin{eqnarray}\rho_h = \frac{\gamma_h}{\gamma_0} = \begin{cases} 1 \quad &amp; &amp;h = 0, \nonumber \\  \frac{-\theta_1}{1 + \theta_{1}^2}\quad &amp; &amp;h = 1, \nonumber\end{cases}\end{eqnarray}\]</span></p>
<div class="fragment">
<p>En el segundo caso</p>
<p><span class="math display">\[\begin{eqnarray}\rho_h = \frac{\gamma_h}{\gamma_0} = \begin{cases} 1 \quad &amp; &amp;h = 0, \nonumber \\  \frac{-\frac{1}{\theta_1}}{1 + \frac{1}{\theta_1^2}} = \frac{-\frac{\theta_{1}^{2}}{\theta_1}}{\theta_{1}^{2} + \frac{\theta_{1}^{2}}{\theta_1^2}} = \frac{-\theta_1}{1 + \theta_{1}^{2}}\quad &amp; &amp;h = 1 \nonumber\end{cases}\end{eqnarray}\]</span></p>
<p><strong>¬°Es la misma!</strong></p>
</div>
</section>
<section id="condici√≥n-de-invertibilidad-2" class="slide level2">
<h2>Condici√≥n de invertibilidad</h2>
<p>Dicha condici√≥n <span class="math inline">\(\left| \theta_{1}\right| &lt; 1\)</span> adem√°s nos permitir√° <span class="hl-yellow"><strong>expresar los errores en funci√≥n de <span class="math inline">\(X_t\)</span></strong></span> tal que</p>
<p><span class="math display">\[ \varepsilon_{t} = X_t + \theta_1 \varepsilon_{t-1} = X_t + \theta_1 \left( X_{t-1} + \theta_1 \varepsilon_{t-2} \right) = \ldots = \sum_{j=0}^{\infty} \theta_{1}^{j}X_{t-j} \]</span></p>
<p>Dicha serie solo converger√° si <span class="math inline">\(\sum_{j=0}^{\infty} \theta_{1}^{j} &lt; \infty\)</span>, es decir, si y solo s√≠ <span class="hl-yellow"><strong><span class="math inline">\(\left| \theta_1 \right| &lt; 1\)</span></strong></span></p>
<p>&nbsp;</p>
<p>En el primero ejemplo simulado se cumpl√≠an las condiciones de invertibilidad, en la segunda no.</p>
</section>
<section id="ma1-6" class="slide level2">
<h2>MA(1)</h2>
<p>Volvamos a ver <span class="hl-yellow"><strong>qu√© forma tiene la funci√≥n de autocorrelaciones</strong></span> del primer ejemplo simulado donde se cumpl√≠an las <strong>condiciones de intertibilidad</strong></p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb510"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb510-1"><a href="#cb510-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb510-2"><a href="#cb510-2"></a>datos <span class="ot">&lt;-</span> <span class="fu">MA_1_simul</span>(<span class="dv">300</span>, <span class="dv">3</span>, <span class="sc">-</span><span class="fl">0.3</span>, <span class="dv">0</span>)</span>
<span id="cb510-3"><a href="#cb510-3"></a><span class="fu">library</span>(feasts)</span>
<span id="cb510-4"><a href="#cb510-4"></a>datos <span class="sc">|&gt;</span> </span>
<span id="cb510-5"><a href="#cb510-5"></a>  <span class="fu">ACF</span>(X_t, <span class="at">lag_max =</span> <span class="dv">20</span>) <span class="sc">|&gt;</span> </span>
<span id="cb510-6"><a href="#cb510-6"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb510-7"><a href="#cb510-7"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb510-8"><a href="#cb510-8"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb510-9"><a href="#cb510-9"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-363-1.png" width="960" class="r-stretch"><p>Usaremos la <span class="hl-yellow"><strong>funci√≥n de autocorrelaciones (ACF)</strong></span> para determinar si se trata de un <span class="hl-yellow"><strong>proceso MA(1): si a partir de la primera las correlaciones caen dr√°sticamente</strong></span> (q-correlacionado), es probable que el proceso sea un <span class="math inline">\(MA(1)\)</span></p>
</section>
<section id="ma1-7" class="slide level2">
<h2>MA(1)</h2>
<p>Recuerda que estamos visualizando las <span class="hl-yellow"><strong>estimaciones muestrales</strong></span> por lo que cuanto m√°s aumente <span class="math inline">\(\theta_1\)</span> m√°s lenta ser√° la ca√≠da (si <span class="math inline">\(\theta_1 &gt; 0\)</span> las autocorrelaciones ir√°n cambiando de signo).</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb511"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb511-1"><a href="#cb511-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb511-2"><a href="#cb511-2"></a>datos <span class="ot">&lt;-</span> <span class="fu">MA_1_simul</span>(<span class="dv">300</span>, <span class="dv">3</span>, <span class="sc">-</span><span class="fl">0.9</span>, <span class="dv">0</span>)</span>
<span id="cb511-3"><a href="#cb511-3"></a><span class="fu">library</span>(feasts)</span>
<span id="cb511-4"><a href="#cb511-4"></a>datos <span class="sc">|&gt;</span> </span>
<span id="cb511-5"><a href="#cb511-5"></a>  <span class="fu">ACF</span>(X_t, <span class="at">lag_max =</span> <span class="dv">30</span>) <span class="sc">|&gt;</span> </span>
<span id="cb511-6"><a href="#cb511-6"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb511-7"><a href="#cb511-7"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb511-8"><a href="#cb511-8"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb511-9"><a href="#cb511-9"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-364-1.png" width="960"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb512"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb512-1"><a href="#cb512-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb512-2"><a href="#cb512-2"></a>datos <span class="ot">&lt;-</span> <span class="fu">MA_1_simul</span>(<span class="dv">300</span>, <span class="dv">3</span>, <span class="fl">0.9</span>, <span class="dv">0</span>)</span>
<span id="cb512-3"><a href="#cb512-3"></a><span class="fu">library</span>(feasts)</span>
<span id="cb512-4"><a href="#cb512-4"></a>datos <span class="sc">|&gt;</span> </span>
<span id="cb512-5"><a href="#cb512-5"></a>  <span class="fu">ACF</span>(X_t, <span class="at">lag_max =</span> <span class="dv">30</span>) <span class="sc">|&gt;</span> </span>
<span id="cb512-6"><a href="#cb512-6"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb512-7"><a href="#cb512-7"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb512-8"><a href="#cb512-8"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb512-9"><a href="#cb512-9"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-365-1.png" width="960"></p>
</div>
</div>
</div>
</div>
</section>
<section id="ma2" class="slide level2">
<h2>MA(2)</h2>
<p><span class="math display">\[X_t =  \Theta_2 \left(B \right)\varepsilon_t = \varepsilon_t - \theta_1 \varepsilon_{t-1} - \theta_2 \varepsilon_{t-2}, \quad \left\lbrace \varepsilon_{t} \right\rbrace \text{ ruido blanco} \nonumber\]</span></p>
<ul>
<li>Demuestra que sus <strong>autocorrelaciones</strong> son</li>
</ul>
<p><span class="math display">\[\begin{eqnarray}\rho_h = \frac{\gamma_h}{\gamma_0} = \begin{cases} 1 \quad &amp; &amp;h = 0, \nonumber \\ \frac{-\theta_1  + \theta_1 \theta_2 }{1 + \theta_{1}^2  + \theta_{2}^2}\quad &amp; &amp;h = 1, \nonumber \\ \frac{-\theta_2}{1 + \theta_{1}^2  + \theta_{2}^2}\quad &amp; &amp;h = 2 \nonumber \\ 0  \quad &amp; &amp;h &gt; 2\end{cases}\end{eqnarray}\]</span></p>
<ul>
<li><p>dise√±a una funci√≥n para simular un MA(2)</p></li>
<li><p>simula varios y observa sus ACF</p></li>
</ul>
</section></section>
<section>
<section id="clase-18" class="title-slide slide level1 center">
<h1>Clases 18: <span class="flow">procesos MA</span></h1>

</section>
<section id="ma2-1" class="slide level2">
<h2>MA(2)</h2>
<p><span class="math display">\[X_t =  \Theta_2 \left(B \right)\varepsilon_t = \varepsilon_t - \theta_1 \varepsilon_{t-1} - \theta_2 \varepsilon_{t-2}, \quad \left\lbrace \varepsilon_{t} \right\rbrace \text{ ruido blanco} \nonumber\]</span></p>
<p>Hagamos de nuevo el ejercicio de calcular las <span class="hl-yellow"><strong>autocovarianzas</strong></span>:</p>
<p><span class="math display">\[\begin{eqnarray}\gamma_h &amp;=&amp; Cov \left( X_t, X_{t+h} \right) = E \left[ \left( \varepsilon_t - \theta_1 \varepsilon_{t-1} - \theta_2 \varepsilon_{t-2}\right) \left( \varepsilon_{t+h} - \theta_1 \varepsilon_{t+h-1} - \theta_2 \varepsilon_{t+h-2}\right)\right] \nonumber \\ &amp;=&amp; E \left[ \varepsilon_t \varepsilon_{t+h} \right]  - \theta_1 E \left[ \varepsilon_{t-1}  \varepsilon_{t+h} \right] - \theta_1 E \left[ \varepsilon_{t}  \varepsilon_{t+h-1} \right] + \theta_{1}^2 E \left[ \varepsilon_{t-1}  \varepsilon_{t+h-1} \right] \nonumber \\ &amp;-&amp;  \theta_2 E \left[ \varepsilon_{t-2}  \varepsilon_{t+h} \right] + \theta_1 \theta_2 E \left[ \varepsilon_{t-2}  \varepsilon_{t+h-1} \right] + \theta_{2}^2 E \left[ \varepsilon_{t-2}  \varepsilon_{t-h-2} \right]  \nonumber \\ &amp;-&amp; \theta_2 E \left[ \varepsilon_{t}  \varepsilon_{t+h-2} \right] + \theta_1 \theta_2 E \left[ \varepsilon_{t-1}  \varepsilon_{t+h-2} \right]  \end{eqnarray}\]</span></p>
<ul>
<li><p><span class="math inline">\(h = 0\)</span> -&gt; <span class="math inline">\(\gamma_0 = \sigma^2 + \theta_{1}^2 \sigma^2 + \theta_{2}^2 \sigma^2 = \left(1 + \theta_{1}^2 + \theta_{2}^2 \right) \sigma^2\)</span></p></li>
<li><p><span class="math inline">\(h = 1\)</span> -&gt; <span class="math inline">\(\gamma_1 = -\theta_1 \sigma^2 + \theta_1 \theta_2 \sigma^2\)</span></p></li>
<li><p><span class="math inline">\(h = 2\)</span> -&gt; <span class="math inline">\(\gamma_2 = -\theta_2 \sigma^2\)</span></p></li>
<li><p><span class="math inline">\(h &gt; 2\)</span> -&gt; <span class="math inline">\(\gamma_h = 0\)</span></p></li>
</ul>
</section>
<section id="ma2-2" class="slide level2">
<h2>MA(2)</h2>
<p><span class="math display">\[X_t =  \Theta_2 \left(B \right)\varepsilon_t = \varepsilon_t - \theta_1 \varepsilon_{t-1} - \theta_2 \varepsilon_{t-2}, \quad \left\lbrace \varepsilon_{t} \right\rbrace \text{ ruido blanco} \nonumber\]</span></p>
<p>Por tanto las <span class="hl-yellow"><strong>autocorrelaciones</strong></span> ser√°n:</p>
<p><span class="math display">\[\begin{eqnarray}\rho_h = \frac{\gamma_h}{\gamma_0} = \begin{cases} \frac{\gamma_h}{\gamma_0} = 1 \quad &amp; &amp;h = 0, \nonumber \\ \frac{\gamma_1}{\gamma_0} = \frac{-\theta_1 \sigma^2 + \theta_1 \theta_2 \sigma^2}{ \left(1 + \theta_{1}^2  + \theta_{2}^2 \right) \sigma^2} = \frac{-\theta_1  + \theta_1 \theta_2 }{1 + \theta_{1}^2  + \theta_{2}^2}\quad &amp; &amp;h = 1, \nonumber \\ \frac{\gamma_2}{\gamma_0} = \frac{-\theta_2 \sigma^2}{ \left(1 + \theta_{1}^2  + \theta_{2}^2 \right) \sigma^2} = \frac{-\theta_2}{1 + \theta_{1}^2  + \theta_{2}^2}\quad &amp; &amp;h = 2 \nonumber \\ 0  \quad &amp; &amp;h &gt; 2\end{cases}\end{eqnarray}\]</span></p>
<div class="fragment">
<p><span class="hl-yellow"><strong>¬øC√≥mo generalizarlo a MA(q)?</strong></span></p>
</div>
</section>
<section id="maq" class="slide level2">
<h2>MA(q)</h2>
<p><span class="math display">\[\begin{eqnarray}\gamma_h &amp;=&amp; Cov \left( X_t, X_{t+h} \right) = E \left[ \left( \varepsilon_t - \theta_1 \varepsilon_{t-1} - \ldots - \theta_q \varepsilon_{t-q}\right) \left( \varepsilon_{t+h} - \theta_1 \varepsilon_{t+h-1} - \ldots - \theta_q \varepsilon_{t+h-q}\right)  \right] \nonumber \\ &amp;=&amp; E \left[ \varepsilon_t \varepsilon_{t+h} \right]  - \theta_1 E \left[ \varepsilon_{t}  \varepsilon_{t+h-1} \right] - \ldots  - \theta_q E \left[ \varepsilon_{t}  \varepsilon_{t+h-q} \right] \nonumber \\ &amp;-&amp; \theta_1 E \left[ \varepsilon_{t-1} \varepsilon_{t+h} \right]  + \theta_{1}^2 E \left[ \varepsilon_{t-1}  \varepsilon_{t+h-1} \right] + \ldots  + \theta_1\theta_q E \left[ \varepsilon_{t-1}  \varepsilon_{t+h-q} \right] \nonumber \\ &amp; &amp; ... \nonumber \\ &amp;-&amp; \theta_q E \left[ \varepsilon_{t-q} \varepsilon_{t+h} \right]  + \theta_{1}\theta_{q} E \left[ \varepsilon_{t-q}  \varepsilon_{t+h-1} \right] + \ldots  + \theta_{q}^{2} E \left[ \varepsilon_{t-q}  \varepsilon_{t+h-q} \right]\end{eqnarray}\]</span></p>
<p><span class="math display">\[\begin{eqnarray}\gamma_h = \begin{cases} \sigma^2 + \theta_{1}^{2}\sigma^2  +  \ldots + \theta_{q}^{2}\sigma^2\quad &amp; &amp;h = 0, \nonumber \\  - \theta_1 \sigma^2 + \theta_1 \theta_2 \sigma^2 + \ldots + \theta_{q-1} \theta_{q} \sigma^2 \quad &amp; &amp;h = 1, \nonumber \\ -\theta_2 \sigma^2 + \theta_1 \theta_3 \sigma^2 + \ldots + \theta_{q-2} \theta_{q} \sigma^2\quad &amp; &amp;h = 2, \nonumber \\  -\theta_3 \sigma^2 + \theta_1 \theta_{4} \sigma^2 +  \ldots +  \theta_{q-3} \theta_{q} \sigma^2 \quad &amp; &amp;h =3\nonumber \end{cases}\end{eqnarray}\]</span></p>
</section>
<section id="maq-1" class="slide level2">
<h2>MA(q)</h2>
<p>De manera general las <span class="hl-yellow"><strong>autocovarianzas de un MA(q)</strong></span> son las siguientes</p>
<p><span class="math display">\[\begin{eqnarray}\gamma_h = \begin{cases} \left(1 + \theta_{1}^{2} + \ldots + \theta_{q}^{2} \right)\sigma^2  \quad &amp; &amp;h = 0, \nonumber \\  \left(-\theta_h + \sum_{j = 1}^{q-h} \theta_{j}  \theta_{j + h} \right) \sigma^2  &amp; &amp;h = 1, \ldots,q \nonumber \\ 0  \quad &amp; &amp;h &gt; q\nonumber \end{cases}\end{eqnarray}\]</span></p>
<p><span class="math display">\[\begin{eqnarray}\rho_h = \frac{\gamma_h}{\gamma_0} = \begin{cases} 1 \quad &amp; &amp;h = 0, \nonumber \\  \frac{\left(-\theta_h + \sum_{j = 1}^{q-h} \theta_{j}  \theta_{j + h} \right)}{\left(1 + \theta_{1}^{2} + \ldots + \theta_{q}^{2} \right)} &amp; &amp;h = 1, \ldots,q \nonumber \\ 0  \quad &amp; &amp;h &gt; q\nonumber \end{cases}\end{eqnarray}\]</span></p>
</section>
<section id="maq-invertibilidad" class="slide level2">
<h2>MA(q): invertibilidad</h2>
<p>¬øQu√© <span class="hl-yellow"><strong>condiciones de invertibilidad</strong></span> necesitamos?</p>
<div class="fragment">
<p>Como antes vamos a intentar poner los errores en funci√≥n de <span class="math inline">\(X_t\)</span></p>
<p><span class="math display">\[\begin{eqnarray}\varepsilon_{t} &amp;=&amp; X_t + \theta_1 \varepsilon_{t-1} + \ldots +  \theta_q \varepsilon_{t-q} \nonumber \\ &amp;=&amp; X_t + \theta_1 \left( X_{t-1} + \theta_1 \varepsilon_{t-2} + \ldots + \theta_q \varepsilon_{t-q-1} \right) +\theta_2 \varepsilon_{t-2}  + \ldots +  \theta_q \varepsilon_{t-q} \nonumber \\ &amp;=&amp; X_t + \theta_1 X_{t-1} + \theta_{1}^{2} \varepsilon_{t-2} + \ldots + \theta_1\theta_q \varepsilon_{t-q-1} \nonumber \\ &amp; &amp; + \theta_2 \varepsilon_{t-2}  + \ldots +  \theta_q \varepsilon_{t-q} \nonumber \\ &amp;=&amp; X_t + \theta_1 X_{t-1} + \theta_{1}^{2} \left( X_{t-2} + \theta_1 \varepsilon_{t-3} + \ldots + \theta_q \varepsilon_{t-q-2} \right) + \ldots + \theta_1\theta_q \varepsilon_{t-q-1}\nonumber \\ &amp; &amp; + \theta_2 \left( X_{t-2} + \theta_1 \varepsilon_{t-3} + \ldots + \theta_q \varepsilon_{t-q-2} \right)  + \ldots +  \theta_q \varepsilon_{t-q} \nonumber \\ &amp;=&amp; \ldots = \sum_{j=0}^{\infty} \pi_j X_{t-j} \end{eqnarray}\]</span></p>
</div>
</section>
<section id="maq-invertibilidad-1" class="slide level2">
<h2>MA(q): invertibilidad</h2>
<p>Diremos que un <span class="hl-yellow"><strong>proceso MA(q) es invertible</strong></span> si</p>
<p><span class="math display">\[\varepsilon_{t} = \sum_{j=0}^{\infty} \pi_j X_{t-j} = \Pi \left(B \right) X_t, \quad  \Pi \left(B \right) = \sum_{j=0}^{\infty} \pi_j B^j = 1 + \pi_1 B + \pi_2 B^2 + ...\]</span></p>
<p>Dado que por definici√≥n <span class="math inline">\(X_t = \Theta_q (B) \varepsilon_t\)</span> entonces</p>
<p><span class="math display">\[\varepsilon_{t}  = \Pi \left(B \right) \Theta_q (B) \varepsilon_t\]</span></p>
<p>por lo que los <span class="hl-yellow"><strong>coeficientes de <span class="math inline">\(\Pi (B)\)</span> se determinar√°n</strong></span> tal que <span class="math inline">\(\Pi \left(B \right) \Theta_q (B) = 1\)</span>.</p>
</section>
<section id="maq-invertibilidad-2" class="slide level2">
<h2>MA(q): invertibilidad</h2>
<p>Si <span class="math inline">\(\Pi \left(B \right) \Theta_q (B) = 1\)</span>, entonces <span class="math inline">\(\Pi (B) = \Theta_{q}^{-1} (B)\)</span>.</p>
<p>Es decir, dicho polinomio <span class="math inline">\(\Theta_{q}(B)\)</span> tiene que ser por tanto invertible. Se puede demostrar como un <span class="hl-yellow"><strong>proceso MA(q) es invertible</strong></span> si y solo si las ra√≠ces de</p>
<p><span class="math display">\[\Theta_{q}(z) = 1 - \theta_1 z - \ldots - \theta_q z^q = 0\]</span></p>
<p>son (en m√≥dulo) mayores que la unidad (<span class="math inline">\(\left| z \right| &gt; 1\)</span>).</p>
</section>
<section id="maq-invertibilidad-3" class="slide level2">
<h2>MA(q) invertibilidad</h2>
<p>El paquete <code>{pracma}</code> nos permite <span class="hl-yellow"><strong>determinar las ra√≠ces de un polinomio con la funci√≥n <code>roots()</code></strong></span> introduciendo los coeficientes del polinomio de m√°s grado a menos.</p>
<p>Por ejemplo si queremos calcular las ra√≠ces de <span class="math inline">\(-z^3 +2 z^2 +1.5* z - 2\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb513"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb513-1"><a href="#cb513-1"></a>pracma<span class="sc">::</span><span class="fu">roots</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">1.5</span>, <span class="sc">-</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  2.2728039 -1.0843343  0.8115305</code></pre>
</div>
</div>
<div class="fragment">
<p>Si queremos definir un <span class="math inline">\(MA(q)\)</span>, por ejemplo, <span class="math inline">\(X_t = \varepsilon_t - 0.2 \varepsilon_{t-1} + 0.5 \varepsilon_{t-2}\)</span>, y ver <span class="hl-yellow"><strong>si cumple las condiciones de invertibilidad</strong></span> basta con meter los <strong>param√©tros de antiguo a reciente y cambiando el signo</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb515"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb515-1"><a href="#cb515-1"></a>pracma<span class="sc">::</span><span class="fu">roots</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.2</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1.628286 -1.228286</code></pre>
</div>
</div>
</div>
</section>
<section id="maq-2" class="slide level2">
<h2>MA(q)</h2>
<p><span class="hl-yellow"><strong>üíª Dise√±a una funci√≥n</strong></span> para simular <span class="math inline">\(n\)</span> trayectorias de un <span class="math inline">\(MA(q)\)</span> en funci√≥n de <span class="math inline">\(q\)</span>, <span class="math inline">\(n\)</span>, <span class="math inline">\(\sigma\)</span>, <span class="math inline">\(\left(\theta_1,~\theta_2, \ldots, ~\theta_q\right)\)</span> y <span class="math inline">\(\left(\varepsilon_1, \ldots, \varepsilon_q\right)\)</span></p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb517"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb517-1"><a href="#cb517-1"></a>MA_q_simul <span class="ot">&lt;-</span> <span class="cf">function</span>(q, n, sigma, theta, eps_0) {</span>
<span id="cb517-2"><a href="#cb517-2"></a>  </span>
<span id="cb517-3"><a href="#cb517-3"></a>  X_t <span class="ot">&lt;-</span> eps_0</span>
<span id="cb517-4"><a href="#cb517-4"></a>  eps <span class="ot">&lt;-</span> <span class="fu">c</span>(eps_0, <span class="fu">rnorm</span>(<span class="at">n =</span> n <span class="sc">-</span> q, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma))</span>
<span id="cb517-5"><a href="#cb517-5"></a>  <span class="cf">for</span> (i <span class="cf">in</span> (q <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>n) {</span>
<span id="cb517-6"><a href="#cb517-6"></a>    X_t[i] <span class="ot">&lt;-</span> eps[i] <span class="sc">-</span> <span class="fu">sum</span>(theta <span class="sc">*</span> eps[(i <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">:</span>(i <span class="sc">-</span> q)])</span>
<span id="cb517-7"><a href="#cb517-7"></a>  } </span>
<span id="cb517-8"><a href="#cb517-8"></a>  ts <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="st">"X_t"</span> <span class="ot">=</span> X_t) <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>(<span class="at">index =</span> t)</span>
<span id="cb517-9"><a href="#cb517-9"></a>  <span class="fu">return</span>(ts)</span>
<span id="cb517-10"><a href="#cb517-10"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="maq-3" class="slide level2">
<h2>MA(q)</h2>
<p>üíª <span class="hl-yellow"><strong>Aplica dicha funci√≥n</strong></span> para simular un <span class="math inline">\(MA(2)\)</span> con <span class="math inline">\(n = 300\)</span>, <span class="math inline">\(\sigma = 3\)</span>, <span class="math inline">\(\left(\varepsilon_1, \varepsilon_2 \right) = 0\)</span> y <span class="math inline">\(\left(\theta_1, ~ \theta_2 \right) = (-0.3, 0.5)\)</span></p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb518"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb518-1"><a href="#cb518-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb518-2"><a href="#cb518-2"></a><span class="fu">ggplot</span>(<span class="fu">MA_q_simul</span>(<span class="dv">2</span>, <span class="dv">300</span>, <span class="dv">3</span>, <span class="at">theta =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.3</span>, <span class="fl">0.5</span>), <span class="at">eps =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb518-3"><a href="#cb518-3"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t)) <span class="sc">+</span></span>
<span id="cb518-4"><a href="#cb518-4"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"MA(2) con theta_1 = -0.3, theta_2 = 0.5 y sigma = 3"</span>) <span class="sc">+</span></span>
<span id="cb518-5"><a href="#cb518-5"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-369-1.png" width="960" class="r-stretch"><p>El proceso tiene que cumplir las condiciones de invertibilidad ya que parece estacionario. ¬øCu√°nto valen sus ra√≠ces?</p>
</section>
<section id="maq-4" class="slide level2">
<h2>MA(q)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb519"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb519-1"><a href="#cb519-1"></a>pracma<span class="sc">::</span><span class="fu">roots</span>(<span class="fu">c</span>(<span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.3</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3+1.382027i 0.3-1.382027i</code></pre>
</div>
<div class="sourceCode cell-code" id="cb521"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb521-1"><a href="#cb521-1"></a><span class="fu">Mod</span>(pracma<span class="sc">::</span><span class="fu">roots</span>(<span class="fu">c</span>(<span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.3</span>, <span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.414214 1.414214</code></pre>
</div>
</div>
<p>Las <span class="hl-yellow"><strong>ra√≠ces pueden ser complejas, lo importante es que su m√≥dulo sea mayor que 1</strong></span></p>
</section>
<section id="maq-5" class="slide level2">
<h2>MA(q)</h2>
<p>üíª <span class="hl-yellow"><strong>Aplica dicha funci√≥n</strong></span> para simular un <span class="math inline">\(MA(3)\)</span> con <span class="math inline">\(n = 300\)</span>, <span class="math inline">\(\sigma = 3\)</span>, <span class="math inline">\(\left(\varepsilon_1,~\varepsilon_2, ~\varepsilon_3 \right) = 0\)</span> y <span class="math inline">\(\left(\theta_1, ~ \theta_2, ~\theta_3 \right) = (0.8, 0.4, -0.9)\)</span></p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb523"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb523-1"><a href="#cb523-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb523-2"><a href="#cb523-2"></a><span class="fu">ggplot</span>(<span class="fu">MA_q_simul</span>(<span class="dv">3</span>, <span class="dv">300</span>, <span class="dv">3</span>, <span class="at">theta =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.4</span>, <span class="sc">-</span><span class="fl">0.9</span>), <span class="at">eps =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">3</span>))) <span class="sc">+</span></span>
<span id="cb523-3"><a href="#cb523-3"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t)) <span class="sc">+</span></span>
<span id="cb523-4"><a href="#cb523-4"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"MA(2) con theta_1 = 0.8, theta_2 = 0.4, theta_3 = -0.9 y sigma = 3"</span>) <span class="sc">+</span></span>
<span id="cb523-5"><a href="#cb523-5"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-371-1.png" width="960" class="r-stretch"><p>¬øPor qu√© es explosivo?</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb524"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb524-1"><a href="#cb524-1"></a><span class="fu">Mod</span>(pracma<span class="sc">::</span><span class="fu">roots</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.9</span>, <span class="fl">0.4</span>, <span class="fl">0.8</span>, <span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.5151316 0.8563545 0.8563545</code></pre>
</div>
</div>
</div>
</section>
<section id="maq-6" class="slide level2">
<h2>MA(q)</h2>
<p>üíª <span class="hl-yellow"><strong>Calcula las ACF de ambas series</strong></span></p>
<div class="fragment">
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb526"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb526-1"><a href="#cb526-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb526-2"><a href="#cb526-2"></a><span class="fu">MA_q_simul</span>(<span class="dv">2</span>, <span class="dv">300</span>, <span class="dv">3</span>, <span class="at">theta =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.3</span>, <span class="fl">0.5</span>), <span class="at">eps =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb526-3"><a href="#cb526-3"></a>  <span class="fu">ACF</span>(X_t) <span class="sc">|&gt;</span> </span>
<span id="cb526-4"><a href="#cb526-4"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb526-5"><a href="#cb526-5"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"MA(2) con theta_1 = -0.3, theta_2 = 0.5 y sigma = 3"</span>) <span class="sc">+</span></span>
<span id="cb526-6"><a href="#cb526-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-373-1.png" width="960"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb527"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb527-1"><a href="#cb527-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb527-2"><a href="#cb527-2"></a><span class="fu">MA_q_simul</span>(<span class="dv">3</span>, <span class="dv">300</span>, <span class="dv">3</span>, <span class="at">theta =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.4</span>, <span class="sc">-</span><span class="fl">0.9</span>), <span class="at">eps =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb527-3"><a href="#cb527-3"></a>  <span class="fu">ACF</span>(X_t) <span class="sc">|&gt;</span> </span>
<span id="cb527-4"><a href="#cb527-4"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb527-5"><a href="#cb527-5"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"MA(3) con theta_1 = 0.8, theta_2 = 0.4, theta_3 = -0.9 y sigma = 3"</span>) <span class="sc">+</span></span>
<span id="cb527-6"><a href="#cb527-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-374-1.png" width="960"></p>
</div>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="clase-19" class="title-slide slide level1 center">
<h1>Clases 19: <span class="flow">procesos AR</span></h1>

</section>
<section id="modelos-ar" class="slide level2">
<h2>Modelos AR</h2>
<p>Hasta ahora hemos visto solo procesos cuya dependencia se contruye <span class="hl-yellow"><strong>promediando los errores pasados</strong></span>. ¬øY si hacemos ¬´lo mismo¬ª pero <span class="hl-yellow"><strong>promediando el pasado de la serie</strong></span>?</p>
<div class="fragment">
<p>Dado que la idea es hacer una <strong>regresi√≥n con su propio pasado</strong>, a estos modelos se conoce como <span class="hl-yellow"><strong>procesos autorregresivos (AR)</strong></span></p>
<p><span class="math display">\[X_t = \phi_1 X_{t-1} + \phi_2 X_{t-2} + \ldots + \phi_p X_{t-p} + \varepsilon_t, \quad p \geq 1, \quad \left\lbrace \varepsilon_{t} \right\rbrace \text{ ruido blanco}\]</span></p>
<p>donde <span class="math inline">\(p\)</span> ser√° el <strong>orden autorregresivo</strong> (lo llamaremos <span class="hl-yellow"><strong>procesos autorregresivos de orden p o AR(p)</strong></span>).</p>
</div>
</section>
<section id="modelos-ma-vs-ar" class="slide level2">
<h2>Modelos MA vs AR</h2>
<p>Simplemente por fijar conceptos, estos son los dos modelos</p>
<div class="columns">
<div class="column" style="width:50%;">
<p><span class="math display">\[\begin{eqnarray}X_t &amp;=&amp; \varepsilon_t - \theta_1 \varepsilon_{t-1} - \ldots - \theta_q \varepsilon_{t-q} \nonumber \\ &amp;=&amp; \varepsilon_t - \sum_{j=1}^{q} \theta_j \varepsilon_{t-j} \quad q \geq 1, \quad \quad \text{MA(q)}\end{eqnarray}\]</span></p>
</div><div class="column" style="width:50%;">
<p><span class="math display">\[\begin{eqnarray}X_t &amp;=&amp; \phi_1 X_{t-1} + \ldots + \phi_p X_{t-p} + \varepsilon_t \nonumber \\ &amp;=&amp;  \varepsilon_{t} + \sum_{i=1}\phi_i X_{t-i}, \quad p \geq 1, \quad \quad \text{AR(p)}\end{eqnarray}\]</span></p>
</div>
</div>
<div class="fragment">
<p>De la misma forma podemos hacer uso del <span class="hl-yellow"><strong>operador de retardos</strong></span> (ahora <span class="math inline">\(\Phi_p(B)\)</span>)</p>
<p><span class="math display">\[X_t =  \phi_1 X_{t-1} + \ldots + \phi_p X_{t-p} + \varepsilon_t \quad \Rightarrow \quad \Phi_p \left(B \right)X_t = \varepsilon_t, \quad \Phi_p(B) = 1 - \phi_1B - \ldots - \phi_p B^p \quad \]</span></p>
</div>
<div class="fragment">
<div class="columns">
<div class="column" style="width:50%;">
<p><span class="math display">\[\begin{eqnarray}X_t &amp;=&amp; \varepsilon_t - \theta_1 \varepsilon_{t-1} - \ldots - \theta_q \varepsilon_{t-q} \nonumber \\ &amp;=&amp; \Theta_q (B) \varepsilon_t \quad \quad \text{MA(q)} \end{eqnarray}\]</span></p>
</div><div class="column" style="width:50%;">
<p><span class="math display">\[\begin{eqnarray}X_t &amp;=&amp; \varepsilon_t + \phi_1 X_{t-1} + \ldots + \phi_q X_{t-q} \nonumber \\ \Phi_p (B)X_t &amp;=&amp;  \varepsilon_t \quad \quad \text{AR(p)} \end{eqnarray}\]</span></p>
</div>
</div>
</div>
</section>
<section id="proceso-ar" class="slide level2">
<h2>Proceso AR</h2>
<p><span class="math display">\[\begin{eqnarray}X_t &amp;=&amp; \varepsilon_t + \phi_1 X_{t-1} + \ldots + \phi_q X_{t-q} \nonumber \\ \Phi_p (B)X_t &amp;=&amp;  \varepsilon_t \quad \quad \text{AR(p)} \end{eqnarray}\]</span></p>
<p>Dale valores <span class="math inline">\(p=1, 2, 3, 4\)</span> y escribe c√≥mo quedar√≠a el proceso</p>
<div class="fragment">
<ul>
<li><p><strong>AR(1)</strong>: <span class="math inline">\(\Phi_1 \left(B \right)X_t = \varepsilon_t \Rightarrow \left(1 - \phi_1 B \right)X_t = \varepsilon_t \Rightarrow X_t = \phi_1 X_{t-1} + \varepsilon_t\)</span></p></li>
<li><p><strong>AR(2)</strong>: <span class="math inline">\(\Phi_2 \left(B \right)X_t = \varepsilon_t \Rightarrow \left(1 - \phi_1 B - \phi_2 B^2 \right)X_t = \varepsilon_t \Rightarrow X_t = \phi_1 X_{t-1} + \phi_2 X_{t-2} + \varepsilon_t\)</span></p></li>
<li><p><strong>AR(3)</strong>: <span class="math inline">\(\Phi_3 \left(B \right)X_t = \varepsilon_t \Rightarrow \left(1 - \phi_1 B - \phi_2 B^2 - \phi_3 B^3 \right)X_t = \varepsilon_t \Rightarrow X_t = \phi_1 X_{t-1} + \phi_2 X_{t-2} + \phi_3 X_{t-3} + \varepsilon_t\)</span></p></li>
</ul>
</div>
</section>
<section id="arp" class="slide level2">
<h2>AR(p)</h2>
<p><span class="hl-yellow"><strong>üíª Dise√±a una funci√≥n</strong></span> para simular <span class="math inline">\(n\)</span> trayectorias de un <span class="math inline">\(AR(p)\)</span> en funci√≥n de <span class="math inline">\(p\)</span>, <span class="math inline">\(n\)</span>, <span class="math inline">\(\sigma\)</span>, <span class="math inline">\(\left(\phi_1,~\phi_2, \ldots, ~\phi_p\right)\)</span> y <span class="math inline">\(\left(X_1, \ldots, X_p\right)\)</span></p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb528"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb528-1"><a href="#cb528-1"></a>AR_p_simul <span class="ot">&lt;-</span> <span class="cf">function</span>(p, n, sigma, phi, X) {</span>
<span id="cb528-2"><a href="#cb528-2"></a>  </span>
<span id="cb528-3"><a href="#cb528-3"></a>  X_t <span class="ot">&lt;-</span> X</span>
<span id="cb528-4"><a href="#cb528-4"></a>  <span class="cf">for</span> (i <span class="cf">in</span> (p <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>n) {</span>
<span id="cb528-5"><a href="#cb528-5"></a>    X_t[i] <span class="ot">&lt;-</span></span>
<span id="cb528-6"><a href="#cb528-6"></a>      <span class="fu">sum</span>(phi <span class="sc">*</span> X_t[(i <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">:</span>(i<span class="sc">-</span>p)]) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)</span>
<span id="cb528-7"><a href="#cb528-7"></a>  } </span>
<span id="cb528-8"><a href="#cb528-8"></a>  ts <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="st">"X_t"</span> <span class="ot">=</span> X_t) <span class="sc">|&gt;</span> <span class="fu">as_tsibble</span>(<span class="at">index =</span> t)</span>
<span id="cb528-9"><a href="#cb528-9"></a>  <span class="fu">return</span>(ts)</span>
<span id="cb528-10"><a href="#cb528-10"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="arp-1" class="slide level2">
<h2>AR(p)</h2>
<p>üíª <span class="hl-yellow"><strong>Aplica dicha funci√≥n</strong></span> para simular un <span class="math inline">\(AR(2)\)</span> con <span class="math inline">\(n = 300\)</span>, <span class="math inline">\(\sigma = 3\)</span>, <span class="math inline">\(\left(X_1, X_2 \right) = 0\)</span> y <span class="math inline">\(\left(\phi_1, ~ \phi_2 \right) = (-0.3, 0.5)\)</span></p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb529"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb529-1"><a href="#cb529-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb529-2"><a href="#cb529-2"></a><span class="fu">AR_p_simul</span>(<span class="at">p =</span> <span class="dv">2</span>, <span class="at">n =</span> <span class="dv">300</span>, <span class="at">sigma =</span> <span class="dv">3</span>, <span class="at">phi =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.3</span>, <span class="fl">0.5</span>), <span class="at">X =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb529-3"><a href="#cb529-3"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb529-4"><a href="#cb529-4"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t)) <span class="sc">+</span></span>
<span id="cb529-5"><a href="#cb529-5"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"AR(2) con phi_1 = -0.3, phi_2 = 0.5 y sigma = 3"</span>) <span class="sc">+</span></span>
<span id="cb529-6"><a href="#cb529-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-376-1.png" width="960" class="r-stretch"></section>
<section id="arp-2" class="slide level2">
<h2>AR(p)</h2>
<p>üíª <span class="hl-yellow"><strong>Aplica la funci√≥n MA_q</strong></span> para simular un <span class="math inline">\(MA(2)\)</span> con <span class="math inline">\(n = 300\)</span>, <span class="math inline">\(\sigma = 3\)</span>, <span class="math inline">\(\left(\varepsilon_1, \varepsilon_2 \right) = 0\)</span> y <span class="math inline">\(\left(\theta_1, ~ \theta_2 \right) = (-0.3, 0.5)\)</span>. Compara ambos procesos (<strong>mismos par√°metros</strong>)</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb530"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb530-1"><a href="#cb530-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb530-2"><a href="#cb530-2"></a><span class="fu">MA_q_simul</span>(<span class="dv">2</span>, <span class="dv">300</span>, <span class="dv">3</span>, <span class="at">theta =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.3</span>, <span class="fl">0.5</span>), <span class="at">eps =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb530-3"><a href="#cb530-3"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb530-4"><a href="#cb530-4"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t)) <span class="sc">+</span></span>
<span id="cb530-5"><a href="#cb530-5"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"MA(2) con theta_1 = -0.3, theta_2 = 0.5 y sigma = 3"</span>) <span class="sc">+</span></span>
<span id="cb530-6"><a href="#cb530-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-377-1.png" width="960"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb531"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb531-1"><a href="#cb531-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb531-2"><a href="#cb531-2"></a><span class="fu">AR_p_simul</span>(<span class="at">p =</span> <span class="dv">2</span>, <span class="at">n =</span> <span class="dv">300</span>, <span class="at">sigma =</span> <span class="dv">3</span>, <span class="at">phi =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.3</span>, <span class="fl">0.5</span>), <span class="at">X =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb531-3"><a href="#cb531-3"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb531-4"><a href="#cb531-4"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t)) <span class="sc">+</span></span>
<span id="cb531-5"><a href="#cb531-5"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"AR(2) con phi_1 = -0.3, phi_2 = 0.5 y sigma = 3"</span>) <span class="sc">+</span></span>
<span id="cb531-6"><a href="#cb531-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-378-1.png" width="960"></p>
</div>
</div>
</div>
</div>
<div class="fragment">
<p>Ambos <span class="hl-red"><strong>parecen algo impredible y aleatorio y ¬°no es cierto!</strong></span>, simplemente son estacionarios (pero una parte de su comportamiento podemos predecirlo).</p>
</div>
</section>
<section id="maar-vs-ruido-blanco" class="slide level2">
<h2>MA/AR vs ruido blanco</h2>
<p>De hecho en ambos casos al <span class="hl-yellow"><strong>realizar el contraste de ruido blanco</strong></span> de Ljung-Box obtenemos p-valores menores que 0.05 ==&gt; <span class="hl-green"><strong>rechazamos la hip√≥tesis nula de ruido blanco</strong></span></p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb532"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb532-1"><a href="#cb532-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb532-2"><a href="#cb532-2"></a><span class="fu">MA_q_simul</span>(<span class="dv">2</span>, <span class="dv">300</span>, <span class="dv">3</span>, <span class="at">theta =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.3</span>, <span class="fl">0.5</span>), <span class="at">eps =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb532-3"><a href="#cb532-3"></a>  <span class="fu">features</span>(X_t, ljung_box)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 2
  lb_stat lb_pvalue
    &lt;dbl&gt;     &lt;dbl&gt;
1    1.20     0.272</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb534"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb534-1"><a href="#cb534-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb534-2"><a href="#cb534-2"></a><span class="fu">AR_p_simul</span>(<span class="at">p =</span> <span class="dv">2</span>, <span class="at">n =</span> <span class="dv">300</span>, <span class="at">sigma =</span> <span class="dv">3</span>, <span class="at">phi =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.3</span>, <span class="fl">0.5</span>), <span class="at">X =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb534-3"><a href="#cb534-3"></a>  <span class="fu">features</span>(X_t, ljung_box)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 2
  lb_stat lb_pvalue
    &lt;dbl&gt;     &lt;dbl&gt;
1    95.0         0</code></pre>
</div>
</div>
</div>
</div>
<p>Algo que no pasa si realmente tenemos ruido blanco.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb536"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb536-1"><a href="#cb536-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb536-2"><a href="#cb536-2"></a><span class="fu">tibble</span>(<span class="st">"t"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">300</span>, <span class="st">"X_t"</span> <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">300</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb536-3"><a href="#cb536-3"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> t) <span class="sc">|&gt;</span> </span>
<span id="cb536-4"><a href="#cb536-4"></a>  <span class="fu">features</span>(X_t, ljung_box)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 2
  lb_stat lb_pvalue
    &lt;dbl&gt;     &lt;dbl&gt;
1  0.0728     0.787</code></pre>
</div>
</div>
</section>
<section id="ar1" class="slide level2">
<h2>AR(1)</h2>
<p><span class="hl-yellow"><strong>¬øEs estacionario?</strong></span></p>
<div class="fragment">
<p>Vamos a empezar por AR(1)</p>
<p><span class="math display">\[X_t = \phi_1 X_{t-1}  + \varepsilon_t, \quad \left\lbrace \varepsilon_{t} \right\rbrace \text{ ruido blanco}\]</span></p>
<p><span class="math display">\[\begin{eqnarray}X_t &amp;=&amp; \phi_1 X_{t-1} +  \varepsilon_t = \phi_1 \left(\phi_1 X_{t-2} +  \varepsilon_{t-1} \right) + \varepsilon_t = \phi_{1}^2 X_{t-2} + \phi_{1}\varepsilon_{t-1}   + \varepsilon_t \nonumber \\ &amp;=&amp; \phi_{1}^2 \left( \phi_1 X_{t-3} +  \varepsilon_{t-2}\right) + \phi_{1}\varepsilon_{t-1}   + \varepsilon_t =\phi_{1}^3 X_{t-3} + \phi_{1}^{2}\varepsilon_{t-2} + \phi_{1}\varepsilon_{t-1}  + \varepsilon_t  \nonumber \\ &amp;=&amp; \ldots = \sum_{j=0}^{\infty} \phi_{1}^j \varepsilon_{t-j} \end{eqnarray}\]</span></p>
</div>
<div class="fragment">
<ol type="1">
<li><p><span class="hl-yellow"><strong>Media</strong></span>: <span class="math inline">\(E\left[X_t \right] = \sum_{j=0}^{\infty} \phi_{1}^j E\left[ \varepsilon_{t} \right] = 0\)</span></p></li>
<li><p><span class="hl-yellow"><strong>Varianza</strong></span>: <span class="math inline">\(Var\left[X_t \right] = \sum_{j=0}^{\infty} \phi_{1}^{2j} Var\left[ \varepsilon_{t} \right] = \sigma^2 \sum_{j=0}^{\infty} \phi_{1}^{2j} = \sigma^2 \frac{1}{1 - \phi_{1}^2}\)</span></p></li>
</ol>
</div>
</section>
<section id="ar1-1" class="slide level2">
<h2>AR(1)</h2>
<ol start="3" type="1">
<li><span class="hl-yellow"><strong>Autocovarianzas</strong></span>: teniendo en cuenta que <span class="math inline">\(\left\lbrace \varepsilon_t \right\rbrace\)</span> es ruido blanco (¬°e incorrelado con <span class="math inline">\(X_t\)</span>!)</li>
</ol>
<p><span class="math display">\[\begin{eqnarray}\gamma_h &amp;=&amp; Cov\left[X_t, X_{t+h} \right] = E \left[\sum_{j=0}^{\infty} \phi_{1}^j \varepsilon_{t-j} * \sum_{j=0}^{\infty} \phi_{1}^j \varepsilon_{t+h-j} \right]\nonumber \\  &amp;=&amp; E \left[\left(\varepsilon_{t} + \phi_{1} \varepsilon_{t-1} + \phi_{1}^2 \varepsilon_{t-2} + \ldots \right) \left(\varepsilon_{t+h} + \phi_{1} \varepsilon_{t+h-1} + \phi_{1}^2 \varepsilon_{t+h-2} + \ldots \right) \right] \nonumber \\  &amp;=&amp;\begin{cases}  \sigma^2 \frac{1}{1 - \phi_{1}^2} \quad h = 0, \\ \phi_1 E \left[\varepsilon_{t}\varepsilon_{t} \right] + \phi_{1}^{3}E \left[\varepsilon_{t-1}\varepsilon_{t-1} \right] + \phi_{1}^{5}E \left[\varepsilon_{t-2}\varepsilon_{t-2} \right] + \ldots = \sigma^2 \sum_{j=0}^{\infty} \phi_{1}^{2*j+1}= \sigma^2 \frac{\phi_1}{1 - \phi_{1}^2} \quad h = 1, \\ \phi_{1}^{2} E \left[\varepsilon_{t}\varepsilon_{t} \right] + \phi_{1}^{4}E \left[\varepsilon_{t-1}\varepsilon_{t-1} \right] + \phi_{1}^{6}E \left[\varepsilon_{t-2}\varepsilon_{t-2} \right] + \ldots = \sigma^2 \sum_{j=0}^{\infty} \phi_{1}^{2*j+2}= \sigma^2 \frac{\phi_{1}^2}{1 - \phi_{1}^2} \quad h = 2 \end{cases}  \nonumber \\ &amp;=&amp; \sigma^2 \sum_{j=0}^{\infty} \phi_{1}^{2*j+h}= \sigma^2 \frac{\phi_{1}^h}{1 - \phi_{1}^2}\end{eqnarray}\]</span></p>
</section>
<section class="slide level2">

<ol start="3" type="1">
<li><span class="hl-yellow"><strong>Autocorrelaciones</strong></span>:</li>
</ol>
<p><span class="math display">\[\begin{eqnarray}\rho_h &amp;=&amp; \frac{\gamma_h}{\gamma_0} = \frac{\sigma^2 \frac{\phi_{1}^h}{1 - \phi_{1}^2}}{\sigma^2 \frac{1}{1 - \phi_{1}^2}} = \phi_{1}^h\end{eqnarray}\]</span></p>
<p>lo cual <span class="hl-yellow"><strong>implica que <span class="math inline">\(\left| \rho_1 \right| &lt; 1\)</span></strong></span> (ya que las correlaciones deber√≠an ser menores que 1 en valor absoluto y <strong>decrecientes</strong>).</p>
<p>&nbsp;</p>
<p>F√≠jate que ahora las <span class="hl-purple"><strong>autocorrelaciones <span class="math inline">\(\rho_h\)</span> no decaen a 0</strong></span></p>
</section>
<section id="ar1-2" class="slide level2">
<h2>AR(1)</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb538"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb538-1"><a href="#cb538-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb538-2"><a href="#cb538-2"></a><span class="fu">MA_q_simul</span>(<span class="at">q =</span> <span class="dv">1</span>, <span class="at">n =</span> <span class="dv">5000</span>, <span class="at">sigma =</span> <span class="dv">1</span>, <span class="at">theta =</span> <span class="fu">c</span>(<span class="fl">0.75</span>), <span class="at">eps =</span> <span class="fu">c</span>(<span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb538-3"><a href="#cb538-3"></a>  <span class="fu">ACF</span>(X_t, <span class="at">lag_max =</span> <span class="dv">50</span>)  <span class="sc">|&gt;</span> </span>
<span id="cb538-4"><a href="#cb538-4"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb538-5"><a href="#cb538-5"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"MA(1) con theta_1 = 0.75 y sigma = 1"</span>) <span class="sc">+</span></span>
<span id="cb538-6"><a href="#cb538-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-382-1.png" width="960"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb539"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb539-1"><a href="#cb539-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb539-2"><a href="#cb539-2"></a><span class="fu">AR_p_simul</span>(<span class="at">p =</span> <span class="dv">1</span>, <span class="at">n =</span> <span class="dv">5000</span>, <span class="at">sigma =</span> <span class="dv">1</span>, <span class="at">phi =</span> <span class="fu">c</span>(<span class="fl">0.75</span>), <span class="at">X =</span> <span class="fu">c</span>(<span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb539-3"><a href="#cb539-3"></a>  <span class="fu">ACF</span>(X_t, <span class="at">lag_max =</span> <span class="dv">50</span>)  <span class="sc">|&gt;</span> </span>
<span id="cb539-4"><a href="#cb539-4"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb539-5"><a href="#cb539-5"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"AR(1) con phi_1 = 0.75 y sigma = 1"</span>) <span class="sc">+</span></span>
<span id="cb539-6"><a href="#cb539-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-383-1.png" width="960"></p>
</div>
</div>
</div>
</div>
<p>¬°La <span class="hl-red"><strong>funci√≥n ACF nunca va a anularse por completo!</strong></span>, de hecho tardar√° mucho en caer dentro de la banda de incorrelaci√≥n.</p>
</section>
<section id="arp-3" class="slide level2">
<h2>AR(p)</h2>
<p>En general</p>
<p><span class="math display">\[X_t = \phi_1 X_{t-1}  + \phi_2 X_{t-2} + \ldots + \phi_p X_{t-p}  + \varepsilon_t, \quad \left\lbrace \varepsilon_{t} \right\rbrace \text{ ruido blanco}\]</span></p>
<p><span class="math display">\[\begin{eqnarray}X_t &amp;=&amp; \phi_1 X_{t-1} + \phi_2 X_{t-2} + \ldots + \phi_p X_{t-p}  + \varepsilon_t \nonumber \\ &amp;=&amp; \phi_1 \left(\phi_1 X_{t-2} + \ldots + \phi_p X_{t-p-1} + \varepsilon_{t-1} \right)  +  \phi_2 X_{t-2} + \ldots + \phi_p X_{t-p} +\varepsilon_t \nonumber \\ &amp;=&amp;  \left(\phi_{1}^{2} + \phi_2 \right) X_{t-2} + \left(\phi_1 \phi_2 + \phi_3 \right) X_{t-3} + \left(\phi_1 \phi_2 + \phi_3 \right) X_{t-3}+\left(\phi_1 \phi_3 + \phi_4 \right) X_{t-4} \nonumber \\ &amp;&amp; + \ldots  +\left(\phi_1 \phi_{p-1} + \phi_{p} \right) X_{t-p} + \phi_1 \phi_{p} X_{t-p-1} + \phi_1 \varepsilon_{t-1} + \varepsilon_t   \nonumber \\ \ &amp;=&amp;  \ldots =^{¬ø?} \sum_{j=0}^{\infty} \psi_j \varepsilon_{t-j} \quad \text{(proceso MA(}\infty\text{))} \end{eqnarray}\]</span></p>
<div class="fragment">
<p>Diremos que un proceso <span class="math inline">\(AR(p)\)</span>, definido como <span class="math inline">\(\Phi_p (B)X_t = \varepsilon_t\)</span>, es un [<strong>proceso estacionario (o causal) si admite la representaci√≥n <span class="math inline">\(MA(\infty)\)</span></strong>]**]{.hl-yellow} anterior, tal que</p>
<p><span class="math display">\[X_t = \sum_{j=0}^{\infty} \psi_j \varepsilon_{t-j} = \Psi (B) \varepsilon_t, \quad \Psi (B) = \sum_{j=0}^{\infty} \psi_j B^j, \quad \sum_{j=0}^{\infty} \left| \psi_j \right| &lt; \infty, ~\psi_0 = 1\]</span></p>
</div>
<div class="fragment">
<p>Al igual que antes, dado que <span class="math inline">\(\Phi_p X_t = \varepsilon_t\)</span>, los <span class="hl-yellow"><strong>coeficientes de <span class="math inline">\(\Psi (B)\)</span> se determinar√°n</strong></span> tal que $ _p (B ) = 1$.</p>
</div>
</section>
<section id="arp-invertibilidad" class="slide level2">
<h2>AR(p): invertibilidad</h2>
<p>Si <span class="math inline">\(\Phi_p (B) \Psi \left(B \right) = 1\)</span>, entonces <span class="math inline">\(\Psi (B) = \Phi_{p}^{-1} (B)\)</span>.</p>
<p>Es decir, dicho polinomio <span class="math inline">\(\Phi_{p}(B)\)</span> <strong>tiene que ser de nuevo invertible</strong>. Se puede demostrar como un <span class="hl-yellow"><strong>proceso AR(p) es invertible</strong></span> si y solo si las ra√≠ces de</p>
<p><span class="math display">\[\Phi_{p}(z) = 1 - \phi_1 z - \ldots - \phi_p z^p = 0\]</span></p>
<p>son (en m√≥dulo) mayores que la unidad (<span class="math inline">\(\left| z \right| &gt; 1\)</span>).</p>
</section>
<section id="arp-4" class="slide level2">
<h2>AR(p)</h2>
<p>Bajo dichas <span class="hl-yellow"><strong>condiciones de estacionariedad</strong></span></p>
<ol type="1">
<li><p><span class="hl-yellow"><strong>Media</strong></span>: <span class="math inline">\(E\left[X_t \right] = \sum_{j=0}^{\infty} \psi_j E\left[ \varepsilon_{t-j} \right] = 0\)</span></p></li>
<li><p><span class="hl-yellow"><strong>Varianza</strong></span>: <span class="math inline">\(Var\left[X_t \right] = \sum_{j=0}^{\infty} \psi_{j}^2 Var\left[ \varepsilon_{t-j} \right] = \sigma^2 \sum_{j=0}^{\infty} \psi_{j}^2 = cte &lt; \infty\)</span> (ya que <span class="math inline">\(\sum_{j=0}^{\infty} \left| \psi_{j} \right| &lt; \infty\)</span>)</p></li>
<li><p><span class="hl-yellow"><strong>Autocovarianzas</strong></span>: multiplicando la ecuaci√≥n por <span class="math inline">\(X_{t-h}\)</span> tenemos que</p></li>
</ol>
<p><span class="math display">\[\begin{eqnarray}\gamma_h &amp;=&amp; E \left[X_{t-h}X_t \right]= E \left[X_{t-h} \left(\phi_1 X_{t-1} + \ldots + \phi_p X_{t-p} + \varepsilon_{t} \right) \right] \nonumber \\ &amp;=&amp; \phi_1 E \left[X_{t-h}  X_{t-1} \right] + \ldots + \phi_p E \left[X_{t-h} X_{t-p} \right] + E \left[X_{t-h} \varepsilon_{t}  \right]\ \nonumber \\ &amp;=&amp; \phi_1 \gamma_{h-1} + \ldots + \phi_p \gamma_{h-p} \quad h \geq 0 \end{eqnarray}\]</span></p>
<div class="fragment">
<ol start="3" type="1">
<li><span class="hl-yellow"><strong>Autocorrelaciones</strong></span>:</li>
</ol>
<p><span class="math display">\[\begin{eqnarray}\rho_h &amp;=&amp; \frac{\gamma_h}{\gamma_0} =  \phi_1 \frac{\gamma_{h-1}}{\gamma_0} + \ldots + \phi_p \frac{\gamma_{h-p}}{\gamma_0} = \phi_1 \rho_{h-1}  + \ldots + \phi_p \rho_{h-p} \quad h \geq 1 \nonumber \\ \Phi_p (B) \rho_h &amp;=&amp; 0 \end{eqnarray}\]</span> Como vemos la estructura es m√°s compleja ahora, de hecho deber√≠amos hacer un proceso iterativo complicado, pero lo que <span class="hl-yellow"><strong>no sucede es que caigan a 0</strong></span></p>
</div>
</section>
<section id="ecuaciones-yule-walker" class="slide level2">
<h2>Ecuaciones Yule-Walker</h2>
<p>Si nos fijamos en las primeras <span class="math inline">\(p\)</span> autocorrelaciones tenemos un <span class="hl-yellow"><strong>sistema de ecuaciones conocido como ecuaciones de Yule-Walker</strong></span></p>
<p><span class="math display">\[\begin{eqnarray}\rho_1 &amp;=&amp;  \phi_1   +  \phi_2 \rho_1  + \ldots + \phi_p \rho_{p-1} \nonumber \\ \rho_2 &amp;=&amp;  \phi_1 \rho_{1} +  \phi_2 + \ldots + \phi_p \rho_{p-2} \nonumber \\ \vdots &amp; &amp; \quad \vdots \quad  \quad \vdots  \quad \quad \vdots \quad \quad \quad \vdots \nonumber \\  \rho_p &amp;=&amp;  \phi_1 \rho_{p-1} +  \phi_2 \rho_{p-2}  + \ldots + \phi_p \end{eqnarray}\]</span></p>
</section>
<section id="arp-5" class="slide level2">
<h2>AR(p)</h2>
<p>üíª <span class="hl-yellow"><strong>Aplica la funci√≥n <code>AR_p</code></strong></span> para simular un <span class="math inline">\(AR(2)\)</span> con <span class="math inline">\(n = 1000\)</span>, <span class="math inline">\(\sigma = 3\)</span>, <span class="math inline">\(\left(X_1, X_2 \right) = 0\)</span> y <span class="math inline">\(\left(\phi_1, ~ \phi_2 \right) = (0.3, 0.5)\)</span></p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb540"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb540-1"><a href="#cb540-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb540-2"><a href="#cb540-2"></a><span class="fu">ggplot</span>(<span class="fu">AR_p_simul</span>(<span class="at">p =</span> <span class="dv">2</span>, <span class="dv">1000</span>, <span class="dv">3</span>, <span class="at">phi =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.5</span>), <span class="at">X =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb540-3"><a href="#cb540-3"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> X_t)) <span class="sc">+</span></span>
<span id="cb540-4"><a href="#cb540-4"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"AR(2) con phi_1 = 0.3, phi_2 = 0.5 y sigma = 3"</span>) <span class="sc">+</span></span>
<span id="cb540-5"><a href="#cb540-5"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-384-1.png" width="960" class="r-stretch"><div class="cell">
<div class="sourceCode cell-code" id="cb541"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb541-1"><a href="#cb541-1"></a>pracma<span class="sc">::</span><span class="fu">roots</span>(<span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.3+1.382027i -0.3-1.382027i</code></pre>
</div>
<div class="sourceCode cell-code" id="cb543"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb543-1"><a href="#cb543-1"></a><span class="fu">Mod</span>(pracma<span class="sc">::</span><span class="fu">roots</span>(<span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.414214 1.414214</code></pre>
</div>
</div>
</section>
<section id="arp-6" class="slide level2">
<h2>AR(p)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb545"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb545-1"><a href="#cb545-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb545-2"><a href="#cb545-2"></a><span class="fu">AR_p_simul</span>(<span class="at">p =</span> <span class="dv">2</span>, <span class="dv">1000</span>, <span class="dv">3</span>, <span class="at">phi =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.5</span>), <span class="at">X =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb545-3"><a href="#cb545-3"></a>  <span class="fu">ACF</span>(X_t, <span class="at">lag_max =</span> <span class="dv">50</span>) <span class="sc">|&gt;</span> </span>
<span id="cb545-4"><a href="#cb545-4"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb545-5"><a href="#cb545-5"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"AR(2) con phi_1 = 0.3, phi_2 = 0.5 y sigma = 3"</span>) <span class="sc">+</span></span>
<span id="cb545-6"><a href="#cb545-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-386-1.png" width="960" class="r-stretch"></section>
<section id="funci√≥n-de-autocorrelaci√≥n-parcial" class="slide level2">
<h2>Funci√≥n de autocorrelaci√≥n parcial</h2>
<p>Es obvio que en el caso de los procesos <span class="math inline">\(MA(q)\)</span> la <span class="hl-yelow"><strong>funci√≥n ACF nos permite su identificaci√≥n</strong></span> pero <span class="hl-red"><strong>no as√≠ en el caso de los procesos <span class="math inline">\(AR(p)\)</span></strong></span></p>
<p><strong>¬øC√≥mo caracterizarlos? ¬øQu√© diferencia a un AR(1) de un AR(2)</strong></p>
<div class="fragment">
<ul>
<li><p>AR(1): <span class="math inline">\(X_t\)</span> y <span class="math inline">\(X_{t-2}\)</span> est√°n relacionados indirectamente ya que <span class="math inline">\(X_t = \phi_1X_{t-1} + \varepsilon_{t} = \phi_{1}^2 X_{t-2} + \phi_{1} \varepsilon_{t-1} + \varepsilon_t\)</span> pero dado que <span class="math inline">\(\left| \phi_1 \right| &lt; 1\)</span> es una relaci√≥n que se va diluyendo</p></li>
<li><p>AR(2): sin embargo aqu√≠ <span class="math inline">\(X_t\)</span> y <span class="math inline">\(X_{t-2}\)</span> <strong>s√≠ est√°n relacionados directamente</strong> ya que <span class="math inline">\(X_t = \phi_1X_{t-1} + \phi_2 X_{t-2} + \varepsilon_{t}\)</span> pero dado que <span class="math inline">\(\left| \phi_1 \right| &lt; 1\)</span> es una relaci√≥n que se va diluyendo</p></li>
</ul>
</div>
<div class="fragment">
<p>Dicho de otra forma: en el caso de los <span class="math inline">\(AR(1)\)</span>, <span class="hl-yellow"><strong>si conocemos <span class="math inline">\(X_{t-1}\)</span>, el valor de <span class="math inline">\(X_{t-2}\)</span> es irrelevante</strong></span> (algo que no sucede en los <span class="math inline">\(AR(2)\)</span>). Si yo pudiese calcular la <span class="hl-green"><strong>autocorrelaci√≥n entre <span class="math inline">\(X_t\)</span> y <span class="math inline">\(X_{t-2}\)</span> ELIMINANDO el efecto</strong></span> de <span class="math inline">\(X_{t-1}\)</span>, tendr√≠a que observar como dicho valor es nulo.</p>
</div>
</section>
<section id="funci√≥n-de-autocorrelaci√≥n-parcial-1" class="slide level2">
<h2>Funci√≥n de autocorrelaci√≥n parcial</h2>
<p><span class="hl-yellow"><strong>¬øC√≥mo eliminar de <span class="math inline">\(X_{t+k}\)</span> el efecto de <span class="math inline">\(X_{t+1},\ldots,X_{t+k-1}\)</span></strong>?</span></p>
<div class="fragment">
<p>En lugar de calular <span class="math inline">\(\rho_h = Cor[X_t, X_{t+h}]\)</span> calcularemos</p>
<p><span class="math display">\[\alpha_h = Cor[X_t - efecto_{X_t~vs~\left(X_{t+1}, \ldots, X_{t+h-1} \right)}, X_{t+h} - efecto_{X_{t+h}~vs~\left(X_{t+1}, \ldots, X_{t+h-1} \right)}]\]</span></p>
</div>
<div class="fragment">
<p>Dicho <span class="hl-yellow"><strong>efecto lo estimaremos calculando el mejor predictor lineal √≥ptimo</strong></span> de <span class="math inline">\(X_t\)</span> y <span class="math inline">\(X_{t+h}\)</span> en funci√≥n de los retardos entre ellas <span class="math inline">\(\left(X_{t+1}, \ldots, X_{t+h-1} \right)\)</span></p>
<p><span class="math display">\[\begin{eqnarray}\widetilde{X}_t &amp;=&amp; efecto_{X_t~vs~\left(X_{t+1}, \ldots, X_{t+h-1} \right)} = \beta_1 X_{t+1} + \ldots +\beta_{t+h-1} X_{t+h-1} \quad \text{reg lineal} \nonumber \\ \widetilde{X}_{t+h} &amp;=&amp; efecto_{X_{t+h}~vs~\left(X_{t+1}, \ldots, X_{t+h-1} \right)} = \delta_1 X_{t+1} + \ldots +\delta_{t+h-1} X_{t+h-1} \quad \text{reg lineal} \end{eqnarray}\]</span></p>
</div>
</section>
<section id="funci√≥n-de-autocorrelaci√≥n-parcial-2" class="slide level2">
<h2>Funci√≥n de autocorrelaci√≥n parcial</h2>
<p>De esta forma tendremos que</p>
<p><span class="math display">\[\begin{eqnarray}\alpha_h &amp;=&amp; Cor[X_t - efecto_{X_t~vs~\left(X_{t+1}, \ldots, X_{t+h-1} \right)}, X_{t+h} - efecto_{X_{t+h}~vs~\left(X_{t+1}, \ldots, X_{t+h-1} \right)}] \nonumber \\ &amp;=&amp; \begin{cases} \rho_1 \quad &amp; &amp; h = 1, \\ \frac{Cov \left( X_t -  \widetilde{X}_t, X_{t+h} - \widetilde{X}_{t+h} \right)}{\sqrt{Var \left[ X_t -  \widetilde{X}_t \right] Var \left[X_{t+h} - \widetilde{X}_{t+h} \right]}} \quad &amp; &amp;h &gt; 1\end{cases} \end{eqnarray}\]</span></p>
<p>y se demuestra que <span class="math inline">\(\alpha_p = \phi_p\)</span> y <span class="math inline">\(\alpha_h = 0\)</span> para <span class="math inline">\(h &gt; p\)</span>.</p>
</section>
<section id="pacf-ar-vs-ma" class="slide level2">
<h2>PACF: AR vs MA</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb546"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb546-1"><a href="#cb546-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb546-2"><a href="#cb546-2"></a><span class="fu">MA_q_simul</span>(<span class="at">q =</span> <span class="dv">2</span>, <span class="at">n =</span> <span class="dv">300</span>, <span class="at">sigma =</span> <span class="dv">3</span>, <span class="at">theta =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.3</span>, <span class="fl">0.4</span>), <span class="at">eps =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">2</span>, <span class="at">sd =</span> <span class="dv">3</span>)) <span class="sc">|&gt;</span></span>
<span id="cb546-3"><a href="#cb546-3"></a>  <span class="fu">PACF</span>(X_t, <span class="at">lag_max =</span> <span class="dv">40</span>)  <span class="sc">|&gt;</span> </span>
<span id="cb546-4"><a href="#cb546-4"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb546-5"><a href="#cb546-5"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"MA(1) con theta_1 = -0.3, theta_2 = 0.4 y sigma = 3"</span>) <span class="sc">+</span></span>
<span id="cb546-6"><a href="#cb546-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-387-1.png" width="960"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb547"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb547-1"><a href="#cb547-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb547-2"><a href="#cb547-2"></a><span class="fu">AR_p_simul</span>(<span class="at">p =</span> <span class="dv">2</span>, <span class="at">n =</span> <span class="dv">300</span>, <span class="at">sigma =</span> <span class="dv">3</span>, <span class="at">phi =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.3</span>, <span class="fl">0.4</span>), <span class="at">X =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">2</span>, <span class="at">sd =</span> <span class="dv">3</span>)) <span class="sc">|&gt;</span></span>
<span id="cb547-3"><a href="#cb547-3"></a>  <span class="fu">PACF</span>(X_t, <span class="at">lag_max =</span> <span class="dv">40</span>)  <span class="sc">|&gt;</span> </span>
<span id="cb547-4"><a href="#cb547-4"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb547-5"><a href="#cb547-5"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"AR(1) con phi_1 = -0.3, phi_2 = 0.4 y sigma = 3"</span>) <span class="sc">+</span></span>
<span id="cb547-6"><a href="#cb547-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-388-1.png" width="960"></p>
</div>
</div>
</div>
</div>
<ul>
<li><p>En el caso de los procesos <span class="math inline">\(MA(q)\)</span>: las <span class="hl-yellow"><strong>autocorrelaciones parciales caen exponencialmente sin patr√≥n</strong></span></p></li>
<li><p>En el caso de los procesos <span class="math inline">\(AR(p)\)</span>: las <span class="hl-yellow"><strong>autocorrelaciones son aprox 0 a partir de <span class="math inline">\(p\)</span> y la correlaci√≥n correspondiente a <span class="math inline">\(p\)</span> se sale de manera evidente</strong></span></p></li>
</ul>
</section>
<section id="maar-en-fable" class="slide level2">
<h2>MA/AR en fable</h2>
<p><span class="hl-yellow"><strong>¬øC√≥mo predecir un MA o AR en fable?</strong></span></p>
<p>Lo primero que haremos ser√° generar un proceso <span class="math inline">\(AR(2)\)</span> y <strong>dividir en train y test</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb548"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb548-1"><a href="#cb548-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb548-2"><a href="#cb548-2"></a>datos <span class="ot">&lt;-</span></span>
<span id="cb548-3"><a href="#cb548-3"></a>  <span class="fu">AR_p_simul</span>(<span class="at">p =</span> <span class="dv">2</span>, <span class="at">n =</span> <span class="dv">300</span>, <span class="at">sigma =</span> <span class="dv">1</span>,</span>
<span id="cb548-4"><a href="#cb548-4"></a>             <span class="at">phi =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.3</span>, <span class="fl">0.5</span>), <span class="at">X =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) </span>
<span id="cb548-5"><a href="#cb548-5"></a></span>
<span id="cb548-6"><a href="#cb548-6"></a>train <span class="ot">&lt;-</span> datos <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">280</span>)</span>
<span id="cb548-7"><a href="#cb548-7"></a>test <span class="ot">&lt;-</span> datos <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">281</span><span class="sc">:</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="maar-en-fable-1" class="slide level2">
<h2>MA/AR en fable</h2>
<p>Tras ello vamos a aplicar en <code>model()</code> el <strong>alisado simple y doble</strong>, y los <span class="hl-yellow"><strong>modelos AR y MA haciendo uso de la funci√≥n <code>ARIMA()</code></strong></span> (basta con indicar la media y los √≥rdenes p y q en la funci√≥n <code>pdq()</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb549"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb549-1"><a href="#cb549-1"></a>fit_arima <span class="ot">&lt;-</span> </span>
<span id="cb549-2"><a href="#cb549-2"></a>  train <span class="sc">|&gt;</span> </span>
<span id="cb549-3"><a href="#cb549-3"></a>  <span class="fu">model</span>(<span class="st">"alisado_simple"</span> <span class="ot">=</span> <span class="fu">ETS</span>(X_t <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"N"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb549-4"><a href="#cb549-4"></a>        <span class="st">"alisado_doble"</span> <span class="ot">=</span> <span class="fu">ETS</span>(X_t <span class="sc">~</span> <span class="fu">error</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">trend</span>(<span class="st">"A"</span>) <span class="sc">+</span> <span class="fu">season</span>(<span class="st">"N"</span>)),</span>
<span id="cb549-5"><a href="#cb549-5"></a>        <span class="co"># AR(1)</span></span>
<span id="cb549-6"><a href="#cb549-6"></a>        <span class="st">"AR1"</span> <span class="ot">=</span> <span class="fu">ARIMA</span>(X_t <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">pdq</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>)),</span>
<span id="cb549-7"><a href="#cb549-7"></a>        <span class="co"># AR(2)</span></span>
<span id="cb549-8"><a href="#cb549-8"></a>        <span class="st">"AR2"</span> <span class="ot">=</span> <span class="fu">ARIMA</span>(X_t <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">pdq</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>)),</span>
<span id="cb549-9"><a href="#cb549-9"></a>        <span class="co"># MA(1)</span></span>
<span id="cb549-10"><a href="#cb549-10"></a>        <span class="st">"MA1"</span> <span class="ot">=</span> <span class="fu">ARIMA</span>(X_t <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">pdq</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>)),</span>
<span id="cb549-11"><a href="#cb549-11"></a>        <span class="co"># MA(2)</span></span>
<span id="cb549-12"><a href="#cb549-12"></a>        <span class="st">"MA2"</span> <span class="ot">=</span> <span class="fu">ARIMA</span>(X_t <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">pdq</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="maar-en-fable-2" class="slide level2">
<h2>MA/AR en fable</h2>
<p>Como antes podemos usar <code>augment()</code> para las <strong>estimaciones</strong> y <code>forecast()</code> para <strong>extraer las predicciones</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb550"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb550-1"><a href="#cb550-1"></a>estimaciones <span class="ot">&lt;-</span> fit_arima <span class="sc">|&gt;</span> <span class="fu">augment</span>()</span>
<span id="cb550-2"><a href="#cb550-2"></a>predicciones <span class="ot">&lt;-</span> fit_arima <span class="sc">|&gt;</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="maar-en-fable-3" class="slide level2">
<h2>MA/AR en fable</h2>
<p>Y con <code>autoplot()</code> pintamos los modelos.</p>
<div class="cell">
<details>
<summary>C√≥digo</summary>
<div class="sourceCode cell-code" id="cb551"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb551-1"><a href="#cb551-1"></a>predicciones <span class="sc">|&gt;</span> </span>
<span id="cb551-2"><a href="#cb551-2"></a>  <span class="fu">autoplot</span>(datos, <span class="at">level =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb551-3"><a href="#cb551-3"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> estimaciones,</span>
<span id="cb551-4"><a href="#cb551-4"></a>            <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> .fitted, <span class="at">color =</span> .model), <span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb551-5"><a href="#cb551-5"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-392-1.png" width="960" class="r-stretch"></section>
<section id="maar-en-fable-4" class="slide level2">
<h2>MA/AR en fable</h2>
<p>Con <code>accuracy()</code> vamos a obtener la <span class="hl-yellow"><strong>calidad de cada modelo</strong></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb552"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb552-1"><a href="#cb552-1"></a>fit_arima <span class="sc">|&gt;</span></span>
<span id="cb552-2"><a href="#cb552-2"></a>  <span class="fu">accuracy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb552-3"><a href="#cb552-3"></a>  <span class="fu">bind_rows</span>(predicciones <span class="sc">|&gt;</span> <span class="fu">accuracy</span>(test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 √ó 10
   .model       .type       ME  RMSE   MAE    MPE  MAPE    MASE   RMSSE     ACF1
   &lt;chr&gt;        &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
 1 alisado_sim‚Ä¶ Trai‚Ä¶  4.20e-4  1.43 1.18   Inf   Inf     0.554   0.560 -0.592  
 2 alisado_dob‚Ä¶ Trai‚Ä¶ -2.86e-2  1.45 1.19  -Inf   Inf     0.558   0.567 -0.574  
 3 AR1          Trai‚Ä¶ -9.20e-2  1.15 0.938  -10.8 251.    0.439   0.452  0.263  
 4 AR2          Trai‚Ä¶ -4.96e-2  1.03 0.816   15.4 217.    0.383   0.402 -0.0236 
 5 MA1          Trai‚Ä¶ -8.63e-2  1.29 1.07    35.8 184.    0.503   0.506 -0.190  
 6 MA2          Trai‚Ä¶ -5.30e-2  1.11 0.919   50.9 163.    0.431   0.436 -0.101  
 7 AR1          Test   5.35e-1  1.37 1.11    97.6  97.6 NaN     NaN     -0.162  
 8 AR2          Test   5.29e-1  1.27 0.989  119.  122.  NaN     NaN      0.00283
 9 MA1          Test   5.41e-1  1.44 1.17    98.9  98.9 NaN     NaN     -0.239  
10 MA2          Test   5.39e-1  1.44 1.17    98.6  98.6 NaN     NaN     -0.234  
11 alisado_dob‚Ä¶ Test   6.63e-1  1.50 1.21    88.9 102.  NaN     NaN     -0.255  
12 alisado_sim‚Ä¶ Test   6.15e-1  1.47 1.20    93.7  96.7 NaN     NaN     -0.257  </code></pre>
</div>
</div>
</section>
<section id="maar-en-fable-5" class="slide level2">
<h2>MA/AR en fable</h2>
<p>Tanto en train como en test el <span class="hl-yellow"><strong>mejor modelo es el AR(2)</strong></span> (l√≥gico ya que los datos los hemos generado as√≠)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb554"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb554-1"><a href="#cb554-1"></a>fit_arima <span class="sc">|&gt;</span></span>
<span id="cb554-2"><a href="#cb554-2"></a>  <span class="fu">accuracy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb554-3"><a href="#cb554-3"></a>  <span class="fu">bind_rows</span>(predicciones <span class="sc">|&gt;</span> <span class="fu">accuracy</span>(test)) <span class="sc">|&gt;</span> </span>
<span id="cb554-4"><a href="#cb554-4"></a>  <span class="fu">slice_min</span>(RMSE,<span class="at">n =</span> <span class="dv">1</span>, <span class="at">by =</span> .type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 √ó 10
  .model .type         ME  RMSE   MAE   MPE  MAPE    MASE   RMSSE     ACF1
  &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
1 AR2    Training -0.0496  1.03 0.816  15.4  217.   0.383   0.402 -0.0236 
2 AR2    Test      0.529   1.27 0.989 119.   122. NaN     NaN      0.00283</code></pre>
</div>
</div>
</section>
<section id="maar-en-fable-6" class="slide level2">
<h2>MA/AR en fable</h2>
<p>Vamos entonces a <span class="hl-yellow"><strong>repetir el proceso solo con dicho modelo</strong></span>. Adem√°s con <code>report()</code> vamos a poder obtener las <span class="hl-yellow"><strong>estimaci√≥n de los coeficientes</strong></span> (<span class="math inline">\(-0.3198\)</span> y <span class="math inline">\(0.4557\)</span>, bastante preciso)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb556"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb556-1"><a href="#cb556-1"></a>fit_arima <span class="ot">&lt;-</span> </span>
<span id="cb556-2"><a href="#cb556-2"></a>  train <span class="sc">|&gt;</span> </span>
<span id="cb556-3"><a href="#cb556-3"></a>  <span class="fu">model</span>(<span class="st">"AR2"</span> <span class="ot">=</span> <span class="fu">ARIMA</span>(X_t <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">pdq</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>)))</span>
<span id="cb556-4"><a href="#cb556-4"></a>estimaciones <span class="ot">&lt;-</span> fit_arima <span class="sc">|&gt;</span> <span class="fu">augment</span>()</span>
<span id="cb556-5"><a href="#cb556-5"></a>predicciones <span class="ot">&lt;-</span> fit_arima <span class="sc">|&gt;</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">20</span>)</span>
<span id="cb556-6"><a href="#cb556-6"></a><span class="fu">report</span>(fit_arima)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: X_t 
Model: ARIMA(2,0,0) 

Coefficients:
          ar1     ar2
      -0.3198  0.4557
s.e.   0.0529  0.0529

sigma^2 estimated as 1.059:  log likelihood=-404.81
AIC=815.62   AICc=815.71   BIC=826.53</code></pre>
</div>
</div>
</section>
<section id="maar-en-fable-7" class="slide level2">
<h2>MA/AR en fable</h2>
<p>Tras el proceso, para asegurarnos de que aunque sea el mejor modelo lo que <span class="hl-yellow"><strong>nos queda sin explicar (residuo) sea ruido blanco</strong></span> vamos a aplicar el <strong>test de Ljung-Box</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb558"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb558-1"><a href="#cb558-1"></a><span class="co"># antes de modelizar</span></span>
<span id="cb558-2"><a href="#cb558-2"></a>datos <span class="sc">|&gt;</span> </span>
<span id="cb558-3"><a href="#cb558-3"></a>  <span class="fu">features</span>(X_t, ljung_box)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 2
  lb_stat lb_pvalue
    &lt;dbl&gt;     &lt;dbl&gt;
1    95.0         0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb560"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb560-1"><a href="#cb560-1"></a><span class="co"># despu√©s (a los errores)</span></span>
<span id="cb560-2"><a href="#cb560-2"></a>estimaciones <span class="sc">|&gt;</span> </span>
<span id="cb560-3"><a href="#cb560-3"></a>  <span class="fu">features</span>(.innov, ljung_box)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 3
  .model lb_stat lb_pvalue
  &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 AR2      0.157     0.692</code></pre>
</div>
</div>
</section>
<section id="maar-en-fable-8" class="slide level2">
<h2>MA/AR en fable</h2>
<p>Por √∫ltimo <span class="hl-yellow"><strong>visualizamos el diagn√≥stico de los residuos</strong></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb562"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb562-1"><a href="#cb562-1"></a>fit_arima <span class="sc">|&gt;</span> </span>
<span id="cb562-2"><a href="#cb562-2"></a>  <span class="fu">gg_tsresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="index_files/figure-revealjs/unnamed-chunk-397-1.png" width="960" class="r-stretch"></section></section>
<section>
<section id="clase-20" class="title-slide slide level1 center">
<h1>Clases 20: <span class="flow">procesos ARMA</span></h1>

</section>
<section id="ajuste-autom√°tico" class="slide level2">
<h2>Ajuste autom√°tico</h2>
<ul>
<li>dejar libre p y q</li>
<li>mirar acf/pcf</li>
</ul>
</section>
<section class="slide level2">

<ul>
<li>ARMA</li>
</ul>
</section></section>
<section>
<section id="clase-21" class="title-slide slide level1 center">
<h1>Clases 21: <span class="flow">procesos ARIMA</span></h1>
<ul>
<li>Box-Cox para ARIMA</li>
</ul>
</section>
<section class="slide level2">

</section></section>
<section id="clase-22" class="title-slide slide level1 center">
<h1>Clases 22: <span class="flow">procesos SARIMA</span></h1>
<div class="footer footer-default">
<p><a href="..."><strong>Javier √Ålvarez Li√©bana</strong></a> ‚Ä¢ Grado en Estad√≠stica Aplicada (UCM)</p>
</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="index_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="index_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="index_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="index_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="index_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="index_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true,"width":"normal"},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>